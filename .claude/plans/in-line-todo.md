# HBC Project Controls – Stage 19 Development TODO List
**Internal Development Plan for Non-Disruptive Excel Deep Bid Import Engine**  
**Date generated:** 28 February 2026  
**Governing plan:** Internal Development Plan for Non-Disruptive Excel Deep Bid Import Engine (Stage 19) + Kick-Off & Post Bid Autopsy extensions

**Verified latest commit on the `hb-suite-stabilization` branch:**  
`0f4147f7c9c8d9510d350f058f0beb93746f0edb`

**Reference templates (stored in repo root):**  
- Project Kick-Off: `reference/Estimating Kickoff Template.xlsx`  
- Post Bid Autopsy: `reference/Estimating - Post Bid Autopsy.xlsx`

## Complete TODO Table (27 items)

| FILE | LINE | DESCRIPTION |
|------|------|-------------|
| packages/hbc-sp-services/src/models/IEstimatingTracker.ts | 142 | // TODO (Stage 19 – Sub-task 1): Immediately after the existing deep-bid TODO cluster, add the new interfaces exactly as defined in the plan: IDeepBidPackage, IEstimateSummary (single primary), IGCGRScenario (single primary), IDeepBidRawCapture (full multi-worksheet parse tree). Use additive-only extension; preserve IExportable pattern and all existing IEstimatingTracker consumers. Ensure TypeScript compiles with zero breaking changes. Reference: plan deliverables & technical approach for model extension. |
| packages/hbc-sp-services/src/services/ExcelDeepBidImportService.ts | 1 | // TODO (Stage 19 – Sub-task 2): Create this new file (mirror SharePointDataService.ts contract). Implement full ExcelDeepBidImportService class using exceljs to read ALL worksheets, detect CSI/merged-scope signatures, “DetailsTier”, labor-rate tables. Normalize to exactly one primary Cost Summary (highest grand-total or flagged) and one primary GC&GR (best duration match). Persist raw multi-version tree + original file. Support Hilltop R2.xlsx and Wellington R2.1-BF.xlsx as golden tests. Commit only after both files parse correctly to single primary + full raw tree. |
| src/webparts/hbcProjectControls/components/pages/department-tracking/DepartmentTrackingPage.tsx | 285 | // TODO (Stage 19 – Sub-task 3): In the Estimating tab (after existing attachment controls), add “Attach Full Estimate Workbook” button + progress toast using existing HbcFileUpload and optimistic TanStack Query mutation pattern. On success, call ExcelDeepBidImportService and invalidate relevant queries. Gate behind DeepBidImportEnabled flag. Reference: plan UI upload deliverable and reuse of current attachment flow. |
| src/webparts/hbcProjectControls/components/pages/department-tracking/DepartmentTrackingPage.tsx | 420 | // TODO (Stage 19 – Sub-task 4): Extend the existing SlideDrawer (Meeting Review Mode pattern) with new “Deep Bid Review” pane. If multiple versions detected, render side-by-side comparison of parsed summaries/GC&GRs; allow estimator to confirm/override primary selection. Persist choice via TanStack Query. Reference: plan review & selection UI deliverable. |
| src/webparts/hbcProjectControls/components/pages/department-tracking/DepartmentTrackingPage.tsx | 680 | // TODO (Stage 19 – Sub-task 5): In KPI cards, HbcDataTable (inline-editable), and Meeting Review Mode, auto-populate primary summary/GC&GR values from the normalized IEstimateSummary/IGCGRScenario. Use existing useQueryScope and query-key patterns with optimistic updates. Data must render identically to current mock data once imported. Reference: plan integration deliverable. |
| packages/hbc-sp-services/src/featureFlags.json | 45 | // TODO (Stage 19 – Sub-task 6): Add DeepBidImportEnabled: false (and any role-specific sub-flags). Update AppContext and PermissionGate usage in Estimating tab to respect the 14-role/70+ permission matrix (Estimator roles only). Reference: plan feature-flag & permission gating deliverable. |
| packages/hbc-sp-services/src/services/ExcelDeepBidImportService.test.ts | 1 | // TODO (Stage 19 – Sub-task 7): Create Jest test suite (mirror existing service tests). Include unit tests for parser on attached Hilltop R2.xlsx and Wellington R2.1-BF.xlsx achieving 100% coverage of normalization logic. Reference: plan unit & integration tests deliverable. |
| playwright/tests/estimating/deep-bid-import.spec.ts | 1 | // TODO (Stage 19 – Sub-task 7 cont.): Create Playwright E2E covering full upload → review → persist flow. Reference: plan unit & integration tests deliverable. |
| packages/hbc-sp-services/src/services/ExcelDeepBidImportService.ts | 320 | // TODO (Stage 19 – Sub-task 8): Add per-section confidence scoring (e.g., 98% for Hilltop scopes); fallback to manual mapping UI if <90%. Always store raw file. Extend AuditService logging. Reference: plan error handling, confidence scoring & fallback deliverable. |
| packages/hbc-sp-services/src/models/IProjectHandoffPayload.ts | 95 | // TODO (Stage 19 – Sub-task 9): Extend IProjectHandoffPayload with deepBidPackage (single primary + raw file link). Update “Mark as Awarded” flow to carry complete normalized package to Project Hub (ties directly to existing handoff TODOs in ProjectHubDashboardPage.tsx). Reference: plan handoff payload update deliverable. |
| src/webparts/hbcProjectControls/components/pages/project-hub/ProjectHubDashboardPage.tsx | 78 | // TODO (Stage 19 – Sub-task 9 cont.): Consume new deepBidPackage in KPI cards and handoff alerts (builds on existing Stage-18 handoff instrumentation). Reference: plan handoff integration. |
| src/webparts/hbcProjectControls/components/pages/department-tracking/DepartmentTrackingPage.tsx | 950 | // TODO (Stage 19 – Sub-task 10): Wrap import flow in React 18 useTransition; ensure TanStack Query caching prevents impact on lazy-loaded routes. Validate <8 s parse time on 5 MB+ workbooks. Reference: plan performance & scale testing deliverable. |
| CHANGELOG.md | 120 | // TODO (Stage 19 – Sub-task 11): Add detailed entry under Stage 19 describing the non-disruptive Excel import engine, primary-selection logic, supported workbooks, and handoff benefits. Reference: plan CHANGELOG entry deliverable. |
| docs/deep-bid-import-guide.md | 1 | // TODO (Stage 19 – Sub-task 14): Create this new markdown file (never any agent context files). Include setup, usage, primary-selection algorithm, Hilltop/Wellington screenshots, rollback to pure-Excel, and maintenance notes. Update README.md with one-line reference. Reference: plan mandatory documentation update (final sub-task). |
| packages/hbc-sp-services/src/models/IProjectHandoffPayload.ts | 110 | // TODO (Stage 19 – Sub-task 15): Extend `deepBidPackage` with turnoverAgendaPopulation object (primaryCostSummaryMapping, primaryGCGRMapping, rawFileLinkForAudit, attribution). Ensure the handoff carries all fields required to auto-populate Turnover agenda sections without data loss or manual re-entry. Reference new Sub-task 15 added 28 February 2026. |
| src/webparts/hbcProjectControls/components/pages/closeout/PHProjectTurnoverPage.tsx | 12 | // TODO (Stage 19 – Sub-task 15): Update the Stage 19 header comment to reference full plan (including Sub-task 15 deep-bid population). Add import for `IDeepBidPackage` and `DeepBidImportEnabled` flag from `@hbc/sp-services`. Reference the provided local source and plan deliverable for Turnover agenda population. |
| src/webparts/hbcProjectControls/components/pages/closeout/PHProjectTurnoverPage.tsx | 292 | // TODO (Stage 19 – Sub-task 15): Immediately after the `agendaQuery`, add a second TanStack Query `deepBidQuery` (key: qk.deepBid.byProject(scope, projectCode)) that fetches the project's deepBidPackage when present. Use `enabled: !!projectCode && DeepBidImportEnabled`. Merge into local `agenda` state via useMemo so estimateOverview, exhibits (Cost Summary), risks/lead-times/buyouts sections can prefer deep-bid values. Reference plan technical approach and existing useQueryScope pattern. |
| src/webparts/hbcProjectControls/components/pages/closeout/PHProjectTurnoverPage.tsx | 655 | // TODO (Stage 19 – Sub-task 15): In the 'estimate-overview' case (and any other relevant sections: risks, lead-times, buyouts, exhibits), prefer values from `agenda.deepBidPackage?.primaryEstimateSummary` and `primaryGCGRScenario` when available. Render attribution badge "Populated from Deep Bid Import – [originalFilename]" with raw-file download link (using existing ExportService pattern). Fall back to legacy agenda.estimateOverview for projects without deep-bid data. Gate behind feature flag. Ensure optimistic mutations still work. Reference provided source lines 620–680 and plan success criteria. |
| src/webparts/hbcProjectControls/components/pages/closeout/PHProjectTurnoverPage.tsx | 385 | // TODO (Stage 19 – Sub-task 15): In the sign-off useEffect (handoffMutation payload construction), include the full `deepBidPackage` (or turnoverAgendaPopulation subset) from the merged agenda state. Update the handoff to Operations to carry complete normalized data. Reference provided source lines 370–410 and Sub-task 9 handoff extension. |
| packages/hbc-sp-services/src/models/IEstimatingTracker.ts | 180 | // TODO (Stage 19 – Sub-task 16): Immediately after deep-bid interfaces, add `IKickOffSection`, `IKickOffField` (with type: text/yesno/responsible/deadline/notes, editable, removable), `IKickOffTemplate` mirroring **every row/section from reference/Estimating Kickoff Template.xlsx**. Support dynamic addition of custom fields per section. Preserve all existing models. Reference new Sub-tasks 16–21 added 28 February 2026. |
| packages/hbc-sp-services/src/services/KickOffService.ts | 1 | // TODO (Stage 19 – Sub-task 17): Create new service (mirror ExcelDeepBidImportService.ts). Provide CRUD for dynamic kick-off data, import-from-template validation, and optimistic persistence. Support 100% field coverage from **reference/Estimating Kickoff Template.xlsx**. |
| src/webparts/hbcProjectControls/components/pages/department-tracking/DepartmentTrackingPage.tsx | 320 | // TODO (Stage 19 – Sub-task 18): In Estimating tab (Project Details panel), replace/extend static fields with dynamic `KickOffSection` renderer. Each section must support inline edit, field removal, “+ Add custom field” button. Reference **reference/Estimating Kickoff Template.xlsx** for 100% field fidelity and existing HbcDataTable patterns. |
| src/webparts/hbcProjectControls/components/pages/project-hub/ProjectKickOffPage.tsx | 1 | // TODO (Stage 19 – Sub-task 19): Create this new file (mirror PHProjectTurnoverPage.tsx). Render every section/field from **reference/Estimating Kickoff Template.xlsx** as editable cards/grids. Support add/edit/remove fields. Reference new Sub-tasks 16–21. |
| src/webparts/hbcProjectControls/components/pages/project-hub/ProjectKickOffPage.tsx | 450 | // TODO (Stage 19 – Sub-task 20): Implement full dynamic field management. Ensure YES/NO toggles, responsible dropdowns, deadline pickers, and notes fields match **reference/Estimating Kickoff Template.xlsx** exactly. Include “Import from Excel Template” button. |
| docs/project-kickoff-guide.md | 1 | // TODO (Stage 19 – Sub-task 21): Create new markdown. Include screenshots of **reference/Estimating Kickoff Template.xlsx** vs UI, dynamic field management, and 100% template coverage. Update README.md and deep-bid-import-guide.md with cross-reference. |
| packages/hbc-sp-services/src/models/IEstimatingTracker.ts | 220 | // TODO (Stage 19 – Sub-task 22): Immediately after Kick-Off interfaces, add `IPostBidAutopsySection`, `IPostBidAutopsyField` (supporting Yes/No, rating 1-10, open discussion, strengths/weaknesses lists, employee list, etc.) mirroring **every row/section from reference/Estimating - Post Bid Autopsy.xlsx**. Support dynamic addition/removal of custom fields per section. Reference new Sub-tasks 22–27 added 28 February 2026. |
| packages/hbc-sp-services/src/services/PostBidAutopsyService.ts | 1 | // TODO (Stage 19 – Sub-task 23): Create new service (mirror KickOffService.ts). Provide full CRUD, template import validation, and optimistic persistence for 100% coverage of **reference/Estimating - Post Bid Autopsy.xlsx** structure. |
| src/webparts/hbcProjectControls/components/pages/department-tracking/DepartmentTrackingPage.tsx | 380 | // TODO (Stage 19 – Sub-task 24): In Estimating tab (Project Details panel, after Kick-Off section), add dynamic `PostBidAutopsySection` renderer with inline edit, field removal, and “+ Add custom field”. Reference **reference/Estimating - Post Bid Autopsy.xlsx** for 100% field fidelity. |
| src/webparts/hbcProjectControls/components/pages/project-hub/PostBidAutopsyPage.tsx | 1 | // TODO (Stage 19 – Sub-task 25): Create this new file (exact mirror of PHProjectTurnoverPage.tsx and ProjectKickOffPage.tsx). Render every section/field from **reference/Estimating - Post Bid Autopsy.xlsx** as editable, collaborative cards/grids. Reference new Sub-tasks 22–27. |
| src/webparts/hbcProjectControls/components/pages/project-hub/PostBidAutopsyPage.tsx | 480 | // TODO (Stage 19 – Sub-task 26): Implement full dynamic field management. Support Yes/No toggles, 1-10 ratings, open-discussion threads, strengths/weaknesses lists, employee list, and “Import from Autopsy Template” button. Reference **reference/Estimating - Post Bid Autopsy.xlsx** rows 3–45 exactly. |
| docs/project-post-bid-autopsy-guide.md | 1 | // TODO (Stage 19 – Sub-task 27): Create new markdown. Include screenshots of **reference/Estimating - Post Bid Autopsy.xlsx** vs UI, dynamic field management, and 100% template fidelity. Update README.md, deep-bid-import-guide.md, and project-kickoff-guide.md with cross-references. |

**Instructions for Code Agent**  
- Work exclusively on the live codebase at commit `0f4147f7c9c8d9510d350f058f0beb93746f0edb`.  
- Begin every session by listing the exact files you are considering and why they are sufficient.  
- Never reference, create, or mention any repository-level context files (`.claude/`, AGENTS.md, etc.).  
- If anything outside the defined scope is needed, state it clearly and ask for clarification.  
- All changes must align with existing TanStack Query, Fluent UI v9, React 18, and 14-role/70+ permission patterns.

---

**End of Stage 19 TODO List**  
Ready for immediate implementation in Claude Code.