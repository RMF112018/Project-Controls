/*! For license information please see 539.51130bc4.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkhbc_project_controls=self.webpackChunkhbc_project_controls||[]).push([[539],{"./node_modules/@microsoft/applicationinsights-web/dist-es5/applicationinsights-web.js"(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{ApplicationInsights:()=>AppInsightsSku});var process=__webpack_require__("./node_modules/process/browser.js");function _pureAssign(func1,func2){return func1||func2}function _pureRef(value,name){return value[name]}var _primitiveTypes,LENGTH="length",CALL="call",ObjClass=_pureAssign(Object),ObjProto=_pureRef(ObjClass,"prototype"),StrCls=_pureAssign(String),StrProto=_pureRef(StrCls,"prototype"),MathCls=_pureAssign(Math),ArrCls=_pureAssign(Array),ArrProto=_pureRef(ArrCls,"prototype"),ArrSlice=_pureRef(ArrProto,"slice");function safe(func,argArray){try{return{v:func.apply(this,argArray)}}catch(e){return{e}}}function _createIs(theType){return function(value){return typeof value===theType}}function _createObjIs(theName){var theType="[object "+theName+"]";return function(value){return!(!value||objToString(value)!==theType)}}function objToString(value){return ObjProto.toString.call(value)}function isUndefined(value){return void 0===value||"undefined"===value}function isNullOrUndefined(value){return null===value||isUndefined(value)}function isStrictNullOrUndefined(value){return null==value}function isDefined(arg){return!!arg||void 0!==arg}function isPrimitiveType(theType){return!_primitiveTypes&&(_primitiveTypes=["string","number","boolean","undefined","symbol","bigint"]),!("object"===theType||-1===_primitiveTypes.indexOf(theType))}var isString=_createIs("string"),isFunction=_createIs("function");function isObject(value){return!(!value&&isNullOrUndefined(value))&&(!!value&&"object"==typeof value)}var isArray=_pureRef(ArrCls,"isArray"),isDate=_createObjIs("Date"),isNumber=_createIs("number"),isBoolean=_createIs("boolean"),isError=_createObjIs("Error");function isPromiseLike(value){return!!(value&&value.then&&isFunction(value.then))}function isTruthy(value){return!(!value||function safeGet(cb,defValue,argArray){var result=safe(cb,argArray);return result.e?defValue:result.v}(function(){return!(value&&0+value)},!value))}function _returnNothing(){}function _returnFalse(){return!1}var asString=_pureAssign(StrCls);function dumpObj(object,format){var propertyValueDump="",objType=ObjProto.toString[CALL](object);"[object Error]"===objType&&(object={stack:asString(object.stack),message:asString(object.message),name:asString(object.name)});try{propertyValueDump=((propertyValueDump=JSON.stringify(object,null,format?"number"==typeof format?format:4:void 0))?propertyValueDump.replace(/"(\w+)"\s*:\s{0,1}/g,"$1: "):null)||asString(object)}catch(e){propertyValueDump=" - "+dumpObj(e,format)}return objType+": "+propertyValueDump}function throwError(message){throw new Error(message)}function throwTypeError(message){throw new TypeError(message)}function _throwIfNullOrUndefined(obj){isStrictNullOrUndefined(obj)&&throwTypeError("Cannot convert undefined or null to object")}function _throwIfNotString(value){isString(value)||throwTypeError("'"+dumpObj(value)+"' is not a string")}function objHasOwnProperty(obj,prop){return!!obj&&ObjProto.hasOwnProperty[CALL](obj,prop)}var _objGetOwnPropertyDescriptor$2=_pureAssign(_pureRef(ObjClass,"getOwnPropertyDescriptor"),_returnNothing),objHasOwn=_pureAssign(_pureRef(ObjClass,"hasOwn"),polyObjHasOwn);function polyObjHasOwn(obj,prop){return _throwIfNullOrUndefined(obj),objHasOwnProperty(obj,prop)||!!_objGetOwnPropertyDescriptor$2(obj,prop)}function objForEachKey(theObject,callbackfn,thisArg){if(theObject&&(isObject(theObject)||isFunction(theObject)))for(var prop in theObject)if(objHasOwn(theObject,prop)&&-1===callbackfn[CALL](thisArg||theObject,prop,theObject[prop]))break}function arrForEach(theArray,callbackfn,thisArg){if(theArray)for(var len=theArray[LENGTH]>>>0,idx=0;idx<len&&(!(idx in theArray)||-1!==callbackfn[CALL](thisArg||theArray,theArray[idx],idx,theArray));idx++);}var _unwrapFunction=_unwrapFunctionWithPoly;function _unwrapFunctionWithPoly(funcName,clsProto,polyFunc){var clsFn=clsProto?clsProto[funcName]:null;return function(thisArg){var theFunc=(thisArg?thisArg[funcName]:null)||clsFn;if(theFunc||polyFunc){var theArgs=arguments;return(theFunc||polyFunc).apply(thisArg,theFunc?ArrSlice[CALL](theArgs,1):theArgs)}throwTypeError('"'+asString(funcName)+'" not defined for '+dumpObj(thisArg))}}function _unwrapProp(propName){return function(thisArg){return thisArg[propName]}}var _objGetOwnPropertyDescriptor$1=_pureAssign(_pureRef(ObjClass,"getOwnPropertyDescriptor"),_returnNothing),propMap={e:"enumerable",c:"configurable",v:"value",w:"writable",g:"get",s:"set"};function _createProp(value){var prop={};if(prop[propMap.c]=!0,prop[propMap.e]=!0,value.l){prop.get=function(){return value.l.v};var desc=_objGetOwnPropertyDescriptor$1(value.l,"v");desc&&desc.set&&(prop.set=function(newValue){value.l.v=newValue})}return objForEachKey(value,function(key,value){prop[propMap[key]]=function isStrictUndefined(arg){return void 0===arg}(value)?prop[propMap[key]]:value}),prop}var objDefineProp=_pureRef(ObjClass,"defineProperty"),objDefineProperties=_pureRef(ObjClass,"defineProperties");function objDefine(target,key,propDesc){return objDefineProp(target,key,_createProp(propDesc))}function _createKeyValueMap(values,keyType,valueType,completeFn,writable){var theMap={};return objForEachKey(values,function(key,value){_assignMapValue(theMap,key,keyType?value:key),_assignMapValue(theMap,value,valueType?value:key)}),completeFn?completeFn(theMap):theMap}function _assignMapValue(theMap,key,value,writable){objDefineProp(theMap,key,{value,enumerable:!0,writable:!1})}var objIsFrozen=_pureAssign(_pureRef(ObjClass,"isFrozen"),_returnFalse),_objFreeze=_pureRef(ObjClass,"freeze");function _doNothing(value){return value}function _getProto(value){return _throwIfNullOrUndefined(value),value.__proto__||null}var objAssign=_pureRef(ObjClass,"assign"),objKeys=_pureRef(ObjClass,"keys");function _deepFreeze(val,visited){if((isArray(val)||isObject(val)||isFunction(val))&&!objIsFrozen(val)){for(var lp=0;lp<visited.length;lp++)if(visited[lp]===val)return val;visited.push(val),objForEachKey(val,function(_key,propValue){_deepFreeze(propValue,visited)}),objFreeze(val)}return val}function objDeepFreeze(value){return _objFreeze?_deepFreeze(value,[]):value}var objFreeze=_pureAssign(_objFreeze,_doNothing),objGetPrototypeOf=_pureAssign(_pureRef(ObjClass,"getPrototypeOf"),_getProto);function createEnumKeyMap(values){return _createKeyValueMap(values,0,0,objFreeze)}var _globalCfg,_wellKnownSymbolMap=createEnumKeyMap({asyncIterator:0,hasInstance:1,isConcatSpreadable:2,iterator:3,match:4,matchAll:5,replace:6,search:7,species:8,split:9,toPrimitive:10,toStringTag:11,unscopables:12});function _getGlobalValue(){var result;return"undefined"!=typeof globalThis&&(result=globalThis),result||"undefined"==typeof self||(result=self),result||"undefined"==typeof window||(result=window),result||void 0===__webpack_require__.g||(result=__webpack_require__.g),result}function _getGlobalConfig(){if(!_globalCfg){var gbl=safe(_getGlobalValue).v||{};_globalCfg=gbl.__tsUtils$gblCfg=gbl.__tsUtils$gblCfg||{}}return _globalCfg}var mathMin=_pureRef(MathCls,"min"),mathMax=_pureRef(MathCls,"max"),strSlice=_unwrapFunction("slice",StrProto),strSubstring=_unwrapFunction("substring",StrProto),strSubstr=_unwrapFunctionWithPoly("substr",StrProto,polyStrSubstr);function polyStrSubstr(value,start,length){return _throwIfNullOrUndefined(value),length<0?"":((start=start||0)<0&&(start=mathMax(start+value[LENGTH],0)),isUndefined(length)?strSlice(value,start):strSlice(value,start,start+length))}function strLeft(value,count){return strSubstring(value,0,count)}var _globalLazyTestHooks,objCreate=_pureAssign(_pureRef(ObjClass,"create"),polyObjCreate);function polyObjCreate(obj,properties){var newObj=null;function tempFunc(){}if(isStrictNullOrUndefined(obj))newObj={};else{var type=typeof obj;"object"!==type&&"function"!==type&&throwTypeError("Prototype must be an Object or function: "+dumpObj(obj)),tempFunc.prototype=obj,safe(function(){tempFunc.__proto__=obj}),newObj=new tempFunc}return properties&&safe(objDefineProperties,[newObj,properties]),newObj}function utcNow(){return(Date.now||polyUtcNow)()}function polyUtcNow(){return(new Date).getTime()}function fnApply(fn,thisArg,argArray){return fn.apply(thisArg,argArray)}function _initTestHooks(){_globalLazyTestHooks=_getGlobalConfig()}function getLazy(cb,argArray){var lazyValue={};return!_globalLazyTestHooks&&_initTestHooks(),lazyValue.b=_globalLazyTestHooks.lzy,objDefineProp(lazyValue,"v",{configurable:!0,get:function(){var result=fnApply(cb,null,argArray);return _globalLazyTestHooks.lzy||objDefineProp(lazyValue,"v",{value:result}),lazyValue.b=_globalLazyTestHooks.lzy,result}}),lazyValue}var _polySymbols,_wellKnownSymbolCache,mathRandom=_pureRef(MathCls,"random"),_uniqueInstanceId=getLazy(function(){for(var value=utcNow().toString(36).slice(2);value.length<16;)value+=mathRandom().toString(36).slice(2);return value=value.substring(0,16)}),_polyId=0;function _globalSymbolRegistry(){if(!_polySymbols){var gblCfg=_getGlobalConfig();_polySymbols=gblCfg.gblSym=gblCfg.gblSym||{k:{},s:{}}}return _polySymbols}function polyNewSymbol(description){var uniqueId="_"+_polyId+++"_"+_uniqueInstanceId.v,symString="Symbol("+description+")";function _setProp(name,value){objDefine(theSymbol,name,{v:value,e:!1,w:!1})}var theSymbol=objCreate(null);return _setProp("description",asString(description)),_setProp("toString",function(){return symString+"$nw21sym"+uniqueId}),_setProp("valueOf",function(){return theSymbol}),_setProp("v",symString),_setProp("_uid",uniqueId),function _tagAsPolyfill(target,polyfillTypeName){return target&&(safe(function(){target._polyfill=!0,target.__nw21$polytype__=polyfillTypeName}),safe(objDefine,[target,"_polyfill",{v:!0,w:!1,e:!1}]),safe(objDefine,[target,"__nw21$polytype__",{v:polyfillTypeName,w:!1,e:!1}])),target}(theSymbol,"symbol")}function polySymbolFor(key){var registry=_globalSymbolRegistry();if(!objHasOwn(registry.k,key)){var newSymbol_1=polyNewSymbol(key),regId_1=objKeys(registry.s).length;newSymbol_1._urid=function(){return regId_1+"_"+newSymbol_1.toString()},registry.k[key]=newSymbol_1,registry.s[newSymbol_1._urid()]=asString(key)}return registry.k[key]}function createCachedValue(value){return objDefineProp({toJSON:function(){return value}},"v",{value})}var _cachedGlobal;function _getGlobalInstFn(getFn,theArgs){var cachedValue;return function(){return!_globalLazyTestHooks&&_initTestHooks(),cachedValue&&!_globalLazyTestHooks.lzy||(cachedValue=createCachedValue(safe(getFn,theArgs).v)),cachedValue.v}}function getGlobal(useCached){return!_globalLazyTestHooks&&_initTestHooks(),_cachedGlobal&&!1!==useCached&&!_globalLazyTestHooks.lzy||(_cachedGlobal=createCachedValue(safe(_getGlobalValue).v||null)),_cachedGlobal.v}function getInst(name,useCached){var gbl;if((gbl=_cachedGlobal&&!1!==useCached?_cachedGlobal.v:getGlobal(useCached))&&gbl[name])return gbl[name];if("window"===name)try{return window}catch(e){}return null}function hasDocument(){return!!getDocument()}var getDocument=_getGlobalInstFn(getInst,["document"]);function hasWindow(){return!!getWindow()}var getWindow=_getGlobalInstFn(getInst,["window"]);var getNavigator=_getGlobalInstFn(getInst,["navigator"]);var _symbol,_symbolFor,getHistory=_getGlobalInstFn(getInst,["history"]),isNode=_getGlobalInstFn(function(){return!!safe(function(){return process&&(process.versions||{}).node}).v}),isWebWorker=_getGlobalInstFn(function(){return!!safe(function(){return self&&self instanceof WorkerGlobalScope}).v});function _initSymbol(){return _symbol=createCachedValue(safe(getInst,["Symbol"]).v)}function _getSymbolKey(key){var gblSym=(_globalLazyTestHooks.lzy?0:_symbol)||_initSymbol();return gblSym.v?gblSym.v[key]:void 0}var _iterSymbol$1;function hasSymbol(){return!!getSymbol()}function getSymbol(){return!_globalLazyTestHooks&&_initTestHooks(),((_globalLazyTestHooks.lzy?0:_symbol)||_initSymbol()).v}function getKnownSymbol(name,noPoly){var knownName=_wellKnownSymbolMap[name];!_globalLazyTestHooks&&_initTestHooks();var sym=(_globalLazyTestHooks.lzy?0:_symbol)||_initSymbol();return sym.v?sym.v[knownName||name]:noPoly?void 0:function polyGetKnownSymbol(name){var result;!_wellKnownSymbolCache&&(_wellKnownSymbolCache={});var knownName=_wellKnownSymbolMap[name];return knownName&&(result=_wellKnownSymbolCache[knownName]=_wellKnownSymbolCache[knownName]||polyNewSymbol("Symbol."+knownName)),result}(name)}function newSymbol(description,noPoly){!_globalLazyTestHooks&&_initTestHooks();var sym=(_globalLazyTestHooks.lzy?0:_symbol)||_initSymbol();return sym.v?sym.v(description):noPoly?null:polyNewSymbol(description)}function symbolFor(key){return!_globalLazyTestHooks&&_initTestHooks(),((_symbolFor=(_globalLazyTestHooks.lzy?0:_symbolFor)||createCachedValue(safe(_getSymbolKey,["for"]).v)).v||polySymbolFor)(key)}function isIterator(value){return!!value&&isFunction(value.next)}function isIterable(value){return!isStrictNullOrUndefined(value)&&isFunction(value[getKnownSymbol(3)])}function iterForOf(iter,callbackfn,thisArg){if(iter&&(isIterator(iter)||(!_iterSymbol$1&&(_iterSymbol$1=createCachedValue(getKnownSymbol(3))),iter=iter[_iterSymbol$1.v]?iter[_iterSymbol$1.v]():null),isIterator(iter))){var err=void 0,iterResult=void 0;try{for(var count=0;!(iterResult=iter.next()).done&&-1!==callbackfn[CALL](thisArg||iter,iterResult.value,count,iter);)count++}catch(failed){err={e:failed},iter.throw&&(iterResult=null,iter.throw(err))}finally{try{iterResult&&!iterResult.done&&iter.return&&iter.return(iterResult)}finally{if(err)throw err.e}}}}function arrAppend(target,elms){return!isUndefined(elms)&&target&&(isArray(elms)?fnApply(target.push,target,elms):isIterator(elms)||isIterable(elms)?iterForOf(elms,function(elm){target.push(elm)}):target.push(elms)),target}var arrIndexOf=_unwrapFunction("indexOf",ArrProto),arrMap=_unwrapFunction("map",ArrProto);function arrSlice(theArray,start,end){return((theArray?theArray.slice:null)||ArrSlice).apply(theArray,ArrSlice[CALL](arguments,1))}var _isProtoArray,arrReduce=_unwrapFunction("reduce",ArrProto);var _unsupportedError,objSetPrototypeOf=_pureAssign(_pureRef(ObjClass,"setPrototypeOf"),_polyObjSetPrototypeOf);function _polyObjSetPrototypeOf(obj,proto){var _a;return!_isProtoArray&&(_isProtoArray=createCachedValue(((_a={}).__proto__=[],_a instanceof Array))),_isProtoArray.v?obj.__proto__=proto:objForEachKey(proto,function(key,value){return obj[key]=value}),obj}function _setName(baseClass,name){name&&(baseClass.name=name)}function createCustomError(name,constructCb,errorBase){var theBaseClass=errorBase||Error,orgName=theBaseClass.prototype.name,captureFn=Error.captureStackTrace;return function _createCustomError(name,d,b){function __(){this.constructor=d,safe(objDefine,[this,"name",{v:name,c:!0,e:!1}])}return safe(objDefine,[d,"name",{v:name,c:!0,e:!1}]),(d=objSetPrototypeOf(d,b)).prototype=null===b?objCreate(b):(__.prototype=b.prototype,new __),d}(name,function(){var theArgs=arguments;try{safe(_setName,[theBaseClass,name]);var _self=fnApply(theBaseClass,this,ArrSlice[CALL](theArgs))||this;if(_self!==this){var orgProto=objGetPrototypeOf(this);orgProto!==objGetPrototypeOf(_self)&&objSetPrototypeOf(_self,orgProto)}return captureFn&&captureFn(_self,this.constructor),constructCb&&constructCb(_self,theArgs),_self}finally{safe(_setName,[theBaseClass,orgName])}},theBaseClass)}function _createTrimFn(exp){return function _doTrim(value){return _throwIfNullOrUndefined(value),value&&value.replace&&(value=value.replace(exp,"")),value}}var strTrim=_unwrapFunctionWithPoly("trim",StrProto,_createTrimFn(/^\s+|(?=\s)\s+$/g));var mathFloor=_pureRef(MathCls,"floor");var _fnToString,_objCtrFnString,_gblWindow;function isPlainObject(value){if(!value||"object"!=typeof value)return!1;_gblWindow||(_gblWindow=!hasWindow()||getWindow());var result=!1;if(value!==_gblWindow){_objCtrFnString||(_fnToString=Function.prototype.toString,_objCtrFnString=_fnToString[CALL](ObjClass));try{var proto=objGetPrototypeOf(value);(result=!proto)||(objHasOwnProperty(proto,"constructor")&&(proto=proto.constructor),result=!(!proto||"function"!=typeof proto||_fnToString[CALL](proto)!==_objCtrFnString))}catch(ex){}}return result}function _defaultDeepCopyHandler(details){return details.value&&plainObjDeepCopyHandler(details),!0}var defaultDeepCopyHandlers=[function arrayDeepCopyHandler(details){var value=details.value;if(isArray(value)){var target=details.result=[];return target.length=value.length,details.copyTo(target,value),!0}return!1},plainObjDeepCopyHandler,function functionDeepCopyHandler(details){if("function"===details.type)return!0;return!1},function dateDeepCopyHandler(details){var value=details.value;if(isDate(value))return details.result=new Date(value.getTime()),!0;return!1}];function _deepCopy(visitMap,value,ctx,key){var userHandler=ctx.handler,newPath=ctx.path?key?ctx.path.concat(key):ctx.path:[],newCtx={handler:ctx.handler,src:ctx.src,path:newPath},theType=typeof value,isPlain=!1,isPrim=null===value;isPrim||(value&&"object"===theType?isPlain=isPlainObject(value):isPrim=isPrimitiveType(theType));var details={type:theType,isPrim,isPlain,value,result:value,path:newPath,origin:ctx.src,copy:function(source,newKey){return _deepCopy(visitMap,source,newKey?newCtx:ctx,newKey)},copyTo:function(target,source){return _copyProps(visitMap,target,source,newCtx)}};return details.isPrim?userHandler&&userHandler[CALL](ctx,details)?details.result:value:function _getSetVisited(visitMap,source,newPath,cb){var theEntry;return arrForEach(visitMap,function(entry){if(entry.k===source)return theEntry=entry,-1}),theEntry||(theEntry={k:source,v:source},visitMap.push(theEntry),cb(theEntry)),theEntry.v}(visitMap,value,0,function(newEntry){objDefine(details,"result",{g:function(){return newEntry.v},s:function(newValue){newEntry.v=newValue}});for(var idx=0,handler=userHandler;!(handler||(idx<defaultDeepCopyHandlers.length?defaultDeepCopyHandlers[idx++]:_defaultDeepCopyHandler))[CALL](ctx,details);)handler=null})}function _copyProps(visitMap,target,source,ctx){if(!isNullOrUndefined(source))for(var key in source)target[key]=_deepCopy(visitMap,source[key],ctx,key);return target}function plainObjDeepCopyHandler(details){var value=details.value;if(value&&details.isPlain){var target=details.result={};return details.copyTo(target,value),!0}return!1}function _doExtend(target,theArgs){return arrForEach(theArgs,function(theArg){!function objCopyProps(target,source,handler){return _copyProps([],target,source,{handler,src:source,path:[]})}(target,theArg)}),target}function deepExtend(target,obj1,obj2,obj3,obj4,obj5,obj6){return _doExtend(function objDeepCopy(source,handler){return _deepCopy([],source,{handler,src:source})}(target)||{},ArrSlice[CALL](arguments))}var strSplit=_unwrapFunction("split",StrProto);function setValueByKey(target,path,value){if(target&&path){var parts=strSplit(path,"."),lastKey=parts.pop();arrForEach(parts,function(key){isNullOrUndefined(target[key])&&(target[key]={}),target=target[key]}),target[lastKey]=value}}var getLength=_unwrapProp(LENGTH);var _perf;function getPerformance(){return!_globalLazyTestHooks&&_initTestHooks(),_perf&&!_globalLazyTestHooks.lzy||(_perf=createCachedValue(safe(getInst,["performance"]).v)),_perf.v}var mathRound=_pureRef(MathCls,"round");var objGetOwnPropertyDescriptor=_pureAssign(_pureRef(ObjClass,"getOwnPropertyDescriptor"),_returnNothing);var strEndsWith=_unwrapFunctionWithPoly("endsWith",StrProto,polyStrEndsWith);function polyStrEndsWith(value,searchString,length){_throwIfNotString(value);var searchValue=isString(searchString)?searchString:asString(searchString),end=!isUndefined(length)&&length<value[LENGTH]?length:value[LENGTH];return strSubstring(value,end-searchValue[LENGTH],end)===searchValue}var strIndexOf=_unwrapFunction("indexOf",StrProto);var _setTimeoutFn,_clearTimeoutFn;function _createTimerHandler(startTimer,refreshFn,cancelFn){var theTimerHandler,ref=!0,timerId=startTimer?refreshFn(null):null;function _unref(){return ref=!1,timerId&&timerId.unref&&timerId.unref(),theTimerHandler}function _cancel(){timerId&&cancelFn(timerId),timerId=null}function _refresh(){return timerId=refreshFn(timerId),ref||_unref(),theTimerHandler}return(theTimerHandler={cancel:_cancel,refresh:_refresh}).hasRef=function(){return timerId&&timerId.hasRef?timerId.hasRef():ref},theTimerHandler.ref=function(){return ref=!0,timerId&&timerId.ref&&timerId.ref(),theTimerHandler},theTimerHandler.unref=_unref,{h:theTimerHandler=objDefineProp(theTimerHandler,"enabled",{get:function(){return!!timerId},set:function _setEnabled(value){!value&&timerId&&_cancel(),value&&!timerId&&_refresh()}}),dn:function(){timerId=null}}}function _createTimeoutWith(startTimer,overrideFn,theArgs){var isArr=isArray(overrideFn),len=isArr?overrideFn.length:0,setFn=function _resolveTimeoutFn(timeoutFn){var result=isFunction(timeoutFn)?timeoutFn:_setTimeoutFn;if(!result){var globalOverrides=_getGlobalConfig().tmOut||[];isArray(globalOverrides)&&globalOverrides.length>0&&isFunction(globalOverrides[0])&&(result=globalOverrides[0])}return result||setTimeout}(len>0?overrideFn[0]:isArr?void 0:overrideFn),clearFn=function _resolveClearTimeoutFn(timeoutFn){var result=isFunction(timeoutFn)?timeoutFn:_clearTimeoutFn;if(!result){var globalOverrides=_getGlobalConfig().tmOut||[];isArray(globalOverrides)&&globalOverrides.length>1&&isFunction(globalOverrides[1])&&(result=globalOverrides[1])}return result||clearTimeout}(len>1?overrideFn[1]:void 0),timerFn=theArgs[0];theArgs[0]=function(){handler.dn(),fnApply(timerFn,void 0,ArrSlice[CALL](arguments))};var handler=_createTimerHandler(startTimer,function(timerId){if(timerId){if(timerId.refresh)return timerId.refresh(),timerId;fnApply(clearFn,void 0,[timerId])}return fnApply(setFn,void 0,theArgs)},function(timerId){fnApply(clearFn,void 0,[timerId])});return handler.h}function scheduleTimeout(callback,timeout){return _createTimeoutWith(!0,void 0,ArrSlice[CALL](arguments))}var _a;var Obj=Object,_objGetPrototypeOf=Obj.getPrototypeOf,_objGetOwnProps=Obj.getOwnPropertyNames,_gbl=getGlobal(),_gblInst=_gbl.__dynProto$Gbl||(_gbl.__dynProto$Gbl={o:(_a={},_a.setInstFuncs=!0,_a.useBaseInst=!0,_a),n:1e3});function _isObjectOrArrayPrototype(target){return target&&(target===Obj.prototype||target===Array.prototype)}function _isObjectArrayOrFunctionPrototype(target){return _isObjectOrArrayPrototype(target)||target===Function.prototype}function _getObjProto(target){var newProto;if(target){if(_objGetPrototypeOf)return _objGetPrototypeOf(target);var curProto=target.__proto__||target.prototype||(target.constructor?target.constructor.prototype:null);newProto=target._dyn__proto__||curProto,objHasOwnProperty(target,"_dyn__proto__")||(delete target._dynInstProto,newProto=target._dyn__proto__=target._dynInstProto||target._dyn__proto__,target._dynInstProto=curProto)}return newProto}function _forEachProp(target,func){var props=[];if(_objGetOwnProps)props=_objGetOwnProps(target);else for(var name_1 in target)"string"==typeof name_1&&objHasOwnProperty(target,name_1)&&props.push(name_1);if(props&&props.length>0)for(var lp=0;lp<props.length;lp++)func(props[lp])}function _isDynamicCandidate(target,funcName,skipOwn){return"constructor"!==funcName&&"function"==typeof target[funcName]&&(skipOwn||objHasOwnProperty(target,funcName))&&"__proto__"!==funcName&&"prototype"!==funcName}function _throwTypeError(message){throwTypeError("DynamicProto: "+message)}function _hasVisited(values,value){for(var lp=values.length-1;lp>=0;lp--)if(values[lp]===value)return!0;return!1}function _populatePrototype(proto,className,target,baseInstFuncs,setInstanceFunc){function _createDynamicPrototype(proto,funcName){var dynProtoProxy=function(){var instFunc=function _getInstFunc(target,funcName,proto,currentDynProtoProxy){var instFunc=null;if(target&&objHasOwnProperty(proto,"_dynClass")){var instFuncTable=target._dynInstFuncs||objCreate(null);if((instFunc=(instFuncTable[proto._dynClass]||objCreate(null))[funcName])||_throwTypeError("Missing ["+funcName+"] function"),!instFunc._dynInstChk&&!1!==instFuncTable._dynInstChk){for(var canAddInst=!objHasOwnProperty(target,funcName),objProto=_getObjProto(target),visited=[];canAddInst&&objProto&&!_isObjectArrayOrFunctionPrototype(objProto)&&!_hasVisited(visited,objProto);){var protoFunc=objProto[funcName];if(protoFunc){canAddInst=protoFunc===currentDynProtoProxy;break}visited.push(objProto),objProto=_getObjProto(objProto)}try{canAddInst&&(target[funcName]=instFunc),instFunc._dynInstChk=1}catch(e){instFuncTable._dynInstChk=!1}}}return instFunc}(this,funcName,proto,dynProtoProxy)||function _getProtoFunc(funcName,proto,currentDynProtoProxy){var protoFunc=proto[funcName];return protoFunc===currentDynProtoProxy&&(protoFunc=_getObjProto(proto)[funcName]),"function"!=typeof protoFunc&&_throwTypeError("["+funcName+"] is not a function"),protoFunc}(funcName,proto,dynProtoProxy);return instFunc.apply(this,arguments)};return dynProtoProxy._isDynProxy=1,dynProtoProxy}if(!_isObjectOrArrayPrototype(proto)){var instFuncTable=target._dynInstFuncs=target._dynInstFuncs||objCreate(null);if(!_isObjectOrArrayPrototype(instFuncTable)){var instFuncs_1=instFuncTable[className]=instFuncTable[className]||objCreate(null);!1!==instFuncTable._dynInstChk&&(instFuncTable._dynInstChk=!!setInstanceFunc),_isObjectOrArrayPrototype(instFuncs_1)||_forEachProp(target,function(name){_isDynamicCandidate(target,name,!1)&&target[name]!==baseInstFuncs[name]&&(instFuncs_1[name]=target[name],delete target[name],(!objHasOwnProperty(proto,name)||proto[name]&&!proto[name]._isDynProxy)&&(proto[name]=_createDynamicPrototype(proto,name)))})}}}function _getObjName(target,unknownValue){return objHasOwnProperty(target,"prototype")?target.name||unknownValue||"_unknown_":((target||{}).constructor||{}).name||unknownValue||"_unknown_"}function dynamicProto(theClass,target,delegateFunc,options){objHasOwnProperty(theClass,"prototype")||_throwTypeError("theClass is an invalid class definition.");var classProto=theClass.prototype;(function _checkPrototype(classProto,thisTarget){if(_objGetPrototypeOf){for(var visited=[],thisProto=_getObjProto(thisTarget);thisProto&&!_isObjectArrayOrFunctionPrototype(thisProto)&&!_hasVisited(visited,thisProto);){if(thisProto===classProto)return!0;visited.push(thisProto),thisProto=_getObjProto(thisProto)}return!1}return!0})(classProto,target)||_throwTypeError("["+_getObjName(theClass)+"] not in hierarchy of ["+_getObjName(target)+"]");var className=null;objHasOwnProperty(classProto,"_dynClass")?className=classProto._dynClass:(className="_dynCls$"+_getObjName(theClass,"_")+"$"+_gblInst.n,_gblInst.n++,classProto._dynClass=className);var perfOptions=dynamicProto._dfOpts,useBaseInst=!!perfOptions.useBaseInst;useBaseInst&&options&&void 0!==options.useBaseInst&&(useBaseInst=!!options.useBaseInst);var instFuncs=function _getInstanceFuncs(thisTarget){var instFuncs=objCreate(null);return _forEachProp(thisTarget,function(name){!instFuncs[name]&&_isDynamicCandidate(thisTarget,name,!1)&&(instFuncs[name]=thisTarget[name])}),instFuncs}(target),baseFuncs=function _getBaseFuncs(classProto,thisTarget,instFuncs,useBaseInst){function _instFuncProxy(target,funcHost,funcName){var theFunc=funcHost[funcName];if(theFunc._isDynProxy&&useBaseInst){var instFuncTable=target._dynInstFuncs||{};!1!==instFuncTable._dynInstChk&&(theFunc=(instFuncTable[funcHost._dynClass]||{})[funcName]||theFunc)}return function(){return theFunc.apply(target,arguments)}}var baseFuncs=objCreate(null);_forEachProp(instFuncs,function(name){baseFuncs[name]=_instFuncProxy(thisTarget,instFuncs,name)});for(var baseProto=_getObjProto(classProto),visited=[];baseProto&&!_isObjectArrayOrFunctionPrototype(baseProto)&&!_hasVisited(visited,baseProto);)_forEachProp(baseProto,function(name){!baseFuncs[name]&&_isDynamicCandidate(baseProto,name,!_objGetPrototypeOf)&&(baseFuncs[name]=_instFuncProxy(thisTarget,baseProto,name))}),visited.push(baseProto),baseProto=_getObjProto(baseProto);return baseFuncs}(classProto,target,instFuncs,useBaseInst);delegateFunc(target,baseFuncs);var setInstanceFunc=!!_objGetPrototypeOf&&!!perfOptions.setInstFuncs;setInstanceFunc&&options&&(setInstanceFunc=!!options.setInstFuncs),_populatePrototype(classProto,className,target,instFuncs,!1!==setInstanceFunc)}dynamicProto._dfOpts=_gblInst.o;var Constants_ObjClass=Object,Constants_ObjProto=Constants_ObjClass.prototype,__assignFn=((getGlobal()||{}).Symbol,(getGlobal()||{}).Reflect,objAssign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Constants_ObjProto.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}),extendStaticsFn=function(d,b){return extendStaticsFn=Constants_ObjClass.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},extendStaticsFn(d,b)};function __extendsFn(d,b){function __(){this.constructor=d}"function"!=typeof b&&null!==b&&throwTypeError("Class extends value "+String(b)+" is not a constructor or null"),extendStaticsFn(d,b),d.prototype=null===b?objCreate(b):(__.prototype=b.prototype,new __)}function __spreadArrayFn(to,from){for(var i=0,il=from.length,j=to.length;i<il;i++,j++)to[j]=from[i];return to}var DEFAULT_SENSITIVE_PARAMS=["sig","Signature","AWSAccessKeyId","X-Goog-Signature"],rCamelCase=/-([a-z])/g,rNormalizeInvalid=/([^\w\d_$])/g,rLeadingNumeric=/^(\d+[\w\d_$])/,HelperFuncs_getObjProto=Object.getPrototypeOf;function isNotNullOrUndefined(value){return!isNullOrUndefined(value)}function HelperFuncs_normalizeJsName(name){var value=name;return value&&isString(value)&&(value=(value=(value=value.replace(rCamelCase,function(_all,letter){return letter.toUpperCase()})).replace(rNormalizeInvalid,"_")).replace(rLeadingNumeric,function(_all,match){return"_"+match})),value}function HelperFuncs_strContains(value,search){return!(!value||!search)&&-1!==strIndexOf(value,search)}function toISOString(date){return date&&date.toISOString()||""}function getExceptionName(object){return isError(object)?object.name:""}function setValue(target,field,value,valChk,srcChk){var theValue=value;return target&&((theValue=target[field])===value||srcChk&&!srcChk(theValue)||valChk&&!valChk(value)||(theValue=value,target[field]=theValue)),theValue}function getSetValue(target,field,defValue){var theValue;return target?!(theValue=target[field])&&isNullOrUndefined(theValue)&&(theValue=isUndefined(defValue)?{}:defValue,target[field]=theValue):theValue=isUndefined(defValue)?{}:defValue,theValue}function _createProxyFunction(source,funcName){var srcFunc=null,src=null;return isFunction(source)?srcFunc=source:src=source,function(){var originalArguments=arguments;if(srcFunc&&(src=srcFunc()),src)return src[funcName].apply(src,originalArguments)}}function proxyFunctionAs(target,name,source,theFunc,overwriteTarget){target&&name&&source&&(!1!==overwriteTarget||isUndefined(target[name]))&&(target[name]=_createProxyFunction(source,theFunc))}function proxyFunctions(target,source,functionsToProxy,overwriteTarget){return target&&source&&isObject(target)&&isArray(functionsToProxy)&&arrForEach(functionsToProxy,function(theFuncName){isString(theFuncName)&&proxyFunctionAs(target,theFuncName,source,theFuncName,overwriteTarget)}),target}function optimizeObject(theObject){return theObject&&objAssign&&(theObject=Constants_ObjClass(objAssign({},theObject))),theObject}function HelperFuncs_objExtend(obj1,obj2,obj3,obj4,obj5,obj6){var theArgs=arguments,extended=theArgs[0]||{},argLen=theArgs.length,deep=!1,idx=1;for(argLen>0&&isBoolean(extended)&&(deep=extended,extended=theArgs[idx]||{},idx++),isObject(extended)||(extended={});idx<argLen;idx++){var arg=theArgs[idx],isArgArray=isArray(arg),isArgObj=isObject(arg);for(var prop in arg){if(isArgArray&&prop in arg||isArgObj&&objHasOwn(arg,prop)){var newValue=arg[prop],isNewArray=void 0;if(deep&&newValue&&((isNewArray=isArray(newValue))||isPlainObject(newValue))){var clone=extended[prop];isNewArray?isArray(clone)||(clone=[]):isPlainObject(clone)||(clone={}),newValue=HelperFuncs_objExtend(deep,clone,newValue)}void 0!==newValue&&(extended[prop]=newValue)}}}return extended}function isFeatureEnabled(feature,cfg,sdkDefaultState){var ft=cfg&&cfg.featureOptIn&&cfg.featureOptIn[feature];if(feature&&ft){var mode=ft.mode;if(3===mode)return!0;if(2===mode)return!1}return sdkDefaultState}function getResponseText(xhr){try{return xhr.responseText}catch(e){}return null}function formatErrorMessageXdr(xdr,message){return xdr?"XDomainRequest,Response:"+getResponseText(xdr)||0:message}function formatErrorMessageXhr(xhr,message){return xhr?"XMLHttpRequest,Status:"+xhr.status+",Response:"+getResponseText(xhr)||0:message}function prependTransports(theTransports,newTransports){return newTransports&&(isNumber(newTransports)?theTransports=[newTransports].concat(theTransports):isArray(newTransports)&&(theTransports=newTransports.concat(theTransports))),theTransports}function _appendHeader(theHeaders,xhr,name){if(!theHeaders[name]&&xhr&&xhr.getResponseHeader){var value=xhr.getResponseHeader(name);value&&(theHeaders[name]=strTrim(value))}return theHeaders}function _getAllResponseHeaders(xhr,isOneDs){var theHeaders={};return xhr.getAllResponseHeaders?theHeaders=function convertAllHeadersToMap(headersString){var headers={};return isString(headersString)&&arrForEach(strTrim(headersString).split(/[\r\n]+/),function(headerEntry){if(headerEntry){var idx=headerEntry.indexOf(": ");if(-1!==idx){var header=strTrim(headerEntry.substring(0,idx)).toLowerCase(),value=strTrim(headerEntry.substring(idx+1));headers[header]=value}else headers[strTrim(headerEntry)]=1}}),headers}(xhr.getAllResponseHeaders()):isOneDs&&(theHeaders=_appendHeader(theHeaders,xhr,"time-delta-millis"),theHeaders=_appendHeader(theHeaders,xhr,"kill-duration"),theHeaders=_appendHeader(theHeaders,xhr,"kill-duration-seconds")),theHeaders}var _isTrident=null,_navUserAgentCheck=null,_enableMocks=!1,_useXDomainRequest=null,_beaconsSupported=null;function _hasProperty(theClass,property){var supported=!1;if(theClass){try{if(!(supported=property in theClass)){var proto=theClass.prototype;proto&&(supported=property in proto)}}catch(e){}if(!supported)try{supported=!isUndefined((new theClass)[property])}catch(e){}}return supported}function getLocation(checkForMock){if(checkForMock&&_enableMocks){var mockLocation=getInst("__mockLocation");if(mockLocation)return mockLocation}return"object"==typeof location&&location?location:getInst("location")}function hasJSON(){return Boolean("object"==typeof JSON&&JSON||null!==getInst("JSON"))}function getJSON(){return hasJSON()?JSON||getInst("JSON"):null}function isIE(){var nav=getNavigator();if(nav&&(nav.userAgent!==_navUserAgentCheck||null===_isTrident)){var userAgent=((_navUserAgentCheck=nav.userAgent)||"").toLowerCase();_isTrident=HelperFuncs_strContains(userAgent,"msie")||HelperFuncs_strContains(userAgent,"trident/")}return _isTrident}function getIEVersion(userAgentStr){if(void 0===userAgentStr&&(userAgentStr=null),!userAgentStr){var navigator_1=getNavigator()||{};userAgentStr=navigator_1?(navigator_1.userAgent||"").toLowerCase():""}var ua=(userAgentStr||"").toLowerCase();if(HelperFuncs_strContains(ua,"msie")){var doc=getDocument()||{};return mathMax(parseInt(ua.split("msie")[1]),doc.documentMode||0)}if(HelperFuncs_strContains(ua,"trident/")){var tridentVer=parseInt(ua.split("trident/")[1]);if(tridentVer)return tridentVer+4}return null}function isBeaconsSupported(useCached){return null!==_beaconsSupported&&!1!==useCached||(_beaconsSupported=function hasNavigator(){return!!getNavigator()}()&&Boolean(getNavigator().sendBeacon)),_beaconsSupported}function isFetchSupported(withKeepAlive){var isSupported=!1;try{isSupported=!!getInst("fetch");var request=getInst("Request");isSupported&&withKeepAlive&&request&&(isSupported=_hasProperty(request,"keepalive"))}catch(e){}return isSupported}function useXDomainRequest(){return null===_useXDomainRequest&&(_useXDomainRequest="undefined"!=typeof XDomainRequest)&&isXhrSupported()&&(_useXDomainRequest=_useXDomainRequest&&!_hasProperty(getInst("XMLHttpRequest"),"withCredentials")),_useXDomainRequest}function isXhrSupported(){var isSupported=!1;try{isSupported=!!getInst("XMLHttpRequest")}catch(e){}return isSupported}function sendCustomEvent(evtName,cfg,customDetails){var global=getGlobal();if(global&&global.CustomEvent)try{return function dispatchEvent(target,evnt){return!!(target&&target.dispatchEvent&&evnt)&&(target.dispatchEvent(evnt),!0)}(global,function createCustomDomEvent(eventName,details){var event=null,detail={detail:details||null};if(isFunction(CustomEvent))event=new CustomEvent(eventName,detail);else{var doc=getDocument();doc&&doc.createEvent&&(event=doc.createEvent("CustomEvent")).initCustomEvent(eventName,!0,!0,detail)}return event}(evtName,{cfg:cfg||null,customDetails:customDetails||null}))}catch(e){}return!1}function fieldRedaction(input,config){if(!input||!isString(input)||-1!==input.indexOf(" "))return input;if(config&&!1===config.redactUrls)return input;var hasCredentials=-1!==strIndexOf(input,"@"),hasQueryParams=-1!==strIndexOf(input,"?");if(!hasCredentials&&!hasQueryParams)return input;try{var result=input;return hasCredentials&&(result=function redactUserInfo(url){return url.replace(/^([a-zA-Z][a-zA-Z0-9+.-]*:\/\/)([^:@]{1,200}):([^@]{1,200})@(.*)$/,"$1REDACTED:REDACTED@$4")}(input)),hasQueryParams&&(result=function redactQueryParameters(url,config){var sensitiveParams,questionMarkIndex=strIndexOf(url,"?");if(-1===questionMarkIndex)return url;sensitiveParams=config&&config.redactQueryParams?DEFAULT_SENSITIVE_PARAMS.concat(config.redactQueryParams):DEFAULT_SENSITIVE_PARAMS;var baseUrl=strSubstring(url,0,questionMarkIndex+1),queryString=strSubstring(url,questionMarkIndex+1),fragment="",hashIndex=strIndexOf(queryString,"#");-1!==hashIndex&&(fragment=strSubstring(queryString,hashIndex),queryString=strSubstring(queryString,0,hashIndex));for(var hasPotentialSensitiveParam=!1,i=0;i<sensitiveParams.length;i++){var paramCheck=sensitiveParams[i]+"=";if(-1!==strIndexOf(queryString,paramCheck)){hasPotentialSensitiveParam=!0;break}}if(!hasPotentialSensitiveParam)return url;var resultParts=[],anyParamRedacted=!1;if(queryString&&queryString.length){var pairs=queryString.split("&");for(i=0;i<pairs.length;i++){var pair=pairs[i];if(pair){var equalsIndex=strIndexOf(pair,"=");if(-1===equalsIndex)resultParts.push(pair);else{var paramName=pair.substring(0,equalsIndex);if(""===pair.substring(equalsIndex+1))resultParts.push(pair);else{for(var shouldRedact=!1,j=0;j<sensitiveParams.length;j++)if(paramName===sensitiveParams[j]){shouldRedact=!0,anyParamRedacted=!0;break}shouldRedact?resultParts.push(paramName+"=REDACTED"):resultParts.push(pair)}}}}}return anyParamRedacted?baseUrl+resultParts.join("&")+fragment:url}(result,config)),result}catch(e){return input}}var _mwcSeeded=!1,_mwcW=123456789,_mwcZ=987654321;function _mwcSeed(seedValue){seedValue<0&&(seedValue>>>=0),_mwcW=123456789+seedValue&4294967295,_mwcZ=987654321-seedValue&4294967295,_mwcSeeded=!0}function _autoSeedMwc(){try{var now=2147483647&utcNow();_mwcSeed((4294967296*Math.random()^now)+now)}catch(e){}}function random32(signed){var value=0,c=function getCrypto(){return getInst("crypto")}()||function getMsCrypto(){return getInst("msCrypto")}();return c&&c.getRandomValues&&(value=4294967295&c.getRandomValues(new Uint32Array(1))[0]),0===value&&isIE()&&(_mwcSeeded||_autoSeedMwc(),value=4294967295&function mwcRandom32(signed){var value=((_mwcZ=36969*(65535&_mwcZ)+(_mwcZ>>16)&4294967295)<<16)+(65535&(_mwcW=18e3*(65535&_mwcW)+(_mwcW>>16)&4294967295))>>>0&4294967295;signed||(value>>>=0);return value}()),0===value&&(value=mathFloor(4294967296*Math.random()|0)),signed||(value>>>=0),value}function newId(maxLength){void 0===maxLength&&(maxLength=22);for(var number=random32()>>>0,chars=0,result="";result.length<maxLength;)chars++,result+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(63&number),number>>>=6,5===chars&&(number=(random32()<<2&4294967295|3&number)>>>0,chars=0);return result}var instanceName="."+newId(6),_dataUid=0;function _canAcceptData(target){return 1===target.nodeType||9===target.nodeType||!+target.nodeType}function createUniqueNamespace(name,includeVersion){return void 0===includeVersion&&(includeVersion=!1),HelperFuncs_normalizeJsName(name+_dataUid+++(includeVersion?".3.3.11":"")+instanceName)}function createElmNodeData(name){var data={id:createUniqueNamespace("_aiData-"+(name||"")+".3.3.11"),accept:function(target){return _canAcceptData(target)},get:function(target,name,defValue,addDefault){var theCache=target[data.id];return theCache?theCache[HelperFuncs_normalizeJsName(name)]:(addDefault&&(theCache=function _getCache(data,target){var theCache=target[data.id];if(!theCache){theCache={};try{_canAcceptData(target)&&objDefine(target,data.id,{e:!1,v:theCache})}catch(e){}}return theCache}(data,target),theCache[HelperFuncs_normalizeJsName(name)]=defValue),defValue)},kill:function(target,name){if(target&&target[name])try{delete target[name]}catch(e){}}};return data}function _isConfigDefaults(value){return value&&isObject(value)&&!isArray(value)&&(value.isVal||value.fb||objHasOwn(value,"v")||objHasOwn(value,"mrg")||objHasOwn(value,"ref")||value.set)}function _getDefault(dynamicHandler,theConfig,cfgDefaults){var defValue,isDefaultValid=cfgDefaults.dfVal||isDefined;if(theConfig&&cfgDefaults.fb){var fallbacks=cfgDefaults.fb;isArray(fallbacks)||(fallbacks=[fallbacks]);for(var lp=0;lp<fallbacks.length;lp++){var fallback=fallbacks[lp],fbValue=theConfig[fallback];if(isDefaultValid(fbValue)?defValue=fbValue:dynamicHandler&&(isDefaultValid(fbValue=dynamicHandler.cfg[fallback])&&(defValue=fbValue),dynamicHandler.set(dynamicHandler.cfg,asString(fallback),fbValue)),isDefaultValid(defValue))break}}return!isDefaultValid(defValue)&&isDefaultValid(cfgDefaults.v)&&(defValue=cfgDefaults.v),defValue}function _resolveDefaultValue(dynamicHandler,theConfig,cfgDefaults){var newValue_1,theValue=cfgDefaults;(cfgDefaults&&_isConfigDefaults(cfgDefaults)&&(theValue=_getDefault(dynamicHandler,theConfig,cfgDefaults)),theValue)&&(_isConfigDefaults(theValue)&&(theValue=_resolveDefaultValue(dynamicHandler,theConfig,theValue)),isArray(theValue)?(newValue_1=[]).length=theValue.length:isPlainObject(theValue)&&(newValue_1={}),newValue_1&&(objForEachKey(theValue,function(key,value){value&&_isConfigDefaults(value)&&(value=_resolveDefaultValue(dynamicHandler,theConfig,value)),newValue_1[key]=value}),theValue=newValue_1));return theValue}function _applyDefaultValue(dynamicHandler,theConfig,name,defaultValue){var isValid,setFn,defValue,mergeDf,reference,readOnly,blkDynamicValue,theValue,cfgDefaults=defaultValue;_isConfigDefaults(cfgDefaults)?(isValid=cfgDefaults.isVal,setFn=cfgDefaults.set,readOnly=cfgDefaults.rdOnly,blkDynamicValue=cfgDefaults.blkVal,mergeDf=cfgDefaults.mrg,!(reference=cfgDefaults.ref)&&isUndefined(reference)&&(reference=!!mergeDf),defValue=_getDefault(dynamicHandler,theConfig,cfgDefaults)):defValue=defaultValue,blkDynamicValue&&dynamicHandler.blkVal(theConfig,name);var usingDefault=!0,cfgValue=theConfig[name];!cfgValue&&isNullOrUndefined(cfgValue)||(theValue=cfgValue,usingDefault=!1,isValid&&theValue!==defValue&&!isValid(theValue)&&(theValue=defValue,usingDefault=!0),setFn&&(usingDefault=(theValue=setFn(theValue,defValue,theConfig))===defValue)),usingDefault?theValue=defValue?_resolveDefaultValue(dynamicHandler,theConfig,defValue):defValue:(isPlainObject(theValue)||isArray(defValue))&&mergeDf&&defValue&&(isPlainObject(defValue)||isArray(defValue))&&objForEachKey(defValue,function(dfName,dfValue){_applyDefaultValue(dynamicHandler,theValue,dfName,dfValue)}),dynamicHandler.set(theConfig,name,theValue),reference&&dynamicHandler.ref(theConfig,name),readOnly&&dynamicHandler.rdOnly(theConfig,name)}var CFG_HANDLER_LINK=symbolFor("[[ai_dynCfg_1]]"),BLOCK_DYNAMIC=symbolFor("[[ai_blkDynCfg_1]]"),FORCE_DYNAMIC=symbolFor("[[ai_frcDynCfg_1]]");function _cfgDeepCopy(source){var target_1;if(source&&(isArray(source)?(target_1=[]).length=source.length:isPlainObject(source)&&(target_1={}),target_1))return objForEachKey(source,function(key,value){target_1[key]=_cfgDeepCopy(value)}),target_1;return source}function _canMakeDynamic(getFunc,state,value){var result=!1;return value&&!getFunc[state.blkVal]&&((result=value[FORCE_DYNAMIC])||value[BLOCK_DYNAMIC]||(result=isPlainObject(value)||isArray(value))),result}function throwInvalidAccess(message){throwTypeError("InvalidAccess:"+message)}var aggregationErrorType,arrayMethodsToPatch=["push","pop","shift","unshift","splice"],_throwDynamicError=function(logger,name,desc,e){logger&&logger.throwInternal(3,108,"".concat(desc," [").concat(name,"] failed - ")+dumpObj(e))};function _getOwnPropGetter(target,name){var propDesc=objGetOwnPropertyDescriptor(target,name);return propDesc&&propDesc.get}function _setDynamicProperty(state,target,name,value){if(target){var getter=_getOwnPropGetter(target,name);getter&&!!getter[state.prop]?target[name]=value:function _createDynamicProperty(state,theConfig,name,value){var detail={n:name,h:[],trk:function(handler){handler&&handler.fn&&(-1===arrIndexOf(detail.h,handler)&&detail.h.push(handler),state.trk(handler,detail))},clr:function(handler){var idx=arrIndexOf(detail.h,handler);-1!==idx&&detail.h.splice(idx,1)}},checkDynamic=!0,isObjectOrArray=!1;function _getProperty(){checkDynamic&&(isObjectOrArray=isObjectOrArray||_canMakeDynamic(_getProperty,state,value),value&&!value[CFG_HANDLER_LINK]&&isObjectOrArray&&(value=_makeDynamicObject(state,value,name,"Converting")),checkDynamic=!1);var activeHandler=state.act;return activeHandler&&detail.trk(activeHandler),value}_getProperty[state.prop]={chng:function(){state.add(detail)}},objDefine(theConfig,detail.n,{g:_getProperty,s:function _setProperty(newValue){if(value!==newValue){_getProperty[state.ro]&&!state.upd&&throwInvalidAccess("["+name+"] is read-only:"+dumpObj(theConfig)),checkDynamic&&(isObjectOrArray=isObjectOrArray||_canMakeDynamic(_getProperty,state,value),checkDynamic=!1);var isReferenced=isObjectOrArray&&_getProperty[state.rf];if(isObjectOrArray)if(isReferenced){objForEachKey(value,function(key){value[key]=newValue?newValue[key]:void 0});try{objForEachKey(newValue,function(key,theValue){_setDynamicProperty(state,value,key,theValue)}),newValue=value}catch(e){_throwDynamicError((state.hdlr||{}).logger,name,"Assigning",e),isObjectOrArray=!1}}else value&&value[CFG_HANDLER_LINK]&&objForEachKey(value,function(key){var getter=_getOwnPropGetter(value,key);if(getter){var valueState=getter[state.prop];valueState&&valueState.chng()}});if(newValue!==value){var newIsObjectOrArray=newValue&&_canMakeDynamic(_getProperty,state,newValue);!isReferenced&&newIsObjectOrArray&&(newValue=_makeDynamicObject(state,newValue,name,"Converting")),value=newValue,isObjectOrArray=newIsObjectOrArray}state.add(detail)}}})}(state,target,name,value)}return target}function _setDynamicPropertyState(state,target,name,flags){if(target){var getter=_getOwnPropGetter(target,name),isDynamic=getter&&!!getter[state.prop],inPlace=flags&&flags[0],rdOnly=flags&&flags[1],blkProp=flags&&flags[2];if(!isDynamic){if(blkProp)try{!function blockDynamicConversion(value){if(value&&(isPlainObject(value)||isArray(value)))try{value[BLOCK_DYNAMIC]=!0}catch(e){}return value}(target)}catch(e){_throwDynamicError((state.hdlr||{}).logger,name,"Blocking",e)}try{_setDynamicProperty(state,target,name,target[name]),getter=_getOwnPropGetter(target,name)}catch(e){_throwDynamicError((state.hdlr||{}).logger,name,"State",e)}}inPlace&&(getter[state.rf]=inPlace),rdOnly&&(getter[state.ro]=rdOnly),blkProp&&(getter[state.blkVal]=!0)}return target}function _makeDynamicObject(state,target,name,desc){try{objForEachKey(target,function(key,value){_setDynamicProperty(state,target,key,value)}),target[CFG_HANDLER_LINK]||(objDefineProp(target,CFG_HANDLER_LINK,{get:function(){return state.hdlr}}),function _patchArray(state,target,name){isArray(target)&&arrForEach(arrayMethodsToPatch,function(method){var orgMethod=target[method];target[method]=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var result=orgMethod.apply(this,args);return _makeDynamicObject(state,target,name,"Patching"),result}})}(state,target,name))}catch(e){_throwDynamicError((state.hdlr||{}).logger,name,desc,e)}return target}function _createState(cfgHandler){var theState,dynamicPropertySymbol=newSymbol("[[ai_get"+cfgHandler.uid+"]]"),dynamicPropertyReadOnly=newSymbol("[[ai_ro"+cfgHandler.uid+"]]"),dynamicPropertyReferenced=newSymbol("[[ai_rf"+cfgHandler.uid+"]]"),dynamicPropertyBlockValue=newSymbol("[[ai_blkVal"+cfgHandler.uid+"]]"),dynamicPropertyDetail=newSymbol("[[ai_dtl"+cfgHandler.uid+"]]"),_waitingHandlers=null,_watcherTimer=null;function _useHandler(activeHandler,callback){var prevWatcher=theState.act;try{theState.act=activeHandler,activeHandler&&activeHandler[dynamicPropertyDetail]&&(arrForEach(activeHandler[dynamicPropertyDetail],function(detail){detail.clr(activeHandler)}),activeHandler[dynamicPropertyDetail]=[]),callback({cfg:cfgHandler.cfg,set:cfgHandler.set.bind(cfgHandler),setDf:cfgHandler.setDf.bind(cfgHandler),ref:cfgHandler.ref.bind(cfgHandler),rdOnly:cfgHandler.rdOnly.bind(cfgHandler)})}catch(e){var logger=cfgHandler.logger;throw logger&&logger.throwInternal(1,107,dumpObj(e)),e}finally{theState.act=prevWatcher||null}}function _notifyWatchers(){if(_waitingHandlers){var notifyHandlers=_waitingHandlers;_waitingHandlers=null,_watcherTimer&&_watcherTimer.cancel(),_watcherTimer=null;var watcherFailures_1=[];if(arrForEach(notifyHandlers,function(handler){if(handler&&(handler[dynamicPropertyDetail]&&(arrForEach(handler[dynamicPropertyDetail],function(detail){detail.clr(handler)}),handler[dynamicPropertyDetail]=null),handler.fn))try{_useHandler(handler,handler.fn)}catch(e){watcherFailures_1.push(e)}}),_waitingHandlers)try{_notifyWatchers()}catch(e){watcherFailures_1.push(e)}watcherFailures_1.length>0&&function throwAggregationError(message,sourceErrors){aggregationErrorType||(aggregationErrorType=createCustomError("AggregationError",function(self,args){args.length>1&&(self.errors=args[1])}));var theMessage=message||"One or more errors occurred.";throw arrForEach(sourceErrors,function(srcError,idx){theMessage+="\n".concat(idx," > ").concat(dumpObj(srcError))}),new aggregationErrorType(theMessage,sourceErrors||[])}("Watcher error(s): ",watcherFailures_1)}}return theState={prop:dynamicPropertySymbol,ro:dynamicPropertyReadOnly,rf:dynamicPropertyReferenced,blkVal:dynamicPropertyBlockValue,hdlr:cfgHandler,add:function _addWatcher(detail){if(detail&&detail.h.length>0){_waitingHandlers||(_waitingHandlers=[]),_watcherTimer||(_watcherTimer=scheduleTimeout(function(){_watcherTimer=null,_notifyWatchers()},0));for(var idx=0;idx<detail.h.length;idx++){var handler=detail.h[idx];handler&&-1===arrIndexOf(_waitingHandlers,handler)&&_waitingHandlers.push(handler)}}},notify:_notifyWatchers,use:_useHandler,trk:function _trackHandler(handler,detail){if(handler){var details=handler[dynamicPropertyDetail]=handler[dynamicPropertyDetail]||[];-1===arrIndexOf(details,detail)&&details.push(detail)}}}}function _createDynamicHandler(logger,target,inPlace){var dynamicHandler=function getDynamicConfigHandler(value){if(value){var handler=value[CFG_HANDLER_LINK]||value;if(handler.cfg&&(handler.cfg===value||handler.cfg[CFG_HANDLER_LINK]===handler))return handler}return null}(target);if(dynamicHandler)return dynamicHandler;var theState,uid=createUniqueNamespace("dyncfg",!0),newTarget=target&&!1!==inPlace?target:_cfgDeepCopy(target);var cfgHandler={uid:null,cfg:newTarget,logger,notify:function _notifyWatchers(){theState.notify()},set:function _setValue(target,name,value){try{target=_setDynamicProperty(theState,target,name,value)}catch(e){_throwDynamicError(logger,name,"Setting value",e)}return target[name]},setDf:function _applyDefaults(theConfig,defaultValues){return defaultValues&&objForEachKey(defaultValues,function(name,value){_applyDefaultValue(cfgHandler,theConfig,name,value)}),theConfig},watch:function _watch(configHandler){return function _createAndUseHandler(state,configHandler){var handler={fn:configHandler,rm:function(){handler.fn=null,state=null,configHandler=null}};return objDefine(handler,"toJSON",{v:function(){return"WatcherHandler"+(handler.fn?"":"[X]")}}),state.use(handler,configHandler),handler}(theState,configHandler)},ref:function _ref(target,name){var _a;return _setDynamicPropertyState(theState,target,name,(_a={},_a[0]=!0,_a))[name]},rdOnly:function _rdOnly(target,name){var _a;return _setDynamicPropertyState(theState,target,name,(_a={},_a[1]=!0,_a))[name]},blkVal:function _blkPropValue(target,name){var _a;return _setDynamicPropertyState(theState,target,name,(_a={},_a[2]=!0,_a))[name]},_block:function _block(configHandler,allowUpdate){theState.use(null,function(details){var prevUpd=theState.upd;try{isUndefined(allowUpdate)||(theState.upd=allowUpdate),configHandler(details)}finally{theState.upd=prevUpd}})}};return objDefine(cfgHandler,"uid",{c:!1,e:!1,w:!1,v:uid}),_makeDynamicObject(theState=_createState(cfgHandler),newTarget,"config","Creating"),cfgHandler}function createDynamicConfig(config,defaultConfig,logger,inPlace){var dynamicHandler=_createDynamicHandler(logger,config||{},inPlace);return defaultConfig&&dynamicHandler.setDf(dynamicHandler.cfg,defaultConfig),dynamicHandler}function onConfigChange(config,configHandler,logger){var handler=config[CFG_HANDLER_LINK]||config;return!handler.cfg||handler.cfg!==config&&handler.cfg[CFG_HANDLER_LINK]!==handler?(function _logInvalidAccess(logger,message){logger?(logger.warnToConsole(message),logger.throwInternal(2,108,message)):throwInvalidAccess(message)}(logger,"Not dynamic - "+dumpObj(config)),createDynamicConfig(config,null,logger).watch(configHandler)):handler.watch(configHandler)}var _debugListener,DiagnosticLogger_a,listenerFuncs=["eventsSent","eventsDiscarded","eventsSendRequest","perfEvent"],_aiNamespace=null;function _listenerProxyFunc(name,config){return function(){var args=arguments,dbgExt=getDebugExt(config);if(dbgExt){var listener=dbgExt.listener;listener&&listener[name]&&listener[name].apply(listener,args)}}}function getDebugExt(config){var ns=_aiNamespace;return ns||!0===config.disableDbgExt||(ns=_aiNamespace||function _getExtensionNamespace(){var target=getInst("Microsoft");return target&&(_aiNamespace=target.ApplicationInsights),_aiNamespace}()),ns?ns.ChromeDbgExt:null}var defaultValues={loggingLevelConsole:0,loggingLevelTelemetry:1,maxMessageLimit:25,enableDebug:!1},_logFuncs=((DiagnosticLogger_a={})[0]=null,DiagnosticLogger_a[1]="errorToConsole",DiagnosticLogger_a[2]="warnToConsole",DiagnosticLogger_a[3]="debugToConsole",DiagnosticLogger_a);function _sanitizeDiagnosticText(text){return text?'"'+text.replace(/\"/g,"")+'"':""}function _logToConsole(func,message){var theConsole=function getConsole(){return"undefined"!=typeof console?console:getInst("console")}();if(theConsole){var logFunc="log";theConsole[func]&&(logFunc=func),isFunction(theConsole[logFunc])&&theConsole[logFunc](message)}}var _InternalLogMessage=function(){function _InternalLogMessage(msgId,msg,isUserAct,properties){void 0===isUserAct&&(isUserAct=!1);this.messageId=msgId,this.message=(isUserAct?"AI: ":"AI (Internal): ")+msgId;var strProps="";hasJSON()&&(strProps=getJSON().stringify(properties));var diagnosticText=(msg?" message:"+_sanitizeDiagnosticText(msg):"")+(properties?" props:"+_sanitizeDiagnosticText(strProps):"");this.message+=diagnosticText}return _InternalLogMessage.dataType="MessageData",_InternalLogMessage}();function safeGetLogger(core,config){return(core||{}).logger||new DiagnosticLogger(config)}var DiagnosticLogger=function(){function DiagnosticLogger(config){this.identifier="DiagnosticLogger",this.queue=[];var _loggingLevelConsole,_loggingLevelTelemetry,_maxInternalMessageLimit,_enableDebug,_unloadHandler,_messageCount=0,_messageLogged={};dynamicProto(DiagnosticLogger,this,function(_self){function _logInternalMessage(severity,message){if(!function _areInternalMessagesThrottled(){return _messageCount>=_maxInternalMessageLimit}()){var logMessage=!0,messageKey="AITR_"+message.messageId;if(_messageLogged[messageKey]?logMessage=!1:_messageLogged[messageKey]=!0,logMessage&&(severity<=_loggingLevelTelemetry&&(_self.queue.push(message),_messageCount++,_debugExtMsg(1===severity?"error":"warn",message)),_messageCount===_maxInternalMessageLimit)){var throttleLimitMessage="Internal events throttle limit per PageView reached for this app.",throttleMessage=new _InternalLogMessage(23,throttleLimitMessage,!1);_self.queue.push(throttleMessage),1===severity?_self.errorToConsole(throttleLimitMessage):_self.warnToConsole(throttleLimitMessage)}}}function _debugExtMsg(name,data){var dbgExt=getDebugExt(config||{});dbgExt&&dbgExt.diagLog&&dbgExt.diagLog(name,data)}_unloadHandler=function _setDefaultsFromConfig(config){return onConfigChange(createDynamicConfig(config,defaultValues,_self).cfg,function(details){var config=details.cfg;_loggingLevelConsole=config.loggingLevelConsole,_loggingLevelTelemetry=config.loggingLevelTelemetry,_maxInternalMessageLimit=config.maxMessageLimit,_enableDebug=config.enableDebug})}(config||{}),_self.consoleLoggingLevel=function(){return _loggingLevelConsole},_self.throwInternal=function(severity,msgId,msg,properties,isUserAct){void 0===isUserAct&&(isUserAct=!1);var message=new _InternalLogMessage(msgId,msg,isUserAct,properties);if(_enableDebug)throw dumpObj(message);var logFunc=_logFuncs[severity]||"warnToConsole";if(isUndefined(message.message))_debugExtMsg("throw"+(1===severity?"Critical":"Warning"),message);else{if(isUserAct){var messageKey=+message.messageId;!_messageLogged[messageKey]&&_loggingLevelConsole>=severity&&(_self[logFunc](message.message),_messageLogged[messageKey]=!0)}else _loggingLevelConsole>=severity&&_self[logFunc](message.message);_logInternalMessage(severity,message)}},_self.debugToConsole=function(message){_logToConsole("debug",message),_debugExtMsg("warning",message)},_self.warnToConsole=function(message){_logToConsole("warn",message),_debugExtMsg("warning",message)},_self.errorToConsole=function(message){_logToConsole("error",message),_debugExtMsg("error",message)},_self.resetInternalMessageCount=function(){_messageCount=0,_messageLogged={}},_self.logInternalMessage=_logInternalMessage,_self.unload=function(isAsync){_unloadHandler&&_unloadHandler.rm(),_unloadHandler=null}})}return DiagnosticLogger.__ieDyn=1,DiagnosticLogger}();function _getLogger(logger){return logger||new DiagnosticLogger}function _throwInternal(logger,severity,msgId,msg,properties,isUserAct){void 0===isUserAct&&(isUserAct=!1),_getLogger(logger).throwInternal(severity,msgId,msg,properties,isUserAct)}function _warnToConsole(logger,message){_getLogger(logger).warnToConsole(message)}var createEnumStyle=function createEnum(values){return _createKeyValueMap(values,1,0,objFreeze)},createValueMap=function createTypeMap(values){return function createSimpleMap(values){var mapClass={};return objForEachKey(values,function(key,value){_assignMapValue(mapClass,key,value[1]),_assignMapValue(mapClass,value[0],value[1])}),objFreeze(mapClass)}(values)},StorageType=createEnumStyle({LocalStorage:0,SessionStorage:1}),_canUseLocalStorage=void 0,_canUseSessionStorage=void 0,_storagePrefix="";function _getLocalStorageObject(){return utlCanUseLocalStorage()?_getVerifiedStorageObject(StorageType.LocalStorage):null}function _getVerifiedStorageObject(storageType){try{if(isNullOrUndefined(getGlobal()))return null;var uid=(new Date).toString(),storage=getInst(storageType===StorageType.LocalStorage?"localStorage":"sessionStorage"),name_1=_storagePrefix+uid;storage.setItem(name_1,uid);var fail=storage.getItem(name_1)!==uid;if(storage.removeItem(name_1),!fail)return storage}catch(exception){}return null}function _getSessionStorageObject(){return utlCanUseSessionStorage()?_getVerifiedStorageObject(StorageType.SessionStorage):null}function utlSetStoragePrefix(storagePrefix){_storagePrefix=storagePrefix||""}function utlCanUseLocalStorage(reset){return(reset||void 0===_canUseLocalStorage)&&(_canUseLocalStorage=!!_getVerifiedStorageObject(StorageType.LocalStorage)),_canUseLocalStorage}function utlGetLocalStorage(logger,name){var storage=_getLocalStorageObject();if(null!==storage)try{return storage.getItem(name)}catch(e){_canUseLocalStorage=!1,_throwInternal(logger,2,1,"Browser failed read of local storage. "+getExceptionName(e),{exception:dumpObj(e)})}return null}function utlSetLocalStorage(logger,name,data){var storage=_getLocalStorageObject();if(null!==storage)try{return storage.setItem(name,data),!0}catch(e){_canUseLocalStorage=!1,_throwInternal(logger,2,3,"Browser failed write to local storage. "+getExceptionName(e),{exception:dumpObj(e)})}return!1}function utlCanUseSessionStorage(reset){return(reset||void 0===_canUseSessionStorage)&&(_canUseSessionStorage=!!_getVerifiedStorageObject(StorageType.SessionStorage)),_canUseSessionStorage}function utlGetSessionStorage(logger,name){var storage=_getSessionStorageObject();if(null!==storage)try{return storage.getItem(name)}catch(e){_canUseSessionStorage=!1,_throwInternal(logger,2,2,"Browser failed read of session storage. "+getExceptionName(e),{exception:dumpObj(e)})}return null}function utlSetSessionStorage(logger,name,data){var storage=_getSessionStorageObject();if(null!==storage)try{return storage.setItem(name,data),!0}catch(e){_canUseSessionStorage=!1,_throwInternal(logger,2,4,"Browser failed write to session storage. "+getExceptionName(e),{exception:dumpObj(e)})}return!1}function utlRemoveSessionStorage(logger,name){var storage=_getSessionStorageObject();if(null!==storage)try{return storage.removeItem(name),!0}catch(e){_canUseSessionStorage=!1,_throwInternal(logger,2,6,"Browser failed removal of session storage item. "+getExceptionName(e),{exception:dumpObj(e)})}return!1}var DisabledPropertyName="Microsoft_ApplicationInsights_BypassAjaxInstrumentation";function dataSanitizeKeyAndAddUniqueness(logger,key,map){var origLength=key.length,field=function dataSanitizeKey(logger,name){var nameTrunc;name&&(name=strTrim(asString(name))).length>150&&(nameTrunc=strSubstring(name,0,150),_throwInternal(logger,2,57,"name is too long.  It has been truncated to 150 characters.",{name},!0));return nameTrunc||name}(logger,key);if(field.length!==origLength){for(var i=0,uniqueField=field;void 0!==map[uniqueField];)i++,uniqueField=strSubstring(field,0,147)+dsPadNumber(i);field=uniqueField}return field}function dataSanitizeString(logger,value,maxLength){var valueTrunc;return void 0===maxLength&&(maxLength=1024),value&&(maxLength=maxLength||1024,(value=strTrim(asString(value))).length>maxLength&&(valueTrunc=strSubstring(value,0,maxLength),_throwInternal(logger,2,61,"string value is too long. It has been truncated to "+maxLength+" characters.",{value},!0))),valueTrunc||value}function dataSanitizeUrl(logger,url,config){return isString(url)&&(url=fieldRedaction(url,config)),dataSanitizeInput(logger,url,2048,66)}function dataSanitizeMessage(logger,message){var messageTrunc;return message&&message.length>32768&&(messageTrunc=strSubstring(message,0,32768),_throwInternal(logger,2,56,"message is too long, it has been truncated to 32768 characters.",{message},!0)),messageTrunc||message}function dataSanitizeProperties(logger,properties){if(properties){var tempProps_1={};objForEachKey(properties,function(prop,value){if(isObject(value)&&hasJSON())try{value=getJSON().stringify(value)}catch(e){_throwInternal(logger,2,49,"custom property is not valid",{exception:e},!0)}value=dataSanitizeString(logger,value,8192),prop=dataSanitizeKeyAndAddUniqueness(logger,prop,tempProps_1),tempProps_1[prop]=value}),properties=tempProps_1}return properties}function dataSanitizeMeasurements(logger,measurements){if(measurements){var tempMeasurements_1={};objForEachKey(measurements,function(measure,value){measure=dataSanitizeKeyAndAddUniqueness(logger,measure,tempMeasurements_1),tempMeasurements_1[measure]=value}),measurements=tempMeasurements_1}return measurements}function dataSanitizeInput(logger,input,maxLength,_msgId){var inputTrunc;return input&&(input=strTrim(asString(input))).length>maxLength&&(inputTrunc=strSubstring(input,0,maxLength),_throwInternal(logger,2,_msgId,"input is too long, it has been truncated to "+maxLength+" characters.",{data:input},!0)),inputTrunc||input}function dsPadNumber(num){var s="00"+num;return strSubstr(s,s.length-3)}function createTelemetryItem(item,baseType,envelopeName,logger,customProperties,systemProperties){envelopeName=dataSanitizeString(logger,envelopeName)||"not_specified",(isNullOrUndefined(item)||isNullOrUndefined(baseType)||isNullOrUndefined(envelopeName))&&throwError("Input doesn't contain all required fields");var iKey="";item.iKey&&(iKey=item.iKey,delete item.iKey);var telemetryItem={name:envelopeName,time:toISOString(new Date),iKey,ext:systemProperties||{},tags:[],data:{},baseType,baseData:item};return isNullOrUndefined(customProperties)||objForEachKey(customProperties,function(prop,value){telemetryItem.data[prop]=value}),telemetryItem}!function(){function TelemetryItemCreator(){}TelemetryItemCreator.create=createTelemetryItem}();var Event_Event=function(){function Event(logger,name,properties,measurements){this.aiDataContract={ver:1,name:1,properties:0,measurements:0};this.ver=2,this.name=dataSanitizeString(logger,name)||"not_specified",this.properties=dataSanitizeProperties(logger,properties),this.measurements=dataSanitizeMeasurements(logger,measurements)}return Event.envelopeType="Microsoft.ApplicationInsights.{0}.Event",Event.dataType="EventData",Event}(),Trace=function(){function Trace(logger,message,severityLevel,properties,measurements){this.aiDataContract={ver:1,message:1,severityLevel:0,properties:0};this.ver=2,message=message||"not_specified",this.message=dataSanitizeMessage(logger,message),this.properties=dataSanitizeProperties(logger,properties),this.measurements=dataSanitizeMeasurements(logger,measurements),severityLevel&&(this.severityLevel=severityLevel)}return Trace.envelopeType="Microsoft.ApplicationInsights.{0}.Message",Trace.dataType="MessageData",Trace}(),DataPoint=function DataPoint(){this.aiDataContract={name:1,kind:0,value:1,count:0,min:0,max:0,stdDev:0},this.kind=0},Metric=function(){function Metric(logger,name,value,count,min,max,stdDev,properties,measurements){this.aiDataContract={ver:1,metrics:1,properties:0};this.ver=2;var dataPoint=new DataPoint;dataPoint.count=count>0?count:void 0,dataPoint.max=isNaN(max)||null===max?void 0:max,dataPoint.min=isNaN(min)||null===min?void 0:min,dataPoint.name=dataSanitizeString(logger,name)||"not_specified",dataPoint.value=value,dataPoint.stdDev=isNaN(stdDev)||null===stdDev?void 0:stdDev,this.metrics=[dataPoint],this.properties=dataSanitizeProperties(logger,properties),this.measurements=dataSanitizeMeasurements(logger,measurements)}return Metric.envelopeType="Microsoft.ApplicationInsights.{0}.Metric",Metric.dataType="MetricData",Metric}();function msToTimeSpan(totalms){(isNaN(totalms)||totalms<0)&&(totalms=0);var ms=""+(totalms=mathRound(totalms))%1e3,sec=""+mathFloor(totalms/1e3)%60,min=""+mathFloor(totalms/6e4)%60,hour=""+mathFloor(totalms/36e5)%24,days=mathFloor(totalms/864e5);return ms=1===ms.length?"00"+ms:2===ms.length?"0"+ms:ms,sec=sec.length<2?"0"+sec:sec,min=min.length<2?"0"+min:min,(days>0?days+".":"")+(hour=hour.length<2?"0"+hour:hour)+":"+min+":"+sec+"."+ms}var PageView=function(){function PageView(logger,name,url,durationMs,properties,measurements,id){this.aiDataContract={ver:1,name:0,url:0,duration:0,properties:0,measurements:0,id:0};this.ver=2,this.id=function dataSanitizeId(logger,id){return id?dataSanitizeInput(logger,id,128,69).toString():id}(logger,id),this.url=dataSanitizeUrl(logger,url),this.name=dataSanitizeString(logger,name)||"not_specified",isNaN(durationMs)||(this.duration=msToTimeSpan(durationMs)),this.properties=dataSanitizeProperties(logger,properties),this.measurements=dataSanitizeMeasurements(logger,measurements)}return PageView.envelopeType="Microsoft.ApplicationInsights.{0}.Pageview",PageView.dataType="PageviewData",PageView}(),PageViewPerformance=function(){function PageViewPerformance(logger,name,url,unused,properties,measurements,cs4BaseData){this.aiDataContract={ver:1,name:0,url:0,duration:0,perfTotal:0,networkConnect:0,sentRequest:0,receivedResponse:0,domProcessing:0,properties:0,measurements:0};this.ver=2,this.url=dataSanitizeUrl(logger,url),this.name=dataSanitizeString(logger,name)||"not_specified",this.properties=dataSanitizeProperties(logger,properties),this.measurements=dataSanitizeMeasurements(logger,measurements),cs4BaseData&&(this.domProcessing=cs4BaseData.domProcessing,this.duration=cs4BaseData.duration,this.networkConnect=cs4BaseData.networkConnect,this.perfTotal=cs4BaseData.perfTotal,this.receivedResponse=cs4BaseData.receivedResponse,this.sentRequest=cs4BaseData.sentRequest)}return PageViewPerformance.envelopeType="Microsoft.ApplicationInsights.{0}.PageviewPerformance",PageViewPerformance.dataType="PageviewPerformanceData",PageViewPerformance}(),IS_FRAME=/^\s{0,50}(from\s|at\s|Line\s{1,5}\d{1,10}\s{1,5}of|\w{1,50}@\w{1,80}|[^\(\s\n]+:[0-9\?]+(?::[0-9\?]+)?)/,PARSE_FILENAME_LINE_COL=/([^\(\s\n]+):([0-9]+):([0-9]+)$/,PARSE_FILENAME_LINE_ONLY=/([^\(\s\n]+):([0-9]+)$/,_parseSequence=[{re:/^(?:\s{0,50}at)?\s{0,50}([^\@\()\s]+)?\s{0,50}(?:\s|\@|\()\s{0,5}([^\(\s\n\]]+):([0-9\?]+):([0-9\?]+)\)?$/,len:5,m:1,fn:2,ln:3,col:4},{chk:function _ignoreNative(frame){return strIndexOf(frame,"[native")<0},pre:function _scrubAnonymous(frame){return frame.replace(/(\(anonymous\))/,"<anonymous>")},re:/^(?:\s{0,50}at)?\s{0,50}([^\@\()\s]+)?\s{0,50}(?:\s|\@|\()\s{0,5}([^\(\s\n\]]+):([0-9\?]+)\)?$/,len:4,m:1,fn:2,ln:3},{re:/^(?:\s{0,50}at)?\s{0,50}([^\@\()\s]+)?\s{0,50}(?:\s|\@|\()\s{0,5}([^\(\s\n\)\]]+)\)?$/,len:3,m:1,fn:2,hdl:_handleFilename},{re:/(?:^|\(|\s{0,10}[\w\)]+\@)?([^\(\n\s\]\)]+)(?:\:([0-9]+)(?:\:([0-9]+))?)?\)?(?:,|$)/,len:2,fn:1,hdl:_handleFilename}];function _stringify(value,convertToString){var result=value;return result&&!isString(result)&&(JSON&&JSON.stringify?(result=JSON.stringify(value),!convertToString||result&&"{}"!==result||(result=isFunction(value.toString)?value.toString():""+value)):result=value+" - (Missing JSON.stringify)"),result||""}function _formatMessage(theEvent,errorType){var evtMessage=theEvent;return theEvent&&(evtMessage&&!isString(evtMessage)&&(evtMessage=theEvent.message||theEvent.description||evtMessage),evtMessage&&!isString(evtMessage)&&(evtMessage=_stringify(evtMessage,!0)),theEvent.filename&&(evtMessage=evtMessage+" @"+(theEvent.filename||"")+":"+(theEvent.lineno||"?")+":"+(theEvent.colno||"?"))),errorType&&"String"!==errorType&&"Object"!==errorType&&"Error"!==errorType&&-1===strIndexOf(evtMessage||"",errorType)&&(evtMessage=errorType+": "+evtMessage),evtMessage||""}function _isStackDetails(details){return details&&details.src&&isString(details.src)&&details.obj&&isArray(details.obj)}function _convertStackObj(errorStack){var src=errorStack||"";isString(src)||(src=isString(src.stack)?src.stack:""+src);var items=src.split("\n");return{src,obj:items}}function _getStackFromErrorObj(errorObj){var details=null;if(errorObj)try{if(errorObj.stack)details=_convertStackObj(errorObj.stack);else if(errorObj.error&&errorObj.error.stack)details=_convertStackObj(errorObj.error.stack);else if(errorObj.exception&&errorObj.exception.stack)details=_convertStackObj(errorObj.exception.stack);else if(_isStackDetails(errorObj))details=errorObj;else if(_isStackDetails(errorObj.stackDetails))details=errorObj.stackDetails;else if(getWindow()&&getWindow().opera&&errorObj.message)details=function _getOperaStack(errorMessage){for(var stack=[],lines=errorMessage.split("\n"),lp=0;lp<lines.length;lp++){var entry=lines[lp];lines[lp+1]&&(entry+="@"+lines[lp+1],lp++),stack.push(entry)}return{src:errorMessage,obj:stack}}(errorObj.message);else if(errorObj.reason&&errorObj.reason.stack)details=_convertStackObj(errorObj.reason.stack);else if(isString(errorObj))details=_convertStackObj(errorObj);else{var evtMessage=errorObj.message||errorObj.description||"";isString(errorObj.errorSrc)&&(evtMessage&&(evtMessage+="\n"),evtMessage+=" from "+errorObj.errorSrc),evtMessage&&(details=_convertStackObj(evtMessage))}}catch(e){details=_convertStackObj(e)}return details||{src:"",obj:null}}function _parseStack(stack){var parsedStack,frames=stack.obj;if(frames&&frames.length>0){parsedStack=[];var level_1=0,foundStackStart_1=!1,totalSizeInBytes_1=0;arrForEach(frames,function(frame){if(foundStackStart_1||function _isStackFrame(frame){var result=!1;if(frame&&isString(frame)){var trimmedFrame=strTrim(frame);trimmedFrame&&(result=IS_FRAME.test(trimmedFrame))}return result}(frame)){var theFrame=asString(frame);foundStackStart_1=!0;var parsedFrame=function _extractStackFrame(frame,level){var _a,theFrame;if(frame&&isString(frame)&&strTrim(frame)){(_a={}).aiDataContract=stackFrameAiDataContract,_a.level=level,_a.assembly=strTrim(frame),_a.method="<no_method>",_a.fileName="",_a.line=0,_a.sizeInBytes=0,theFrame=_a;for(var idx=0;idx<_parseSequence.length;){var sequence=_parseSequence[idx];if(sequence.chk&&!sequence.chk(frame))break;sequence.pre&&(frame=sequence.pre(frame));var matches=frame.match(sequence.re);if(matches&&matches.length>=sequence.len){sequence.m&&(theFrame.method=strTrim(matches[sequence.m]||"<no_method>")),sequence.hdl?sequence.hdl(theFrame,sequence,matches):sequence.fn&&(sequence.ln?(theFrame.fileName=strTrim(matches[sequence.fn]||""),theFrame.line=parseInt(strTrim(matches[sequence.ln]||""))||0):_parseFilename(theFrame,matches[sequence.fn]||""));break}idx++}}return _populateFrameSizeInBytes(theFrame)}(theFrame,level_1);parsedFrame&&(totalSizeInBytes_1+=parsedFrame.sizeInBytes,parsedStack.push(parsedFrame),level_1++)}});if(totalSizeInBytes_1>32768)for(var left=0,right=parsedStack.length-1,size=0,acceptedLeft=left,acceptedRight=right;left<right;){if((size+=parsedStack[left].sizeInBytes+parsedStack[right].sizeInBytes)>32768){var howMany=acceptedRight-acceptedLeft+1;parsedStack.splice(acceptedLeft,howMany);break}acceptedLeft=left,acceptedRight=right,left++,right--}}return parsedStack}function _getErrorType(errorType){var typeName="";if(errorType&&!(typeName=errorType.typeName||errorType.name||""))try{var results=/function (.{1,200})\(/.exec(errorType.constructor.toString());typeName=results&&results.length>1?results[1]:""}catch(e){}return typeName}function _formatErrorCode(errorObj){if(errorObj)try{if(!isString(errorObj)){var errorType=_getErrorType(errorObj),result=_stringify(errorObj,!1);return result&&"{}"!==result||(errorObj.error&&(errorType=_getErrorType(errorObj=errorObj.error)),result=_stringify(errorObj,!0)),0!==strIndexOf(result,errorType)&&"String"!==errorType?errorType+":"+result:result}}catch(e){}return""+(errorObj||"")}var Exception=function(){function Exception(logger,exception,properties,measurements,severityLevel,id){this.aiDataContract={ver:1,exceptions:1,severityLevel:0,properties:0,measurements:0};this.ver=2,!function _isExceptionInternal(value){try{if(isObject(value))return"ver"in value&&"exceptions"in value&&"properties"in value}catch(e){}return!1}(exception)?(properties||(properties={}),id&&(properties.id=id),this.exceptions=[_createExceptionDetails(logger,exception,properties)],this.properties=dataSanitizeProperties(logger,properties),this.measurements=dataSanitizeMeasurements(logger,measurements),severityLevel&&(this.severityLevel=severityLevel),id&&(this.id=id)):(this.exceptions=exception.exceptions||[],this.properties=exception.properties,this.measurements=exception.measurements,exception.severityLevel&&(this.severityLevel=exception.severityLevel),exception.id&&(this.id=exception.id,exception.properties.id=exception.id),exception.problemGroup&&(this.problemGroup=exception.problemGroup),isNullOrUndefined(exception.isManual)||(this.isManual=exception.isManual))}return Exception.CreateAutoException=function(message,url,lineNumber,columnNumber,error,evt,stack,errorSrc){var errorType=_getErrorType(error||evt||message);return{message:_formatMessage(message,errorType),url,lineNumber,columnNumber,error:_formatErrorCode(error||evt||message),evt:_formatErrorCode(evt||message),typeName:errorType,stackDetails:_getStackFromErrorObj(stack||error||evt),errorSrc}},Exception.CreateFromInterface=function(logger,exception,properties,measurements){var exceptions=exception.exceptions&&arrMap(exception.exceptions,function(ex){return function _createExDetailsFromInterface(logger,exception){var parsedStack=isArray(exception.parsedStack)&&arrMap(exception.parsedStack,function(frame){return function _stackFrameFromInterface(frame){var _a,parsedFrame=(_a={},_a.aiDataContract=stackFrameAiDataContract,_a.level=frame.level,_a.method=frame.method,_a.assembly=frame.assembly,_a.fileName=frame.fileName,_a.line=frame.line,_a.sizeInBytes=0,_a);return _populateFrameSizeInBytes(parsedFrame)}(frame)})||exception.parsedStack,exceptionDetails=_createExceptionDetails(logger,__assignFn(__assignFn({},exception),{parsedStack}));return exceptionDetails}(logger,ex)});return new Exception(logger,__assignFn(__assignFn({},exception),{exceptions}),properties,measurements)},Exception.prototype.toInterface=function(){var _a=this,exceptions=_a.exceptions,properties=_a.properties,measurements=_a.measurements,severityLevel=_a.severityLevel,problemGroup=_a.problemGroup,id=_a.id,isManual=_a.isManual;return{ver:"4.0",exceptions:exceptions instanceof Array&&arrMap(exceptions,function(exception){return exception.toInterface()})||void 0,severityLevel,properties,measurements,problemGroup,id,isManual}},Exception.CreateSimpleException=function(message,typeName,assembly,fileName,details,line){var _a;return{exceptions:[(_a={},_a.hasFullStack=!0,_a.message=message,_a.stack=details,_a.typeName=typeName,_a)]}},Exception.envelopeType="Microsoft.ApplicationInsights.{0}.Exception",Exception.dataType="ExceptionData",Exception.formatError=_formatErrorCode,Exception}(),exDetailsAiDataContract=objFreeze({id:0,outerId:0,typeName:1,message:1,hasFullStack:0,stack:0,parsedStack:2});function _toInterface(){var parsedStack=isArray(this.parsedStack)&&arrMap(this.parsedStack,function(frame){return function _parsedFrameToInterface(frame){return{level:frame.level,method:frame.method,assembly:frame.assembly,fileName:frame.fileName,line:frame.line}}(frame)});return{id:this.id,outerId:this.outerId,typeName:this.typeName,message:this.message,hasFullStack:this.hasFullStack,stack:this.stack,parsedStack:parsedStack||void 0}}function _createExceptionDetails(logger,exception,properties){var _a,typeName,message,hasFullStack,theStack,parsedStack;if(function _isExceptionDetailsInternal(value){try{if(isObject(value))return"hasFullStack"in value&&"typeName"in value}catch(e){}return!1}(exception))typeName=exception.typeName,message=exception.message,theStack=exception.stack,parsedStack=exception.parsedStack||[],hasFullStack=exception.hasFullStack;else{var error=exception,evt=error&&error.evt;isError(error)||(error=error.error||evt||error),typeName=dataSanitizeString(logger,_getErrorType(error))||"not_specified",message=dataSanitizeMessage(logger,_formatMessage(exception||error,typeName))||"not_specified";var stack=exception.stackDetails||_getStackFromErrorObj(exception);parsedStack=_parseStack(stack),isArray(parsedStack)&&arrMap(parsedStack,function(frame){frame.assembly=dataSanitizeString(logger,frame.assembly),frame.fileName=dataSanitizeString(logger,frame.fileName)}),theStack=function dataSanitizeException(logger,exception){var exceptionTrunc;if(exception){var value=""+exception;value.length>32768&&(exceptionTrunc=strSubstring(value,0,32768),_throwInternal(logger,2,52,"exception is too long, it has been truncated to 32768 characters.",{exception},!0))}return exceptionTrunc||exception}(logger,function _formatStackTrace(stackDetails){var stack="";return stackDetails&&(stack=stackDetails.obj?stackDetails.obj.join("\n"):stackDetails.src||""),stack}(stack)),hasFullStack=isArray(parsedStack)&&parsedStack.length>0,properties&&(properties.typeName=properties.typeName||typeName)}return(_a={}).aiDataContract=exDetailsAiDataContract,_a.id=void 0,_a.outerId=void 0,_a.typeName=typeName,_a.message=message,_a.hasFullStack=hasFullStack,_a.stack=theStack,_a.parsedStack=parsedStack,_a.toInterface=_toInterface,_a}function _parseFilename(theFrame,fileName){var lineCol=fileName.match(PARSE_FILENAME_LINE_COL);if(lineCol&&lineCol.length>=4)theFrame.fileName=lineCol[1],theFrame.line=parseInt(lineCol[2]);else{var lineNo=fileName.match(PARSE_FILENAME_LINE_ONLY);lineNo&&lineNo.length>=3?(theFrame.fileName=lineNo[1],theFrame.line=parseInt(lineNo[2])):theFrame.fileName=fileName}}function _handleFilename(theFrame,sequence,matches){var filename=theFrame.fileName;sequence.fn&&matches&&matches.length>sequence.fn&&(sequence.ln&&matches.length>sequence.ln?(filename=strTrim(matches[sequence.fn]||""),theFrame.line=parseInt(strTrim(matches[sequence.ln]||""))||0):filename=strTrim(matches[sequence.fn]||"")),filename&&_parseFilename(theFrame,filename)}var stackFrameAiDataContract=objFreeze({level:1,method:1,assembly:0,fileName:0,line:0});function _populateFrameSizeInBytes(frame){var sizeInBytes=58;return frame&&(sizeInBytes+=frame.method.length,sizeInBytes+=frame.assembly.length,sizeInBytes+=frame.fileName.length,sizeInBytes+=frame.level.toString().length,sizeInBytes+=frame.line.toString().length,frame.sizeInBytes=sizeInBytes),frame}function generateW3CId(){for(var tmp,hexValues=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],oct="",a=0;a<4;a++)oct+=hexValues[15&(tmp=random32())]+hexValues[tmp>>4&15]+hexValues[tmp>>8&15]+hexValues[tmp>>12&15]+hexValues[tmp>>16&15]+hexValues[tmp>>20&15]+hexValues[tmp>>24&15]+hexValues[tmp>>28&15];var clockSequenceHi=hexValues[8+(3&random32())|0];return strSubstr(oct,0,8)+strSubstr(oct,9,4)+"4"+strSubstr(oct,13,3)+clockSequenceHi+strSubstr(oct,16,3)+strSubstr(oct,19,12)}var INVALID_TRACE_ID="00000000000000000000000000000000";function _isValid(value,len,invalidValue){return!(!value||value.length!==len||value===invalidValue)&&!!value.match(/^[\da-f]*$/i)}function _formatValue(value,len,defValue){return _isValid(value,len)?value:defValue}function _formatFlags(value){(isNaN(value)||value<0||value>255)&&(value=1);for(var result=value.toString(16);result.length<2;)result="0"+result;return result}function createTraceParent(traceId,spanId,flags,version){return{version:_isValid(version,2,"ff")?version:"00",traceId:isValidTraceId(traceId)?traceId:generateW3CId(),spanId:isValidSpanId(spanId)?spanId:strLeft(generateW3CId(),16),traceFlags:flags>=0&&flags<=255?flags:1}}function isValidTraceId(value){return _isValid(value,32,INVALID_TRACE_ID)}function isValidSpanId(value){return _isValid(value,16,"0000000000000000")}function formatTraceParent(value){if(value){var flags=_formatFlags(value.traceFlags);_isValid(flags,2)||(flags="01");var version=value.version||"00";return"00"!==version&&"ff"!==version&&(version="00"),"".concat(version.toLowerCase(),"-").concat(_formatValue(value.traceId,32,INVALID_TRACE_ID).toLowerCase(),"-").concat(_formatValue(value.spanId,16,"0000000000000000").toLowerCase(),"-").concat(flags.toLowerCase())}return""}var RequestHeaders=createValueMap({requestContextHeader:[0,"Request-Context"],requestContextTargetKey:[1,"appId"],requestContextAppIdFormat:[2,"appId=cid-v1:"],requestIdHeader:[3,"Request-Id"],traceParentHeader:[4,"traceparent"],traceStateHeader:[5,"tracestate"],sdkContextHeader:[6,"Sdk-Context"],sdkContextHeaderAppIdRequest:[7,"appId"],requestContextHeaderLowerCase:[8,"request-context"]}),_document=getDocument()||{},_htmlAnchorIdx=0,_htmlAnchorElement=[null,null,null,null,null];function urlParseUrl(url){var anchorIdx=_htmlAnchorIdx,anchorCache=_htmlAnchorElement,tempAnchor=anchorCache[anchorIdx];return _document.createElement?anchorCache[anchorIdx]||(tempAnchor=anchorCache[anchorIdx]=_document.createElement("a")):tempAnchor={host:urlParseHost(url,!0)},tempAnchor.href=url,++anchorIdx>=anchorCache.length&&(anchorIdx=0),_htmlAnchorIdx=anchorIdx,tempAnchor}function urlParseHost(url,inclPort){var fullHost=urlParseFullHost(url,inclPort)||"";if(fullHost){var match=fullHost.match(/(www\d{0,5}\.)?([^\/:]{1,256})(:\d{1,20})?/i);if(null!=match&&match.length>3&&isString(match[2])&&match[2].length>0)return match[2]+(match[3]||"")}return fullHost}function urlParseFullHost(url,inclPort){var result=null;if(url){var match=url.match(/(\w{1,150}):\/\/([^\/:]{1,256})(:\d{1,20})?/i);if(null!=match&&match.length>2&&isString(match[2])&&match[2].length>0&&(result=match[2]||"",inclPort&&match.length>2)){var protocol=(match[1]||"").toLowerCase(),port=match[3]||"";("http"===protocol&&":80"===port||"https"===protocol&&":443"===port)&&(port=""),result+=port}}return result}var _internalEndpoints=["https://dc.services.visualstudio.com/v2/track","https://breeze.aimon.applicationinsights.io/v2/track","https://dc-int.services.visualstudio.com/v2/track"],_correlationIdPrefix="cid-v1:";function isInternalApplicationInsightsEndpoint(endpointUrl){return-1!==arrIndexOf(_internalEndpoints,endpointUrl.toLowerCase())}function correlationIdCanIncludeCorrelationHeader(config,requestUrl,currentHost){if(!requestUrl||config&&config.disableCorrelationHeaders)return!1;if(config&&config.correlationHeaderExcludePatterns)for(var i=0;i<config.correlationHeaderExcludePatterns.length;i++)if(config.correlationHeaderExcludePatterns[i].test(requestUrl))return!1;var requestHost=urlParseUrl(requestUrl).host.toLowerCase();if(!requestHost||-1===strIndexOf(requestHost,":443")&&-1===strIndexOf(requestHost,":80")||(requestHost=(urlParseFullHost(requestUrl,!0)||"").toLowerCase()),(!config||!config.enableCorsCorrelation)&&requestHost&&requestHost!==currentHost)return!1;var matchExists_1,includedDomains=config&&config.correlationHeaderDomains;if(includedDomains&&(arrForEach(includedDomains,function(domain){var regex=new RegExp(domain.toLowerCase().replace(/\\/g,"\\\\").replace(/\./g,"\\.").replace(/\*/g,".*"));matchExists_1=matchExists_1||regex.test(requestHost)}),!matchExists_1))return!1;var excludedDomains=config&&config.correlationHeaderExcludedDomains;if(!excludedDomains||0===excludedDomains.length)return!0;for(i=0;i<excludedDomains.length;i++){if(new RegExp(excludedDomains[i].toLowerCase().replace(/\\/g,"\\\\").replace(/\./g,"\\.").replace(/\*/g,".*")).test(requestHost))return!1}return requestHost&&requestHost.length>0}function correlationIdGetCorrelationContext(responseHeader){if(responseHeader){var correlationId=function correlationIdGetCorrelationContextValue(responseHeader,key){if(responseHeader)for(var keyValues=responseHeader.split(","),i=0;i<keyValues.length;++i){var keyValue=keyValues[i].split("=");if(2===keyValue.length&&keyValue[0]===key)return keyValue[1]}}(responseHeader,RequestHeaders[1]);if(correlationId&&correlationId!==_correlationIdPrefix)return correlationId}}function dateTimeUtilsNow(){var perf=getPerformance();if(perf&&perf.now&&perf.timing){var now=perf.now()+perf.timing.navigationStart;if(now>0)return now}return utcNow()}function dateTimeUtilsDuration(start,end){var result=null;return 0===start||0===end||isNullOrUndefined(start)||isNullOrUndefined(end)||(result=end-start),result}function createDistributedTraceContextFromTrace(telemetryTrace,parentCtx){var trace=telemetryTrace||{};return{getName:function(){return trace.name},setName:function(newValue){parentCtx&&parentCtx.setName(newValue),trace.name=newValue},getTraceId:function(){return trace.traceID},setTraceId:function(newValue){parentCtx&&parentCtx.setTraceId(newValue),isValidTraceId(newValue)&&(trace.traceID=newValue)},getSpanId:function(){return trace.parentID},setSpanId:function(newValue){parentCtx&&parentCtx.setSpanId(newValue),isValidSpanId(newValue)&&(trace.parentID=newValue)},getTraceFlags:function(){return trace.traceFlags},setTraceFlags:function(newTraceFlags){parentCtx&&parentCtx.setTraceFlags(newTraceFlags),trace.traceFlags=newTraceFlags}}}var CookieMgr_a,_b,RemoteDependencyData=function(){function RemoteDependencyData(logger,id,absoluteUrl,commandName,value,success,resultCode,method,requestAPI,correlationContext,properties,measurements){void 0===requestAPI&&(requestAPI="Ajax"),this.aiDataContract={id:1,ver:1,name:0,resultCode:0,duration:0,success:0,data:0,target:0,type:0,properties:0,measurements:0,kind:0,value:0,count:0,min:0,max:0,stdDev:0,dependencyKind:0,dependencySource:0,commandName:0,dependencyTypeName:0};this.ver=2,this.id=id,this.duration=msToTimeSpan(value),this.success=success,this.resultCode=resultCode+"",this.type=dataSanitizeString(logger,requestAPI);var dependencyFields=function AjaxHelperParseDependencyPath(logger,absoluteUrl,method,commandName){var target,name=commandName,data=commandName;if(absoluteUrl&&absoluteUrl.length>0){var parsedUrl=urlParseUrl(absoluteUrl);if(target=parsedUrl.host,!name)if(null!=parsedUrl.pathname){var pathName=0===parsedUrl.pathname.length?"/":parsedUrl.pathname;"/"!==pathName.charAt(0)&&(pathName="/"+pathName),data=parsedUrl.pathname,name=dataSanitizeString(logger,method?method+" "+pathName:pathName)}else name=dataSanitizeString(logger,absoluteUrl)}else target=commandName,name=commandName;return{target,name,data}}(logger,absoluteUrl,method,commandName);this.data=dataSanitizeUrl(logger,commandName)||dependencyFields.data,this.target=dataSanitizeString(logger,dependencyFields.target),correlationContext&&(this.target="".concat(this.target," | ").concat(correlationContext)),this.name=dataSanitizeString(logger,dependencyFields.name),this.properties=dataSanitizeProperties(logger,properties),this.measurements=dataSanitizeMeasurements(logger,measurements)}return RemoteDependencyData.envelopeType="Microsoft.ApplicationInsights.{0}.RemoteDependency",RemoteDependencyData.dataType="RemoteDependencyData",RemoteDependencyData}();function createDomEvent(eventName){var event=null;if(isFunction(Event))event=new Event(eventName);else{var doc=getDocument();doc&&doc.createEvent&&(event=doc.createEvent("Event")).initEvent(eventName,!0,!0)}return event}function _stringToBoolOrDefault(theValue,defaultValue,theConfig){return!theValue&&isNullOrUndefined(theValue)?defaultValue:isBoolean(theValue)?theValue:"true"===asString(theValue).toLowerCase()}function cfgDfMerge(defaultValue){return{mrg:!0,v:defaultValue}}function cfgDfSet(setter,defaultValue){return{set:setter,v:defaultValue}}function cfgDfValidate(validator,defaultValue,fallBackName){return{fb:fallBackName,isVal:validator,v:defaultValue}}function cfgDfBoolean(defaultValue,fallBackName){return{fb:fallBackName,set:_stringToBoolOrDefault,v:!!defaultValue}}var _doc,_supportsCookies=null,_allowUaSameSite=null,_parsedCookieValue=null,_cookieCache={},_globalCookieConfig={},rootDefaultConfig=((CookieMgr_a={cookieCfg:cfgDfMerge((_b={},_b.domain={fb:"cookieDomain",dfVal:isNotNullOrUndefined},_b.path={fb:"cookiePath",dfVal:isNotNullOrUndefined},_b.enabled=void 0,_b.ignoreCookies=void 0,_b.blockedCookies=void 0,_b.disableCookieDefer=!1,_b)),cookieDomain:void 0,cookiePath:void 0}).disableCookiesUsage=void 0,CookieMgr_a);function _getDoc(){!_doc&&(_doc=getLazy(function(){return getDocument()}))}function _isMgrEnabled(cookieMgr){return!cookieMgr||cookieMgr.isEnabled()}function _isIgnoredCookie(cookieMgrCfg,name){return!!(name&&cookieMgrCfg&&isArray(cookieMgrCfg.ignoreCookies))&&-1!==arrIndexOf(cookieMgrCfg.ignoreCookies,name)}function _isBlockedCookie(cookieMgrCfg,name){return!!(name&&cookieMgrCfg&&isArray(cookieMgrCfg.blockedCookies)&&-1!==arrIndexOf(cookieMgrCfg.blockedCookies,name))||_isIgnoredCookie(cookieMgrCfg,name)}function _isCfgEnabled(rootConfig,cookieMgrConfig){var isCfgEnabled=cookieMgrConfig.enabled;if(isNullOrUndefined(isCfgEnabled)){var cookieEnabled=void 0;isUndefined(rootConfig.isCookieUseDisabled)||(cookieEnabled=!rootConfig.isCookieUseDisabled),isUndefined(rootConfig.disableCookiesUsage)||(cookieEnabled=!rootConfig.disableCookiesUsage),isCfgEnabled=cookieEnabled}return isCfgEnabled}function safeGetCookieMgr(core,config){var cookieMgr;if(core)cookieMgr=core.getCookieMgr();else if(config){var cookieCfg=config.cookieCfg;cookieMgr=cookieCfg&&cookieCfg._ckMgr?cookieCfg._ckMgr:createCookieMgr(config)}return cookieMgr||(cookieMgr=function _gblCookieMgr(config,logger){var inst=createCookieMgr._ckMgr||_globalCookieConfig._ckMgr;return inst||(inst=createCookieMgr._ckMgr=createCookieMgr(config,logger),_globalCookieConfig._ckMgr=inst),inst}(config,(core||{}).logger)),cookieMgr}function createCookieMgr(rootConfig,logger){var cookieMgrConfig,_path,_domain,unloadHandler,_enabled,_getCookieFn,_setCookieFn,_delCookieFn,_pendingCookies=[];function _formatDeletionValue(path){var _a,values=((_a={}).path=path||"/",_a.expires="Thu, 01 Jan 1970 00:00:01 GMT",_a);return isIE()||(values["max-age"]="0"),_formatCookieValue("",values)}function _formatSetCookieValue(value,maxAgeSec,domain,path){var values={},theValue=strTrim(value||""),idx=strIndexOf(theValue,";");if(-1!==idx&&(theValue=strTrim(strLeft(value,idx)),values=_extractParts(strSubstring(value,idx+1))),setValue(values,"domain",domain||_domain,isTruthy,isUndefined),!isNullOrUndefined(maxAgeSec)){var _isIE=isIE();if(isUndefined(values.expires)){var expireMs=utcNow()+1e3*maxAgeSec;if(expireMs>0){var expiry=new Date;expiry.setTime(expireMs),setValue(values,"expires",_formatDate(expiry,_isIE?"toGMTString":"toUTCString")||_formatDate(expiry,_isIE?"toGMTString":"toUTCString")||"",isTruthy)}}_isIE||setValue(values,"max-age",""+maxAgeSec,null,isUndefined)}var location=getLocation();return location&&"https:"===location.protocol&&(setValue(values,"secure",null,null,isUndefined),null===_allowUaSameSite&&(_allowUaSameSite=!function uaDisallowsSameSiteNone(userAgent){if(!isString(userAgent))return!1;if(HelperFuncs_strContains(userAgent,"CPU iPhone OS 12")||HelperFuncs_strContains(userAgent,"iPad; CPU OS 12"))return!0;if(HelperFuncs_strContains(userAgent,"Macintosh; Intel Mac OS X 10_14")&&HelperFuncs_strContains(userAgent,"Version/")&&HelperFuncs_strContains(userAgent,"Safari"))return!0;if(HelperFuncs_strContains(userAgent,"Macintosh; Intel Mac OS X 10_14")&&strEndsWith(userAgent,"AppleWebKit/605.1.15 (KHTML, like Gecko)"))return!0;if(HelperFuncs_strContains(userAgent,"Chrome/5")||HelperFuncs_strContains(userAgent,"Chrome/6"))return!0;if(HelperFuncs_strContains(userAgent,"UnrealEngine")&&!HelperFuncs_strContains(userAgent,"Chrome"))return!0;if(HelperFuncs_strContains(userAgent,"UCBrowser/12")||HelperFuncs_strContains(userAgent,"UCBrowser/11"))return!0;return!1}((getNavigator()||{}).userAgent)),_allowUaSameSite&&setValue(values,"SameSite","None",null,isUndefined)),setValue(values,"path",path||_path,null,isUndefined),_formatCookieValue(theValue,values)}function _removePendingCookie(name){if(_pendingCookies)for(var i=_pendingCookies.length-1;i>=0;i--)_pendingCookies[i].n===name&&_pendingCookies.splice(i,1)}rootConfig=createDynamicConfig(rootConfig||_globalCookieConfig,null,logger).cfg,unloadHandler=onConfigChange(rootConfig,function(details){details.setDf(details.cfg,rootDefaultConfig),cookieMgrConfig=details.ref(details.cfg,"cookieCfg"),_path=cookieMgrConfig.path||"/",_domain=cookieMgrConfig.domain,cookieMgrConfig.disableCookieDefer?_pendingCookies=null:null===_pendingCookies&&(_pendingCookies=[]);var wasEnabled=_enabled;_enabled=!1!==_isCfgEnabled(rootConfig,cookieMgrConfig),_getCookieFn=cookieMgrConfig.getCookie||_getCookieValue,_setCookieFn=cookieMgrConfig.setCookie||_setCookieValue,_delCookieFn=cookieMgrConfig.delCookie||_setCookieValue,!wasEnabled&&_enabled&&_pendingCookies&&function _flushPendingCookies(){areCookiesSupported(logger)&&_pendingCookies&&(arrForEach(_pendingCookies,function(pendingData){_isBlockedCookie(cookieMgrConfig,pendingData.n)||(0===pendingData.o?_setCookieFn(pendingData.n,pendingData.v):1===pendingData.o&&_delCookieFn(pendingData.n,pendingData.v))}),_pendingCookies=[])}()},logger);var cookieMgr={isEnabled:function(){var enabled=!1!==_isCfgEnabled(rootConfig,cookieMgrConfig)&&_enabled&&areCookiesSupported(logger),gblManager=_globalCookieConfig._ckMgr;return enabled&&gblManager&&cookieMgr!==gblManager&&(enabled=_isMgrEnabled(gblManager)),enabled},setEnabled:function(value){cookieMgrConfig.enabled=value,isUndefined(rootConfig.disableCookiesUsage)||(rootConfig.disableCookiesUsage=!value)},set:function(name,value,maxAgeSec,domain,path){var result=!1;if(!_isBlockedCookie(cookieMgrConfig,name)){var cookieValue=_formatSetCookieValue(value,maxAgeSec,domain,path);_isMgrEnabled(cookieMgr)?(_setCookieFn(name,cookieValue),result=!0):_pendingCookies&&(_removePendingCookie(name),_pendingCookies.push({n:name,o:0,v:cookieValue}),result=!0)}return result},get:function(name){var value="";if(!_isIgnoredCookie(cookieMgrConfig,name))if(_isMgrEnabled(cookieMgr))value=_getCookieFn(name);else if(_pendingCookies)for(var i=_pendingCookies.length-1;i>=0;i--){var pendingData=_pendingCookies[i];if(pendingData.n===name){if(0===pendingData.o){var cookieValue=pendingData.v,idx=strIndexOf(cookieValue,";");value=strTrim(-1!==idx?strLeft(cookieValue,idx):cookieValue)}break}}return value},del:function(name,path){var result=!1;return _isMgrEnabled(cookieMgr)?result=cookieMgr.purge(name,path):_pendingCookies&&(_removePendingCookie(name),_pendingCookies.push({n:name,o:1,v:_formatDeletionValue(path)}),result=!0),result},purge:function(name,path){var result=!1;return areCookiesSupported(logger)&&(_delCookieFn(name,_formatDeletionValue(path)),result=!0),result},unload:function(isAsync){unloadHandler&&unloadHandler.rm(),unloadHandler=null,_pendingCookies=null}};return cookieMgr._ckMgr=cookieMgr,cookieMgr}function areCookiesSupported(logger){if(null===_supportsCookies){_supportsCookies=!1,!_doc&&_getDoc();try{var doc=_doc.v||{};_supportsCookies=void 0!==doc.cookie}catch(e){_throwInternal(logger,2,68,"Cannot access document.cookie - "+getExceptionName(e),{exception:dumpObj(e)})}}return _supportsCookies}function _extractParts(theValue){var values={};theValue&&theValue.length&&arrForEach(strTrim(theValue).split(";"),function(thePart){if(thePart=strTrim(thePart||"")){var idx=strIndexOf(thePart,"=");-1===idx?values[thePart]=null:values[strTrim(strLeft(thePart,idx))]=strTrim(strSubstring(thePart,idx+1))}});return values}function _formatDate(theDate,func){return isFunction(theDate[func])?theDate[func]():null}function _formatCookieValue(value,values){var cookieValue=value||"";return objForEachKey(values,function(name,theValue){cookieValue+="; "+name+(isNullOrUndefined(theValue)?"":"="+theValue)}),cookieValue}function _getCookieValue(name){var cookieValue="";if(!_doc&&_getDoc(),_doc.v){var theCookie=_doc.v.cookie||"";_parsedCookieValue!==theCookie&&(_cookieCache=_extractParts(theCookie),_parsedCookieValue=theCookie),cookieValue=strTrim(_cookieCache[name]||"")}return cookieValue}function _setCookieValue(name,cookieValue){!_doc&&_getDoc(),_doc.v&&(_doc.v.cookie=name+"="+cookieValue)}var strPageHideNamespace=createUniqueNamespace("aiEvtPageHide"),rRemoveEmptyNs=(createUniqueNamespace("aiEvtPageShow"),/\.[\.]+/g),rRemoveTrailingEmptyNs=/[\.]+$/,_guid=1,elmNodeData=createElmNodeData("events"),eventNamespace=/^([^.]*)(?:\.(.+)|)/;function _normalizeNamespace(name){return name&&name.replace?name.replace(/^[\s\.]+|(?=[\s\.])[\.\s]+$/g,""):name}function _getEvtNamespace(eventName,evtNamespace){if(evtNamespace){var theNamespace_1="";isArray(evtNamespace)?(theNamespace_1="",arrForEach(evtNamespace,function(name){(name=_normalizeNamespace(name))&&("."!==name[0]&&(name="."+name),theNamespace_1+=name)})):theNamespace_1=_normalizeNamespace(evtNamespace),theNamespace_1&&("."!==theNamespace_1[0]&&(theNamespace_1="."+theNamespace_1),eventName=(eventName||"")+theNamespace_1)}var parsedEvent=eventNamespace.exec(eventName||"")||[];return{type:parsedEvent[1],ns:(parsedEvent[2]||"").replace(rRemoveEmptyNs,".").replace(rRemoveTrailingEmptyNs,"").split(".").sort().join(".")}}function _getRegisteredEvents(target,evtName,addDefault){void 0===addDefault&&(addDefault=!0);var aiEvts=elmNodeData.get(target,"events",{},addDefault),registeredEvents=aiEvts[evtName];return registeredEvents||(registeredEvents=aiEvts[evtName]=[]),registeredEvents}function _doDetach(obj,evtName,handlerRef,useCapture){obj&&evtName&&evtName.type&&(obj.removeEventListener?obj.removeEventListener(evtName.type,handlerRef,useCapture):obj.detachEvent&&obj.detachEvent("on"+evtName.type,handlerRef))}function _doUnregister(target,events,evtName,unRegFn){for(var idx=events.length;idx--;){var theEvent=events[idx];theEvent&&(evtName.ns&&evtName.ns!==theEvent.evtName.ns||unRegFn&&!unRegFn(theEvent)||(_doDetach(target,theEvent.evtName,theEvent.handler,theEvent.capture),events.splice(idx,1)))}}function mergeEvtNamespace(theNamespace,namespaces){return namespaces?_getEvtNamespace("xx",isArray(namespaces)?[theNamespace].concat(namespaces):[theNamespace,namespaces]).ns.split("."):theNamespace}function eventOn(target,eventName,handlerRef,evtNamespace,useCapture){void 0===useCapture&&(useCapture=!1);var result=!1;if(target)try{var evtName=_getEvtNamespace(eventName,evtNamespace);if(result=function _doAttach(obj,evtName,handlerRef,useCapture){var result=!1;return obj&&evtName&&evtName.type&&handlerRef&&(obj.addEventListener?(obj.addEventListener(evtName.type,handlerRef,useCapture),result=!0):obj.attachEvent&&(obj.attachEvent("on"+evtName.type,handlerRef),result=!0)),result}(target,evtName,handlerRef,useCapture),result&&elmNodeData.accept(target)){var registeredEvent={guid:_guid++,evtName,handler:handlerRef,capture:useCapture};_getRegisteredEvents(target,evtName.type).push(registeredEvent)}}catch(e){}return result}function eventOff(target,eventName,handlerRef,evtNamespace,useCapture){if(void 0===useCapture&&(useCapture=!1),target)try{var evtName_1=_getEvtNamespace(eventName,evtNamespace),found_1=!1;!function _unregisterEvents(target,evtName,unRegFn){if(evtName.type)_doUnregister(target,_getRegisteredEvents(target,evtName.type),evtName,unRegFn);else{var eventCache=elmNodeData.get(target,"events",{});objForEachKey(eventCache,function(evtType,events){_doUnregister(target,events,evtName,unRegFn)}),0===objKeys(eventCache).length&&elmNodeData.kill(target,"events")}}(target,evtName_1,function(regEvent){return!((!evtName_1.ns||handlerRef)&&regEvent.handler!==handlerRef)&&(found_1=!0,!0)}),found_1||_doDetach(target,evtName_1,handlerRef,useCapture)}catch(e){}}function _addEventListeners(events,listener,excludeEvents,evtNamespace){var added=!1;return listener&&events&&events.length>0&&arrForEach(events,function(name){name&&(excludeEvents&&-1!==arrIndexOf(excludeEvents,name)||(added=function addEventHandler(eventName,callback,evtNamespace){var result=!1,w=getWindow();w&&(result=eventOn(w,eventName,callback,evtNamespace),result=eventOn(w.body,eventName,callback,evtNamespace)||result);var doc=getDocument();return doc&&(result=eventOn(doc,eventName,callback,evtNamespace)||result),result}(name,listener,evtNamespace)||added))}),added}function removeEventListeners(events,listener,evtNamespace){events&&isArray(events)&&arrForEach(events,function(name){name&&function removeEventHandler(eventName,callback,evtNamespace){var w=getWindow();w&&(eventOff(w,eventName,callback,evtNamespace),eventOff(w.body,eventName,callback,evtNamespace));var doc=getDocument();doc&&eventOff(doc,eventName,callback,evtNamespace)}(name,listener,evtNamespace)})}function addPageUnloadEventListener(listener,excludeEvents,evtNamespace){return function addEventListeners(events,listener,excludeEvents,evtNamespace){var added=!1;return listener&&events&&isArray(events)&&!(added=_addEventListeners(events,listener,excludeEvents,evtNamespace))&&excludeEvents&&excludeEvents.length>0&&(added=_addEventListeners(events,listener,null,evtNamespace)),added}(["beforeunload","unload","pagehide"],listener,excludeEvents,evtNamespace)}function addPageHideEventListener(listener,excludeEvents,evtNamespace){var newNamespaces=mergeEvtNamespace(strPageHideNamespace,evtNamespace),pageUnloadAdded=_addEventListeners(["pagehide"],listener,excludeEvents,newNamespaces);return excludeEvents&&-1!==arrIndexOf(excludeEvents,"visibilitychange")||(pageUnloadAdded=_addEventListeners(["visibilitychange"],function _handlePageVisibility(evt){var doc=getDocument();listener&&doc&&"hidden"===doc.visibilityState&&listener(evt)},excludeEvents,newNamespaces)||pageUnloadAdded),!pageUnloadAdded&&excludeEvents&&(pageUnloadAdded=addPageHideEventListener(listener,null,evtNamespace)),pageUnloadAdded}var _defaultPerfManager=null,PerfEvent=function(){function PerfEvent(name,payloadDetails,isAsync){var theDetails_1,_self=this;(_self.start=utcNow(),_self.name=name,_self.isAsync=isAsync,_self.isChildEvt=function(){return!1},isFunction(payloadDetails))&&objDefine(_self,"payload",{g:function(){return!theDetails_1&&isFunction(payloadDetails)&&(theDetails_1=payloadDetails(),payloadDetails=null),theDetails_1}});_self.getCtx=function(key){return key?key===PerfEvent.ParentContextKey||key===PerfEvent.ChildrenContextKey?_self[key]:(_self.ctx||{})[key]:null},_self.setCtx=function(key,value){if(key)if(key===PerfEvent.ParentContextKey)_self[key]||(_self.isChildEvt=function(){return!0}),_self[key]=value;else if(key===PerfEvent.ChildrenContextKey)_self[key]=value;else{(_self.ctx=_self.ctx||{})[key]=value}},_self.complete=function(){var childTime=0,childEvts=_self.getCtx(PerfEvent.ChildrenContextKey);if(isArray(childEvts))for(var lp=0;lp<childEvts.length;lp++){var childEvt=childEvts[lp];childEvt&&(childTime+=childEvt.time)}_self.time=utcNow()-_self.start,_self.exTime=_self.time-childTime,_self.complete=function(){}}}return PerfEvent.ParentContextKey="parent",PerfEvent.ChildrenContextKey="childEvts",PerfEvent}(),PerfManager=function(){function PerfManager(manager){this.ctx={},dynamicProto(PerfManager,this,function(_self){_self.create=function(src,payloadDetails,isAsync){return new PerfEvent(src,payloadDetails,isAsync)},_self.fire=function(perfEvent){perfEvent&&(perfEvent.complete(),manager&&isFunction(manager.perfEvent)&&manager.perfEvent(perfEvent))},_self.setCtx=function(key,value){key&&((_self.ctx=_self.ctx||{})[key]=value)},_self.getCtx=function(key){return(_self.ctx||{})[key]}})}return PerfManager.__ieDyn=1,PerfManager}();function doPerf(mgrSource,getSource,func,details,isAsync){if(mgrSource){var perfMgr=mgrSource;if(perfMgr.getPerfMgr&&(perfMgr=perfMgr.getPerfMgr()),perfMgr){var perfEvt=void 0,currentActive=perfMgr.getCtx("CoreUtils.doPerf");try{if(perfEvt=perfMgr.create(getSource(),details,isAsync)){if(currentActive&&perfEvt.setCtx&&(perfEvt.setCtx(PerfEvent.ParentContextKey,currentActive),currentActive.getCtx&&currentActive.setCtx)){var children=currentActive.getCtx(PerfEvent.ChildrenContextKey);children||(children=[],currentActive.setCtx(PerfEvent.ChildrenContextKey,children)),children.push(perfEvt)}return perfMgr.setCtx("CoreUtils.doPerf",perfEvt),func(perfEvt)}}catch(ex){perfEvt&&perfEvt.setCtx&&perfEvt.setCtx("exception",ex)}finally{perfEvt&&perfMgr.fire(perfEvt),perfMgr.setCtx("CoreUtils.doPerf",currentActive)}}}return func()}var pluginStateData=createElmNodeData("plugin");function _getPluginState(plugin){return pluginStateData.get(plugin,"state",{},!0)}function initializePlugins(processContext,extensions){for(var pluginState,initPlugins=[],lastPlugin=null,proxy=processContext.getNext();proxy;){var thePlugin=proxy.getPlugin();if(thePlugin){lastPlugin&&lastPlugin.setNextPlugin&&thePlugin.processTelemetry&&lastPlugin.setNextPlugin(thePlugin);var isInitialized=!!(pluginState=_getPluginState(thePlugin)).isInitialized;thePlugin.isInitialized&&(isInitialized=thePlugin.isInitialized()),isInitialized||initPlugins.push(thePlugin),lastPlugin=thePlugin,proxy=proxy.getNext()}}arrForEach(initPlugins,function(thePlugin){var core=processContext.core();thePlugin.initialize(processContext.getCfg(),core,extensions,processContext.getNext()),pluginState=_getPluginState(thePlugin),thePlugin.core||pluginState.core||(pluginState.core=core),pluginState.isInitialized=!0,delete pluginState.teardown})}function sortPlugins(plugins){return plugins.sort(function(extA,extB){var result=0;if(extB){var bHasProcess=extB.processTelemetry;extA.processTelemetry?result=bHasProcess?extA.priority-extB.priority:1:bHasProcess&&(result=-1)}else result=extA?1:-1;return result})}var _chainId=0;function _createInternalContext(telemetryChain,dynamicHandler,core,startAt){var _nextProxy=null,_onComplete=[];dynamicHandler||(dynamicHandler=createDynamicConfig({},null,core.logger)),null!==startAt&&(_nextProxy=startAt?function _getNextProxyStart(proxy,core,startAt){for(;proxy;){if(proxy.getPlugin()===startAt)return proxy;proxy=proxy.getNext()}return createTelemetryProxyChain([startAt],core.config||{},core)}(telemetryChain,core,startAt):telemetryChain);var context={_next:function _moveNext(){var nextProxy=_nextProxy;if(_nextProxy=nextProxy?nextProxy.getNext():null,!nextProxy){var onComplete=_onComplete;onComplete&&onComplete.length>0&&(arrForEach(onComplete,function(completeDetails){try{completeDetails.func.call(completeDetails.self,completeDetails.args)}catch(e){_throwInternal(core.logger,2,73,"Unexpected Exception during onComplete - "+dumpObj(e))}}),_onComplete=[])}return nextProxy},ctx:{core:function(){return core},diagLog:function(){return safeGetLogger(core,dynamicHandler.cfg)},getCfg:function(){return dynamicHandler.cfg},getExtCfg:function _resolveExtCfg(identifier,defaultValues){var newConfig=_getExtCfg(identifier,!0);defaultValues&&objForEachKey(defaultValues,function(field,defaultValue){if(isNullOrUndefined(newConfig[field])){var cfgValue=dynamicHandler.cfg[field];!cfgValue&&isNullOrUndefined(cfgValue)||(newConfig[field]=cfgValue)}_applyDefaultValue(dynamicHandler,newConfig,field,defaultValue)});return dynamicHandler.setDf(newConfig,defaultValues)},getConfig:function _getConfig(identifier,field,defaultValue){void 0===defaultValue&&(defaultValue=!1);var theValue,extConfig=_getExtCfg(identifier,!1),rootConfig=dynamicHandler.cfg;!extConfig||!extConfig[field]&&isNullOrUndefined(extConfig[field])?!rootConfig[field]&&isNullOrUndefined(rootConfig[field])||(theValue=rootConfig[field]):theValue=extConfig[field];return theValue||!isNullOrUndefined(theValue)?theValue:defaultValue},hasNext:function(){return!!_nextProxy},getNext:function(){return _nextProxy},setNext:function(nextPlugin){_nextProxy=nextPlugin},iterate:function _iterateChain(cb){var nextPlugin;for(;nextPlugin=context._next();){var plugin=nextPlugin.getPlugin();plugin&&cb(plugin)}},onComplete:function _addOnComplete(onComplete,that){for(var args=[],_i=2;_i<arguments.length;_i++)args[_i-2]=arguments[_i];onComplete&&_onComplete.push({func:onComplete,self:isUndefined(that)?context.ctx:that,args})}}};function _getExtCfg(identifier,createIfMissing){var idCfg=null,cfg=dynamicHandler.cfg;if(cfg&&identifier){var extCfg=cfg.extensionConfig;!extCfg&&createIfMissing&&(extCfg={}),cfg.extensionConfig=extCfg,(extCfg=dynamicHandler.ref(cfg,"extensionConfig"))&&(!(idCfg=extCfg[identifier])&&createIfMissing&&(idCfg={}),extCfg[identifier]=idCfg,idCfg=dynamicHandler.ref(extCfg,identifier))}return idCfg}return context}function createProcessTelemetryContext(telemetryChain,cfg,core,startAt){var config=createDynamicConfig(cfg),internalContext=_createInternalContext(telemetryChain,config,core,startAt),context=internalContext.ctx;return context.processNext=function _processNext(env){var nextPlugin=internalContext._next();return nextPlugin&&nextPlugin.processTelemetry(env,context),!nextPlugin},context.createNew=function _createNew(plugins,startAt){return void 0===plugins&&(plugins=null),isArray(plugins)&&(plugins=createTelemetryProxyChain(plugins,config.cfg,core,startAt)),createProcessTelemetryContext(plugins||context.getNext(),config.cfg,core,startAt)},context}function createProcessTelemetryUnloadContext(telemetryChain,core,startAt){var config=createDynamicConfig(core.config),internalContext=_createInternalContext(telemetryChain,config,core,startAt),context=internalContext.ctx;return context.processNext=function _processNext(unloadState){var nextPlugin=internalContext._next();return nextPlugin&&nextPlugin.unload(context,unloadState),!nextPlugin},context.createNew=function _createNew(plugins,startAt){return void 0===plugins&&(plugins=null),isArray(plugins)&&(plugins=createTelemetryProxyChain(plugins,config.cfg,core,startAt)),createProcessTelemetryUnloadContext(plugins||context.getNext(),core,startAt)},context}function createProcessTelemetryUpdateContext(telemetryChain,core,startAt){var config=createDynamicConfig(core.config),context=_createInternalContext(telemetryChain,config,core,startAt).ctx;return context.processNext=function _processNext(updateState){return context.iterate(function(plugin){isFunction(plugin.update)&&plugin.update(context,updateState)})},context.createNew=function _createNew(plugins,startAt){return void 0===plugins&&(plugins=null),isArray(plugins)&&(plugins=createTelemetryProxyChain(plugins,config.cfg,core,startAt)),createProcessTelemetryUpdateContext(plugins||context.getNext(),core,startAt)},context}function createTelemetryProxyChain(plugins,config,core,startAt){var firstProxy=null,add=!startAt;if(isArray(plugins)&&plugins.length>0){var lastProxy_1=null;arrForEach(plugins,function(thePlugin){if(add||startAt!==thePlugin||(add=!0),add&&thePlugin&&isFunction(thePlugin.processTelemetry)){var newProxy=function createTelemetryPluginProxy(plugin,config,core){var chainId,nextProxy=null,hasProcessTelemetry=isFunction(plugin.processTelemetry),hasSetNext=isFunction(plugin.setNextPlugin);chainId=plugin?plugin.identifier+"-"+plugin.priority+"-"+_chainId++:"Unknown-0-"+_chainId++;var proxyChain={getPlugin:function(){return plugin},getNext:function(){return nextProxy},processTelemetry:_processTelemetry,unload:_unloadPlugin,update:_updatePlugin,_id:chainId,_setNext:function(nextPlugin){nextProxy=nextPlugin}};function _getTelCtx(){var itemCtx;return plugin&&isFunction(plugin._getTelCtx)&&(itemCtx=plugin._getTelCtx()),itemCtx||(itemCtx=createProcessTelemetryContext(proxyChain,config,core)),itemCtx}function _processChain(itemCtx,processPluginFn,name,details,isAsync){var hasRun=!1,identifier=plugin?plugin.identifier:"TelemetryPluginChain",hasRunContext=itemCtx._hasRun;return hasRunContext||(hasRunContext=itemCtx._hasRun={}),itemCtx.setNext(nextProxy),plugin&&doPerf(itemCtx.core(),function(){return identifier+":"+name},function(){hasRunContext[chainId]=!0;try{var nextId=nextProxy?nextProxy._id:"";nextId&&(hasRunContext[nextId]=!1),hasRun=processPluginFn(itemCtx)}catch(error){var hasNextRun=!nextProxy||hasRunContext[nextProxy._id];hasNextRun&&(hasRun=!0),nextProxy&&hasNextRun||_throwInternal(itemCtx.diagLog(),1,73,"Plugin ["+identifier+"] failed during "+name+" - "+dumpObj(error)+", run flags: "+dumpObj(hasRunContext))}},details,isAsync),hasRun}function _processTelemetry(env,itemCtx){function _callProcessTelemetry(itemCtx){if(!plugin||!hasProcessTelemetry)return!1;var pluginState=_getPluginState(plugin);return!pluginState.teardown&&!pluginState.disabled&&(hasSetNext&&plugin.setNextPlugin(nextProxy),plugin.processTelemetry(env,itemCtx),!0)}_processChain(itemCtx=itemCtx||_getTelCtx(),_callProcessTelemetry,"processTelemetry",function(){return{item:env}},!env.sync)||itemCtx.processNext(env)}function _unloadPlugin(unloadCtx,unloadState){function _callTeardown(){var hasRun=!1;if(plugin){var pluginState=_getPluginState(plugin),pluginCore=plugin.core||pluginState.core;!plugin||pluginCore&&pluginCore!==unloadCtx.core()||pluginState.teardown||(pluginState.core=null,pluginState.teardown=!0,pluginState.isInitialized=!1,plugin.teardown&&!0===plugin.teardown(unloadCtx,unloadState)&&(hasRun=!0))}return hasRun}_processChain(unloadCtx,_callTeardown,"unload",function(){},unloadState.isAsync)||unloadCtx.processNext(unloadState)}function _updatePlugin(updateCtx,updateState){function _callUpdate(){var hasRun=!1;if(plugin){var pluginState=_getPluginState(plugin),pluginCore=plugin.core||pluginState.core;!plugin||pluginCore&&pluginCore!==updateCtx.core()||pluginState.teardown||plugin.update&&!0===plugin.update(updateCtx,updateState)&&(hasRun=!0)}return hasRun}_processChain(updateCtx,_callUpdate,"update",function(){},!1)||updateCtx.processNext(updateState)}return objFreeze(proxyChain)}(thePlugin,config,core);firstProxy||(firstProxy=newProxy),lastProxy_1&&lastProxy_1._setNext(newProxy),lastProxy_1=newProxy}})}return startAt&&!firstProxy?createTelemetryProxyChain([startAt],config,core):firstProxy}var _maxHooks,_hookAddMonitor,BaseTelemetryPlugin_a,cbNames=["req","rsp","hkErr","fnErr"];function _arrLoop(arr,fn){if(arr)for(var lp=0;lp<arr.length&&!fn(arr[lp],lp);lp++);}function _doCallbacks(hooks,callDetails,cbArgs,hookCtx,type){type>=0&&type<=2&&_arrLoop(hooks,function(hook,idx){var cbks=hook.cbks,cb=cbks[cbNames[type]];if(cb){callDetails.ctx=function(){return hookCtx[idx]=hookCtx[idx]||{}};try{cb.apply(callDetails.inst,cbArgs)}catch(err){var orgEx=callDetails.err;try{var hookErrorCb=cbks[cbNames[2]];hookErrorCb&&(callDetails.err=err,hookErrorCb.apply(callDetails.inst,cbArgs))}catch(e){}finally{callDetails.err=orgEx}}}})}function _getOwner(target,name,checkPrototype,checkParentProto){var owner=null;return target&&(objHasOwnProperty(target,name)?owner=target:checkPrototype&&(owner=_getOwner(HelperFuncs_getObjProto(target),name,checkParentProto,!1))),owner}function _createInstrumentHook(owner,funcName,fn,callbacks){var aiHook=fn&&fn._aiHooks;if(!aiHook){var newFunc=function _createFunctionHook(aiHook){return function(){var orgArgs=arguments,hooks=aiHook.h,funcArgs={name:aiHook.n,inst:this,ctx:null,set:function _replaceArg(idx,value){(orgArgs=_createArgs([],orgArgs))[idx]=value,cbArgs=_createArgs([funcArgs],orgArgs)}},hookCtx=[],cbArgs=_createArgs([funcArgs],orgArgs);function _createArgs(target,theArgs){return _arrLoop(theArgs,function(arg){target.push(arg)}),target}funcArgs.evt=getInst("event"),_doCallbacks(hooks,funcArgs,cbArgs,hookCtx,0);var theFunc=aiHook.f;if(theFunc)try{funcArgs.rslt=theFunc.apply(this,orgArgs)}catch(err){throw funcArgs.err=err,_doCallbacks(hooks,funcArgs,cbArgs,hookCtx,3),err}return _doCallbacks(hooks,funcArgs,cbArgs,hookCtx,1),funcArgs.rslt}}(aiHook={i:0,n:funcName,f:fn,h:[]});newFunc._aiHooks=aiHook,owner[funcName]=newFunc}var theHook={id:aiHook.i,cbks:callbacks,rm:function(){var id=this.id;_arrLoop(aiHook.h,function(hook,idx){if(hook.id===id)return aiHook.h.splice(idx,1),1})}};return aiHook.i++,aiHook.h.push(theHook),theHook}function InstrumentFunc(target,funcName,callbacks,checkPrototype,checkParentProto){if(void 0===checkPrototype&&(checkPrototype=!0),target&&funcName&&callbacks){var owner=_getOwner(target,funcName,checkPrototype,checkParentProto);if(owner){var fn=owner[funcName];if("function"==typeof fn)return _createInstrumentHook(owner,funcName,fn,callbacks)}}return null}function InstrumentEvent(target,evtName,callbacks,checkPrototype,checkParentProto){if(target&&evtName&&callbacks){var owner=_getOwner(target,evtName,checkPrototype,checkParentProto)||target;if(owner)return _createInstrumentHook(owner,evtName,owner[evtName],callbacks)}return null}function createUnloadHandlerContainer(){var handlers=[];return{add:function _addHandler(handler){handler&&handlers.push(handler)},run:function _runHandlers(unloadCtx,unloadState){arrForEach(handlers,function(handler){try{handler(unloadCtx,unloadState)}catch(e){_throwInternal(unloadCtx.diagLog(),2,73,"Unexpected error calling unload handler - "+dumpObj(e))}}),handlers=[]}}}function createUnloadHookContainer(){var _hooks=[];return{run:function _doUnload(logger){var oldHooks=_hooks;_hooks=[],arrForEach(oldHooks,function(fn){try{(fn.rm||fn.remove).call(fn)}catch(e){_throwInternal(logger,2,73,"Unloading:"+dumpObj(e))}}),_maxHooks&&oldHooks.length>_maxHooks&&(_hookAddMonitor?_hookAddMonitor("doUnload",oldHooks):_throwInternal(null,1,48,"Max unload hooks exceeded. An excessive number of unload hooks has been detected."))},add:function _addHook(hooks){hooks&&(arrAppend(_hooks,hooks),_maxHooks&&_hooks.length>_maxHooks&&(_hookAddMonitor?_hookAddMonitor("Add",_hooks):_throwInternal(null,1,48,"Max unload hooks exceeded. An excessive number of unload hooks has been detected.")))}}}var BaseTelemetryPlugin_defaultValues=((BaseTelemetryPlugin_a={}).extensionConfig={isVal:isNotNullOrUndefined,v:{}},BaseTelemetryPlugin_a),BaseTelemetryPlugin=function(){function BaseTelemetryPlugin(){var _isinitialized,_rootCtx,_nextPlugin,_unloadHandlerContainer,_hookContainer,_self=this;function _getTelCtx(currentCtx){void 0===currentCtx&&(currentCtx=null);var itemCtx=currentCtx;if(!itemCtx){var rootCtx=_rootCtx||createProcessTelemetryContext(null,{},_self.core);itemCtx=_nextPlugin&&_nextPlugin.getPlugin?rootCtx.createNew(null,_nextPlugin.getPlugin):rootCtx.createNew(null,_nextPlugin)}return itemCtx}function _setDefaults(config,core,pluginChain){createDynamicConfig(config,BaseTelemetryPlugin_defaultValues,safeGetLogger(core)),!pluginChain&&core&&(pluginChain=core.getProcessTelContext().getNext());var nextPlugin=_nextPlugin;_nextPlugin&&_nextPlugin.getPlugin&&(nextPlugin=_nextPlugin.getPlugin()),_self.core=core,_rootCtx=createProcessTelemetryContext(pluginChain,config,core,nextPlugin)}function _initDefaults(){_isinitialized=!1,_self.core=null,_rootCtx=null,_nextPlugin=null,_hookContainer=createUnloadHookContainer(),_unloadHandlerContainer=createUnloadHandlerContainer()}_initDefaults(),dynamicProto(BaseTelemetryPlugin,_self,function(_self){_self.initialize=function(config,core,extensions,pluginChain){_setDefaults(config,core,pluginChain),_isinitialized=!0},_self.teardown=function(unloadCtx,unloadState){var core=_self.core;if(core&&(!unloadCtx||core===unloadCtx.core())){var result,unloadDone=!1,theUnloadCtx=unloadCtx||createProcessTelemetryUnloadContext(null,core,_nextPlugin&&_nextPlugin.getPlugin?_nextPlugin.getPlugin():_nextPlugin),theUnloadState=unloadState||{reason:0,isAsync:!1};return _self._doTeardown&&!0===_self._doTeardown(theUnloadCtx,theUnloadState,_unloadCallback)?result=!0:_unloadCallback(),result}function _unloadCallback(){unloadDone||(unloadDone=!0,_unloadHandlerContainer.run(theUnloadCtx,unloadState),_hookContainer.run(theUnloadCtx.diagLog()),!0===result&&theUnloadCtx.processNext(theUnloadState),_initDefaults())}},_self.update=function(updateCtx,updateState){var core=_self.core;if(core&&(!updateCtx||core===updateCtx.core())){var result,updateDone=!1,theUpdateCtx=updateCtx||createProcessTelemetryUpdateContext(null,core,_nextPlugin&&_nextPlugin.getPlugin?_nextPlugin.getPlugin():_nextPlugin),theUpdateState=updateState||{reason:0};return _self._doUpdate&&!0===_self._doUpdate(theUpdateCtx,theUpdateState,_updateCallback)?result=!0:_updateCallback(),result}function _updateCallback(){updateDone||(updateDone=!0,_setDefaults(theUpdateCtx.getCfg(),theUpdateCtx.core(),theUpdateCtx.getNext()))}},proxyFunctionAs(_self,"_addUnloadCb",function(){return _unloadHandlerContainer},"add"),proxyFunctionAs(_self,"_addHook",function(){return _hookContainer},"add"),objDefine(_self,"_unloadHooks",{g:function(){return _hookContainer}})}),_self.diagLog=function(itemCtx){return _getTelCtx(itemCtx).diagLog()},_self.isInitialized=function(){return _isinitialized},_self.setInitialized=function(isInitialized){_isinitialized=isInitialized},_self.setNextPlugin=function(next){_nextPlugin=next},_self.processNext=function(env,itemCtx){itemCtx?itemCtx.processNext(env):_nextPlugin&&isFunction(_nextPlugin.processTelemetry)&&_nextPlugin.processTelemetry(env,null)},_self._getTelCtx=_getTelCtx}return BaseTelemetryPlugin.__ieDyn=1,BaseTelemetryPlugin}(),PageViewManager=function(){function PageViewManager(appInsights,overridePageViewDuration,core,pageViewPerformanceManager){dynamicProto(PageViewManager,this,function(_self){var _logger,queueTimer=null,itemQueue=[],pageViewPerformanceSent=!1,firstPageViewSent=!1;function _flushChannels(isAsync){core&&core.flush(isAsync,function(){})}function _startTimer(){queueTimer||(queueTimer=scheduleTimeout(function(){queueTimer=null;var allItems=itemQueue.slice(0),doFlush=!1;itemQueue=[],arrForEach(allItems,function(item){item()?doFlush=!0:itemQueue.push(item)}),itemQueue.length>0&&_startTimer(),doFlush&&_flushChannels(!0)},100))}function _addQueue(cb){itemQueue.push(cb),_startTimer()}core&&(_logger=core.logger),_self.trackPageView=function(pageView,customProperties){var name=pageView.name;if(isNullOrUndefined(name)||"string"!=typeof name){var doc=getDocument();name=pageView.name=doc&&doc.title||""}var uri=pageView.uri;if(isNullOrUndefined(uri)||"string"!=typeof uri){var location_1=getLocation();uri=pageView.uri=location_1&&location_1.href||""}if(core&&core.config&&(uri=pageView.uri=fieldRedaction(pageView.uri,core.config)),!firstPageViewSent){var perf=getPerformance(),navigationEntries=perf&&perf.getEntriesByType&&perf.getEntriesByType("navigation");if(navigationEntries&&navigationEntries[0]&&!isUndefined(perf.timeOrigin)){var loadEventStart=navigationEntries[0].loadEventStart;pageView.startTime=new Date(perf.timeOrigin+loadEventStart)}else{var duration_1=(customProperties||pageView.properties||{}).duration||0;pageView.startTime=new Date((new Date).getTime()-duration_1)}firstPageViewSent=!0}if(!pageViewPerformanceManager.isPerformanceTimingSupported())return appInsights.sendPageViewInternal(pageView,customProperties),_flushChannels(!0),void(isWebWorker()||_throwInternal(_logger,2,25,"trackPageView: navigation timing API used for calculation of page duration is not supported in this browser. This page view will be collected without duration and timing info."));var customDuration,duration,pageViewSent=!1,start=pageViewPerformanceManager.getPerformanceTiming().navigationStart;start>0&&(customDuration=dateTimeUtilsDuration(start,+new Date),pageViewPerformanceManager.shouldCollectDuration(customDuration)||(customDuration=void 0)),isNullOrUndefined(customProperties)||isNullOrUndefined(customProperties.duration)||(duration=customProperties.duration),!overridePageViewDuration&&isNaN(duration)||(isNaN(duration)&&(customProperties||(customProperties={}),customProperties.duration=customDuration),appInsights.sendPageViewInternal(pageView,customProperties),_flushChannels(!0),pageViewSent=!0);customProperties||(customProperties={}),_addQueue(function(){var processed=!1;try{if(pageViewPerformanceManager.isPerformanceTimingDataReady()){processed=!0;var pageViewPerformance={name,uri};pageViewPerformanceManager.populatePageViewPerformanceEvent(pageViewPerformance),pageViewPerformance.isValid||pageViewSent?(pageViewSent||(customProperties.duration=pageViewPerformance.durationMs,appInsights.sendPageViewInternal(pageView,customProperties)),pageViewPerformanceSent||(appInsights.sendPageViewPerformanceInternal(pageViewPerformance,customProperties),pageViewPerformanceSent=!0)):(customProperties.duration=customDuration,appInsights.sendPageViewInternal(pageView,customProperties))}else start>0&&dateTimeUtilsDuration(start,+new Date)>6e4&&(processed=!0,pageViewSent||(customProperties.duration=6e4,appInsights.sendPageViewInternal(pageView,customProperties)))}catch(e){_throwInternal(_logger,1,38,"trackPageView failed on page load calculation: "+getExceptionName(e),{exception:dumpObj(e)})}return processed})},_self.teardown=function(unloadCtx,unloadState){if(queueTimer){queueTimer.cancel(),queueTimer=null;var allItems=itemQueue.slice(0);itemQueue=[],arrForEach(allItems,function(item){item()&&!0})}}})}return PageViewManager.__ieDyn=1,PageViewManager}(),botAgentNames=["googlebot","adsbot-google","apis-google","mediapartners-google"];function _isPerformanceTimingSupported(){var perf=getPerformance();return perf&&!!perf.timing}function _isPerformanceTimingDataReady(){var perf=getPerformance(),timing=perf?perf.timing:0;return timing&&timing.domainLookupStart>0&&timing.navigationStart>0&&timing.responseStart>0&&timing.requestStart>0&&timing.loadEventEnd>0&&timing.responseEnd>0&&timing.connectEnd>0&&timing.domLoading>0}function _getPerformanceTiming(){return _isPerformanceTimingSupported()?getPerformance().timing:null}function _getPerformanceNavigationTiming(){return function _isPerformanceNavigationTimingSupported(){var perf=getPerformance();return perf&&perf.getEntriesByType&&perf.getEntriesByType("navigation").length>0}()?getPerformance().getEntriesByType("navigation")[0]:null}function _shouldCollectDuration(){for(var durations=[],_i=0;_i<arguments.length;_i++)durations[_i]=arguments[_i];var userAgent=(getNavigator()||{}).userAgent,isGoogleBot=!1;if(userAgent)for(var i=0;i<botAgentNames.length;i++)isGoogleBot=isGoogleBot||-1!==strIndexOf(userAgent.toLowerCase(),botAgentNames[i]);if(isGoogleBot)return!1;for(i=0;i<durations.length;i++)if(durations[i]<0||durations[i]>=36e5)return!1;return!0}var AnalyticsPlugin_a,PageViewPerformanceManager=function(){function PageViewPerformanceManager(core){var _logger=safeGetLogger(core);dynamicProto(PageViewPerformanceManager,this,function(_self){_self.populatePageViewPerformanceEvent=function(pageViewPerformance){pageViewPerformance.isValid=!1;var navigationTiming=_getPerformanceNavigationTiming(),timing=_getPerformanceTiming(),total=0,network=0,request=0,response=0,dom=0;(navigationTiming||timing)&&(navigationTiming?(total=navigationTiming.duration,network=0===navigationTiming.startTime?navigationTiming.connectEnd:dateTimeUtilsDuration(navigationTiming.startTime,navigationTiming.connectEnd),request=dateTimeUtilsDuration(navigationTiming.requestStart,navigationTiming.responseStart),response=dateTimeUtilsDuration(navigationTiming.responseStart,navigationTiming.responseEnd),dom=dateTimeUtilsDuration(navigationTiming.responseEnd,navigationTiming.loadEventEnd)):(total=dateTimeUtilsDuration(timing.navigationStart,timing.loadEventEnd),network=dateTimeUtilsDuration(timing.navigationStart,timing.connectEnd),request=dateTimeUtilsDuration(timing.requestStart,timing.responseStart),response=dateTimeUtilsDuration(timing.responseStart,timing.responseEnd),dom=dateTimeUtilsDuration(timing.responseEnd,timing.loadEventEnd)),0===total?_throwInternal(_logger,2,10,"error calculating page view performance.",{total,network,request,response,dom}):_self.shouldCollectDuration(total,network,request,response,dom)?total<mathFloor(network)+mathFloor(request)+mathFloor(response)+mathFloor(dom)?_throwInternal(_logger,2,8,"client performance math error.",{total,network,request,response,dom}):(pageViewPerformance.durationMs=total,pageViewPerformance.perfTotal=pageViewPerformance.duration=msToTimeSpan(total),pageViewPerformance.networkConnect=msToTimeSpan(network),pageViewPerformance.sentRequest=msToTimeSpan(request),pageViewPerformance.receivedResponse=msToTimeSpan(response),pageViewPerformance.domProcessing=msToTimeSpan(dom),pageViewPerformance.isValid=!0):_throwInternal(_logger,2,45,"Invalid page load duration value. Browser perf data won't be sent.",{total,network,request,response,dom}))},_self.getPerformanceTiming=_getPerformanceTiming,_self.isPerformanceTimingSupported=_isPerformanceTimingSupported,_self.isPerformanceTimingDataReady=_isPerformanceTimingDataReady,_self.shouldCollectDuration=_shouldCollectDuration})}return PageViewPerformanceManager.__ieDyn=1,PageViewPerformanceManager}(),PageVisitTimeManager=function(){function PageVisitTimeManager(logger,pageVisitTimeTrackingHandler){dynamicProto(PageVisitTimeManager,this,function(_self){_self.trackPreviousPageVisit=function(currentPageName,currentPageUrl){try{var prevPageVisitTimeData=function restartPageVisitTimer(pageName,pageUrl){var prevPageVisitData=null;try{if(prevPageVisitData=function stopPageVisitTimer(){var prevPageVisitData=null;try{if(utlCanUseSessionStorage()){var pageVisitEndTime=utcNow(),pageVisitDataJsonStr=utlGetSessionStorage(logger,"prevPageVisitData");pageVisitDataJsonStr&&hasJSON()&&((prevPageVisitData=getJSON().parse(pageVisitDataJsonStr)).pageVisitTime=pageVisitEndTime-prevPageVisitData.pageVisitStartTime,utlRemoveSessionStorage(logger,"prevPageVisitData"))}}catch(e){_warnToConsole(logger,"Stop page visit timer failed: "+dumpObj(e)),prevPageVisitData=null}return prevPageVisitData}(),utlCanUseSessionStorage()){null!=utlGetSessionStorage(logger,"prevPageVisitData")&&throwError("Cannot call startPageVisit consecutively without first calling stopPageVisit");var currPageVisitDataStr=getJSON().stringify(new PageVisitData(pageName,pageUrl));utlSetSessionStorage(logger,"prevPageVisitData",currPageVisitDataStr)}}catch(e){_warnToConsole(logger,"Call to restart failed: "+dumpObj(e)),prevPageVisitData=null}return prevPageVisitData}(currentPageName,currentPageUrl);prevPageVisitTimeData&&pageVisitTimeTrackingHandler(prevPageVisitTimeData.pageName,prevPageVisitTimeData.pageUrl,prevPageVisitTimeData.pageVisitTime)}catch(e){_warnToConsole(logger,"Auto track page visit time failed, metric will not be collected: "+dumpObj(e))}},objDefine(_self,"_logger",{g:function(){return logger}}),objDefine(_self,"pageVisitTimeTrackingHandler",{g:function(){return pageVisitTimeTrackingHandler}})})}return PageVisitTimeManager.__ieDyn=1,PageVisitTimeManager}(),PageVisitData=function PageVisitData(pageName,pageUrl){this.pageVisitStartTime=utcNow(),this.pageName=pageName,this.pageUrl=pageUrl},Timing=function Timing(logger,name){var _self=this,_events={};_self.start=function(name){void 0!==_events[name]&&_throwInternal(logger,2,62,"start was called more than once for this event without calling stop.",{name,key:name},!0),_events[name]=+new Date},_self.stop=function(name,url,properties,measurements){var start=_events[name];if(isNaN(start))_throwInternal(logger,2,63,"stop was called without a corresponding start.",{name,key:name},!0);else{var duration=dateTimeUtilsDuration(start,+new Date);_self.action(name,url,duration,properties,measurements)}delete _events[name],_events[name]=void 0}};function _dispatchEvent(target,evnt){target&&target.dispatchEvent&&evnt&&target.dispatchEvent(evnt)}var AnalyticsPlugin_defaultValues=objDeepFreeze(((AnalyticsPlugin_a={sessionRenewalMs:cfgDfSet(_chkConfigMilliseconds,18e5),sessionExpirationMs:cfgDfSet(_chkConfigMilliseconds,864e5),disableExceptionTracking:cfgDfBoolean()}).autoTrackPageVisitTime=cfgDfBoolean(),AnalyticsPlugin_a.overridePageViewDuration=cfgDfBoolean(),AnalyticsPlugin_a.enableUnhandledPromiseRejectionTracking=cfgDfBoolean(),AnalyticsPlugin_a.autoUnhandledPromiseInstrumented=!1,AnalyticsPlugin_a.samplingPercentage=cfgDfValidate(function _chkSampling(value){return!isNaN(value)&&value>0&&value<=100},100),AnalyticsPlugin_a.isStorageUseDisabled=cfgDfBoolean(),AnalyticsPlugin_a.isBrowserLinkTrackingEnabled=cfgDfBoolean(),AnalyticsPlugin_a.enableAutoRouteTracking=cfgDfBoolean(),AnalyticsPlugin_a.namePrefix=function cfgDfString(defaultValue){return{isVal:isString,v:asString(defaultValue||"")}}(),AnalyticsPlugin_a.enableDebug=cfgDfBoolean(),AnalyticsPlugin_a.disableFlushOnBeforeUnload=cfgDfBoolean(),AnalyticsPlugin_a.disableFlushOnUnload=cfgDfBoolean(!1,"disableFlushOnBeforeUnload"),AnalyticsPlugin_a.expCfg=cfgDfMerge({inclScripts:!1,expLog:void 0,maxLogs:50}),AnalyticsPlugin_a));function _chkConfigMilliseconds(value,defValue){return(value=value||defValue)<6e4&&(value=6e4),+value}function _updateStorageUsage(extConfig){isUndefined(extConfig.isStorageUseDisabled)||(extConfig.isStorageUseDisabled?function utlDisableStorage(){_canUseLocalStorage=!1,_canUseSessionStorage=!1}():function utlEnableStorage(){_canUseLocalStorage=utlCanUseLocalStorage(!0),_canUseSessionStorage=utlCanUseSessionStorage(!0)}())}var _debugState,_debugResult,_debugHandled,AnalyticsPlugin=function(_super){function AnalyticsPlugin(){var _eventTracking,_pageTracking,_pageViewManager,_pageViewPerformanceManager,_pageVisitTimeManager,_preInitTelemetryInitializers,_isBrowserLinkTrackingEnabled,_browserLinkInitializerAdded,_enableAutoRouteTracking,_historyListenerAdded,_disableExceptionTracking,_autoExceptionInstrumented,_enableUnhandledPromiseRejectionTracking,_autoUnhandledPromiseInstrumented,_extConfig,_autoTrackPageVisitTime,_expCfg,_prevUri,_currUri,_evtNamespace,_errorHookCnt,_this=_super.call(this)||this;return _this.identifier="ApplicationInsightsAnalytics",_this.priority=180,_this.autoRoutePVDelay=500,dynamicProto(AnalyticsPlugin,_this,function(_self,_base){var _addHook=_base._addHook;function _resetAjaxAttempts(){if(_self.core){var ajaxPlugin=_self.core.getPlugin("AjaxDependencyPlugin");ajaxPlugin&&ajaxPlugin.plugin&&ajaxPlugin.plugin.resetAjaxAttempts&&ajaxPlugin.plugin.resetAjaxAttempts()}}function _throwInternal(severity,msgId,msg,properties,isUserAct){_self.diagLog().throwInternal(severity,msgId,msg,properties,isUserAct)}function _initDefaults(){_eventTracking=null,_pageTracking=null,_pageViewManager=null,_pageViewPerformanceManager=null,_pageVisitTimeManager=null,_preInitTelemetryInitializers=null,_isBrowserLinkTrackingEnabled=!1,_browserLinkInitializerAdded=!1,_enableAutoRouteTracking=!1,_historyListenerAdded=!1,_disableExceptionTracking=!1,_autoExceptionInstrumented=!1,_enableUnhandledPromiseRejectionTracking=!1,_autoUnhandledPromiseInstrumented=!1,_autoTrackPageVisitTime=!1,_resetAjaxAttempts();var location=getLocation(!0);_prevUri=location&&location.href||"",_self.core&&_self.core.config&&(_prevUri=fieldRedaction(_prevUri,_self.core.config)),_currUri=null,_evtNamespace=null,_extConfig=null,_errorHookCnt=0,objDefine(_self,"config",{g:function(){return _extConfig}})}_initDefaults(),_self.getCookieMgr=function(){return safeGetCookieMgr(_self.core)},_self.processTelemetry=function(env,itemCtx){_self.processNext(env,itemCtx)},_self.trackEvent=function(event,customProperties){try{var telemetryItem=createTelemetryItem(event,Event_Event.dataType,Event_Event.envelopeType,_self.diagLog(),customProperties);_self.core.track(telemetryItem)}catch(e){_throwInternal(2,39,"trackTrace failed, trace will not be collected: "+getExceptionName(e),{exception:dumpObj(e)})}},_self.startTrackEvent=function(name){try{_eventTracking.start(name)}catch(e){_throwInternal(1,29,"startTrackEvent failed, event will not be collected: "+getExceptionName(e),{exception:dumpObj(e)})}},_self.stopTrackEvent=function(name,properties,measurements){try{_eventTracking.stop(name,void 0,properties,measurements)}catch(e){_throwInternal(1,30,"stopTrackEvent failed, event will not be collected: "+getExceptionName(e),{exception:dumpObj(e)})}},_self.trackTrace=function(trace,customProperties){try{var telemetryItem=createTelemetryItem(trace,Trace.dataType,Trace.envelopeType,_self.diagLog(),customProperties);_self.core.track(telemetryItem)}catch(e){_throwInternal(2,39,"trackTrace failed, trace will not be collected: "+getExceptionName(e),{exception:dumpObj(e)})}},_self.trackMetric=function(metric,customProperties){try{var telemetryItem=createTelemetryItem(metric,Metric.dataType,Metric.envelopeType,_self.diagLog(),customProperties);_self.core.track(telemetryItem)}catch(e){_throwInternal(1,36,"trackMetric failed, metric will not be collected: "+getExceptionName(e),{exception:dumpObj(e)})}},_self.trackPageView=function(pageView,customProperties){try{var inPv=pageView||{};_self.core&&_self.core.config&&(inPv.uri=fieldRedaction(inPv.uri,_self.core.config)),_pageViewManager.trackPageView(inPv,__assignFn(__assignFn(__assignFn({},inPv.properties),inPv.measurements),customProperties)),_autoTrackPageVisitTime&&_pageVisitTimeManager.trackPreviousPageVisit(inPv.name,inPv.uri)}catch(e){_throwInternal(1,37,"trackPageView failed, page view will not be collected: "+getExceptionName(e),{exception:dumpObj(e)})}},_self.sendPageViewInternal=function(pageView,properties,systemProperties){var doc=getDocument();if(doc&&(pageView.refUri=void 0===pageView.refUri?doc.referrer:pageView.refUri),_self.core&&_self.core.config&&(pageView.refUri=fieldRedaction(pageView.refUri,_self.core.config)),isNullOrUndefined(pageView.startTime)){var duration=(properties||pageView.properties||{}).duration||0;pageView.startTime=new Date((new Date).getTime()-duration)}var telemetryItem=createTelemetryItem(pageView,PageView.dataType,PageView.envelopeType,_self.diagLog(),properties,systemProperties);_self.core.track(telemetryItem),_resetAjaxAttempts()},_self.sendPageViewPerformanceInternal=function(pageViewPerformance,properties,systemProperties){var telemetryItem=createTelemetryItem(pageViewPerformance,PageViewPerformance.dataType,PageViewPerformance.envelopeType,_self.diagLog(),properties,systemProperties);_self.core.track(telemetryItem)},_self.trackPageViewPerformance=function(pageViewPerformance,customProperties){var inPvp=pageViewPerformance||{};try{_pageViewPerformanceManager.populatePageViewPerformanceEvent(inPvp),_self.sendPageViewPerformanceInternal(inPvp,customProperties)}catch(e){_throwInternal(1,37,"trackPageViewPerformance failed, page view will not be collected: "+getExceptionName(e),{exception:dumpObj(e)})}},_self.startTrackPage=function(name){try{if("string"!=typeof name){var doc=getDocument();name=doc&&doc.title||""}_pageTracking.start(name)}catch(e){_throwInternal(1,31,"startTrackPage failed, page view may not be collected: "+getExceptionName(e),{exception:dumpObj(e)})}},_self.stopTrackPage=function(name,url,properties,measurement){try{if("string"!=typeof name){var doc=getDocument();name=doc&&doc.title||""}if("string"!=typeof url){var loc=getLocation();url=loc&&loc.href||""}_self.core&&_self.core.config&&(url=fieldRedaction(url,_self.core.config)),_pageTracking.stop(name,url,properties,measurement),_autoTrackPageVisitTime&&_pageVisitTimeManager.trackPreviousPageVisit(name,url)}catch(e){_throwInternal(1,32,"stopTrackPage failed, page view will not be collected: "+getExceptionName(e),{exception:dumpObj(e)})}},_self.sendExceptionInternal=function(exception,customProperties,systemProperties){var theError=exception&&(exception.exception||exception.error)||isError(exception)&&exception||{name:exception&&typeof exception,message:exception||"not_specified"};exception=exception||{};var exceptionPartB=new Exception(_self.diagLog(),theError,exception.properties||customProperties,exception.measurements,exception.severityLevel,exception.id).toInterface(),doc=getDocument();if(doc&&(null==_expCfg?void 0:_expCfg.inclScripts)){var scriptsInfo=function findAllScripts(doc){var scripts=doc.getElementsByTagName("script"),result=[];return arrForEach(scripts,function(script){var src=script.getAttribute("src");if(src){var crossOrigin=script.getAttribute("crossorigin"),async=!0===script.hasAttribute("async"),defer=!0===script.hasAttribute("defer"),referrerPolicy=script.getAttribute("referrerpolicy"),info={url:src};crossOrigin&&(info.crossOrigin=crossOrigin),async&&(info.async=async),defer&&(info.defer=defer),referrerPolicy&&(info.referrerPolicy=referrerPolicy),result.push(info)}}),result}(doc);exceptionPartB.properties.exceptionScripts=JSON.stringify(scriptsInfo)}if(null==_expCfg?void 0:_expCfg.expLog){var logs=_expCfg.expLog();logs&&logs.logs&&isArray(logs.logs)&&(exceptionPartB.properties.exceptionLog=logs.logs.slice(0,_expCfg.maxLogs).join("\n"))}var telemetryItem=createTelemetryItem(exceptionPartB,Exception.dataType,Exception.envelopeType,_self.diagLog(),customProperties,systemProperties);_self.core.track(telemetryItem)},_self.trackException=function(exception,customProperties){exception&&!exception.exception&&exception.error&&(exception.exception=exception.error);try{_self.sendExceptionInternal(exception,customProperties)}catch(e){_throwInternal(1,35,"trackException failed, exception will not be collected: "+getExceptionName(e),{exception:dumpObj(e)})}},_self._onerror=function(exception){var error=exception&&exception.error,evt=exception&&exception.evt;try{if(!evt){var _window=getWindow();_window&&(evt=_window.event)}var url=exception&&exception.url||(getDocument()||{}).URL,errorSrc=exception.errorSrc||"window.onerror@"+url+":"+(exception.lineNumber||0)+":"+(exception.columnNumber||0),properties={errorSrc,url,lineNumber:exception.lineNumber||0,columnNumber:exception.columnNumber||0,message:exception.message};!function isCrossOriginError(message,url,lineNumber,columnNumber,error){return!error&&isString(message)&&("Script error."===message||"Script error"===message)}(exception.message,exception.url,exception.lineNumber,exception.columnNumber,exception.error)?(exception.errorSrc||(exception.errorSrc=errorSrc),_self.trackException({exception,severityLevel:3},properties)):function _sendCORSException(exception,properties){var telemetryItem=createTelemetryItem(exception,Exception.dataType,Exception.envelopeType,_self.diagLog(),properties);_self.core.track(telemetryItem)}(Exception.CreateAutoException("Script error: The browser's same-origin policy prevents us from getting the details of this exception. Consider using the 'crossorigin' attribute.",url,exception.lineNumber||0,exception.columnNumber||0,error,evt,null,errorSrc),properties)}catch(e){var errorString=error?error.name+", "+error.message:"null";_throwInternal(1,11,"_onError threw exception while logging error, error will not be collected: "+getExceptionName(e),{exception:dumpObj(e),errorString})}},_self.addTelemetryInitializer=function(telemetryInitializer){if(_self.core)return _self.core.addTelemetryInitializer(telemetryInitializer);_preInitTelemetryInitializers||(_preInitTelemetryInitializers=[]),_preInitTelemetryInitializers.push(telemetryInitializer)},_self.initialize=function(config,core,extensions,pluginChain){if(!_self.isInitialized()){isNullOrUndefined(core)&&throwError("Error initializing"),_base.initialize(config,core,extensions,pluginChain);try{_evtNamespace=mergeEvtNamespace(createUniqueNamespace(_self.identifier),core.evtNamespace&&core.evtNamespace()),_preInitTelemetryInitializers&&(arrForEach(_preInitTelemetryInitializers,function(initializer){core.addTelemetryInitializer(initializer)}),_preInitTelemetryInitializers=null),function _populateDefaults(config){var identifier=_self.identifier,core=_self.core;_self._addHook(onConfigChange(config,function(){var ctx=createProcessTelemetryContext(null,config,core);_extConfig=ctx.getExtCfg(identifier,AnalyticsPlugin_defaultValues),_autoExceptionInstrumented=_autoExceptionInstrumented||config.autoExceptionInstrumented||_extConfig.autoExceptionInstrumented,_expCfg=_extConfig.expCfg,_autoTrackPageVisitTime=_extConfig.autoTrackPageVisitTime,config.storagePrefix&&utlSetStoragePrefix(config.storagePrefix),_updateStorageUsage(_extConfig),_isBrowserLinkTrackingEnabled=_extConfig.isBrowserLinkTrackingEnabled,function _addDefaultTelemetryInitializers(){if(!_browserLinkInitializerAdded&&_isBrowserLinkTrackingEnabled){var browserLinkPaths_1=["/browserLinkSignalR/","/__browserLink/"],dropBrowserLinkRequests=function(envelope){if(_isBrowserLinkTrackingEnabled&&envelope.baseType===RemoteDependencyData.dataType){var remoteData=envelope.baseData;if(remoteData)for(var i=0;i<browserLinkPaths_1.length;i++)if(remoteData.target&&strIndexOf(remoteData.target,browserLinkPaths_1[i])>=0)return!1}return!0};_self._addHook(_self.addTelemetryInitializer(dropBrowserLinkRequests)),_browserLinkInitializerAdded=!0}}()}))}(config),_pageViewPerformanceManager=new PageViewPerformanceManager(_self.core),_pageViewManager=new PageViewManager(_self,_extConfig.overridePageViewDuration,_self.core,_pageViewPerformanceManager),_pageVisitTimeManager=new PageVisitTimeManager(_self.diagLog(),function(pageName,pageUrl,pageVisitTime){return function trackPageVisitTime(pageName,pageUrl,pageVisitTime){var properties={PageName:pageName,PageUrl:pageUrl};_self.trackMetric({name:"PageVisitTime",average:pageVisitTime,max:pageVisitTime,min:pageVisitTime,sampleCount:1},properties)}(pageName,pageUrl,pageVisitTime)}),(_eventTracking=new Timing(_self.diagLog(),"trackEvent")).action=function(name,url,duration,properties,measurements){properties||(properties={}),measurements||(measurements={}),properties.duration=duration.toString(),_self.trackEvent({name,properties,measurements})},(_pageTracking=new Timing(_self.diagLog(),"trackPageView")).action=function(name,url,duration,properties,measurements){isNullOrUndefined(properties)&&(properties={}),properties.duration=duration.toString();var pageViewItem={name,uri:url,properties,measurements};_self.sendPageViewInternal(pageViewItem,properties)},hasWindow()&&(!function _updateExceptionTracking(){var _window=getWindow(),locn=getLocation(!0);_self._addHook(onConfigChange(_extConfig,function(){(_disableExceptionTracking=_extConfig.disableExceptionTracking)||_autoExceptionInstrumented||_extConfig.autoExceptionInstrumented||(_addHook(InstrumentEvent(_window,"onerror",{ns:_evtNamespace,rsp:function(callDetails,message,url,lineNumber,columnNumber,error){_disableExceptionTracking||!0===callDetails.rslt||_self._onerror(Exception.CreateAutoException(message,url,lineNumber,columnNumber,error,callDetails.evt))}},!1)),_errorHookCnt++,_autoExceptionInstrumented=!0)})),function _addUnhandledPromiseRejectionTracking(_window,_location){_self._addHook(onConfigChange(_extConfig,function(){_enableUnhandledPromiseRejectionTracking=!0===_extConfig.enableUnhandledPromiseRejectionTracking,_autoExceptionInstrumented=_autoExceptionInstrumented||_extConfig.autoUnhandledPromiseInstrumented,_enableUnhandledPromiseRejectionTracking&&!_autoUnhandledPromiseInstrumented&&(_addHook(InstrumentEvent(_window,"onunhandledrejection",{ns:_evtNamespace,rsp:function(callDetails,error){_enableUnhandledPromiseRejectionTracking&&!0!==callDetails.rslt&&_self._onerror(Exception.CreateAutoException(function _getReason(error){if(error&&error.reason){var reason=error.reason;return!isString(reason)&&isFunction(reason.toString)?reason.toString():dumpObj(reason)}return error||""}(error),_location?_location.href:"",0,0,error,callDetails.evt))}},!1)),_errorHookCnt++,_extConfig.autoUnhandledPromiseInstrumented=_autoUnhandledPromiseInstrumented=!0)}))}(_window,locn)}(),function _updateLocationChange(){var win=getWindow(),locn=getLocation(!0);_self._addHook(onConfigChange(_extConfig,function(){if(_enableAutoRouteTracking=!0===_extConfig.enableAutoRouteTracking,win&&_enableAutoRouteTracking&&!_historyListenerAdded&&function hasHistory(){return!!getHistory()}()){var _history=getHistory();isFunction(_history.pushState)&&isFunction(_history.replaceState)&&"undefined"!=typeof Event&&function _addHistoryListener(win,history,locn){if(_historyListenerAdded)return;var namePrefix=_extConfig.namePrefix||"";function _popstateHandler(){_enableAutoRouteTracking&&_dispatchEvent(win,createDomEvent(namePrefix+"locationchange"))}function _locationChangeHandler(){if(_currUri?(_prevUri=_currUri,_currUri=locn&&locn.href||""):_currUri=locn&&locn.href||"",_self.core&&_self.core.config&&(_currUri=fieldRedaction(_currUri,_self.core.config)),_enableAutoRouteTracking){var distributedTraceCtx=function _getDistributedTraceCtx(){var distributedTraceCtx=null;_self.core&&_self.core.getTraceCtx&&(distributedTraceCtx=_self.core.getTraceCtx(!1));if(!distributedTraceCtx){var properties=_self.core.getPlugin("AppInsightsPropertiesPlugin");if(properties){var context=properties.plugin.context;context&&(distributedTraceCtx=createDistributedTraceContextFromTrace(context.telemetryTrace))}}return distributedTraceCtx}();if(distributedTraceCtx){distributedTraceCtx.setTraceId(generateW3CId());var traceLocationName="_unknown_";locn&&locn.pathname&&(traceLocationName=locn.pathname+(locn.hash||"")),distributedTraceCtx.setName(dataSanitizeString(_self.diagLog(),traceLocationName))}scheduleTimeout(function(uri){_self.trackPageView({refUri:uri,properties:{duration:0}})}.bind(_self,_prevUri),_self.autoRoutePVDelay)}}_addHook(InstrumentEvent(history,"pushState",{ns:_evtNamespace,rsp:function(){_enableAutoRouteTracking&&(_dispatchEvent(win,createDomEvent(namePrefix+"pushState")),_dispatchEvent(win,createDomEvent(namePrefix+"locationchange")))}},!0)),_addHook(InstrumentEvent(history,"replaceState",{ns:_evtNamespace,rsp:function(){_enableAutoRouteTracking&&(_dispatchEvent(win,createDomEvent(namePrefix+"replaceState")),_dispatchEvent(win,createDomEvent(namePrefix+"locationchange")))}},!0)),eventOn(win,namePrefix+"popstate",_popstateHandler,_evtNamespace),eventOn(win,namePrefix+"locationchange",_locationChangeHandler,_evtNamespace),_historyListenerAdded=!0}(win,_history,locn)}}))}())}catch(e){throw _self.setInitialized(!1),e}}},_self._doTeardown=function(unloadCtx,unloadState){_pageViewManager&&_pageViewManager.teardown(unloadCtx,unloadState),eventOff(window,null,null,_evtNamespace),_initDefaults()},_self._getDbgPlgTargets=function(){return[_errorHookCnt,_autoExceptionInstrumented]},objDefine(_self,"_pageViewManager",{g:function(){return _pageViewManager}}),objDefine(_self,"_pageViewPerformanceManager",{g:function(){return _pageViewPerformanceManager}}),objDefine(_self,"_pageVisitTimeManager",{g:function(){return _pageVisitTimeManager}}),objDefine(_self,"_evtNamespace",{g:function(){return"."+_evtNamespace}})}),_this}return __extendsFn(AnalyticsPlugin,_super),AnalyticsPlugin.Version="3.3.11",AnalyticsPlugin}(BaseTelemetryPlugin),ts_async_process=__webpack_require__("./node_modules/process/browser.js");function doAwaitResponse(value,cb){return doAwait(value,function(value){return cb?cb({status:"fulfilled",rejected:!1,value}):value},function(reason){return cb?cb({status:"rejected",rejected:!0,reason}):reason})}function doAwait(value,resolveFn,rejectFn,finallyFn){var result=value;try{if(isPromiseLike(value))(resolveFn||rejectFn)&&(result=value.then(resolveFn,rejectFn));else try{resolveFn&&(result=resolveFn(value))}catch(err){if(!rejectFn)throw err;result=rejectFn(err)}}finally{finallyFn&&doFinally(result,finallyFn)}return result}function doFinally(value,finallyFn){var result=value;return finallyFn&&(isPromiseLike(value)?result=value.finally?value.finally(finallyFn):value.then(function(value){return finallyFn(),value},function(reason){throw finallyFn(),reason}):finallyFn()),result}var _promiseDebugEnabled=!1;var _hasInitEvent,STRING_STATES=["pending","resolving","resolved","rejected"];function _hasInitEventFn(doc){var evt;return doc&&doc.createEvent&&(evt=doc.createEvent("Event")),!!evt&&evt.initEvent}var _hasPromiseRejectionEvent,UNHANDLED_REJECTION="unhandledRejection".toLowerCase(),_currentPromiseId=[],_uniquePromiseId=0;function dumpFnObj(value){return isFunction(value)?value.toString():dumpObj(value)}function _createPromise(newPromise,processor,executor){var _settledValue,_thePromise,additionalArgs=arrSlice(arguments,3),_state=0,_hasResolved=!1,_queue=[],_id=_uniquePromiseId++,_parentId=_currentPromiseId.length>0?_currentPromiseId[_currentPromiseId.length-1]:void 0,_handled=!1,_unHandledRejectionHandler=null;function _then(onResolved,onRejected){try{return _currentPromiseId.push(_id),_handled=!0,_unHandledRejectionHandler&&_unHandledRejectionHandler.cancel(),_unHandledRejectionHandler=null,newPromise(function(resolve,reject){_queue.push(function(){try{var handler=2===_state?onResolved:onRejected,value=isUndefined(handler)?_settledValue:isFunction(handler)?handler(_settledValue):handler;isPromiseLike(value)?value.then(resolve,reject):handler?resolve(value):3===_state?reject(value):resolve(value)}catch(e){reject(e)}}),_hasResolved&&_processQueue()},additionalArgs)}finally{_currentPromiseId.pop()}}function _strState(){return STRING_STATES[_state]}function _processQueue(){if(_queue.length>0){var pending=_queue.slice();_queue=[],_handled=!0,_unHandledRejectionHandler&&_unHandledRejectionHandler.cancel(),_unHandledRejectionHandler=null,processor(pending)}}function _createSettleIfFn(newState,allowState){return function(theValue){if(_state===allowState){if(2===newState&&isPromiseLike(theValue))return _state=1,void theValue.then(_createSettleIfFn(2,1),_createSettleIfFn(3,1));_state=newState,_hasResolved=!0,_settledValue=theValue,_processQueue(),_handled||3!==newState||_unHandledRejectionHandler||(_unHandledRejectionHandler=scheduleTimeout(_notifyUnhandledRejection,10))}}}function _notifyUnhandledRejection(){if(!_handled)if(_handled=!0,isNode())ts_async_process.emit("unhandledRejection",_settledValue,_thePromise);else{var gbl=getWindow()||getGlobal();!_hasPromiseRejectionEvent&&(_hasPromiseRejectionEvent=createCachedValue(safe(getInst,["PromiseRejectionEvent"]).v)),function emitEvent(target,evtName,populateEvent,useNewEvent){var doc=getDocument();!_hasInitEvent&&(_hasInitEvent=createCachedValue(!!safe(_hasInitEventFn,[doc]).v));var theEvt=_hasInitEvent.v?doc.createEvent("Event"):useNewEvent?new Event(evtName):{};if(populateEvent&&populateEvent(theEvt),_hasInitEvent.v&&theEvt.initEvent(evtName,!1,!0),theEvt&&target.dispatchEvent)target.dispatchEvent(theEvt);else{var handler=target["on"+evtName];if(handler)handler(theEvt);else{var theConsole=getInst("console");theConsole&&(theConsole.error||theConsole.log)(evtName,dumpObj(theEvt))}}}(gbl,UNHANDLED_REJECTION,function(theEvt){return objDefine(theEvt,"promise",{g:function(){return _thePromise}}),theEvt.reason=_settledValue,theEvt},!!_hasPromiseRejectionEvent.v)}}return objDefineProp(_thePromise={then:_then,catch:function _catch(onRejected){return _then(void 0,onRejected)},finally:function _finally(onFinally){var thenFinally=onFinally,catchFinally=onFinally;return isFunction(onFinally)&&(thenFinally=function(value){return onFinally&&onFinally(),value},catchFinally=function(reason){throw onFinally&&onFinally(),reason}),_then(thenFinally,catchFinally)}},"state",{get:_strState}),_promiseDebugEnabled&&function _addDebugState$1(thePromise,stateFn,resultFn,handledFn){_debugResult=_debugResult||{toString:function(){return"[[PromiseResult]]"}},_debugHandled=_debugHandled||{toString:function(){return"[[PromiseIsHandled]]"}};var props={};props[_debugState=_debugState||{toString:function(){return"[[PromiseState]]"}}]={get:stateFn},props[_debugResult]={get:resultFn},props[_debugHandled]={get:handledFn},objDefineProperties(thePromise,props)}(_thePromise,_strState,function(){return objToString(_settledValue)},function(){return _handled}),hasSymbol()&&(_thePromise[getKnownSymbol(11)]="IPromise"),_thePromise.toString=function _toString(){return"IPromise"+(_promiseDebugEnabled?"["+_id+(isUndefined(_parentId)?"":":"+_parentId)+"]":"")+" "+_strState()+(_hasResolved?" - "+dumpFnObj(_settledValue):"")},function _initialize(){isFunction(executor)||throwTypeError("Promise: executor is not a function - "+dumpFnObj(executor));var _rejectFn=_createSettleIfFn(3,0);try{executor.call(_thePromise,_createSettleIfFn(2,0),_rejectFn)}catch(e){_rejectFn(e)}}(),_thePromise}function _createAllPromise(newPromise){return function(input){var additionalArgs=arrSlice(arguments,1);return newPromise(function(resolve,reject){try{var values_1=[],pending_1=1;iterForOf(input,function(item,idx){item&&(pending_1++,doAwait(item,function(value){values_1[idx]=value,0===--pending_1&&resolve(values_1)},reject))}),0===--pending_1&&resolve(values_1)}catch(e){reject(e)}},additionalArgs)}}function _createAllSettledPromise(newPromise){return createCachedValue(function(input){var additionalArgs=arrSlice(arguments,1);return newPromise(function(resolve,reject){var values=[],pending=1;function processItem(item,idx){pending++,doAwaitResponse(item,function(value){value.rejected?values[idx]={status:"rejected",reason:value.reason}:values[idx]={status:"fulfilled",value:value.value},0===--pending&&resolve(values)})}try{isArray(input)?arrForEach(input,processItem):isIterable(input)?iterForOf(input,processItem):throwTypeError("Input is not an iterable"),0===--pending&&resolve(values)}catch(e){reject(e)}},additionalArgs)})}function syncItemProcessor(pending){arrForEach(pending,function(fn){try{fn()}catch(e){}})}function createAsyncPromise(executor,timeout){return _createPromise(createAsyncPromise,function timeoutItemProcessor(timeout){var callbackTimeout=isNumber(timeout)?timeout:0;return function(pending){scheduleTimeout(function(){syncItemProcessor(pending)},callbackTimeout)}}(timeout),executor,timeout)}var _promiseCls;function createNativePromise(executor,timeout){!_promiseCls&&(_promiseCls=createCachedValue(safe(getInst,["Promise"]).v||null));var PrmCls=_promiseCls.v;if(!PrmCls)return createAsyncPromise(executor);isFunction(executor)||throwTypeError("Promise: executor is not a function - "+dumpObj(executor));var _state=0;var thePromise=new PrmCls(function(resolve,reject){executor(function _resolve(value){_state=2,resolve(value)},function _reject(reason){_state=3,reject(reason)})});return objDefineProp(thePromise,"state",{get:function _strState(){return STRING_STATES[_state]}}),thePromise}var _allSyncSettledCreator;function createSyncPromise(executor){return _createPromise(createSyncPromise,syncItemProcessor,executor)}var _promiseCreator;function createPromise(executor,timeout){return!_promiseCreator&&(_promiseCreator=createCachedValue(createNativePromise)),_promiseCreator.v.call(this,executor,timeout)}var createAllPromise=_createAllPromise(createPromise);getKnownSymbol(11);function replaceByNonOverrideCfg(cfg,nonOverrideConfigs,curLevel,maxLevel){try{var exceedMaxLevel=curLevel>maxLevel;exceedMaxLevel&&(cfg=null);var curCfg_1=0==curLevel?function objExtend(target,obj1,obj2,obj3,obj4,obj5,obj6){return _doExtend(target||{},ArrSlice[CALL](arguments))}({},cfg):cfg;return curCfg_1&&nonOverrideConfigs&&!exceedMaxLevel&&objForEachKey(curCfg_1,function(key){var nonOverrideVal=nonOverrideConfigs[key];nonOverrideVal&&(isObject(curCfg_1[key])&&isObject(nonOverrideVal)?curCfg_1[key]=replaceByNonOverrideCfg(curCfg_1[key],nonOverrideVal,++curLevel,maxLevel):delete curCfg_1[key])}),curCfg_1}catch(e){}return cfg}var CfgSyncPlugin_a,F="featureOptIn.",M=".mode",ON=".onCfg",OFF=".offCfg";function applyCdnfeatureCfg(cdnCfg,core){try{if(!cdnCfg||!cdnCfg.enabled)return null;if(!cdnCfg.featureOptIn)return cdnCfg.config;var optInMap=cdnCfg.featureOptIn,cdnConfig_1=cdnCfg.config||{};return objForEachKey(optInMap,function(key){var featureVal=function resolveCdnFeatureCfg(field,cdnCfg,userOptInDetails){var _a;if(!cdnCfg||!cdnCfg.enabled)return null;var cdnFt=(cdnCfg.featureOptIn||{})[field]||{mode:1},cdnM=cdnFt.mode,cdnOnV=cdnFt.onCfg,cdnOffV=cdnFt.offCfg,userFt=(userOptInDetails||{})[field]||{mode:2},userM=userFt.mode,userOnV=userFt.onCfg,userOffV=userFt.offCfg,blockCdn=!!userFt.blockCdnCfg,onFld=F+field+".onCfg",offFld=F+field+".offCfg",mode=userM,onV=userOnV,offV=userOffV;return blockCdn||(4===cdnM||5===cdnM?(mode=4==cdnM?3:2,onV=cdnOnV||userOnV,offV=cdnOffV||userOffV):2===cdnM||2===userM?(mode=2,onV=userOnV||cdnOnV,offV=userOffV||cdnOffV):3===cdnM?(mode=3,onV=userOnV||cdnOnV,offV=userOffV||cdnOffV):1===cdnM&&1===userM&&(mode=1)),(_a={})[F+field+M]=mode,_a[onFld]=onV,_a[offFld]=offV,_a}(key,cdnCfg,core.config.featureOptIn);isNullOrUndefined(featureVal)||(objForEachKey(featureVal,function(config,val){setValueByKey(cdnConfig_1,config,val)}),function _overrideCdnCfgByFeature(field,ftVal,config){var mode=ftVal[F+field+M],val=ftVal[F+field+ON],dVal=ftVal[F+field+OFF],target=null;3===mode&&(target=val);2===mode&&(target=dVal);target&&objForEachKey(target,function(key,cfg){setValueByKey(config,key,cfg)})}(key,featureVal,cdnConfig_1))}),cdnConfig_1}catch(e){}return null}var _defaultConfig=objDeepFreeze(((CfgSyncPlugin_a={syncMode:1,blkCdnCfg:void 0,customEvtName:void 0,cfgUrl:void 0,overrideSyncFn:void 0,overrideFetchFn:void 0,onCfgChangeReceive:void 0}).scheduleFetchTimeout=18e5,CfgSyncPlugin_a.nonOverrideConfigs={instrumentationKey:!0,connectionString:!0,endpointUrl:!0},CfgSyncPlugin_a.enableAjax=!1,CfgSyncPlugin_a)),CfgSyncPlugin=function(_super){function CfgSyncPlugin(){var _extensionConfig,_mainConfig,_evtName,_evtNamespace,_cfgUrl,_timeoutHandle,_receiveChanges,_broadcastChanges,_blkCdnCfg,_fetchTimeout,_retryCnt,_onCfgChangeReceive,_nonOverrideConfigs,_fetchFn,_overrideFetchFn,_overrideSyncFn,_this=_super.call(this)||this;_this.priority=198,_this.identifier="AppInsightsCfgSyncPlugin";var _enableAjax,_paused=!1;return dynamicProto(CfgSyncPlugin,_this,function(_self,_base){function _initDefaults(){_mainConfig=null,_evtName=null,_evtNamespace=null,_cfgUrl=null,_receiveChanges=null,_broadcastChanges=null,_nonOverrideConfigs=null,_timeoutHandle=null,_fetchTimeout=null,_retryCnt=null,_blkCdnCfg=null,_enableAjax=!1,_overrideFetchFn=null,_overrideSyncFn=null,_onCfgChangeReceive=null}function _setCfg(config,isAutoSync){if(config){if(_mainConfig=config,isAutoSync&&!_paused)return _sendCfgsyncEvents();if(_receiveChanges&&!_paused)return _self.core.updateCfg(config),!0}return!1}function _eventOff(){try{var global_1=getGlobal();global_1&&eventOff(global_1,null,null,_evtNamespace)}catch(e){}}function _sendCfgsyncEvents(customDetails){try{return _overrideSyncFn&&isFunction(_overrideSyncFn)?_overrideSyncFn(_mainConfig,customDetails):sendCustomEvent(_evtName,_mainConfig,customDetails)}catch(e){}return!1}function _updateEventListenerName(name){try{return _eventOff(),name&&(_evtName=name,function _addEventListener(){if(_receiveChanges){var global_2=getGlobal();if(global_2)try{eventOn(global_2,_evtName,function(event){var cfgEvent=event&&event.detail;if(_onCfgChangeReceive&&cfgEvent)_onCfgChangeReceive(cfgEvent);else{var cfg=cfgEvent&&cfgEvent.cfg,newCfg=cfg&&isPlainObject(cfg)&&_replaceTartgetByKeys(cfg);newCfg&&_setCfg(newCfg)}},_evtNamespace,!0)}catch(e){}}}()),!0}catch(e){}return!1}function _fetchSender(url,oncomplete,isAutoSync){var global=getGlobal(),fetchFn=global&&global.fetch||null;if(url&&fetchFn&&isFunction(fetchFn))try{var init={method:"GET"};_enableAjax||(init[DisabledPropertyName]=!0);var request=new Request(url,init);if(!_enableAjax)try{request[DisabledPropertyName]=!0}catch(e){}doAwaitResponse(fetch(request),function(result){var response=result.value;result.rejected?_doOnComplete(oncomplete,400):response.ok?doAwaitResponse(response.text(),function(res){_doOnComplete(oncomplete,response.status,res.value,isAutoSync)}):_doOnComplete(oncomplete,response.status,null,isAutoSync)})}catch(e){}}function _xhrSender(url,oncomplete,isAutoSync){try{var xhr_1=new XMLHttpRequest;_enableAjax||(xhr_1[DisabledPropertyName]=!0),xhr_1.open("GET",url),xhr_1.onreadystatechange=function(){xhr_1.readyState===XMLHttpRequest.DONE&&_doOnComplete(oncomplete,xhr_1.status,xhr_1.responseText,isAutoSync)},xhr_1.onerror=function(){_doOnComplete(oncomplete,400)},xhr_1.ontimeout=function(){_doOnComplete(oncomplete,400)},xhr_1.send()}catch(e){}}function _onFetchComplete(status,response,isAutoSync){try{if(status>=200&&status<400&&response){_retryCnt=0;var JSON_1=getJSON();if(JSON_1){var cfg=applyCdnfeatureCfg(JSON_1.parse(response),_self.core),newCfg=cfg&&isPlainObject(cfg)&&_replaceTartgetByKeys(cfg);newCfg&&_setCfg(newCfg,isAutoSync)}}else _retryCnt++;_retryCnt<3&&_setupTimer()}catch(e){}}function _doOnComplete(oncomplete,status,response,isAutoSync){try{oncomplete(status,response,isAutoSync)}catch(e){}}function _replaceTartgetByKeys(cfg,level){var _cfg=null;try{cfg&&(_cfg=replaceByNonOverrideCfg(cfg,_nonOverrideConfigs,0,5))}catch(e){}return _cfg}function _setupTimer(){!_timeoutHandle&&_fetchTimeout&&(_timeoutHandle=scheduleTimeout(function(){_timeoutHandle=null,_fetchFn(_cfgUrl,_onFetchComplete,_broadcastChanges)},_fetchTimeout)).unref()}function _clearScheduledTimer(){_timeoutHandle&&_timeoutHandle.cancel(),_timeoutHandle=null,_retryCnt=0}_initDefaults(),_self.initialize=function(config,core,extensions,pluginChain){_base.initialize(config,core,extensions,pluginChain),_evtNamespace=mergeEvtNamespace(createUniqueNamespace(_self.identifier),core.evtNamespace&&core.evtNamespace()),function _populateDefaults(config){var identifier=_self.identifier,core=_self.core;_self._addHook(onConfigChange(config,function(){var ctx=createProcessTelemetryContext(null,config,core);_extensionConfig=ctx.getExtCfg(identifier,_defaultConfig);var preBlkCdn=_blkCdnCfg;_blkCdnCfg=!!_extensionConfig.blkCdnCfg,_enableAjax=!!_extensionConfig.enableAjax,isNullOrUndefined(preBlkCdn)||preBlkCdn===_blkCdnCfg||(!_blkCdnCfg&&_cfgUrl?_fetchFn&&_fetchFn(_cfgUrl,_onFetchComplete,_broadcastChanges):_clearScheduledTimer()),isNullOrUndefined(_receiveChanges)&&(_receiveChanges=2===_extensionConfig.syncMode),isNullOrUndefined(_broadcastChanges)&&(_broadcastChanges=1===_extensionConfig.syncMode);var newEvtName=_extensionConfig.customEvtName||"ai_cfgsync";_evtName!==newEvtName&&(_receiveChanges?_updateEventListenerName(newEvtName):(_eventOff(),_evtName=newEvtName)),isNullOrUndefined(_cfgUrl)&&(_cfgUrl=_extensionConfig.cfgUrl),_cfgUrl||(_mainConfig=config,_broadcastChanges&&_sendCfgsyncEvents())})),_overrideSyncFn=_extensionConfig.overrideSyncFn,_overrideFetchFn=_extensionConfig.overrideFetchFn,_onCfgChangeReceive=_extensionConfig.onCfgChangeReceive,_nonOverrideConfigs=_extensionConfig.nonOverrideConfigs,_fetchTimeout=_extensionConfig.scheduleFetchTimeout,_fetchFn=function _getFetchFnInterface(){var _fetchFn=_overrideFetchFn;isNullOrUndefined(_fetchFn)&&(isFetchSupported()?_fetchFn=_fetchSender:isXhrSupported()&&(_fetchFn=_xhrSender));return _fetchFn}(),_retryCnt=0,_cfgUrl&&!_blkCdnCfg&&_fetchFn&&_fetchFn(_cfgUrl,_onFetchComplete,_broadcastChanges)}(config)},_self.getCfg=function(){return _mainConfig},_self.pause=function(){_paused=!0,_clearScheduledTimer()},_self.resume=function(){_paused=!1,_setupTimer()},_self.setCfg=function(config){return _setCfg(config)},_self.sync=function(customDetails){return _sendCfgsyncEvents(customDetails)},_self.updateEventListenerName=function(eventName){return _updateEventListenerName(eventName)},_self._doTeardown=function(unloadCtx,unloadState){_eventOff(),_clearScheduledTimer(),_initDefaults()},_self._getDbgPlgTargets=function(){return[_broadcastChanges,_receiveChanges,_evtName,_blkCdnCfg,_nonOverrideConfigs]},_self.processTelemetry=function(env,itemCtx){_self.processNext(env,itemCtx)}}),_this}return __extendsFn(CfgSyncPlugin,_super),CfgSyncPlugin.__ieDyn=1,CfgSyncPlugin}(BaseTelemetryPlugin);function _disableEvents(target,evtNamespace){eventOff(target,null,null,evtNamespace)}var ActiveStatus=createEnumStyle({NONE:0,PENDING:3,INACTIVE:1,ACTIVE:2}),SenderPostManager=function(){function SenderPostManager(){var _enableSendPromise,_isInitialized,_diagLog,_isOneDs,_onCompleteFuncs,_disableCredentials,_fetchCredentials,_fallbackInst,_disableXhr,_disableBeacon,_disableBeaconSync,_disableFetchKeepAlive,_addNoResponse,_timeoutWrapper,_syncFetchPayload=0;dynamicProto(SenderPostManager,this,function(_self,_base){var _sendCredentials=!0;function _onError(message,onComplete){_throwInternal(_diagLog,2,26,"Failed to send telemetry.",{message}),_doOnComplete(onComplete,400,{})}function _onNoPayloadUrl(onComplete){_onError("No endpoint url is provided for the batch",onComplete)}function _doOnComplete(oncomplete,status,headers,response){try{oncomplete&&oncomplete(status,headers,response)}catch(e){}}function _doBeaconSend(payload,oncomplete){var nav=getNavigator(),url=payload.urlString;if(!url)return _onNoPayloadUrl(oncomplete),!0;url=payload.urlString+(_addNoResponse?"&NoResponseBody=true":"");var data=payload.data,plainTextBatch=_isOneDs?data:new Blob([data],{type:"text/plain;charset=UTF-8"});return nav.sendBeacon(url,plainTextBatch)}function _beaconSender(payload,oncomplete,sync){var data=payload.data;try{if(data)if(_doBeaconSend(payload,oncomplete))!function _onSuccess(res,onComplete){_doOnComplete(onComplete,200,{},res)}("",oncomplete);else{var onRetry=_onCompleteFuncs&&_onCompleteFuncs.beaconOnRetry;onRetry&&isFunction(onRetry)?onRetry(payload,oncomplete,_doBeaconSend):(_fallbackInst&&_fallbackInst.sendPOST(payload,oncomplete,!0),_throwInternal(_diagLog,2,40,". Failed to send telemetry with Beacon API, retried with normal sender."))}}catch(e){_isOneDs&&_warnToConsole(_diagLog,"Failed to send telemetry using sendBeacon API. Ex:"+dumpObj(e)),_doOnComplete(oncomplete,_isOneDs?0:400,{},"")}}function _xhrSender(payload,oncomplete,sync){var thePromise,resolveFunc,rejectFunc,headers=payload.headers||{};!sync&&_enableSendPromise&&(thePromise=createPromise(function(resolve,reject){resolveFunc=resolve,rejectFunc=reject})),_isOneDs&&sync&&payload.disableXhrSync&&(sync=!1);var endPointUrl=payload.urlString;if(!endPointUrl)return _onNoPayloadUrl(oncomplete),void(resolveFunc&&resolveFunc(!1));var xhr=function openXhr(method,urlString,withCredentials,disabled,isSync,timeout){function _wrapSetXhrProp(xhr,prop,value){try{xhr[prop]=value}catch(e){}}void 0===disabled&&(disabled=!1),void 0===isSync&&(isSync=!1);var xhr=new XMLHttpRequest;return disabled&&_wrapSetXhrProp(xhr,"Microsoft_ApplicationInsights_BypassAjaxInstrumentation",disabled),withCredentials&&_wrapSetXhrProp(xhr,"withCredentials",withCredentials),xhr.open(method,urlString,!isSync),withCredentials&&_wrapSetXhrProp(xhr,"withCredentials",withCredentials),!isSync&&timeout&&_wrapSetXhrProp(xhr,"timeout",timeout),xhr}("POST",endPointUrl,_sendCredentials,!0,sync,payload.timeout);function _doOnReadyFunc(xhr){var onReadyFunc=_onCompleteFuncs&&_onCompleteFuncs.xhrOnComplete;if(onReadyFunc&&isFunction(onReadyFunc))onReadyFunc(xhr,oncomplete,payload);else{var response=getResponseText(xhr);_doOnComplete(oncomplete,xhr.status,_getAllResponseHeaders(xhr,_isOneDs),response)}}return _isOneDs||xhr.setRequestHeader("Content-type","application/json"),arrForEach(objKeys(headers),function(headerName){xhr.setRequestHeader(headerName,headers[headerName])}),xhr.onreadystatechange=function(){_isOneDs||(_doOnReadyFunc(xhr),4===xhr.readyState&&resolveFunc&&resolveFunc(!0))},xhr.onload=function(){_isOneDs&&_doOnReadyFunc(xhr)},xhr.onerror=function(event){_doOnComplete(oncomplete,_isOneDs?xhr.status:400,_getAllResponseHeaders(xhr,_isOneDs),_isOneDs?"":formatErrorMessageXhr(xhr)),rejectFunc&&rejectFunc(event)},xhr.ontimeout=function(){_doOnComplete(oncomplete,_isOneDs?xhr.status:500,_getAllResponseHeaders(xhr,_isOneDs),_isOneDs?"":formatErrorMessageXhr(xhr)),resolveFunc&&resolveFunc(!1)},xhr.send(payload.data),thePromise}function _doFetchSender(payload,oncomplete,sync){var _a,thePromise,resolveFunc,rejectFunc,endPointUrl=payload.urlString,batch=payload.data,plainTextBatch=_isOneDs?batch:new Blob([batch],{type:"application/json"}),requestHeaders=new Headers,batchLength=batch.length,ignoreResponse=!1,responseHandled=!1,headers=payload.headers||{},init=((_a={method:"POST",body:plainTextBatch}).Microsoft_ApplicationInsights_BypassAjaxInstrumentation=!0,_a);payload.headers&&objKeys(payload.headers).length>0&&(arrForEach(objKeys(headers),function(headerName){requestHeaders.append(headerName,headers[headerName])}),init.headers=requestHeaders),_fetchCredentials?init.credentials=_fetchCredentials:_sendCredentials&&_isOneDs&&(init.credentials="include"),sync&&(init.keepalive=!0,_syncFetchPayload+=batchLength,_isOneDs?2===payload._sendReason&&(ignoreResponse=!0,_addNoResponse&&(endPointUrl+="&NoResponseBody=true")):ignoreResponse=!0);var request=new Request(endPointUrl,init);try{request.Microsoft_ApplicationInsights_BypassAjaxInstrumentation=!0}catch(e){}if(!sync&&_enableSendPromise&&(thePromise=createPromise(function(resolve,reject){resolveFunc=resolve,rejectFunc=reject})),!endPointUrl)return _onNoPayloadUrl(oncomplete),void(resolveFunc&&resolveFunc(!1));function _handleError(res,statusCode){_doOnComplete(oncomplete,statusCode?_isOneDs?0:statusCode:_isOneDs?0:400,{},_isOneDs?"":res)}function _onFetchComplete(response,payload,value){var status=response.status,onCompleteFunc=_onCompleteFuncs.fetchOnComplete;onCompleteFunc&&isFunction(onCompleteFunc)?onCompleteFunc(response,oncomplete,value||"",payload):_doOnComplete(oncomplete,status,{},value||"")}try{doAwaitResponse(fetch(_isOneDs?endPointUrl:request,_isOneDs?init:null),function(result){if(sync&&(_syncFetchPayload-=batchLength,batchLength=0),!responseHandled)if(responseHandled=!0,result.rejected)_handleError(result.reason&&result.reason.message,499),rejectFunc&&rejectFunc(result.reason);else{var response_1=result.value;try{_isOneDs||response_1.ok?_isOneDs&&!response_1.body?(_onFetchComplete(response_1,null,""),resolveFunc&&resolveFunc(!0)):doAwaitResponse(response_1.text(),function(resp){_onFetchComplete(response_1,payload,resp.value),resolveFunc&&resolveFunc(!0)}):(response_1.status?_handleError(response_1.statusText,response_1.status):_handleError(response_1.statusText,499),resolveFunc&&resolveFunc(!1))}catch(e){response_1&&response_1.status?_handleError(dumpObj(e),response_1.status):_handleError(dumpObj(e),499),rejectFunc&&rejectFunc(e)}}})}catch(e){responseHandled||(_handleError(dumpObj(e),499),rejectFunc&&rejectFunc(e))}return ignoreResponse&&!responseHandled&&(responseHandled=!0,_doOnComplete(oncomplete,200,{}),resolveFunc&&resolveFunc(!0)),_isOneDs&&!responseHandled&&payload.timeout>0&&_timeoutWrapper&&_timeoutWrapper.set(function(){responseHandled||(responseHandled=!0,_doOnComplete(oncomplete,500,{}),resolveFunc&&resolveFunc(!0))},payload.timeout),thePromise}function _xdrSender(payload,oncomplete,sync){var _window=getWindow(),xdr=new XDomainRequest,data=payload.data;xdr.onload=function(){var response=getResponseText(xdr),onloadFunc=_onCompleteFuncs&&_onCompleteFuncs.xdrOnComplete;onloadFunc&&isFunction(onloadFunc)?onloadFunc(xdr,oncomplete,payload):_doOnComplete(oncomplete,200,{},response)},xdr.onerror=function(){_doOnComplete(oncomplete,400,{},_isOneDs?"":formatErrorMessageXdr(xdr))},xdr.ontimeout=function(){_doOnComplete(oncomplete,500,{})},xdr.onprogress=function(){};var hostingProtocol=_window&&_window.location&&_window.location.protocol||"",endpoint=payload.urlString;if(endpoint){if(!_isOneDs&&0!==endpoint.lastIndexOf(hostingProtocol,0)){var msg="Cannot send XDomain request. The endpoint URL protocol doesn't match the hosting page protocol.";return _throwInternal(_diagLog,2,40,". "+msg),void _onError(msg,oncomplete)}var endpointUrl=_isOneDs?endpoint:endpoint.replace(/^(https?:)/,"");xdr.open("POST",endpointUrl),payload.timeout&&(xdr.timeout=payload.timeout),xdr.send(data),_isOneDs&&sync?_timeoutWrapper&&_timeoutWrapper.set(function(){xdr.send(data)},0):xdr.send(data)}else _onNoPayloadUrl(oncomplete)}function _initDefaults(){_syncFetchPayload=0,_isInitialized=!1,_enableSendPromise=!1,_diagLog=null,_isOneDs=null,_onCompleteFuncs=null,_disableCredentials=null,_fetchCredentials=null,_fallbackInst=null,_disableXhr=!1,_disableBeacon=!1,_disableBeaconSync=!1,_disableFetchKeepAlive=!1,_addNoResponse=!1,_timeoutWrapper=null}_initDefaults(),_self.initialize=function(config,diagLog){_diagLog=diagLog,_isInitialized&&_throwInternal(_diagLog,1,28,"Sender is already initialized"),_self.SetConfig(config),_isInitialized=!0},_self._getDbgPlgTargets=function(){return[_isInitialized,_isOneDs,_disableCredentials,_enableSendPromise]},_self.SetConfig=function(config){try{if(_onCompleteFuncs=config.senderOnCompleteCallBack||{},_disableCredentials=!!config.disableCredentials,_fetchCredentials=config.fetchCredentials,_isOneDs=!!config.isOneDs,_enableSendPromise=!!config.enableSendPromise,_disableXhr=!!config.disableXhr,_disableBeacon=!!config.disableBeacon,_disableBeaconSync=!!config.disableBeaconSync,_timeoutWrapper=config.timeWrapper,_addNoResponse=!!config.addNoResponse,_disableFetchKeepAlive=!!config.disableFetchKeepAlive,_fallbackInst={sendPOST:_xhrSender},_isOneDs||(_sendCredentials=!1),_disableCredentials){var location_1=getLocation();location_1&&location_1.protocol&&"file:"===location_1.protocol.toLowerCase()&&(_sendCredentials=!1)}return!0}catch(e){}return!1},_self.getSyncFetchPayload=function(){return _syncFetchPayload},_self.getSenderInst=function(transports,sync){return transports&&transports.length?function _getSenderInterface(transports,syncSupport){var transportType=0,sendPostFunc=null,lp=0;for(;null==sendPostFunc&&lp<transports.length;)transportType=transports[lp],_disableXhr||1!==transportType?2!==transportType||!isFetchSupported(syncSupport)||syncSupport&&_disableFetchKeepAlive?3!==transportType||!isBeaconsSupported()||(syncSupport?_disableBeaconSync:_disableBeacon)||(sendPostFunc=_beaconSender):sendPostFunc=_doFetchSender:useXDomainRequest()?sendPostFunc=_xdrSender:isXhrSupported()&&(sendPostFunc=_xhrSender),lp++;if(sendPostFunc)return{_transport:transportType,_isSync:syncSupport,sendPOST:sendPostFunc};return null}(transports,sync):null},_self.getFallbackInst=function(){return _fallbackInst},_self._doTeardown=function(unloadCtx,unloadState){_initDefaults()},_self.preparePayload=function(callback,zipPayload,payload,isSync){if(zipPayload&&!isSync&&payload.data)try{var csStream=getInst("CompressionStream");if(!isFunction(csStream))return void callback(payload);var reader_1=new ReadableStream({start:function(controller){controller.enqueue(isString(payload.data)?(new TextEncoder).encode(payload.data):payload.data),controller.close()}}).pipeThrough(new csStream("gzip")).getReader(),chunks_1=[],totalLength_1=0,callbackCalled_1=!1;return doAwaitResponse(reader_1.read(),function processChunk(response){if(!callbackCalled_1&&!response.rejected){var result=response.value;if(!result.done)return chunks_1.push(result.value),totalLength_1+=result.value.length,doAwaitResponse(reader_1.read(),processChunk);for(var combined=new Uint8Array(totalLength_1),offset=0,_i=0,chunks_2=chunks_1;_i<chunks_2.length;_i++){var chunk=chunks_2[_i];combined.set(chunk,offset),offset+=chunk.length}payload.data=combined,payload.headers["Content-Encoding"]="gzip",payload._chunkCount=chunks_1.length}callbackCalled_1||(callbackCalled_1=!0,callback(payload))}),reader_1}catch(error){return void callback(payload)}else callback(payload)}})}return SenderPostManager.__ieDyn=1,SenderPostManager}();function runTargetUnload(target,isAsync){if(target&&target.unload)return target.unload(isAsync)}function doUnloadAll(targets,isAsync,done){var result;return done||(result=createPromise(function(resolved){done=resolved})),targets&&getLength(targets)>0?doAwaitResponse(runTargetUnload(targets[0],isAsync),function(){doUnloadAll(arrSlice(targets,1),isAsync,done)}):done(),result}function parseResponse(response,diagLog){try{if(response&&""!==response){var result=getJSON().parse(response);if(result&&result.itemsReceived&&result.itemsReceived>=result.itemsAccepted&&result.itemsReceived-result.itemsAccepted===result.errors.length)return result}}catch(e){_throwInternal(diagLog,1,43,"Cannot parse the response. "+(e.name||dumpObj(e)),{response})}return null}function _aiNameFunc(baseName){var aiName="ai."+baseName+".";return function(name){return aiName+name}}var _aiApplication=_aiNameFunc("application"),_aiDevice=_aiNameFunc("device"),_aiLocation=_aiNameFunc("location"),_aiOperation=_aiNameFunc("operation"),_aiSession=_aiNameFunc("session"),_aiUser=_aiNameFunc("user"),_aiCloud=_aiNameFunc("cloud"),_aiInternal=_aiNameFunc("internal"),ContextTagKeys=function(_super){function ContextTagKeys(){return _super.call(this)||this}return __extendsFn(ContextTagKeys,_super),ContextTagKeys}(function createClassFromInterface(defaults){return function class_1(){var _this=this;defaults&&objForEachKey(defaults,function(field,value){_this[field]=value})}}({applicationVersion:_aiApplication("ver"),applicationBuild:_aiApplication("build"),applicationTypeId:_aiApplication("typeId"),applicationId:_aiApplication("applicationId"),applicationLayer:_aiApplication("layer"),deviceId:_aiDevice("id"),deviceIp:_aiDevice("ip"),deviceLanguage:_aiDevice("language"),deviceLocale:_aiDevice("locale"),deviceModel:_aiDevice("model"),deviceFriendlyName:_aiDevice("friendlyName"),deviceNetwork:_aiDevice("network"),deviceNetworkName:_aiDevice("networkName"),deviceOEMName:_aiDevice("oemName"),deviceOS:_aiDevice("os"),deviceOSVersion:_aiDevice("osVersion"),deviceRoleInstance:_aiDevice("roleInstance"),deviceRoleName:_aiDevice("roleName"),deviceScreenResolution:_aiDevice("screenResolution"),deviceType:_aiDevice("type"),deviceMachineName:_aiDevice("machineName"),deviceVMName:_aiDevice("vmName"),deviceBrowser:_aiDevice("browser"),deviceBrowserVersion:_aiDevice("browserVersion"),locationIp:_aiLocation("ip"),locationCountry:_aiLocation("country"),locationProvince:_aiLocation("province"),locationCity:_aiLocation("city"),operationId:_aiOperation("id"),operationName:_aiOperation("name"),operationParentId:_aiOperation("parentId"),operationRootId:_aiOperation("rootId"),operationSyntheticSource:_aiOperation("syntheticSource"),operationCorrelationVector:_aiOperation("correlationVector"),sessionId:_aiSession("id"),sessionIsFirst:_aiSession("isFirst"),sessionIsNew:_aiSession("isNew"),userAccountAcquisitionDate:_aiUser("accountAcquisitionDate"),userAccountId:_aiUser("accountId"),userAgent:_aiUser("userAgent"),userId:_aiUser("id"),userStoreRegion:_aiUser("storeRegion"),userAuthUserId:_aiUser("authUserId"),userAnonymousUserAcquisitionDate:_aiUser("anonUserAcquisitionDate"),userAuthenticatedUserAcquisitionDate:_aiUser("authUserAcquisitionDate"),cloudName:_aiCloud("name"),cloudRole:_aiCloud("role"),cloudRoleVer:_aiCloud("roleVer"),cloudRoleInstance:_aiCloud("roleInstance"),cloudEnvironment:_aiCloud("environment"),cloudLocation:_aiCloud("location"),cloudDeploymentUnit:_aiCloud("deploymentUnit"),internalNodeName:_aiInternal("nodeName"),internalSdkVersion:_aiInternal("sdkVersion"),internalAgentVersion:_aiInternal("agentVersion"),internalSnippet:_aiInternal("snippet"),internalSdkSrc:_aiInternal("sdkSrc")})),Extensions_UserExt="user",Extensions_DeviceExt="device",Extensions_TraceExt="trace",Extensions_WebExt="web",Extensions_AppExt="app",Extensions_OSExt="os",CtxTagKeys=new ContextTagKeys,Envelope=function Envelope(logger,data,name){var _this=this;this.ver=1,this.sampleRate=100,this.tags={},this.name=dataSanitizeString(logger,name)||"not_specified",this.data=data,this.time=toISOString(new Date),this.aiDataContract={time:1,iKey:1,name:1,sampleRate:function(){return 100===_this.sampleRate?4:1},tags:1,data:1}},Data=function Data(baseType,data){this.aiDataContract={baseType:1,baseData:1},this.baseType=baseType,this.baseData=data};function _setValueIf(target,field,value){return setValue(target,field,value,isTruthy)}function _extractPropsAndMeasurements(data,properties,measurements){isNullOrUndefined(data)||objForEachKey(data,function(key,value){isNumber(value)?measurements[key]=value:isString(value)?properties[key]=value:hasJSON()&&(properties[key]=getJSON().stringify(value))})}function _convertPropsUndefinedToCustomDefinedValue(properties,customUndefinedValue){isNullOrUndefined(properties)||objForEachKey(properties,function(key,value){properties[key]=value||customUndefinedValue})}function _createEnvelope(logger,envelopeType,telemetryItem,data){var envelope=new Envelope(logger,data,envelopeType);_setValueIf(envelope,"sampleRate",telemetryItem.sampleRate),(telemetryItem.baseData||{}).startTime&&(envelope.time=toISOString(telemetryItem.baseData.startTime)),envelope.iKey=telemetryItem.iKey;var iKeyNoDashes=telemetryItem.iKey.replace(/-/g,"");return envelope.name=envelope.name.replace("{0}",iKeyNoDashes),function _extractPartAExtensions(logger,item,env){var envTags=env.tags=env.tags||{},itmExt=item.ext=item.ext||{},itmTags=item.tags=item.tags||[],extUser=itmExt.user;extUser&&(_setValueIf(envTags,CtxTagKeys.userAuthUserId,extUser.authId),_setValueIf(envTags,CtxTagKeys.userId,extUser.id||extUser.localId));var extApp=itmExt.app;extApp&&_setValueIf(envTags,CtxTagKeys.sessionId,extApp.sesId);var extDevice=itmExt.device;extDevice&&(_setValueIf(envTags,CtxTagKeys.deviceId,extDevice.id||extDevice.localId),_setValueIf(envTags,CtxTagKeys.deviceType,extDevice.deviceClass),_setValueIf(envTags,CtxTagKeys.deviceIp,extDevice.ip),_setValueIf(envTags,CtxTagKeys.deviceModel,extDevice.model),_setValueIf(envTags,CtxTagKeys.deviceType,extDevice.deviceType));var web=item.ext.web;if(web){_setValueIf(envTags,CtxTagKeys.deviceLanguage,web.browserLang),_setValueIf(envTags,CtxTagKeys.deviceBrowserVersion,web.browserVer),_setValueIf(envTags,CtxTagKeys.deviceBrowser,web.browser);var envData=env.data=env.data||{},envBaseData=envData.baseData=envData.baseData||{},envProps=envBaseData.properties=envBaseData.properties||{};_setValueIf(envProps,"domain",web.domain),_setValueIf(envProps,"isManual",web.isManual?"true":null),_setValueIf(envProps,"screenRes",web.screenRes),_setValueIf(envProps,"userConsent",web.userConsent?"true":null)}var extOs=itmExt.os;extOs&&(_setValueIf(envTags,CtxTagKeys.deviceOS,extOs.name),_setValueIf(envTags,CtxTagKeys.deviceOSVersion,extOs.osVer));var extTrace=itmExt.trace;extTrace&&(_setValueIf(envTags,CtxTagKeys.operationParentId,extTrace.parentID),_setValueIf(envTags,CtxTagKeys.operationName,dataSanitizeString(logger,extTrace.name)),_setValueIf(envTags,CtxTagKeys.operationId,extTrace.traceID));for(var tgs={},i=itmTags.length-1;i>=0;i--)objForEachKey(itmTags[i],function(key,value){tgs[key]=value}),itmTags.splice(i,1);objForEachKey(itmTags,function(tg,value){tgs[tg]=value});var theTags=__assignFn(__assignFn({},envTags),tgs);theTags[CtxTagKeys.internalSdkVersion]||(theTags[CtxTagKeys.internalSdkVersion]=dataSanitizeString(logger,"javascript:".concat(EnvelopeCreator.Version),64)),env.tags=optimizeObject(theTags)}(logger,telemetryItem,envelope),telemetryItem.tags=telemetryItem.tags||[],optimizeObject(envelope)}function EnvelopeCreatorInit(logger,telemetryItem){isNullOrUndefined(telemetryItem.baseData)&&_throwInternal(logger,1,46,"telemetryItem.baseData cannot be null.")}var EnvelopeCreator={Version:"3.3.11"};function EventEnvelopeCreator(logger,telemetryItem,customUndefinedValue){EnvelopeCreatorInit(logger,telemetryItem);var customProperties={},customMeasurements={};telemetryItem.baseType!==Event_Event.dataType&&(customProperties.baseTypeSource=telemetryItem.baseType),telemetryItem.baseType===Event_Event.dataType?(customProperties=telemetryItem.baseData.properties||{},customMeasurements=telemetryItem.baseData.measurements||{}):telemetryItem.baseData&&_extractPropsAndMeasurements(telemetryItem.baseData,customProperties,customMeasurements),_extractPropsAndMeasurements(telemetryItem.data,customProperties,customMeasurements),isNullOrUndefined(customUndefinedValue)||_convertPropsUndefinedToCustomDefinedValue(customProperties,customUndefinedValue);var eventName=telemetryItem.baseData.name,eventData=new Event_Event(logger,eventName,customProperties,customMeasurements),data=new Data(Event_Event.dataType,eventData);return _createEnvelope(logger,Event_Event.envelopeType,telemetryItem,data)}var Sender_a,Sender_b,BaseSendBuffer=function(){function BaseSendBuffer(logger,config){var _buffer=[],_bufferFullMessageSent=!1,_maxRetryCnt=config.maxRetryCnt;this._get=function(){return _buffer},this._set=function(buffer){return _buffer=buffer},dynamicProto(BaseSendBuffer,this,function(_self){_self.enqueue=function(payload){_self.count()>=config.eventsLimitInMem?_bufferFullMessageSent||(_throwInternal(logger,2,105,"Maximum in-memory buffer size reached: "+_self.count(),!0),_bufferFullMessageSent=!0):(payload.cnt=payload.cnt||0,!isNullOrUndefined(_maxRetryCnt)&&payload.cnt>_maxRetryCnt||_buffer.push(payload))},_self.count=function(){return _buffer.length},_self.size=function(){for(var size=_buffer.length,lp=0;lp<_buffer.length;lp++)size+=_buffer[lp].item.length;return config.emitLineDelimitedJson||(size+=2),size},_self.clear=function(){_buffer=[],_bufferFullMessageSent=!1},_self.getItems=function(){return _buffer.slice(0)},_self.batchPayloads=function(payloads){if(payloads&&payloads.length>0){var payloadStr_1=[];return arrForEach(payloads,function(payload){payloadStr_1.push(payload.item)}),config.emitLineDelimitedJson?payloadStr_1.join("\n"):"["+payloadStr_1.join(",")+"]"}return null},_self.createNew=function(newLogger,newConfig,canUseSessionStorage){var items=_buffer.slice(0);newLogger=newLogger||logger,newConfig=newConfig||{};var newBuffer=canUseSessionStorage?new SessionStorageSendBuffer(newLogger,newConfig):new ArraySendBuffer(newLogger,newConfig);return arrForEach(items,function(payload){newBuffer.enqueue(payload)}),newBuffer}})}return BaseSendBuffer.__ieDyn=1,BaseSendBuffer}(),ArraySendBuffer=function(_super){function ArraySendBuffer(logger,config){var _this=_super.call(this,logger,config)||this;return dynamicProto(ArraySendBuffer,_this,function(_self,_base){_self.markAsSent=function(payload){_base.clear()},_self.clearSent=function(payload){}}),_this}return __extendsFn(ArraySendBuffer,_super),ArraySendBuffer.__ieDyn=1,ArraySendBuffer}(BaseSendBuffer),PREVIOUS_KEYS=["AI_buffer","AI_sentBuffer"],SessionStorageSendBuffer=function(_super){function SessionStorageSendBuffer(logger,config){var _this=_super.call(this,logger,config)||this,_bufferFullMessageSent=!1,_namePrefix=null==config?void 0:config.namePrefix,_b=config.bufferOverride||{getItem:utlGetSessionStorage,setItem:utlSetSessionStorage},getItem=_b.getItem,setItem=_b.setItem,_maxRetryCnt=config.maxRetryCnt;return dynamicProto(SessionStorageSendBuffer,_this,function(_self,_base){var bufferItems=_getBuffer(SessionStorageSendBuffer.BUFFER_KEY),itemsInSentBuffer=_getBuffer(SessionStorageSendBuffer.SENT_BUFFER_KEY),previousItems=function _getPreviousEvents(){var items=[];try{return arrForEach(PREVIOUS_KEYS,function(key){var events=_getItemsFromPreviousKey(key);if(items=items.concat(events),_namePrefix){var prefixEvents=_getItemsFromPreviousKey(_namePrefix+"_"+key);items=items.concat(prefixEvents)}}),items}catch(e){_throwInternal(logger,2,41,"Transfer events from previous buffers: "+getExceptionName(e)+". previous Buffer items can not be removed",{exception:dumpObj(e)})}return[]}(),notDeliveredItems=itemsInSentBuffer.concat(previousItems),buffer=_self._set(bufferItems.concat(notDeliveredItems));function _removePayloadsFromBuffer(payloads,buffer){var remaining=[],payloadStr=[];return arrForEach(payloads,function(payload){payloadStr.push(payload.item)}),arrForEach(buffer,function(value){isFunction(value)||-1!==arrIndexOf(payloadStr,value.item)||remaining.push(value)}),remaining}function _getBuffer(key){var prefixedKey=key;return _getBufferBase(prefixedKey=_namePrefix?_namePrefix+"_"+prefixedKey:prefixedKey)}function _getBufferBase(key){try{var bufferJson=getItem(logger,key);if(bufferJson){var buffer_1=getJSON().parse(bufferJson);if(isString(buffer_1)&&(buffer_1=getJSON().parse(buffer_1)),buffer_1&&isArray(buffer_1))return buffer_1}}catch(e){_throwInternal(logger,1,42," storage key: "+key+", "+getExceptionName(e),{exception:dumpObj(e)})}return[]}function _setBuffer(key,buffer){var prefixedKey=key;try{prefixedKey=_namePrefix?_namePrefix+"_"+prefixedKey:prefixedKey;var bufferJson=JSON.stringify(buffer);setItem(logger,prefixedKey,bufferJson)}catch(e){setItem(logger,prefixedKey,JSON.stringify([])),_throwInternal(logger,2,41," storage key: "+prefixedKey+", "+getExceptionName(e)+". Buffer cleared",{exception:dumpObj(e)})}}function _getItemsFromPreviousKey(key){try{var items=_getBufferBase(key),transFormedItems_1=[];return arrForEach(items,function(item){var internalItem={item,cnt:0};transFormedItems_1.push(internalItem)}),utlRemoveSessionStorage(logger,key),transFormedItems_1}catch(e){}return[]}buffer.length>SessionStorageSendBuffer.MAX_BUFFER_SIZE&&(buffer.length=SessionStorageSendBuffer.MAX_BUFFER_SIZE),_setBuffer(SessionStorageSendBuffer.SENT_BUFFER_KEY,[]),_setBuffer(SessionStorageSendBuffer.BUFFER_KEY,buffer),_self.enqueue=function(payload){_self.count()>=SessionStorageSendBuffer.MAX_BUFFER_SIZE?_bufferFullMessageSent||(_throwInternal(logger,2,67,"Maximum buffer size reached: "+_self.count(),!0),_bufferFullMessageSent=!0):(payload.cnt=payload.cnt||0,!isNullOrUndefined(_maxRetryCnt)&&payload.cnt>_maxRetryCnt||(_base.enqueue(payload),_setBuffer(SessionStorageSendBuffer.BUFFER_KEY,_self._get())))},_self.clear=function(){_base.clear(),_setBuffer(SessionStorageSendBuffer.BUFFER_KEY,_self._get()),_setBuffer(SessionStorageSendBuffer.SENT_BUFFER_KEY,[]),_bufferFullMessageSent=!1},_self.markAsSent=function(payload){_setBuffer(SessionStorageSendBuffer.BUFFER_KEY,_self._set(_removePayloadsFromBuffer(payload,_self._get())));var sentElements=_getBuffer(SessionStorageSendBuffer.SENT_BUFFER_KEY);sentElements instanceof Array&&payload instanceof Array&&((sentElements=sentElements.concat(payload)).length>SessionStorageSendBuffer.MAX_BUFFER_SIZE&&(_throwInternal(logger,1,67,"Sent buffer reached its maximum size: "+sentElements.length,!0),sentElements.length=SessionStorageSendBuffer.MAX_BUFFER_SIZE),_setBuffer(SessionStorageSendBuffer.SENT_BUFFER_KEY,sentElements))},_self.clearSent=function(payload){var sentElements=_getBuffer(SessionStorageSendBuffer.SENT_BUFFER_KEY);sentElements=_removePayloadsFromBuffer(payload,sentElements),_setBuffer(SessionStorageSendBuffer.SENT_BUFFER_KEY,sentElements)},_self.createNew=function(newLogger,newConfig,canUseSessionStorage){canUseSessionStorage=!!canUseSessionStorage;var unsentItems=_self._get().slice(0),sentItems=_getBuffer(SessionStorageSendBuffer.SENT_BUFFER_KEY).slice(0);newLogger=newLogger||logger,newConfig=newConfig||{},_self.clear();var newBuffer=canUseSessionStorage?new SessionStorageSendBuffer(newLogger,newConfig):new ArraySendBuffer(newLogger,newConfig);return arrForEach(unsentItems,function(payload){newBuffer.enqueue(payload)}),canUseSessionStorage&&newBuffer.markAsSent(sentItems),newBuffer}}),_this}var _a;return __extendsFn(SessionStorageSendBuffer,_super),_a=SessionStorageSendBuffer,SessionStorageSendBuffer.VERSION="_1",SessionStorageSendBuffer.BUFFER_KEY="AI_buffer"+_a.VERSION,SessionStorageSendBuffer.SENT_BUFFER_KEY="AI_sentBuffer"+_a.VERSION,SessionStorageSendBuffer.MAX_BUFFER_SIZE=2e3,SessionStorageSendBuffer}(BaseSendBuffer),Serializer=function(){function Serializer(logger){dynamicProto(Serializer,this,function(_self){function _serializeObject(source,name){var output={};if(!source)return _throwInternal(logger,1,48,"cannot serialize object because it is null or undefined",{name},!0),output;if(source.__aiCircularRefCheck)return _throwInternal(logger,2,50,"Circular reference detected while serializing object",{name},!0),output;if(!source.aiDataContract){if("measurements"===name)output=_serializeStringMap(source,"number",name);else if("properties"===name)output=_serializeStringMap(source,"string",name);else if("tags"===name)output=_serializeStringMap(source,"string",name);else if(isArray(source))output=_serializeArray(source,name);else{_throwInternal(logger,2,49,"Attempting to serialize an object which does not implement ISerializable",{name},!0);try{getJSON().stringify(source),output=source}catch(e){_throwInternal(logger,1,48,e&&isFunction(e.toString)?e.toString():"Error serializing object",null,!0)}}return output}return source.__aiCircularRefCheck=!0,objForEachKey(source.aiDataContract,function(field,contract){var isRequired=isFunction(contract)?1&contract():1&contract,isHidden=isFunction(contract)?4&contract():4&contract,isArray=2&contract,isPresent=void 0!==source[field],isObj=isObject(source[field])&&null!==source[field];if(!isRequired||isPresent||isArray){if(!isHidden){var value=void 0;void 0!==(value=isObj?isArray?_serializeArray(source[field],field):_serializeObject(source[field],field):source[field])&&(output[field]=value)}}else _throwInternal(logger,1,24,"Missing required field specification. The field is required but not present on source",{field,name})}),delete source.__aiCircularRefCheck,output}function _serializeArray(sources,name){var output;if(sources)if(isArray(sources)){output=[];for(var i=0;i<sources.length;i++){var item=_serializeObject(sources[i],name+"["+i+"]");output.push(item)}}else _throwInternal(logger,1,54,"This field was specified as an array in the contract but the item is not an array.\r\n",{name},!0);return output}function _serializeStringMap(map,expectedType,name){var output;return map&&(output={},objForEachKey(map,function(field,value){if("string"===expectedType)void 0===value?output[field]="undefined":null===value?output[field]="null":value.toString?output[field]=value.toString():output[field]="invalid field: toString() is not defined.";else if("number"===expectedType)if(void 0===value)output[field]="undefined";else if(null===value)output[field]="null";else{var num=parseFloat(value);output[field]=num}else output[field]="invalid field: "+name+" is of unknown type.",_throwInternal(logger,1,output[field],null,!0)})),output}_self.serialize=function(input){var output=_serializeObject(input,"root");try{return getJSON().stringify(output)}catch(e){_throwInternal(logger,1,48,e&&isFunction(e.toString)?e.toString():"Error serializing object",null,!0)}}})}return Serializer.__ieDyn=1,Serializer}(),HashCodeScoreGenerator=function(){function HashCodeScoreGenerator(){}return HashCodeScoreGenerator.prototype.getHashCodeScore=function(key){return 100*(this.getHashCode(key)/HashCodeScoreGenerator.INT_MAX_VALUE)},HashCodeScoreGenerator.prototype.getHashCode=function(input){if(""===input)return 0;for(;input.length<8;)input=input.concat(input);for(var hash=5381,i=0;i<input.length;++i)hash=(hash<<5)+hash+input.charCodeAt(i),hash&=hash;return Math.abs(hash)},HashCodeScoreGenerator.INT_MAX_VALUE=2147483647,HashCodeScoreGenerator}(),SamplingScoreGenerator=function SamplingScoreGenerator(){var hashCodeGenerator=new HashCodeScoreGenerator,keys=new ContextTagKeys;this.getSamplingScore=function(item){return item.tags&&item.tags[keys.userId]?hashCodeGenerator.getHashCodeScore(item.tags[keys.userId]):item.ext&&item.ext.user&&item.ext.user.id?hashCodeGenerator.getHashCodeScore(item.ext.user.id):item.tags&&item.tags[keys.operationId]?hashCodeGenerator.getHashCodeScore(item.tags[keys.operationId]):item.ext&&item.ext.telemetryTrace&&item.ext.telemetryTrace.traceID?hashCodeGenerator.getHashCodeScore(item.ext.telemetryTrace.traceID):100*Math.random()}},Sample=function(){function Sample(sampleRate,logger){this.INT_MAX_VALUE=2147483647;var _logger=logger||safeGetLogger(null);(sampleRate>100||sampleRate<0)&&(_logger.throwInternal(2,58,"Sampling rate is out of range (0..100). Sampling will be disabled, you may be sending too much data which may affect your AI service level.",{samplingRate:sampleRate},!0),sampleRate=100),this.sampleRate=sampleRate,this.samplingScoreGenerator=new SamplingScoreGenerator}return Sample.prototype.isSampledIn=function(envelope){var samplingPercentage=this.sampleRate;return null==samplingPercentage||samplingPercentage>=100||(envelope.baseType===Metric.dataType||this.samplingScoreGenerator.getSamplingScore(envelope)<samplingPercentage)},Sample}();function _getResponseText(xhr){try{return xhr.responseText}catch(e){}return null}var defaultAppInsightsChannelConfig=objDeepFreeze(((Sender_a={endpointUrl:cfgDfValidate(isTruthy,"https://dc.services.visualstudio.com/v2/track")}).emitLineDelimitedJson=cfgDfBoolean(),Sender_a.maxBatchInterval=15e3,Sender_a.maxBatchSizeInBytes=102400,Sender_a.disableTelemetry=cfgDfBoolean(),Sender_a.enableSessionStorageBuffer=cfgDfBoolean(!0),Sender_a.isRetryDisabled=cfgDfBoolean(),Sender_a.isBeaconApiDisabled=cfgDfBoolean(!0),Sender_a.disableSendBeaconSplit=cfgDfBoolean(!0),Sender_a.disableXhr=cfgDfBoolean(),Sender_a.onunloadDisableFetch=cfgDfBoolean(),Sender_a.onunloadDisableBeacon=cfgDfBoolean(),Sender_a.instrumentationKey=void 0,Sender_a.namePrefix=void 0,Sender_a.samplingPercentage=cfgDfValidate(function Sender_chkSampling(value){return!isNaN(value)&&value>0&&value<=100},100),Sender_a.customHeaders=void 0,Sender_a.convertUndefined=void 0,Sender_a.eventsLimitInMem=1e4,Sender_a.bufferOverride=!1,Sender_a.httpXHROverride={isVal:function isOverrideFn(httpXHROverride){return httpXHROverride&&httpXHROverride.sendPOST},v:void 0},Sender_a.alwaysUseXhrOverride=cfgDfBoolean(),Sender_a.transports=void 0,Sender_a.retryCodes=void 0,Sender_a.corsPolicy=void 0,Sender_a.maxRetryCnt={isVal:isNumber,v:10},Sender_a));var EnvelopeTypeCreator=((Sender_b={})[Event_Event.dataType]=EventEnvelopeCreator,Sender_b[Trace.dataType]=function TraceEnvelopeCreator(logger,telemetryItem,customUndefinedValue){EnvelopeCreatorInit(logger,telemetryItem);var message=telemetryItem.baseData.message,severityLevel=telemetryItem.baseData.severityLevel,props=telemetryItem.baseData.properties||{},measurements=telemetryItem.baseData.measurements||{};_extractPropsAndMeasurements(telemetryItem.data,props,measurements),isNullOrUndefined(customUndefinedValue)||_convertPropsUndefinedToCustomDefinedValue(props,customUndefinedValue);var baseData=new Trace(logger,message,severityLevel,props,measurements),data=new Data(Trace.dataType,baseData);return _createEnvelope(logger,Trace.envelopeType,telemetryItem,data)},Sender_b[PageView.dataType]=function PageViewEnvelopeCreator(logger,telemetryItem,customUndefinedValue){var duration;EnvelopeCreatorInit(logger,telemetryItem);var baseData=telemetryItem.baseData;isNullOrUndefined(baseData)||isNullOrUndefined(baseData.properties)||isNullOrUndefined(baseData.properties.duration)?isNullOrUndefined(telemetryItem.data)||isNullOrUndefined(telemetryItem.data.duration)||(duration=telemetryItem.data.duration,delete telemetryItem.data.duration):(duration=baseData.properties.duration,delete baseData.properties.duration);var currentContextId,bd=telemetryItem.baseData;((telemetryItem.ext||{}).trace||{}).traceID&&(currentContextId=telemetryItem.ext.trace.traceID);var id=bd.id||currentContextId,name=bd.name,url=bd.uri,properties=bd.properties||{},measurements=bd.measurements||{};isNullOrUndefined(bd.refUri)||(properties.refUri=bd.refUri),isNullOrUndefined(bd.pageType)||(properties.pageType=bd.pageType),isNullOrUndefined(bd.isLoggedIn)||(properties.isLoggedIn=bd.isLoggedIn.toString()),isNullOrUndefined(bd.properties)||objForEachKey(bd.properties,function(key,value){properties[key]=value}),_extractPropsAndMeasurements(telemetryItem.data,properties,measurements),isNullOrUndefined(customUndefinedValue)||_convertPropsUndefinedToCustomDefinedValue(properties,customUndefinedValue);var pageViewData=new PageView(logger,name,url,duration,properties,measurements,id),data=new Data(PageView.dataType,pageViewData);return _createEnvelope(logger,PageView.envelopeType,telemetryItem,data)},Sender_b[PageViewPerformance.dataType]=function PageViewPerformanceEnvelopeCreator(logger,telemetryItem,customUndefinedValue){EnvelopeCreatorInit(logger,telemetryItem);var bd=telemetryItem.baseData,name=bd.name,url=bd.uri||bd.url,properties=bd.properties||{},measurements=bd.measurements||{};_extractPropsAndMeasurements(telemetryItem.data,properties,measurements),isNullOrUndefined(customUndefinedValue)||_convertPropsUndefinedToCustomDefinedValue(properties,customUndefinedValue);var baseData=new PageViewPerformance(logger,name,url,void 0,properties,measurements,bd),data=new Data(PageViewPerformance.dataType,baseData);return _createEnvelope(logger,PageViewPerformance.envelopeType,telemetryItem,data)},Sender_b[Exception.dataType]=function ExceptionEnvelopeCreator(logger,telemetryItem,customUndefinedValue){EnvelopeCreatorInit(logger,telemetryItem);var customMeasurements=telemetryItem.baseData.measurements||{},customProperties=telemetryItem.baseData.properties||{};_extractPropsAndMeasurements(telemetryItem.data,customProperties,customMeasurements),isNullOrUndefined(customUndefinedValue)||_convertPropsUndefinedToCustomDefinedValue(customProperties,customUndefinedValue);var bd=telemetryItem.baseData,exData=Exception.CreateFromInterface(logger,bd,customProperties,customMeasurements),data=new Data(Exception.dataType,exData);return _createEnvelope(logger,Exception.envelopeType,telemetryItem,data)},Sender_b[Metric.dataType]=function MetricEnvelopeCreator(logger,telemetryItem,customUndefinedValue){EnvelopeCreatorInit(logger,telemetryItem);var baseData=telemetryItem.baseData,props=baseData.properties||{},measurements=baseData.measurements||{};_extractPropsAndMeasurements(telemetryItem.data,props,measurements),isNullOrUndefined(customUndefinedValue)||_convertPropsUndefinedToCustomDefinedValue(props,customUndefinedValue);var baseMetricData=new Metric(logger,baseData.name,baseData.average,baseData.sampleCount,baseData.min,baseData.max,baseData.stdDev,props,measurements),data=new Data(Metric.dataType,baseMetricData);return _createEnvelope(logger,Metric.envelopeType,telemetryItem,data)},Sender_b[RemoteDependencyData.dataType]=function DependencyEnvelopeCreator(logger,telemetryItem,customUndefinedValue){EnvelopeCreatorInit(logger,telemetryItem);var customMeasurements=telemetryItem.baseData.measurements||{},customProperties=telemetryItem.baseData.properties||{};_extractPropsAndMeasurements(telemetryItem.data,customProperties,customMeasurements),isNullOrUndefined(customUndefinedValue)||_convertPropsUndefinedToCustomDefinedValue(customProperties,customUndefinedValue);var bd=telemetryItem.baseData;if(isNullOrUndefined(bd))return _warnToConsole(logger,"Invalid input for dependency data"),null;var method=bd.properties&&bd.properties["http.method"]?bd.properties["http.method"]:"GET",remoteDepData=new RemoteDependencyData(logger,bd.id,bd.target,bd.name,bd.duration,bd.success,bd.responseCode,method,bd.type,bd.correlationContext,customProperties,customMeasurements),data=new Data(RemoteDependencyData.dataType,remoteDepData);return _createEnvelope(logger,RemoteDependencyData.envelopeType,telemetryItem,data)},Sender_b),Sender=function(_super){function Sender(){var _consecutiveErrors,_retryAt,_paused,_timeoutHandle,_serializer,_stamp_specific_redirects,_headers,_this=_super.call(this)||this;_this.priority=1001,_this.identifier="AppInsightsChannelPlugin";var _syncUnloadSender,_offlineListener,_evtNamespace,_endpointUrl,_orgEndpointUrl,_maxBatchSizeInBytes,_beaconSupported,_beaconOnUnloadSupported,_beaconNormalSupported,_customHeaders,_disableTelemetry,_instrumentationKey,_convertUndefined,_isRetryDisabled,_maxBatchInterval,_sessionStorageUsed,_bufferOverrideUsed,_namePrefix,_enableSendPromise,_alwaysUseCustomSend,_disableXhr,_fetchKeepAlive,_xhrSend,_fallbackSend,_disableBeaconSplit,_sendPostMgr,_retryCodes,_zipPayload,_syncFetchPayload=0;return dynamicProto(Sender,_this,function(_self,_base){function _xdrOnLoad(xdr,payload){var responseText=_getResponseText(xdr);if(!xdr||responseText+""!="200"&&""!==responseText){var results=parseResponse(responseText);results&&results.itemsReceived&&results.itemsReceived>results.itemsAccepted&&!_isRetryDisabled?_self._onPartialSuccess(payload,results):_self._onError(payload,formatErrorMessageXdr(xdr))}else _consecutiveErrors=0,_self._onSuccess(payload,0)}function _xhrReadyStateChange(xhr,payload,countOfItemsInPayload){4===xhr.readyState&&_checkResponsStatus(xhr.status,payload,xhr.responseURL,countOfItemsInPayload,formatErrorMessageXhr(xhr),_getResponseText(xhr)||xhr.response)}function _getPayloadArr(payload){try{if(payload){var arr=payload.oriPayload;return arr&&arr.length?arr:null}}catch(e){}return null}function _validate(telemetryItem,diagLogger){return!_disableTelemetry&&(telemetryItem?telemetryItem.baseData&&!telemetryItem.baseType?(diagLogger&&_throwInternal(diagLogger,1,70,"Cannot send telemetry without baseData and baseType"),!1):(telemetryItem.baseType||(telemetryItem.baseType="EventData"),_self._sender?function _isSampledIn(envelope){return _self._sample.isSampledIn(envelope)}(telemetryItem)?(telemetryItem.sampleRate=_self._sample.sampleRate,!0):(diagLogger&&_throwInternal(diagLogger,2,33,"Telemetry item was sampled out and not sent",{SampleRate:_self._sample.sampleRate}),!1):(diagLogger&&_throwInternal(diagLogger,1,28,"Sender was not initialized"),!1)):(diagLogger&&_throwInternal(diagLogger,1,7,"Cannot send empty telemetry"),!1))}function _getEnvelope(telemetryItem,diagLogger){var defaultEnvelopeIkey=telemetryItem.iKey||_instrumentationKey,aiEnvelope=Sender.constructEnvelope(telemetryItem,defaultEnvelopeIkey,diagLogger,_convertUndefined);if(aiEnvelope){var doNotSendItem=!1;if(telemetryItem.tags&&telemetryItem.tags.ProcessLegacy&&(arrForEach(telemetryItem.tags.ProcessLegacy,function(callBack){try{callBack&&!1===callBack(aiEnvelope)&&(doNotSendItem=!0,_warnToConsole(diagLogger,"Telemetry processor check returns false"))}catch(e){_throwInternal(diagLogger,1,64,"One of telemetry initializers failed, telemetry item will not be sent: "+getExceptionName(e),{exception:dumpObj(e)},!0)}}),delete telemetryItem.tags.ProcessLegacy),!doNotSendItem)return aiEnvelope}else _throwInternal(diagLogger,1,47,"Unable to create an AppInsights envelope")}function _serialize(item){var rlt="",diagLogger=_self.diagLog();try{var valid=_validate(item,diagLogger),envelope=null;valid&&(envelope=_getEnvelope(item,diagLogger)),envelope&&(rlt=_serializer.serialize(envelope))}catch(e){}return rlt}function _batch(arr){var rlt="";return arr&&arr.length&&(rlt="["+arr.join(",")+"]"),rlt}function _createPayload(data){var headers=_getHeaders();return{urlString:_endpointUrl,data,headers}}function _doSend(sendInterface,payload,isAsync,markAsSent){void 0===markAsSent&&(markAsSent=!0);var onComplete=function(status,headers,response){return function _getOnComplete(payload,status,headers,response){200===status&&payload?_self._onSuccess(payload,payload.length):response&&_self._onError(payload,response)}(payload,status,0,response)},payloadData=_getPayload(payload),sendPostFunc=sendInterface&&sendInterface.sendPOST;if(sendPostFunc&&payloadData){var result_2;markAsSent&&_self._buffer.markAsSent(payload);var resolveFn_1,rejectFn_1,callbackExecuted_1=!1;return _sendPostMgr.preparePayload(function(processedPayload){result_2=sendPostFunc(processedPayload,onComplete,!isAsync),callbackExecuted_1=!0,resolveFn_1&&doAwait(result_2,resolveFn_1,rejectFn_1)},_zipPayload,payloadData,!isAsync),callbackExecuted_1?result_2:createPromise(function(resolve,reject){resolveFn_1=resolve,rejectFn_1=reject})}return null}function _getPayload(payload){if(isArray(payload)&&payload.length>0){var batch=_self._buffer.batchPayloads(payload),headers=_getHeaders();return{data:batch,urlString:_endpointUrl,headers,disableXhrSync:_disableXhr,disableFetchKeepAlive:!_fetchKeepAlive,oriPayload:payload}}return null}function _getHeaders(){try{var headers=_headers||{};return isInternalApplicationInsightsEndpoint(_endpointUrl)&&(headers[RequestHeaders[6]]=RequestHeaders[7]),headers}catch(e){}return null}function _checkMaxSize(incomingPayload){var incomingSize=incomingPayload?incomingPayload.length:0;return _self._buffer.size()+incomingSize>_maxBatchSizeInBytes&&(_offlineListener&&!_offlineListener.isOnline()||_self.triggerSend(!0,null,10),!0)}function _checkResponsStatus(status,payload,responseUrl,countOfItemsInPayload,errorMessage,res){var response=null;if(_self._appId||(response=parseResponse(res))&&response.appId&&(_self._appId=response.appId),(status<200||status>=300)&&0!==status){if((301===status||307===status||308===status)&&!_checkAndUpdateEndPointUrl(responseUrl))return void _self._onError(payload,errorMessage);if(_offlineListener&&!_offlineListener.isOnline()){if(!_isRetryDisabled){_resendPayload(payload,10),_throwInternal(_self.diagLog(),2,40,". Offline - Response Code: ".concat(status,". Offline status: ").concat(!_offlineListener.isOnline(),". Will retry to send ").concat(payload.length," items."))}return}!_isRetryDisabled&&_isRetriable(status)?(_resendPayload(payload),_throwInternal(_self.diagLog(),2,40,". Response code "+status+". Will retry to send "+payload.length+" items.")):_self._onError(payload,errorMessage)}else _checkAndUpdateEndPointUrl(responseUrl),206===status?(response||(response=parseResponse(res)),response&&!_isRetryDisabled?_self._onPartialSuccess(payload,response):_self._onError(payload,errorMessage)):(_consecutiveErrors=0,_self._onSuccess(payload,countOfItemsInPayload))}function _checkAndUpdateEndPointUrl(responseUrl){return!(_stamp_specific_redirects>=10)&&(!isNullOrUndefined(responseUrl)&&""!==responseUrl&&responseUrl!==_endpointUrl&&(_endpointUrl=responseUrl,++_stamp_specific_redirects,!0))}function _doUnloadSend(payload,isAsync){if(!_syncUnloadSender)return _doSend(_sendPostMgr&&_sendPostMgr.getSenderInst([3],!0),payload,isAsync);_syncUnloadSender(payload,!1)}function _isStringArr(arr){try{if(arr&&arr.length)return isString(arr[0])}catch(e){}return null}function _fetchKeepAliveSender(payload,isAsync){var transport=null;if(isArray(payload)){for(var payloadSize=payload.length,lp=0;lp<payload.length;lp++)payloadSize+=payload[lp].item.length;return _sendPostMgr.getSyncFetchPayload()+payloadSize<=65e3?transport=2:isBeaconsSupported()?transport=3:(transport=1,_throwInternal(_self.diagLog(),2,40,". Failed to send telemetry with Beacon API, retried with xhrSender.")),_doSend(_sendPostMgr&&_sendPostMgr.getSenderInst([transport],!0),payload,isAsync)}return null}function _resendPayload(payload,linearFactor){if(void 0===linearFactor&&(linearFactor=1),payload&&0!==payload.length){var buffer=_self._buffer;buffer.clearSent(payload),_consecutiveErrors++;for(var _i=0,payload_1=payload;_i<payload_1.length;_i++){var item=payload_1[_i];item.cnt=item.cnt||0,item.cnt++,buffer.enqueue(item)}!function _setRetryTime(linearFactor){var delayInSeconds,SlotDelayInSeconds=10;if(_consecutiveErrors<=1)delayInSeconds=SlotDelayInSeconds;else{var backOffSlot=(Math.pow(2,_consecutiveErrors)-1)/2,backOffDelay=mathFloor(Math.random()*backOffSlot*SlotDelayInSeconds)+1;delayInSeconds=mathMax(mathMin(backOffDelay*=linearFactor,3600),SlotDelayInSeconds)}var retryAfterTimeSpan=utcNow()+1e3*delayInSeconds;_retryAt=retryAfterTimeSpan}(linearFactor),_setupTimer()}}function _setupTimer(){if(!_timeoutHandle&&!_paused){var retryInterval=_retryAt?mathMax(0,_retryAt-utcNow()):0,timerValue=mathMax(_maxBatchInterval,retryInterval);_timeoutHandle=scheduleTimeout(function(){_timeoutHandle=null,_self.triggerSend(!0,null,1)},timerValue)}}function _clearScheduledTimer(){_timeoutHandle&&_timeoutHandle.cancel(),_timeoutHandle=null,_retryAt=null}function _isRetriable(statusCode){return isNullOrUndefined(_retryCodes)?401===statusCode||408===statusCode||429===statusCode||500===statusCode||502===statusCode||503===statusCode||504===statusCode:_retryCodes.length&&_retryCodes.indexOf(statusCode)>-1}function _initDefaults(){_self._sender=null,_self._buffer=null,_self._appId=null,_self._sample=null,_headers={},_offlineListener=null,_consecutiveErrors=0,_retryAt=null,_paused=!1,_timeoutHandle=null,_serializer=null,_stamp_specific_redirects=0,_syncFetchPayload=0,_syncUnloadSender=null,_evtNamespace=null,_endpointUrl=null,_orgEndpointUrl=null,_maxBatchSizeInBytes=0,_beaconSupported=!1,_customHeaders=null,_disableTelemetry=!1,_instrumentationKey=null,_convertUndefined=void 0,_isRetryDisabled=!1,_sessionStorageUsed=null,_namePrefix=void 0,_disableXhr=!1,_fetchKeepAlive=!1,_disableBeaconSplit=!1,_xhrSend=null,_fallbackSend=null,_sendPostMgr=null,objDefine(_self,"_senderConfig",{g:function(){return HelperFuncs_objExtend({},defaultAppInsightsChannelConfig)}})}_initDefaults(),_self.pause=function(){_clearScheduledTimer(),_paused=!0},_self.resume=function(){_paused&&(_paused=!1,_retryAt=null,_checkMaxSize(),_setupTimer())},_self.flush=function(isAsync,callBack,sendReason){if(void 0===isAsync&&(isAsync=!0),!_paused){_clearScheduledTimer();try{var result_1=_self.triggerSend(isAsync,null,sendReason||1);return doAwaitResponse(result_1,function(rsp){return callBack?(callBack(!rsp.rejected),!0):isAsync?createPromise(function(resolve){resolve(!rsp.rejected)}):result_1})}catch(e){_throwInternal(_self.diagLog(),1,22,"flush failed, telemetry will not be collected: "+getExceptionName(e),{exception:dumpObj(e)})}}},_self.onunloadFlush=function(){if(!_paused)if(_beaconSupported||_alwaysUseCustomSend)try{return _self.triggerSend(!0,_doUnloadSend,2)}catch(e){_throwInternal(_self.diagLog(),1,20,"failed to flush with beacon sender on page unload, telemetry will not be collected: "+getExceptionName(e),{exception:dumpObj(e)})}else _self.flush(!1)},_self.addHeader=function(name,value){_headers[name]=value},_self.initialize=function(config,core,extensions,pluginChain){_self.isInitialized()&&_throwInternal(_self.diagLog(),1,28,"Sender is already initialized"),_base.initialize(config,core,extensions,pluginChain);var identifier=_self.identifier;_serializer=new Serializer(core.logger),_consecutiveErrors=0,_retryAt=null,_self._sender=null,_stamp_specific_redirects=0;var diagLog=_self.diagLog();_evtNamespace=mergeEvtNamespace(createUniqueNamespace("Sender"),core.evtNamespace&&core.evtNamespace()),_offlineListener=function createOfflineListener(parentEvtNamespace){var _document=getDocument(),_navigator=getNavigator(),_isListening=!1,listenerList=[],rState=1;!_navigator||isNullOrUndefined(_navigator.onLine)||_navigator.onLine||(rState=2);var uState=0,_currentState=calCurrentState(),_evtNamespace=mergeEvtNamespace(createUniqueNamespace("OfflineListener"),parentEvtNamespace);try{if(_enableEvents(getWindow())&&(_isListening=!0),_document){var target=_document.body||_document;target.ononline&&_enableEvents(target)&&(_isListening=!0)}}catch(e){_isListening=!1}function _enableEvents(target){var enabled=!1;return target&&(enabled=eventOn(target,"online",_setOnline,_evtNamespace))&&eventOn(target,"offline",_setOffline,_evtNamespace),enabled}function calCurrentState(){return 2!==uState&&2!==rState}function listnerNoticeCheck(){var newState=calCurrentState();_currentState!==newState&&(_currentState=newState,arrForEach(listenerList,function(callback){var offlineState={isOnline:_currentState,rState,uState};try{callback(offlineState)}catch(e){}}))}function _setOnline(){rState=1,listnerNoticeCheck()}function _setOffline(){rState=2,listnerNoticeCheck()}return{isOnline:function _isOnline(){return _currentState},isListening:function(){return _isListening},unload:function _unload(){var win=getWindow();if(win&&_isListening){if(_disableEvents(win,_evtNamespace),_document){var target=_document.body||_document;isUndefined(target.ononline)||_disableEvents(target,_evtNamespace)}_isListening=!1}},addListener:function addListener(callback){return listenerList.push(callback),{rm:function(){var index=listenerList.indexOf(callback);return index>-1?listenerList.splice(index,1):void 0}}},setOnlineState:function setOnlineState(newState){uState=newState,listnerNoticeCheck()}}}(_evtNamespace),_self._addHook(onConfigChange(config,function(details){var config=details.cfg;config.storagePrefix&&utlSetStoragePrefix(config.storagePrefix);var senderConfig=createProcessTelemetryContext(null,config,core).getExtCfg(identifier,defaultAppInsightsChannelConfig),curExtUrl=senderConfig.endpointUrl;if(_endpointUrl&&curExtUrl===_endpointUrl){var coreUrl=config.endpointUrl;coreUrl&&coreUrl!==curExtUrl&&(senderConfig.endpointUrl=coreUrl)}var csStream=getInst("CompressionStream");_zipPayload=isFeatureEnabled("zipPayload",config,!1),isFunction(csStream)||(_zipPayload=!1);var corsPolicy=senderConfig.corsPolicy;corsPolicy?"same-origin"!==corsPolicy&&"same-site"!==corsPolicy&&"cross-origin"!==corsPolicy||_this.addHeader("X-Set-Cross-Origin-Resource-Policy",corsPolicy):delete _headers["X-Set-Cross-Origin-Resource-Policy"],isPromiseLike(senderConfig.instrumentationKey)&&(senderConfig.instrumentationKey=config.instrumentationKey),objDefine(_self,"_senderConfig",{g:function(){return senderConfig}}),_orgEndpointUrl!==senderConfig.endpointUrl&&(_endpointUrl=_orgEndpointUrl=senderConfig.endpointUrl),core.activeStatus()===ActiveStatus.PENDING?_self.pause():core.activeStatus()===ActiveStatus.ACTIVE&&_self.resume(),_customHeaders&&_customHeaders!==senderConfig.customHeaders&&arrForEach(_customHeaders,function(customHeader){delete _headers[customHeader.header]}),_maxBatchSizeInBytes=senderConfig.maxBatchSizeInBytes,_beaconSupported=(!1===senderConfig.onunloadDisableBeacon||!1===senderConfig.isBeaconApiDisabled)&&isBeaconsSupported(),_beaconOnUnloadSupported=!1===senderConfig.onunloadDisableBeacon&&isBeaconsSupported(),_beaconNormalSupported=!1===senderConfig.isBeaconApiDisabled&&isBeaconsSupported(),_alwaysUseCustomSend=senderConfig.alwaysUseXhrOverride,_disableXhr=!!senderConfig.disableXhr,_retryCodes=senderConfig.retryCodes;var bufferOverride=senderConfig.bufferOverride,canUseSessionStorage=!!senderConfig.enableSessionStorageBuffer&&(!!bufferOverride||utlCanUseSessionStorage()),namePrefix=senderConfig.namePrefix,shouldUpdate=canUseSessionStorage!==_sessionStorageUsed||canUseSessionStorage&&_namePrefix!==namePrefix||canUseSessionStorage&&_bufferOverrideUsed!==bufferOverride;if(_self._buffer){if(shouldUpdate)try{_self._buffer=_self._buffer.createNew(diagLog,senderConfig,canUseSessionStorage)}catch(e){_throwInternal(_self.diagLog(),1,12,"failed to transfer telemetry to different buffer storage, telemetry will be lost: "+getExceptionName(e),{exception:dumpObj(e)})}_checkMaxSize()}else _self._buffer=canUseSessionStorage?new SessionStorageSendBuffer(diagLog,senderConfig):new ArraySendBuffer(diagLog,senderConfig);_namePrefix=namePrefix,_sessionStorageUsed=canUseSessionStorage,_bufferOverrideUsed=bufferOverride,_fetchKeepAlive=!senderConfig.onunloadDisableFetch&&isFetchSupported(!0),_disableBeaconSplit=!!senderConfig.disableSendBeaconSplit,_self._sample=new Sample(senderConfig.samplingPercentage,diagLog),isPromiseLike(_instrumentationKey=senderConfig.instrumentationKey)||function _validateInstrumentationKey(instrumentationKey,config){var disableValidation=config.disableInstrumentationKeyValidation;if(!isNullOrUndefined(disableValidation)&&disableValidation)return!0;return new RegExp("^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$").test(instrumentationKey)}(_instrumentationKey,config)||_throwInternal(diagLog,1,100,"Invalid Instrumentation key "+_instrumentationKey),_customHeaders=senderConfig.customHeaders,isString(_endpointUrl)&&!isInternalApplicationInsightsEndpoint(_endpointUrl)&&_customHeaders&&_customHeaders.length>0?arrForEach(_customHeaders,function(customHeader){_this.addHeader(customHeader.header,customHeader.value)}):_customHeaders=null,_enableSendPromise=senderConfig.enableSendPromise;var sendPostConfig=function _getSendPostMgrConfig(){try{return{enableSendPromise:_enableSendPromise,isOneDs:!1,disableCredentials:!1,disableXhr:_disableXhr,disableBeacon:!_beaconNormalSupported,disableBeaconSync:!_beaconOnUnloadSupported,senderOnCompleteCallBack:{xdrOnComplete:function(xdr,oncomplete,payload){var payloadArr=_getPayloadArr(payload);if(payloadArr)return _xdrOnLoad(xdr,payloadArr)},fetchOnComplete:function(response,onComplete,resValue,payload){var payloadArr=_getPayloadArr(payload);if(payloadArr)return _checkResponsStatus(response.status,payloadArr,response.url,payloadArr.length,response.statusText,resValue||"")},xhrOnComplete:function(request,oncomplete,payload){var payloadArr=_getPayloadArr(payload);if(payloadArr)return _xhrReadyStateChange(request,payloadArr,payloadArr.length)},beaconOnRetry:function(data,onComplete,canSend){return function _onBeaconRetry(payload,onComplete,canSend){var internalPayload=payload,data=internalPayload&&internalPayload.oriPayload;if(_disableBeaconSplit)_fallbackSend&&_fallbackSend(data,!0),_throwInternal(_self.diagLog(),2,40,". Failed to send telemetry with Beacon API, retried with normal sender.");else{for(var droppedPayload=[],lp=0;lp<data.length;lp++){var thePayload=data[lp],arr=[thePayload];canSend(_getPayload(arr),onComplete)?_self._onSuccess(arr,arr.length):droppedPayload.push(thePayload)}droppedPayload.length>0&&(_fallbackSend&&_fallbackSend(droppedPayload,!0),_throwInternal(_self.diagLog(),2,40,". Failed to send telemetry with Beacon API, retried with normal sender."))}}(data,onComplete,canSend)}}}}catch(e){}return null}();_sendPostMgr?_sendPostMgr.SetConfig(sendPostConfig):(_sendPostMgr=new SenderPostManager).initialize(sendPostConfig,diagLog);var customInterface=senderConfig.httpXHROverride,httpInterface=null,syncInterface=null,theTransports=prependTransports([3,1,2],senderConfig.transports);httpInterface=_sendPostMgr&&_sendPostMgr.getSenderInst(theTransports,!1);var xhrInterface=_sendPostMgr&&_sendPostMgr.getFallbackInst();_xhrSend=function(payload,isAsync){return _doSend(xhrInterface,payload,isAsync)},_fallbackSend=function(payload,isAsync){return _doSend(xhrInterface,payload,isAsync,!1)},httpInterface=_alwaysUseCustomSend?customInterface:httpInterface||customInterface||xhrInterface,_self._sender=function(payload,isAsync){return _doSend(httpInterface,payload,isAsync)},_fetchKeepAlive&&(_syncUnloadSender=_fetchKeepAliveSender);var syncTransports=prependTransports([3,1],senderConfig.unloadTransports);_fetchKeepAlive||(syncTransports=syncTransports.filter(function(transport){return 2!==transport})),syncInterface=_sendPostMgr&&_sendPostMgr.getSenderInst(syncTransports,!0),syncInterface=_alwaysUseCustomSend?customInterface:syncInterface||customInterface,(_alwaysUseCustomSend||senderConfig.unloadTransports||!_syncUnloadSender)&&syncInterface&&(_syncUnloadSender=function(payload,isAsync){return _doSend(syncInterface,payload,isAsync)}),_syncUnloadSender||(_syncUnloadSender=_xhrSend),_disableTelemetry=senderConfig.disableTelemetry,_convertUndefined=senderConfig.convertUndefined||void 0,_isRetryDisabled=senderConfig.isRetryDisabled,_maxBatchInterval=senderConfig.maxBatchInterval}))},_self.processTelemetry=function(telemetryItem,itemCtx){var diagLogger=(itemCtx=_self._getTelCtx(itemCtx)).diagLog();try{if(!_validate(telemetryItem,diagLogger))return;var aiEnvelope=_getEnvelope(telemetryItem,diagLogger);if(!aiEnvelope)return;var payload=_serializer.serialize(aiEnvelope),buffer=_self._buffer;_checkMaxSize(payload);var payloadItem={item:payload,cnt:0};buffer.enqueue(payloadItem),_setupTimer()}catch(e){_throwInternal(diagLogger,2,12,"Failed adding telemetry to the sender's buffer, some telemetry will be lost: "+getExceptionName(e),{exception:dumpObj(e)})}_self.processNext(telemetryItem,itemCtx)},_self.isCompletelyIdle=function(){return!_paused&&0===_syncFetchPayload&&0===_self._buffer.count()},_self.getOfflineListener=function(){return _offlineListener},_self._xhrReadyStateChange=function(xhr,payload,countOfItemsInPayload){if(!_isStringArr(payload))return _xhrReadyStateChange(xhr,payload,countOfItemsInPayload)},_self.triggerSend=function(isAsync,forcedSender,sendReason){var result;if(void 0===isAsync&&(isAsync=!0),!_paused)try{var buffer=_self._buffer;if(_disableTelemetry)buffer.clear();else{if(buffer.count()>0){var payload=buffer.getItems();!function _notifySendRequest(sendRequest,isAsync){var manager=function _getNotifyMgr(){var result,func="getNotifyMgr",core=_self.core;core&&(result=core[func]?core[func]():core._notificationManager);return result}();if(manager&&manager.eventsSendRequest)try{manager.eventsSendRequest(sendRequest,isAsync)}catch(e){_throwInternal(_self.diagLog(),1,74,"send request notification failed: "+getExceptionName(e),{exception:dumpObj(e)})}}(sendReason||0,isAsync),result=forcedSender?forcedSender.call(_self,payload,isAsync):_self._sender(payload,isAsync)}+new Date}_clearScheduledTimer()}catch(e){var ieVer=getIEVersion();(!ieVer||ieVer>9)&&_throwInternal(_self.diagLog(),1,40,"Telemetry transmission failed, some telemetry will be lost: "+getExceptionName(e),{exception:dumpObj(e)})}return result},_self.getOfflineSupport=function(){return{getUrl:function(){return _endpointUrl},createPayload:_createPayload,serialize:_serialize,batch:_batch,shouldProcess:function(evt){return!!_validate(evt)}}},_self._doTeardown=function(unloadCtx,unloadState){_self.onunloadFlush(),runTargetUnload(_offlineListener,!1),_initDefaults()},_self._onError=function(payload,message,event){if(!_isStringArr(payload))return function _onError(payload,message,event){_throwInternal(_self.diagLog(),2,26,"Failed to send telemetry.",{message}),_self._buffer&&_self._buffer.clearSent(payload)}(payload,message)},_self._onPartialSuccess=function(payload,results){if(!_isStringArr(payload))return function _onPartialSuccess(payload,results){for(var failed=[],retry=[],errors=results.errors.reverse(),_i=0,errors_1=errors;_i<errors_1.length;_i++){var error=errors_1[_i],extracted=payload.splice(error.index,1)[0];_isRetriable(error.statusCode)?retry.push(extracted):failed.push(extracted)}payload.length>0&&_self._onSuccess(payload,results.itemsAccepted);failed.length>0&&_self._onError(failed,formatErrorMessageXhr(null,["partial success",results.itemsAccepted,"of",results.itemsReceived].join(" ")));retry.length>0&&(_resendPayload(retry),_throwInternal(_self.diagLog(),2,40,"Partial success. Delivered: "+payload.length+", Failed: "+failed.length+". Will retry to send "+retry.length+" our of "+results.itemsReceived+" items"))}(payload,results)},_self._onSuccess=function(payload,countOfItemsInPayload){if(!_isStringArr(payload))return function _onSuccess(payload,countOfItemsInPayload){_self._buffer&&_self._buffer.clearSent(payload)}(payload)},_self._xdrOnLoad=function(xdr,payload){if(!_isStringArr(payload))return _xdrOnLoad(xdr,payload)}}),_this}return __extendsFn(Sender,_super),Sender.constructEnvelope=function(orig,iKey,logger,convertUndefined){var envelope;return envelope=iKey===orig.iKey||isNullOrUndefined(iKey)?orig:__assignFn(__assignFn({},orig),{iKey}),(EnvelopeTypeCreator[envelope.baseType]||EventEnvelopeCreator)(logger,envelope,convertUndefined)},Sender}(BaseTelemetryPlugin);function parseConnectionString(connectionString){if(!connectionString)return{};var kvPairs=connectionString.split(";"),result=arrReduce(kvPairs,function(fields,kv){var kvParts=kv.split("=");if(2===kvParts.length){var key=kvParts[0].toLowerCase(),value=kvParts[1];fields[key]=value}return fields},{});if(objKeys(result).length>0){if(result.endpointsuffix){var locationPrefix=result.location?result.location+".":"";result.ingestionendpoint=result.ingestionendpoint||"https://"+locationPrefix+"dc."+result.endpointsuffix}result.ingestionendpoint=result.ingestionendpoint||"https://dc.services.visualstudio.com",strEndsWith(result.ingestionendpoint,"/")&&(result.ingestionendpoint=result.ingestionendpoint.slice(0,-1))}return result}var ThrottleMgr=function ThrottleMgr(core,namePrefix){var _canUseLocalStorage,_logger,_config,_localStorageObj,_isTriggered,_namePrefix,_queue,_self=this,_isReady=!1,_isSpecificDaysGiven=!1;function _flushMessage(msgID,message,severity,saveUnsentMsg){if(_isReady){var isSampledIn=function _canSampledIn(msgID){try{var cfg=_getCfgByKey(msgID);return function randomValue(maxValue){return maxValue>0?mathFloor(random32()/4294967295*(maxValue+1))>>>0:0}(1e6)<=cfg.limit.samplingRate}catch(e){}return!1}(msgID);if(!isSampledIn)return;var cfg=_getCfgByKey(msgID),localStorageObj=_getLocalStorageObjByKey(msgID),canThrottle=_canThrottle(cfg,_canUseLocalStorage,localStorageObj),throttled=!1,number=0,isTriggered=_isTrigger(msgID);try{canThrottle&&!isTriggered?(number=mathMin(cfg.limit.maxSendNumber,localStorageObj.count+1),localStorageObj.count=0,throttled=!0,_isTriggered[msgID]=!0,localStorageObj.preTriggerDate=new Date):(_isTriggered[msgID]=canThrottle,localStorageObj.count+=1);var localStorageName=_getLocalStorageName(msgID);_resetLocalStorage(_logger,localStorageName,localStorageObj);for(var i=0;i<number;i++)_sendMessage(msgID,_logger,message,severity)}catch(e){}return{isThrottled:throttled,throttleNum:number}}return saveUnsentMsg&&_getQueueByKey(msgID).push({msgID,message,severity}),null}function _getCfgByKey(msgID){return _config[msgID]||_config[109]}function _setCfgByKey(msgID,config){var _a,_b;try{var cfg=config||{},curCfg={};curCfg.disabled=!!cfg.disabled;var configInterval=cfg.interval||{};_isSpecificDaysGiven=(null==configInterval?void 0:configInterval.daysOfMonth)&&(null==configInterval?void 0:configInterval.daysOfMonth.length)>0,curCfg.interval=function _getIntervalConfig(interval){var monthInterval=null===(interval=interval||{})||void 0===interval?void 0:interval.monthInterval,dayInterval=null==interval?void 0:interval.dayInterval;return isNullOrUndefined(monthInterval)&&isNullOrUndefined(dayInterval)&&(interval.monthInterval=3,_isSpecificDaysGiven||(interval.daysOfMonth=[28],_isSpecificDaysGiven=!0)),interval={monthInterval:null==interval?void 0:interval.monthInterval,dayInterval:null==interval?void 0:interval.dayInterval,daysOfMonth:null==interval?void 0:interval.daysOfMonth}}(configInterval);var limit={samplingRate:(null===(_a=cfg.limit)||void 0===_a?void 0:_a.samplingRate)||100,maxSendNumber:(null===(_b=cfg.limit)||void 0===_b?void 0:_b.maxSendNumber)||1};curCfg.limit=limit,_config[msgID]=curCfg}catch(e){}}function _canThrottle(config,canUseLocalStorage,localStorageObj){if(config&&!config.disabled&&canUseLocalStorage&&isNotNullOrUndefined(localStorageObj)){var curDate=_getThrottleDate(),date=localStorageObj.date,interval=config.interval,monthCheck=1;if(null==interval?void 0:interval.monthInterval){var monthExpand=12*(curDate.getUTCFullYear()-date.getUTCFullYear())+curDate.getUTCMonth()-date.getUTCMonth();monthCheck=_checkInterval(interval.monthInterval,0,monthExpand)}var dayCheck=1;if(_isSpecificDaysGiven)dayCheck=arrIndexOf(interval.daysOfMonth,curDate.getUTCDate());else if(null==interval?void 0:interval.dayInterval){var daySpan=mathFloor((curDate.getTime()-date.getTime())/864e5);dayCheck=_checkInterval(interval.dayInterval,0,daySpan)}return monthCheck>=0&&dayCheck>=0}return!1}function _getLocalStorageName(msgKey,prefix){var fix=isNotNullOrUndefined(prefix)?prefix:"";return msgKey?"appInsightsThrottle"+fix+"-"+msgKey:null}function _getThrottleDate(dateStr){try{if(!dateStr)return new Date;var date=new Date(dateStr);if(!isNaN(date.getDate()))return date}catch(e){}return null}function _resetLocalStorage(logger,storageName,obj){try{return utlSetLocalStorage(logger,storageName,strTrim(JSON.stringify(obj)))}catch(e){}return!1}function _checkInterval(interval,start,current){return interval<=0?1:current>=start&&(current-start)%interval==0?mathFloor((current-start)/interval)+1:-1}function _sendMessage(msgID,logger,message,severity){_throwInternal(logger,severity||1,msgID,message)}function _getLocalStorageObjByKey(key){try{var curObj=_localStorageObj[key];if(!curObj){var localStorageName=_getLocalStorageName(key,_namePrefix);curObj=function _getLocalStorageObj(value,logger,storageName){try{var storageObj={date:_getThrottleDate(),count:0};if(value){var obj=JSON.parse(value);return{date:_getThrottleDate(obj.date)||storageObj.date,count:obj.count||storageObj.count,preTriggerDate:obj.preTriggerDate?_getThrottleDate(obj.preTriggerDate):void 0}}return _resetLocalStorage(logger,storageName,storageObj),storageObj}catch(e){}return null}(utlGetLocalStorage(_logger,localStorageName),_logger,localStorageName),_localStorageObj[key]=curObj}return _localStorageObj[key]}catch(e){}return null}function _isTrigger(key){var isTrigger=_isTriggered[key];if(isNullOrUndefined(isTrigger)){isTrigger=!1;var localStorageObj=_getLocalStorageObjByKey(key);localStorageObj&&(isTrigger=function _isTriggeredOnCurDate(preTriggerDate){try{if(preTriggerDate){var curDate=new Date;return preTriggerDate.getUTCFullYear()===curDate.getUTCFullYear()&&preTriggerDate.getUTCMonth()===curDate.getUTCMonth()&&preTriggerDate.getUTCDate()===curDate.getUTCDate()}}catch(e){}return!1}(localStorageObj.preTriggerDate)),_isTriggered[key]=isTrigger}return _isTriggered[key]}function _getQueueByKey(key){return isNullOrUndefined((_queue=_queue||{})[key])&&(_queue[key]=[]),_queue[key]}!function _initConfig(){_logger=safeGetLogger(core),_isTriggered={},_localStorageObj={},_queue={},_config={},_setCfgByKey(109),_namePrefix=isNotNullOrUndefined(namePrefix)?namePrefix:"",core.addUnloadHook(onConfigChange(core.config,function(details){var coreConfig=details.cfg;_canUseLocalStorage=utlCanUseLocalStorage(),objForEachKey(coreConfig.throttleMgrCfg||{},function(key,cfg){_setCfgByKey(parseInt(key),cfg)})}))}(),_self._getDbgPlgTargets=function(){return[_queue]},_self.getConfig=function(){return _config},_self.canThrottle=function(msgId){var localObj=_getLocalStorageObjByKey(msgId);return _canThrottle(_getCfgByKey(msgId),_canUseLocalStorage,localObj)},_self.isTriggered=function(msgId){return _isTrigger(msgId)},_self.isReady=function(){return _isReady},_self.flush=function(msgId){try{var queue=_getQueueByKey(msgId);if(queue&&queue.length>0){var items=queue.slice(0);return _queue[msgId]=[],arrForEach(items,function(item){_flushMessage(item.msgID,item.message,item.severity,!1)}),!0}}catch(err){}return!1},_self.flushAll=function(){try{if(_queue){var result_1=!0;return objForEachKey(_queue,function(key){var isFlushed=_self.flush(parseInt(key));result_1=result_1&&isFlushed}),result_1}}catch(err){}return!1},_self.onReadyState=function(isReady,flushAll){return void 0===flushAll&&(flushAll=!0),(_isReady=!!isNullOrUndefined(isReady)||isReady)&&flushAll?_self.flushAll():null},_self.sendMessage=function(msgID,message,severity){return _flushMessage(msgID,message,severity,!0)}},NotificationManager_defaultValues={perfEvtsSendAll:!1};function _runScheduledListeners(asyncNotifications){asyncNotifications.h=null;var callbacks=asyncNotifications.cb;asyncNotifications.cb=[],arrForEach(callbacks,function(cb){safe(cb.fn,[cb.arg])})}function _runListeners(listeners,name,asyncNotifications,callback){arrForEach(listeners,function(listener){listener&&listener[name]&&(asyncNotifications?(asyncNotifications.cb.push({fn:callback,arg:listener}),asyncNotifications.h=asyncNotifications.h||scheduleTimeout(_runScheduledListeners,0,asyncNotifications)):safe(callback,[listener]))})}var NotificationManager=function(){function NotificationManager(config){var perfEvtsSendAll,unloadHandler;this.listeners=[];var _listeners=[],_asyncNotifications={h:null,cb:[]},cfgHandler=createDynamicConfig(config,NotificationManager_defaultValues);unloadHandler=cfgHandler.watch(function(details){perfEvtsSendAll=!!details.cfg.perfEvtsSendAll}),dynamicProto(NotificationManager,this,function(_self){objDefine(_self,"listeners",{g:function(){return _listeners}}),_self.addNotificationListener=function(listener){_listeners.push(listener)},_self.removeNotificationListener=function(listener){for(var index=arrIndexOf(_listeners,listener);index>-1;)_listeners.splice(index,1),index=arrIndexOf(_listeners,listener)},_self.eventsSent=function(events){_runListeners(_listeners,"eventsSent",_asyncNotifications,function(listener){listener.eventsSent(events)})},_self.eventsDiscarded=function(events,reason,sendType){_runListeners(_listeners,"eventsDiscarded",_asyncNotifications,function(listener){listener.eventsDiscarded(events,reason,sendType)})},_self.eventsSendRequest=function(sendReason,isAsync){_runListeners(_listeners,"eventsSendRequest",isAsync?_asyncNotifications:null,function(listener){listener.eventsSendRequest(sendReason,isAsync)})},_self.perfEvent=function(perfEvent){perfEvent&&(!perfEvtsSendAll&&perfEvent.isChildEvt()||_runListeners(_listeners,"perfEvent",null,function(listener){perfEvent.isAsync?scheduleTimeout(function(){return listener.perfEvent(perfEvent)},0):listener.perfEvent(perfEvent)}))},_self.offlineEventsStored=function(events){events&&events.length&&_runListeners(_listeners,"offlineEventsStored",_asyncNotifications,function(listener){listener.offlineEventsStored(events)})},_self.offlineBatchSent=function(batch){batch&&batch.data&&_runListeners(_listeners,"offlineBatchSent",_asyncNotifications,function(listener){listener.offlineBatchSent(batch)})},_self.offlineBatchDrop=function(cnt,reason){if(cnt>0){var rn_1=reason||0;_runListeners(_listeners,"offlineBatchDrop",_asyncNotifications,function(listener){listener.offlineBatchDrop(cnt,rn_1)})}},_self.unload=function(isAsync){var waiting,_finishUnload=function(){unloadHandler&&unloadHandler.rm(),unloadHandler=null,_listeners=[],_asyncNotifications.h&&_asyncNotifications.h.cancel(),_asyncNotifications.h=null,_asyncNotifications.cb=[]};if(_runListeners(_listeners,"unload",null,function(listener){var asyncUnload=listener.unload(isAsync);asyncUnload&&(waiting||(waiting=[]),waiting.push(asyncUnload))}),waiting)return createPromise(function(resolve){return doAwaitResponse(createAllPromise(waiting),function(){_finishUnload(),resolve()})});_finishUnload()}})}return NotificationManager.__ieDyn=1,NotificationManager}();var AppInsightsCore_a,TelemetryInitializerPlugin=function(_super){function TelemetryInitializerPlugin(){var _id,_initializers,_this=_super.call(this)||this;function _initDefaults(){_id=0,_initializers=[]}return _this.identifier="TelemetryInitializerPlugin",_this.priority=199,_initDefaults(),dynamicProto(TelemetryInitializerPlugin,_this,function(_self,_base){_self.addTelemetryInitializer=function(telemetryInitializer){return function _addInitializer(_initializers,id,telemetryInitializer){var theInitializer={id,fn:telemetryInitializer};return arrAppend(_initializers,theInitializer),{remove:function(){arrForEach(_initializers,function(initializer,idx){if(initializer.id===theInitializer.id)return _initializers.splice(idx,1),-1})}}}(_initializers,_id++,telemetryInitializer)},_self.processTelemetry=function(item,itemCtx){(function _runInitializers(_initializers,item,logger){for(var doNotSendItem=!1,telemetryInitializersCount=_initializers.length,i=0;i<telemetryInitializersCount;++i){var telemetryInitializer=_initializers[i];if(telemetryInitializer)try{if(!1===telemetryInitializer.fn.apply(null,[item])){doNotSendItem=!0;break}}catch(e){_throwInternal(logger,2,64,"Telemetry initializer failed: "+getExceptionName(e),{exception:dumpObj(e)},!0)}}return!doNotSendItem})(_initializers,item,itemCtx?itemCtx.diagLog():_self.diagLog())&&_self.processNext(item,itemCtx)},_self._doTeardown=function(){_initDefaults()}}),_this}return __extendsFn(TelemetryInitializerPlugin,_super),TelemetryInitializerPlugin.__ieDyn=1,TelemetryInitializerPlugin}(BaseTelemetryPlugin),defaultConfig=objDeepFreeze(((AppInsightsCore_a={cookieCfg:{}}).extensions={rdOnly:!0,ref:!0,v:[]},AppInsightsCore_a.channels={rdOnly:!0,ref:!0,v:[]},AppInsightsCore_a.extensionConfig={ref:!0,v:{}},AppInsightsCore_a.createPerfMgr=void 0,AppInsightsCore_a.loggingLevelConsole=0,AppInsightsCore_a.diagnosticLogInterval=void 0,AppInsightsCore_a));function _createPerfManager(core,notificationMgr){return new PerfManager(notificationMgr)}function _isPluginPresent(thePlugin,plugins){var exists=!1;return arrForEach(plugins,function(plugin){if(plugin===thePlugin)return exists=!0,-1}),exists}function _deepMergeConfig(details,target,newValues,merge){newValues&&objForEachKey(newValues,function(key,value){merge&&isPlainObject(value)&&isPlainObject(target[key])&&_deepMergeConfig(details,target[key],value,merge),merge&&isPlainObject(value)&&isPlainObject(target[key])?_deepMergeConfig(details,target[key],value,merge):details.set(target,key,value)})}function _findWatcher(listeners,newWatcher){var theListener=null,idx=-1;return arrForEach(listeners,function(listener,lp){if(listener.w===newWatcher)return theListener=listener,idx=lp,-1}),{i:idx,l:theListener}}function _initDebugListener(configHandler,unloadContainer,notificationManager,debugListener){return unloadContainer.add(configHandler.watch(function(details){var disableDbgExt=details.cfg.disableDbgExt;!0===disableDbgExt&&debugListener&&(notificationManager.removeNotificationListener(debugListener),debugListener=null),notificationManager&&!debugListener&&!0!==disableDbgExt&&(debugListener=function getDebugListener(config){if(!_debugListener){_debugListener={};for(var lp=0;lp<listenerFuncs.length;lp++)_debugListener[listenerFuncs[lp]]=_listenerProxyFunc(listenerFuncs[lp],config)}return _debugListener}(details.cfg),notificationManager.addNotificationListener(debugListener))})),debugListener}var AppInsightsCore=function(){function AppInsightsCore(){var _configHandler,_isInitialized,_logger,_eventQueue,_notificationManager,_perfManager,_cfgPerfManager,_cookieManager,_pluginChain,_configExtensions,_channelConfig,_channels,_isUnloading,_telemetryInitializerPlugin,_internalLogsEventName,_evtNamespace,_unloadHandlers,_hookContainer,_debugListener,_traceCtx,_instrumentationKey,_cfgListeners,_extensions,_pluginVersionStringArr,_pluginVersionString,_activeStatus,_endpoint,_initInMemoMaxSize,_isStatusSet,_initTimer,_internalLogPoller,_internalLogPollerListening,_forceStopInternalLogPoller;dynamicProto(AppInsightsCore,this,function(_self){function _setStatus(){_isStatusSet=!0,isNullOrUndefined(_instrumentationKey)?(_activeStatus=ActiveStatus.INACTIVE,_throwInternal(_logger,1,112,"ikey can't be resolved from promises")):_activeStatus=ActiveStatus.ACTIVE,_releaseQueues()}function _releaseQueues(){_isInitialized&&(_self.releaseQueue(),_self.pollInternalLogs())}function _startLogPoller(alwaysStart){_internalLogPoller&&_internalLogPoller.enabled||_forceStopInternalLogPoller||(alwaysStart||_logger&&_logger.queue.length>0)&&(_internalLogPollerListening||(_internalLogPollerListening=!0,_addUnloadHook(_configHandler.watch(function(details){var interval=details.cfg.diagnosticLogInterval;interval&&interval>0||(interval=1e4);var isRunning=!1;_internalLogPoller&&(isRunning=_internalLogPoller.enabled,_internalLogPoller.cancel()),_internalLogPoller=function createTimeout(callback,timeout){return _createTimeoutWith(!1,void 0,ArrSlice[CALL](arguments))}(_flushInternalLogs,interval),_internalLogPoller.unref(),_internalLogPoller.enabled=isRunning}))),_internalLogPoller.enabled=!0);return _internalLogPoller}function _setPluginVersions(){var thePlugins={};_pluginVersionStringArr=[];var _addPluginVersions=function(plugins){plugins&&arrForEach(plugins,function(plugin){if(plugin.identifier&&plugin.version&&!thePlugins[plugin.identifier]){var ver=plugin.identifier+"="+plugin.version;_pluginVersionStringArr.push(ver),thePlugins[plugin.identifier]=plugin}})};_addPluginVersions(_channels),_channelConfig&&arrForEach(_channelConfig,function(channels){_addPluginVersions(channels)}),_addPluginVersions(_configExtensions)}function _initDefaults(){_isInitialized=!1,(_configHandler=createDynamicConfig({},defaultConfig,_self.logger)).cfg.loggingLevelConsole=1,objDefine(_self,"config",{g:function(){return _configHandler.cfg},s:function(newValue){_self.updateCfg(newValue,!1)}}),objDefine(_self,"pluginVersionStringArr",{g:function(){return _pluginVersionStringArr||_setPluginVersions(),_pluginVersionStringArr}}),objDefine(_self,"pluginVersionString",{g:function(){return _pluginVersionString||(_pluginVersionStringArr||_setPluginVersions(),_pluginVersionString=_pluginVersionStringArr.join(";")),_pluginVersionString||""}}),objDefine(_self,"logger",{g:function(){return _logger||(_logger=new DiagnosticLogger(_configHandler.cfg),_configHandler.logger=_logger),_logger},s:function(newLogger){_configHandler.logger=newLogger,_logger!==newLogger&&(runTargetUnload(_logger,!1),_logger=newLogger)}}),_self.logger=new DiagnosticLogger(_configHandler.cfg),_extensions=[];var cfgExtensions=_self.config.extensions||[];cfgExtensions.splice(0,cfgExtensions.length),arrAppend(cfgExtensions,_extensions),_telemetryInitializerPlugin=new TelemetryInitializerPlugin,_eventQueue=[],runTargetUnload(_notificationManager,!1),_notificationManager=null,_perfManager=null,_cfgPerfManager=null,runTargetUnload(_cookieManager,!1),_cookieManager=null,_pluginChain=null,_configExtensions=[],_channelConfig=null,_channels=null,_isUnloading=!1,_internalLogsEventName=null,_evtNamespace=createUniqueNamespace("AIBaseCore",!0),_unloadHandlers=createUnloadHandlerContainer(),_traceCtx=null,_instrumentationKey=null,_hookContainer=createUnloadHookContainer(),_cfgListeners=[],_pluginVersionString=null,_pluginVersionStringArr=null,_forceStopInternalLogPoller=!1,_internalLogPoller=null,_internalLogPollerListening=!1,_activeStatus=0,_endpoint=null,_initInMemoMaxSize=null,_isStatusSet=!1,_initTimer=null}function _createTelCtx(){var theCtx=createProcessTelemetryContext(_getPluginChain(),_configHandler.cfg,_self);return theCtx.onComplete(_startLogPoller),theCtx}function _initPluginChain(updateState){var theExtensions=function _validateExtensions(logger,channelPriority,allExtensions){var coreExtensions=[],channels=[],extPriorities={};return arrForEach(allExtensions,function(ext){(isNullOrUndefined(ext)||isNullOrUndefined(ext.initialize))&&throwError("Plugins must provide initialize method");var extPriority=ext.priority,identifier=ext.identifier;ext&&extPriority&&(isNullOrUndefined(extPriorities[extPriority])?extPriorities[extPriority]=identifier:_warnToConsole(logger,"Two extensions have same priority #"+extPriority+" - "+extPriorities[extPriority]+", "+identifier)),!extPriority||extPriority<channelPriority?coreExtensions.push(ext):channels.push(ext)}),{core:coreExtensions,channels}}(_self.logger,500,_configExtensions);_pluginChain=null,_pluginVersionString=null,_pluginVersionStringArr=null,_channels=sortPlugins(arrAppend(_channels=(_channelConfig||[])[0]||[],theExtensions.channels));var allExtensions=arrAppend(sortPlugins(theExtensions.core),_channels);_extensions=objFreeze(allExtensions);var cfgExtensions=_self.config.extensions||[];cfgExtensions.splice(0,cfgExtensions.length),arrAppend(cfgExtensions,_extensions);var rootCtx=_createTelCtx();_channels&&_channels.length>0&&initializePlugins(rootCtx.createNew(_channels),allExtensions),initializePlugins(rootCtx,allExtensions),updateState&&_doUpdate(updateState)}function _getPlugin(pluginIdentifier){var theExt=null,thePlugin=null,channelHosts=[];return arrForEach(_extensions,function(ext){if(ext.identifier===pluginIdentifier&&ext!==_telemetryInitializerPlugin)return thePlugin=ext,-1;ext.getChannel&&channelHosts.push(ext)}),!thePlugin&&channelHosts.length>0&&arrForEach(channelHosts,function(host){if(!(thePlugin=host.getChannel(pluginIdentifier)))return-1}),thePlugin&&(theExt={plugin:thePlugin,setEnabled:function(enabled){_getPluginState(thePlugin).disabled=!enabled},isEnabled:function(){var pluginState=_getPluginState(thePlugin);return!pluginState.teardown&&!pluginState.disabled},remove:function(isAsync,removeCb){void 0===isAsync&&(isAsync=!0);var pluginsToRemove=[thePlugin];_removePlugins(pluginsToRemove,{reason:1,isAsync},function(removed){removed&&_initPluginChain({reason:32,removed:pluginsToRemove}),removeCb&&removeCb(removed)})}}),theExt}function _getPluginChain(){if(!_pluginChain){var extensions=(_extensions||[]).slice();-1===arrIndexOf(extensions,_telemetryInitializerPlugin)&&extensions.push(_telemetryInitializerPlugin),_pluginChain=createTelemetryProxyChain(sortPlugins(extensions),_configHandler.cfg,_self)}return _pluginChain}function _removePlugins(thePlugins,unloadState,removeComplete){if(thePlugins&&thePlugins.length>0){var unloadCtx=createProcessTelemetryUnloadContext(createTelemetryProxyChain(thePlugins,_configHandler.cfg,_self),_self);unloadCtx.onComplete(function(){var removed=!1,newConfigExtensions=[];arrForEach(_configExtensions,function(plugin,idx){_isPluginPresent(plugin,thePlugins)?removed=!0:newConfigExtensions.push(plugin)}),_configExtensions=newConfigExtensions,_pluginVersionString=null,_pluginVersionStringArr=null;var newChannelConfig=[];_channelConfig&&(arrForEach(_channelConfig,function(queue,idx){var newQueue=[];arrForEach(queue,function(channel){_isPluginPresent(channel,thePlugins)?removed=!0:newQueue.push(channel)}),newChannelConfig.push(newQueue)}),_channelConfig=newChannelConfig),removeComplete&&removeComplete(removed),_startLogPoller()}),unloadCtx.processNext(unloadState)}else removeComplete(!1)}function _flushInternalLogs(){if(_logger&&_logger.queue){var queue=_logger.queue.slice(0);_logger.queue.length=0,arrForEach(queue,function(logMessage){var item={name:_internalLogsEventName||"InternalMessageId: "+logMessage.messageId,iKey:_instrumentationKey,time:toISOString(new Date),baseType:_InternalLogMessage.dataType,baseData:{message:logMessage.message}};_self.track(item)})}}function _flushChannels(isAsync,callBack,sendReason,cbTimeout){var waiting=1,doneIterating=!1,cbTimer=null;function doCallback(){waiting--,doneIterating&&0===waiting&&(cbTimer&&cbTimer.cancel(),cbTimer=null,callBack&&callBack(doneIterating),callBack=null)}(cbTimeout=cbTimeout||5e3,_channels&&_channels.length>0)&&_createTelCtx().createNew(_channels).iterate(function(plugin){if(plugin.flush){waiting++;var handled_1=!1;plugin.flush(isAsync,function(){handled_1=!0,doCallback()},sendReason)||handled_1||(isAsync&&null==cbTimer?cbTimer=scheduleTimeout(function(){cbTimer=null,doCallback()},cbTimeout):doCallback())}});return doneIterating=!0,doCallback(),!0}function _doUpdate(updateState){var updateCtx=createProcessTelemetryUpdateContext(_getPluginChain(),_self);updateCtx.onComplete(_startLogPoller),_self._updateHook&&!0===_self._updateHook(updateCtx,updateState)||updateCtx.processNext(updateState)}function _logOrThrowError(message){var logger=_self.logger;logger?(_throwInternal(logger,2,73,message),_startLogPoller()):throwError(message)}function _notifyInvalidEvent(telemetryItem){var manager=_self.getNotifyMgr();manager&&manager.eventsDiscarded([telemetryItem],2)}function _addUnloadHook(hooks){_hookContainer.add(hooks)}_initDefaults(),_self._getDbgPlgTargets=function(){return[_extensions,_eventQueue]},_self.isInitialized=function(){return _isInitialized},_self.activeStatus=function(){return _activeStatus},_self._setPendingStatus=function(){_activeStatus=3},_self.initialize=function(config,extensions,logger,notificationManager){_isUnloading&&throwError("SDK is still unloading..."),_self.isInitialized()&&throwError("Core cannot be initialized more than once"),config=(_configHandler=createDynamicConfig(config,defaultConfig,logger||_self.logger,!1)).cfg,_addUnloadHook(_configHandler.watch(function(details){var rootCfg=details.cfg;_initInMemoMaxSize=rootCfg.initInMemoMaxSize||100,function _handleIKeyEndpointPromises(theConfig){var ikey=theConfig.instrumentationKey,endpointUrl=theConfig.endpointUrl;if(3!==_activeStatus){if(isNullOrUndefined(ikey)){_instrumentationKey=null,_activeStatus=ActiveStatus.INACTIVE;var msg="Please provide instrumentation key";return void(_isInitialized?(_throwInternal(_logger,1,100,msg),_releaseQueues()):throwError(msg))}var promises=[];isPromiseLike(ikey)?(promises.push(ikey),_instrumentationKey=null):_instrumentationKey=ikey,isPromiseLike(endpointUrl)?(promises.push(endpointUrl),_endpoint=null):_endpoint=endpointUrl,promises.length?function _waitForInitPromises(theConfig,promises){_isStatusSet=!1,_activeStatus=3;var initTimeout=isNotNullOrUndefined(theConfig.initTimeOut)?theConfig.initTimeOut:5e4,allPromises=function createSyncAllSettledPromise(input,timeout){return!_allSyncSettledCreator&&(_allSyncSettledCreator=_createAllSettledPromise(createSyncPromise)),_allSyncSettledCreator.v(input,timeout)}(promises);_initTimer&&_initTimer.cancel();_initTimer=scheduleTimeout(function(){_initTimer=null,_isStatusSet||_setStatus()},initTimeout),doAwaitResponse(allPromises,function(response){try{if(_isStatusSet)return;if(!response.rejected){var values=response.value;if(values&&values.length){var ikeyRes=values[0];if(_instrumentationKey=ikeyRes&&ikeyRes.value,values.length>1){var endpointRes=values[1];_endpoint=endpointRes&&endpointRes.value}}_instrumentationKey&&(theConfig.instrumentationKey=_instrumentationKey,theConfig.endpointUrl=_endpoint)}_setStatus()}catch(e){_isStatusSet||_setStatus()}})}(theConfig,promises):_setStatus()}}(rootCfg);var extCfg=details.ref(details.cfg,"extensionConfig");objForEachKey(extCfg,function(key){details.ref(extCfg,key)})})),_debugListener=_initDebugListener(_configHandler,_hookContainer,(_notificationManager=notificationManager)&&_self.getNotifyMgr(),_debugListener),function _initPerfManager(){var prevCfgPerfMgr;_addUnloadHook(_configHandler.watch(function(details){if(details.cfg.enablePerfMgr){var createPerfMgr=details.cfg.createPerfMgr;prevCfgPerfMgr===createPerfMgr&&prevCfgPerfMgr||(createPerfMgr||(createPerfMgr=_createPerfManager),getSetValue(details.cfg,"createPerfMgr",createPerfMgr),prevCfgPerfMgr=createPerfMgr,_cfgPerfManager=null),_perfManager||_cfgPerfManager||!isFunction(createPerfMgr)||(_cfgPerfManager=createPerfMgr(_self,_self.getNotifyMgr()))}else _cfgPerfManager=null,prevCfgPerfMgr=null}))}(),_self.logger=logger;var cfgExtensions=config.extensions;if((_configExtensions=[]).push.apply(_configExtensions,__spreadArrayFn(__spreadArrayFn([],extensions),cfgExtensions)),_channelConfig=config.channels,_initPluginChain(null),_channels&&0!==_channels.length||throwError("No channels available"),_channelConfig&&_channelConfig.length>1){var teeController=_self.getPlugin("TeeChannelController");teeController&&teeController.plugin||_throwInternal(_logger,1,28,"TeeChannel required")}!function _registerDelayedCfgListener(config,listeners,logger){arrForEach(listeners,function(listener){var unloadHdl=onConfigChange(config,listener.w,logger);delete listener.w,listener.rm=function(){unloadHdl.rm()}})}(config,_cfgListeners,_logger),_cfgListeners=null,_isInitialized=!0,_activeStatus===ActiveStatus.ACTIVE&&_releaseQueues()},_self.getChannels=function(){var controls=[];return _channels&&arrForEach(_channels,function(channel){controls.push(channel)}),objFreeze(controls)},_self.track=function(telemetryItem){doPerf(_self.getPerfMgr(),function(){return"AppInsightsCore:track"},function(){null===telemetryItem&&(_notifyInvalidEvent(telemetryItem),throwError("Invalid telemetry item")),!telemetryItem.name&&isNullOrUndefined(telemetryItem.name)&&(_notifyInvalidEvent(telemetryItem),throwError("telemetry name required")),telemetryItem.iKey=telemetryItem.iKey||_instrumentationKey,telemetryItem.time=telemetryItem.time||toISOString(new Date),telemetryItem.ver=telemetryItem.ver||"4.0",!_isUnloading&&_self.isInitialized()&&_activeStatus===ActiveStatus.ACTIVE?_createTelCtx().processNext(telemetryItem):_activeStatus!==ActiveStatus.INACTIVE&&_eventQueue.length<=_initInMemoMaxSize&&_eventQueue.push(telemetryItem)},function(){return{item:telemetryItem}},!telemetryItem.sync)},_self.getProcessTelContext=_createTelCtx,_self.getNotifyMgr=function(){return _notificationManager||(_notificationManager=new NotificationManager(_configHandler.cfg),_self._notificationManager=_notificationManager),_notificationManager},_self.addNotificationListener=function(listener){_self.getNotifyMgr().addNotificationListener(listener)},_self.removeNotificationListener=function(listener){_notificationManager&&_notificationManager.removeNotificationListener(listener)},_self.getCookieMgr=function(){return _cookieManager||(_cookieManager=createCookieMgr(_configHandler.cfg,_self.logger)),_cookieManager},_self.setCookieMgr=function(cookieMgr){_cookieManager!==cookieMgr&&(runTargetUnload(_cookieManager,!1),_cookieManager=cookieMgr)},_self.getPerfMgr=function(){return _perfManager||_cfgPerfManager||function getGblPerfMgr(){return _defaultPerfManager}()},_self.setPerfMgr=function(perfMgr){_perfManager=perfMgr},_self.eventCnt=function(){return _eventQueue.length},_self.releaseQueue=function(){if(_isInitialized&&_eventQueue.length>0){var eventQueue=_eventQueue;_eventQueue=[],2===_activeStatus?arrForEach(eventQueue,function(event){event.iKey=event.iKey||_instrumentationKey,_createTelCtx().processNext(event)}):_throwInternal(_logger,2,20,"core init status is not active")}},_self.pollInternalLogs=function(eventName){return _internalLogsEventName=eventName||null,_forceStopInternalLogPoller=!1,_internalLogPoller&&_internalLogPoller.cancel(),_startLogPoller(!0)},_self.stopPollingInternalLogs=function(){_forceStopInternalLogPoller=!0,_internalLogPoller&&_internalLogPoller.cancel(),_flushInternalLogs()},proxyFunctions(_self,function(){return _telemetryInitializerPlugin},["addTelemetryInitializer"]),_self.unload=function(isAsync,unloadComplete,cbTimeout){void 0===isAsync&&(isAsync=!0),_isInitialized||throwError("SDK is not initialized"),_isUnloading&&throwError("SDK is still unloading...");var result,unloadState={reason:50,isAsync,flushComplete:!1};isAsync&&!unloadComplete&&(result=createPromise(function(resolve){unloadComplete=resolve}));var processUnloadCtx=createProcessTelemetryUnloadContext(_getPluginChain(),_self);function _doUnload(flushComplete){unloadState.flushComplete=flushComplete,_isUnloading=!0,_unloadHandlers.run(processUnloadCtx,unloadState),_self.stopPollingInternalLogs(),processUnloadCtx.processNext(unloadState)}return processUnloadCtx.onComplete(function(){_hookContainer.run(_self.logger),doUnloadAll([_cookieManager,_notificationManager,_logger],isAsync,function(){_initDefaults(),unloadComplete&&unloadComplete(unloadState)})},_self),_flushInternalLogs(),_flushChannels(isAsync,_doUnload,6,cbTimeout)||_doUnload(!1),result},_self.getPlugin=_getPlugin,_self.addPlugin=function(plugin,replaceExisting,isAsync,addCb){if(!plugin)return addCb&&addCb(!1),void _logOrThrowError("Plugins must provide initialize method");var existingPlugin=_getPlugin(plugin.identifier);if(existingPlugin&&!replaceExisting)return addCb&&addCb(!1),void _logOrThrowError("Plugin ["+plugin.identifier+"] is already loaded!");var updateState={reason:16};function _addPlugin(removed){_configExtensions.push(plugin),updateState.added=[plugin],_initPluginChain(updateState),addCb&&addCb(!0)}if(existingPlugin){var removedPlugins_1=[existingPlugin.plugin];_removePlugins(removedPlugins_1,{reason:2,isAsync:!!isAsync},function(removed){removed?(updateState.removed=removedPlugins_1,updateState.reason|=32,_addPlugin()):addCb&&addCb(!1)})}else _addPlugin()},_self.updateCfg=function(newConfig,mergeExisting){var updateState;if(void 0===mergeExisting&&(mergeExisting=!0),_self.isInitialized()){updateState={reason:1,cfg:_configHandler.cfg,oldCfg:deepExtend({},_configHandler.cfg),newConfig:deepExtend({},newConfig),merge:mergeExisting},newConfig=updateState.newConfig;var cfg=_configHandler.cfg;newConfig.extensions=cfg.extensions,newConfig.channels=cfg.channels}_configHandler._block(function(details){var theConfig=details.cfg;_deepMergeConfig(details,theConfig,newConfig,mergeExisting),mergeExisting||objForEachKey(theConfig,function(key){objHasOwn(newConfig,key)||details.set(theConfig,key,void 0)}),details.setDf(theConfig,defaultConfig)},!0),_configHandler.notify(),updateState&&_doUpdate(updateState)},_self.evtNamespace=function(){return _evtNamespace},_self.flush=_flushChannels,_self.getTraceCtx=function(createNew){return _traceCtx||(_traceCtx=function createDistributedTraceContext(parentCtx){var trace={};return{getName:function(){return trace.name},setName:function(newValue){parentCtx&&parentCtx.setName(newValue),trace.name=newValue},getTraceId:function(){return trace.traceId},setTraceId:function(newValue){parentCtx&&parentCtx.setTraceId(newValue),isValidTraceId(newValue)&&(trace.traceId=newValue)},getSpanId:function(){return trace.spanId},setSpanId:function(newValue){parentCtx&&parentCtx.setSpanId(newValue),isValidSpanId(newValue)&&(trace.spanId=newValue)},getTraceFlags:function(){return trace.traceFlags},setTraceFlags:function(newTraceFlags){parentCtx&&parentCtx.setTraceFlags(newTraceFlags),trace.traceFlags=newTraceFlags}}}()),_traceCtx},_self.setTraceCtx=function(traceCtx){_traceCtx=traceCtx||null},_self.addUnloadHook=_addUnloadHook,proxyFunctionAs(_self,"addUnloadCb",function(){return _unloadHandlers},"add"),_self.onCfgChange=function(handler){return function _createUnloadHook(unloadHook){return objDefine({rm:function(){unloadHook.rm()}},"toJSON",{v:function(){return"aicore::onCfgChange<"+JSON.stringify(unloadHook)+">"}})}(_isInitialized?onConfigChange(_configHandler.cfg,handler,_self.logger):function _addDelayedCfgListener(listeners,newWatcher){var theListener=_findWatcher(listeners,newWatcher).l;return theListener||(theListener={w:newWatcher,rm:function(){var fnd=_findWatcher(listeners,newWatcher);-1!==fnd.i&&listeners.splice(fnd.i,1)}},listeners.push(theListener)),theListener}(_cfgListeners,handler))},_self.getWParam=function(){return hasDocument()||_configHandler.cfg.enableWParam?0:-1}})}return AppInsightsCore.__ieDyn=1,AppInsightsCore}();function _calcPerfDuration(resourceEntry,start,end){var result=0,from=resourceEntry[start],to=resourceEntry[end];return from&&to&&(result=dateTimeUtilsDuration(from,to)),result}function _setPerfDuration(props,name,resourceEntry,start,end){var result=0,value=_calcPerfDuration(resourceEntry,start,end);return value&&(result=_setPerfValue(props,name,msToTimeSpan(value))),result}function _setPerfValue(props,name,value){var result=0;props&&name&&value&&((props.ajaxPerf=props.ajaxPerf||{})[name]=value,result=1);return result}var ajax_a,XHRMonitoringState=function XHRMonitoringState(){this.openDone=!1,this.setRequestHeaderDone=!1,this.sendDone=!1,this.abortDone=!1,this.stateChangeAttached=!1},ajaxRecord=function(){function ajaxRecord(traceId,spanId,logger,traceCtx){var _logger=logger;this.perfMark=null,this.completed=!1,this.requestHeadersSize=null,this.requestHeaders=null,this.responseReceivingDuration=null,this.callbackDuration=null,this.ajaxTotalDuration=null,this.aborted=0,this.pageUrl=null,this.requestUrl=null,this.requestSize=0,this.method=null,this.status=null,this.requestSentTime=null,this.responseStartedTime=null,this.responseFinishedTime=null,this.callbackFinishedTime=null,this.endTime=null,this.xhrMonitoringState=new XHRMonitoringState,this.clientFailure=0,this.traceID=traceId,this.spanID=spanId,this.traceFlags=null==traceCtx?void 0:traceCtx.getTraceFlags(),this.eventTraceCtx=traceCtx?{traceId:traceCtx.getTraceId(),spanId:traceCtx.getSpanId(),traceFlags:traceCtx.getTraceFlags()}:null,dynamicProto(ajaxRecord,this,function(self){self.getAbsoluteUrl=function(){return self.requestUrl?function urlGetAbsoluteUrl(url){var result,a=urlParseUrl(url);return a&&(result=a.href),result}(self.requestUrl):null},self.getPathName=function(){return self.requestUrl?dataSanitizeUrl(_logger,function urlGetCompleteUrl(method,absoluteUrl){return method?method.toUpperCase()+" "+absoluteUrl:absoluteUrl}(self.method,self.requestUrl)):null},self.CreateTrackItem=function(ajaxType,enableRequestHeaderTracking,getResponse){var _a;if(self.ajaxTotalDuration=mathRound(1e3*dateTimeUtilsDuration(self.requestSentTime,self.responseFinishedTime))/1e3,self.ajaxTotalDuration<0)return null;var dependency=((_a={id:"|"+self.traceID+"."+self.spanID,target:self.getAbsoluteUrl(),name:self.getPathName(),type:ajaxType,startTime:null,duration:self.ajaxTotalDuration,success:+self.status>=200&&+self.status<400,responseCode:+self.status}).properties={HttpMethod:self.method},_a),props=dependency.properties;if(self.aborted&&(props.aborted=!0),self.requestSentTime&&(dependency.startTime=new Date,dependency.startTime.setTime(self.requestSentTime)),function _populatePerfData(ajaxData,dependency){var resourceEntry=ajaxData.perfTiming,props=dependency.properties||{},propsSet=0,strRedirect="redirect",strRedirectStart=strRedirect+"Start",strRedirectEnd=strRedirect="End";if(resourceEntry){propsSet|=_setPerfDuration(props,strRedirect,resourceEntry,strRedirectStart,strRedirectEnd),propsSet|=_setPerfDuration(props,"domainLookup",resourceEntry,"domainLookupStart","domainLookupEnd"),propsSet|=_setPerfDuration(props,"connect",resourceEntry,"connectStart","connectEnd"),propsSet|=_setPerfDuration(props,"request",resourceEntry,"requestStart","requestEnd"),propsSet|=_setPerfDuration(props,"response",resourceEntry,"responseStart","responseEnd"),propsSet|=_setPerfDuration(props,"networkConnect",resourceEntry,"startTime","connectEnd"),propsSet|=_setPerfDuration(props,"sentRequest",resourceEntry,"requestStart","responseEnd");var duration=resourceEntry.duration;duration||(duration=_calcPerfDuration(resourceEntry,"startTime","responseEnd")||0),propsSet|=_setPerfValue(props,"duration",duration),propsSet|=_setPerfValue(props,"perfTotal",duration);var serverTiming=resourceEntry.serverTiming;if(serverTiming){var server_1={};arrForEach(serverTiming,function(value,idx){var name=HelperFuncs_normalizeJsName(value.name||""+idx),newValue=server_1[name]||{};objForEachKey(value,function(key,val){("name"!==key&&isString(val)||isNumber(val))&&(newValue[key]&&(val=newValue[key]+";"+val),!val&&isString(val)||(newValue[key]=val))}),server_1[name]=newValue}),propsSet|=_setPerfValue(props,"serverTiming",server_1)}propsSet|=_setPerfValue(props,"transferSize",resourceEntry.transferSize),propsSet|=_setPerfValue(props,"encodedBodySize",resourceEntry.encodedBodySize),propsSet|=_setPerfValue(props,"decodedBodySize",resourceEntry.decodedBodySize)}else ajaxData.perfMark&&(propsSet|=_setPerfValue(props,"missing",ajaxData.perfAttempts));propsSet&&(dependency.properties=props)}(self,dependency),enableRequestHeaderTracking&&objKeys(self.requestHeaders).length>0&&(props.requestHeaders=self.requestHeaders),getResponse){var response=getResponse();if(response){var correlationContext=response.correlationContext;if(correlationContext&&(dependency.correlationContext=correlationContext),response.headerMap&&objKeys(response.headerMap).length>0&&(props.responseHeaders=response.headerMap),self.errorStatusText)if(self.status>=400){var responseType=response.type;""!==responseType&&"text"!==responseType||(props.responseText=response.responseText?response.statusText+" - "+response.responseText:response.statusText),"json"===responseType&&(props.responseText=response.response?response.statusText+" - "+JSON.stringify(response.response):response.statusText)}else 0===self.status&&(props.responseText=response.statusText||"")}}return dependency},self.getPartAProps=function(){var partA=null,traceCtx=self.eventTraceCtx;if(traceCtx&&(traceCtx.traceId||traceCtx.spanId)){var traceExt=(partA={})[Extensions_TraceExt]={traceID:traceCtx.traceId,parentID:traceCtx.spanId};isNullOrUndefined(traceCtx.traceFlags)||(traceExt.traceFlags=traceCtx.traceFlags)}return partA}})}return ajaxRecord.__ieDyn=1,ajaxRecord}(),ERROR_HEADER="Failed to monitor XMLHttpRequest",ERROR_PREFIX=", monitoring data for this ajax call ",ERROR_POSTFIX=ERROR_PREFIX+"may be incorrect.",ERROR_NOT_SENT=ERROR_PREFIX+"won't be sent.",CORRELATION_HEADER_ERROR="Failed to get Request-Context correlation header as it may be not included in the response or not accessible.",CUSTOM_REQUEST_CONTEXT_ERROR="Failed to add custom defined request context as configured call back may missing a null check.",_markCount=0;var _getAjaxData=function(xhr,ajaxDataId){return xhr&&ajaxDataId&&xhr._ajaxData?(xhr._ajaxData.i||{})[ajaxDataId]:null},_isHeaderSet=function(xhr,name){var isPresent=!1;if(xhr){var headers=(xhr._ajaxData||{}).xh;headers&&arrForEach(headers,function(header){if(header.n===name)return isPresent=!0,-1})}return isPresent};function _getFailedAjaxDiagnosticsMessage(xhr,ajaxDataId){var result="";try{var ajaxData=_getAjaxData(xhr,ajaxDataId);ajaxData&&ajaxData.requestUrl&&(result+="(url: '"+ajaxData.requestUrl+"')")}catch(e){}return result}function _throwInternalCritical(ajaxMonitorInstance,msgId,message,properties,isUserAct){_throwInternal(ajaxMonitorInstance.diagLog(),1,msgId,message,properties,isUserAct)}function _throwInternalWarning(ajaxMonitorInstance,msgId,message,properties,isUserAct){_throwInternal(ajaxMonitorInstance.diagLog(),2,msgId,message,properties,isUserAct)}function _createErrorCallbackFunc(ajaxMonitorInstance,internalMessage,message){return function(callDetails){var _a;_throwInternalCritical(ajaxMonitorInstance,internalMessage,message,((_a={}).ajaxDiagnosticsMessage=_getFailedAjaxDiagnosticsMessage(callDetails.inst,ajaxMonitorInstance._ajaxDataId),_a.exception=dumpObj(callDetails.err),_a))}}function _indexOf(value,match){return value&&match?strIndexOf(value,match):-1}function _addHandler(container,id,theFunc){var theHandler={id,fn:theFunc};return container.push(theHandler),{remove:function(){arrForEach(container,function(initializer,idx){if(initializer.id===theHandler.id)return container.splice(idx,1),-1})}}}function _processDependencyContainer(core,container,details,message){var result=!0;return arrForEach(container,function(theFunc,idx){try{!1===theFunc.fn.call(null,details)&&(result=!1)}catch(e){_throwInternal(core&&core.logger,1,64,"Dependency "+message+" [#"+idx+"] failed: "+getExceptionName(e),{exception:dumpObj(e)},!0)}}),result}var DfltAjaxCorrelationHeaderExDomains=objFreeze(["*.blob.core.windows.net","*.blob.core.chinacloudapi.cn","*.blob.core.cloudapi.de","*.blob.core.usgovcloudapi.net"]),_internalExcludeEndpoints=[/https:\/\/[^\/]*(\.pipe\.aria|aria\.pipe|events\.data|collector\.azure)\.[^\/]+\/(OneCollector\/1|Collector\/3)\.0/i],ajax_defaultConfig=objFreeze(((ajax_a={}).maxAjaxCallsPerView=500,ajax_a.disableAjaxTracking=!1,ajax_a.disableFetchTracking=!1,ajax_a.excludeRequestFromAutoTrackingPatterns=void 0,ajax_a.disableCorrelationHeaders=!1,ajax_a.distributedTracingMode=1,ajax_a.correlationHeaderExcludedDomains=DfltAjaxCorrelationHeaderExDomains,ajax_a.correlationHeaderDomains=void 0,ajax_a.correlationHeaderExcludePatterns=void 0,ajax_a.appId=void 0,ajax_a.enableCorsCorrelation=!1,ajax_a.enableRequestHeaderTracking=!1,ajax_a.enableResponseHeaderTracking=!1,ajax_a.enableAjaxErrorStatusText=!1,ajax_a.enableAjaxPerfTracking=!1,ajax_a.maxAjaxPerfLookupAttempts=3,ajax_a.ajaxPerfLookupDelay=25,ajax_a.ignoreHeaders=["Authorization","X-API-Key","WWW-Authenticate"],ajax_a.addRequestContext=void 0,ajax_a.addIntEndpoints=!0,ajax_a)),AjaxMonitor=function(_super){function AjaxMonitor(){var _fetchInitialized,_xhrInitialized,_currentWindowHost,_extensionConfig,_enableRequestHeaderTracking,_enableAjaxErrorStatusText,_trackAjaxAttempts,_context,_isUsingW3CHeaders,_isUsingAIHeaders,_markPrefix,_enableAjaxPerfTracking,_maxAjaxCallsPerView,_enableResponseHeaderTracking,_disabledUrls,_disableAjaxTracking,_disableFetchTracking,_excludeRequestFromAutoTrackingPatterns,_addRequestContext,_evtNamespace,_ajaxDataId,_dependencyHandlerId,_dependencyListeners,_dependencyInitializers,_ignoreHeaders,_maxAjaxPerfLookupAttempts,_ajaxPerfLookupDelay,_distributedTracingMode,_appId,_polyfillInitialized,_this=_super.call(this)||this;return _this.identifier=AjaxMonitor.identifier,_this.priority=120,dynamicProto(AjaxMonitor,_this,function(_self,_base){var _addHook=_base._addHook;function _initDefaults(){var location=getLocation();_fetchInitialized=!1,_xhrInitialized=!1,_polyfillInitialized=!1,_currentWindowHost=location&&location.host&&location.host.toLowerCase(),_extensionConfig=null,_enableRequestHeaderTracking=!1,_enableAjaxErrorStatusText=!1,_trackAjaxAttempts=0,_context=null,_isUsingW3CHeaders=!1,_isUsingAIHeaders=!1,_markPrefix=null,_enableAjaxPerfTracking=!1,_maxAjaxCallsPerView=0,_enableResponseHeaderTracking=!1,_disabledUrls={},_disableAjaxTracking=!1,_disableFetchTracking=!1,_excludeRequestFromAutoTrackingPatterns=null,_addRequestContext=null,_evtNamespace=null,_dependencyHandlerId=0,_dependencyListeners=[],_dependencyInitializers=[],_ajaxDataId=createUniqueNamespace("ajaxData"),_self._ajaxDataId=_ajaxDataId,_ignoreHeaders=null,_maxAjaxPerfLookupAttempts=1,_ajaxPerfLookupDelay=1,_distributedTracingMode=1,_appId=null}function _canIncludeHeaders(header){var rlt=!0;return(header||_ignoreHeaders)&&arrForEach(_ignoreHeaders,function(key){if(key.toLowerCase()===header.toLowerCase())return rlt=!1,-1}),rlt}function _hookProto(target,funcName,callbacks){_addHook(function InstrumentProto(target,funcName,callbacks){return target?InstrumentFunc(target.prototype,funcName,callbacks,!1):null}(target,funcName,callbacks))}function _isDisabledRequest(xhr,request,init){var isDisabled=!1,theUrl=((isString(request)?request:(request||{}).url||"")||"").toLowerCase();if(arrForEach(_excludeRequestFromAutoTrackingPatterns,function(regex){var theRegex=regex;isString(regex)&&(theRegex=new RegExp(regex)),isDisabled||(isDisabled=theRegex.test(theUrl))}),isDisabled)return isDisabled;var idx=_indexOf(theUrl,"?"),idx2=_indexOf(theUrl,"#");return(-1===idx||-1!==idx2&&idx2<idx)&&(idx=idx2),-1!==idx&&(theUrl=theUrl.substring(0,idx)),isNullOrUndefined(xhr)?isNullOrUndefined(request)||(isDisabled="object"==typeof request&&!0===request[DisabledPropertyName]||!!init&&!0===init[DisabledPropertyName]):isDisabled=!0===xhr[DisabledPropertyName]||!0===theUrl[DisabledPropertyName],!isDisabled&&theUrl&&isInternalApplicationInsightsEndpoint(theUrl)&&(isDisabled=!0),isDisabled?_disabledUrls[theUrl]||(_disabledUrls[theUrl]=1):_disabledUrls[theUrl]&&(isDisabled=!0),isDisabled}function _isMonitoredXhrInstance(xhr,ajaxData,excludeAjaxDataValidation){var ajaxValidation=!0,initialized=_xhrInitialized;return isNullOrUndefined(xhr)||(ajaxValidation=!0===excludeAjaxDataValidation||!isNullOrUndefined(ajaxData)),initialized&&ajaxValidation}function _getDistributedTraceCtx(){var distributedTraceCtx=null;return _self.core&&_self.core.getTraceCtx&&(distributedTraceCtx=_self.core.getTraceCtx(!1)),!distributedTraceCtx&&_context&&_context.telemetryTrace&&(distributedTraceCtx=createDistributedTraceContextFromTrace(_context.telemetryTrace)),distributedTraceCtx}function _createMarkId(type,ajaxData){if(ajaxData.requestUrl&&_markPrefix&&_enableAjaxPerfTracking){var performance_1=getPerformance();if(performance_1&&isFunction(performance_1.mark)){_markCount++;var markId=_markPrefix+type+"#"+_markCount;performance_1.mark(markId);var entries=performance_1.getEntriesByName(markId);entries&&1===entries.length&&(ajaxData.perfMark=entries[0])}}}function _findPerfResourceEntry(initiatorType,ajaxData,trackCallback,reportError){var perfMark=ajaxData.perfMark,performance=getPerformance(),maxAttempts=_maxAjaxPerfLookupAttempts,retryDelay=_ajaxPerfLookupDelay,requestUrl=ajaxData.requestUrl,attempt=0;!function locateResourceTiming(){try{if(performance&&perfMark){attempt++;for(var perfTiming=null,entries=performance.getEntries(),lp=entries.length-1;lp>=0;lp--){var entry=entries[lp];if(entry){if("resource"===entry.entryType)entry.initiatorType!==initiatorType||-1===_indexOf(entry.name,requestUrl)&&-1===_indexOf(requestUrl,entry.name)||(perfTiming=entry);else if("mark"===entry.entryType&&entry.name===perfMark.name){ajaxData.perfTiming=perfTiming;break}if(entry.startTime<perfMark.startTime-1e3)break}}}!perfMark||ajaxData.perfTiming||attempt>=maxAttempts||!1===ajaxData.async?(perfMark&&isFunction(performance.clearMarks)&&performance.clearMarks(perfMark.name),ajaxData.perfAttempts=attempt,trackCallback()):scheduleTimeout(locateResourceTiming,retryDelay)}catch(e){reportError(e)}}()}function _getFailedFetchDiagnosticsMessage(input){var result="";try{isNullOrUndefined(input)||(result+="(url: '".concat("string"==typeof input?input:input.url,"')"))}catch(e){_throwInternalCritical(_self,15,"Failed to grab failed fetch diagnostics message",{exception:dumpObj(e)})}return result}function _reportFetchMetrics(callDetails,status,input,response,ajaxData,getResponse,properties){function _reportFetchError(msgId,e,failedProps){var errorProps=failedProps||{};errorProps.fetchDiagnosticsMessage=_getFailedFetchDiagnosticsMessage(input),e&&(errorProps.exception=dumpObj(e)),_throwInternalWarning(_self,msgId,"Failed to calculate the duration of the fetch call"+ERROR_NOT_SENT,errorProps)}ajaxData&&(ajaxData.responseFinishedTime=dateTimeUtilsNow(),ajaxData.status=status,_findPerfResourceEntry("fetch",ajaxData,function(){var properties,dependency=ajaxData.CreateTrackItem("Fetch",_enableRequestHeaderTracking,getResponse);try{_addRequestContext&&(properties=_addRequestContext({status,request:input,response}))}catch(e){_throwInternalWarning(_self,104,CUSTOM_REQUEST_CONTEXT_ERROR)}if(dependency){void 0!==properties&&(dependency.properties=__assignFn(__assignFn({},dependency.properties),properties));var sysProperties=ajaxData.getPartAProps();_reportDependencyInternal(_dependencyInitializers,_self.core,ajaxData,dependency,null,sysProperties)}else _reportFetchError(14,null,{requestSentTime:ajaxData.requestSentTime,responseFinishedTime:ajaxData.responseFinishedTime})},function(e){_reportFetchError(18,e,null)}))}function _reportDependencyInternal(initializers,core,ajaxData,dependency,properties,systemProperties){var result=!0;initializers.length>0&&(result=_processDependencyContainer(core,initializers,{item:dependency,properties,sysProperties:systemProperties,context:ajaxData?ajaxData.context:null,aborted:!!ajaxData&&!!ajaxData.aborted},"initializer"));result&&_self.trackDependencyDataInternal(dependency,properties,systemProperties)}_initDefaults(),_self.initialize=function(config,core,extensions,pluginChain){_self.isInitialized()||(_base.initialize(config,core,extensions,pluginChain),_evtNamespace=mergeEvtNamespace(createUniqueNamespace("ajax"),core&&core.evtNamespace&&core.evtNamespace()),function _populateDefaults(config){_self._addHook(onConfigChange(config,function(details){var ctx=createProcessTelemetryContext(null,details.cfg,_self.core);_extensionConfig=ctx.getExtCfg(AjaxMonitor.identifier,ajax_defaultConfig),_distributedTracingMode=_extensionConfig.distributedTracingMode,_enableRequestHeaderTracking=_extensionConfig.enableRequestHeaderTracking,_enableAjaxErrorStatusText=_extensionConfig.enableAjaxErrorStatusText,_enableAjaxPerfTracking=_extensionConfig.enableAjaxPerfTracking,_maxAjaxCallsPerView=_extensionConfig.maxAjaxCallsPerView,_excludeRequestFromAutoTrackingPatterns=[].concat(_extensionConfig.excludeRequestFromAutoTrackingPatterns||[],!1!==_extensionConfig.addIntEndpoints?_internalExcludeEndpoints:[]),_addRequestContext=_extensionConfig.addRequestContext,_isUsingAIHeaders=0===_distributedTracingMode||1===_distributedTracingMode,_isUsingW3CHeaders=1===_distributedTracingMode||2===_distributedTracingMode,_enableAjaxPerfTracking&&(_markPrefix=_ajaxDataId),_disableAjaxTracking=!!_extensionConfig.disableAjaxTracking,_maxAjaxPerfLookupAttempts=_extensionConfig.maxAjaxPerfLookupAttempts,_ajaxPerfLookupDelay=_extensionConfig.ajaxPerfLookupDelay,_ignoreHeaders=_extensionConfig.ignoreHeaders,_appId=_extensionConfig.appId}))}(config),function _instrumentXhr(){if(!function _supportsAjaxMonitoring(ajaxMonitorInstance,ajaxDataId){var _a,result=!1;if(isXhrSupported()){var proto=XMLHttpRequest.prototype;result=!(isNullOrUndefined(proto)||isNullOrUndefined(proto.open)||isNullOrUndefined(proto.send)||isNullOrUndefined(proto.abort))}var ieVer=getIEVersion();if(ieVer&&ieVer<9&&(result=!1),result)try{var xhr=new XMLHttpRequest,xhrData={xh:[],i:(_a={},_a[ajaxDataId]={},_a)};xhr._ajaxData=xhrData;var theOpen=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=theOpen}catch(e){result=!1,_throwInternalCritical(ajaxMonitorInstance,15,"Failed to enable XMLHttpRequest monitoring, extension is not supported",{exception:dumpObj(e)})}return result}(_self,_ajaxDataId))return;_self._addHook(onConfigChange(_extensionConfig,function(){_disableAjaxTracking=!!_extensionConfig.disableAjaxTracking,_enableRequestHeaderTracking=_extensionConfig.enableRequestHeaderTracking,_disableAjaxTracking||_xhrInitialized||(_hookProto(XMLHttpRequest,"open",{ns:_evtNamespace,req:function(callDetails,method,url,async){if(!_disableAjaxTracking){var xhr=callDetails.inst,ajaxData=_getAjaxData(xhr,_ajaxDataId);!_isDisabledRequest(xhr,url)&&_isMonitoredXhrInstance(xhr,ajaxData,!0)&&(ajaxData&&ajaxData.xhrMonitoringState.openDone||(ajaxData=function _openHandler(xhr,method,url,async){var _a,distributedTraceCtx=_getDistributedTraceCtx(),traceID=distributedTraceCtx&&distributedTraceCtx.getTraceId()||generateW3CId(),spanID=strSubstr(generateW3CId(),0,16),xhrRequestData=xhr._ajaxData=xhr._ajaxData||{xh:[],i:{}},ajaxDataCntr=xhrRequestData.i=xhrRequestData.i||{},ajaxData=ajaxDataCntr[_ajaxDataId]=ajaxDataCntr[_ajaxDataId]||new ajaxRecord(traceID,spanID,_self.diagLog(),null===(_a=_self.core)||void 0===_a?void 0:_a.getTraceCtx());return ajaxData.traceFlags=distributedTraceCtx&&distributedTraceCtx.getTraceFlags(),ajaxData.method=method,ajaxData.requestUrl=url,ajaxData.xhrMonitoringState.openDone=!0,ajaxData.requestHeaders={},ajaxData.async=async,ajaxData.errorStatusText=_enableAjaxErrorStatusText,ajaxData}(xhr,method,url,async)),function _attachToOnReadyStateChange(xhr,ajaxData){ajaxData.xhrMonitoringState.stateChangeAttached=eventOn(xhr,"readystatechange",function(){var _a;try{xhr&&4===xhr.readyState&&_isMonitoredXhrInstance(xhr,ajaxData)&&function _onAjaxComplete(xhr){var ajaxData=_getAjaxData(xhr,_ajaxDataId);function _reportXhrError(e,failedProps){var errorProps=failedProps||{};errorProps.ajaxDiagnosticsMessage=_getFailedAjaxDiagnosticsMessage(xhr,_ajaxDataId),e&&(errorProps.exception=dumpObj(e)),_throwInternalWarning(_self,14,"Failed to calculate the duration of the ajax call"+ERROR_NOT_SENT,errorProps)}ajaxData.responseFinishedTime=dateTimeUtilsNow(),ajaxData.status=xhr.status,_findPerfResourceEntry("xmlhttprequest",ajaxData,function(){try{var dependency=ajaxData.CreateTrackItem("Ajax",_enableRequestHeaderTracking,function(){var _a,ajaxResponse=((_a={statusText:xhr.statusText,headerMap:null}).correlationContext=function _getAjaxCorrelationContext(xhr){var _a;try{var responseHeadersString=xhr.getAllResponseHeaders();if(null!==responseHeadersString)if(-1!==_indexOf(responseHeadersString.toLowerCase(),RequestHeaders[8]))return correlationIdGetCorrelationContext(xhr.getResponseHeader(RequestHeaders[0]))}catch(e){_throwInternalWarning(_self,18,CORRELATION_HEADER_ERROR,((_a={}).ajaxDiagnosticsMessage=_getFailedAjaxDiagnosticsMessage(xhr,_ajaxDataId),_a.exception=dumpObj(e),_a))}}(xhr),_a.type=xhr.responseType,_a.responseText=function _getResponseText(xhr){try{var responseType=xhr.responseType;if(""===responseType||"text"===responseType)return xhr.responseText}catch(e){}return null}(xhr),_a.response=xhr.response,_a);if(_enableResponseHeaderTracking){var headers=xhr.getAllResponseHeaders();if(headers){var arr=strTrim(headers).split(/[\r\n]+/),responseHeaderMap_2={};arrForEach(arr,function(line){var parts=line.split(": "),header=parts.shift(),value=parts.join(": ");_canIncludeHeaders(header)&&(responseHeaderMap_2[header]=value)}),ajaxResponse.headerMap=responseHeaderMap_2}}return ajaxResponse}),properties=void 0;try{_addRequestContext&&(properties=_addRequestContext({status:xhr.status,xhr}))}catch(e){_throwInternalWarning(_self,104,CUSTOM_REQUEST_CONTEXT_ERROR)}if(dependency){void 0!==properties&&(dependency.properties=__assignFn(__assignFn({},dependency.properties),properties));var sysProperties=ajaxData.getPartAProps();_reportDependencyInternal(_dependencyInitializers,_self.core,ajaxData,dependency,null,sysProperties)}else _reportXhrError(null,{requestSentTime:ajaxData.requestSentTime,responseFinishedTime:ajaxData.responseFinishedTime})}finally{try{var ajaxDataCntr=(xhr._ajaxData||{i:{}}).i||{};ajaxDataCntr[_ajaxDataId]&&(ajaxDataCntr[_ajaxDataId]=null)}catch(e){}}},function(e){_reportXhrError(e,null)})}(xhr)}catch(e){var exceptionText=dumpObj(e);exceptionText&&-1!==_indexOf(exceptionText.toLowerCase(),"c00c023f")||_throwInternalCritical(_self,16,ERROR_HEADER+" 'readystatechange' event handler"+ERROR_POSTFIX,((_a={}).ajaxDiagnosticsMessage=_getFailedAjaxDiagnosticsMessage(xhr,_ajaxDataId),_a.exception=exceptionText,_a))}},_evtNamespace)}(xhr,ajaxData))}},hkErr:_createErrorCallbackFunc(_self,15,ERROR_HEADER+".open"+ERROR_POSTFIX)}),_hookProto(XMLHttpRequest,"send",{ns:_evtNamespace,req:function(callDetails,context){if(!_disableAjaxTracking){var xhr=callDetails.inst,ajaxData=_getAjaxData(xhr,_ajaxDataId);_isMonitoredXhrInstance(xhr,ajaxData)&&!ajaxData.xhrMonitoringState.sendDone&&(_createMarkId("xhr",ajaxData),ajaxData.requestSentTime=dateTimeUtilsNow(),_self.includeCorrelationHeaders(ajaxData,void 0,void 0,xhr),ajaxData.xhrMonitoringState.sendDone=!0)}},hkErr:_createErrorCallbackFunc(_self,17,ERROR_HEADER+ERROR_POSTFIX)}),_hookProto(XMLHttpRequest,"abort",{ns:_evtNamespace,req:function(callDetails){if(!_disableAjaxTracking){var xhr=callDetails.inst,ajaxData=_getAjaxData(xhr,_ajaxDataId);_isMonitoredXhrInstance(xhr,ajaxData)&&!ajaxData.xhrMonitoringState.abortDone&&(ajaxData.aborted=1,ajaxData.xhrMonitoringState.abortDone=!0)}},hkErr:_createErrorCallbackFunc(_self,13,ERROR_HEADER+".abort"+ERROR_POSTFIX)}),_hookProto(XMLHttpRequest,"setRequestHeader",{ns:_evtNamespace,req:function(callDetails,header,value){if(!_disableAjaxTracking){var xhr=callDetails.inst,ajaxData=_getAjaxData(xhr,_ajaxDataId);ajaxData&&_isMonitoredXhrInstance(xhr,ajaxData)&&(!function(xhr,name,value){if(xhr){var headers=(xhr._ajaxData||{}).xh;headers&&headers.push({n:name,v:value})}}(xhr,header,value),_enableRequestHeaderTracking&&_canIncludeHeaders(header)&&(ajaxData.requestHeaders[header]=value))}},hkErr:_createErrorCallbackFunc(_self,71,ERROR_HEADER+".setRequestHeader"+ERROR_POSTFIX)}),_xhrInitialized=!0)}))}(),function _instrumentFetch(){var fetch=function _supportsFetch(){var _global=getGlobal();return!_global||isNullOrUndefined(_global.Request)||isNullOrUndefined(_global.Request.prototype)||isNullOrUndefined(_global.fetch)?null:_global.fetch}();if(!fetch)return;var global=getGlobal(),isPolyfill=fetch.polyfill;_self._addHook(onConfigChange(_extensionConfig,function(){_disableFetchTracking=!!_extensionConfig.disableFetchTracking,_enableResponseHeaderTracking=_extensionConfig.enableResponseHeaderTracking,_disableFetchTracking||_fetchInitialized?isPolyfill&&!_polyfillInitialized&&(_addHook(InstrumentFunc(global,"fetch",{ns:_evtNamespace,req:function(callDetails,input,init){_isDisabledRequest(null,input,init)}})),_polyfillInitialized=!0):(_addHook(InstrumentFunc(global,"fetch",{ns:_evtNamespace,req:function(callDetails,input,init){var fetchData;if(!_disableFetchTracking&&_fetchInitialized&&!_isDisabledRequest(null,input,init)&&(!isPolyfill||!_xhrInitialized)){var ctx=callDetails.ctx();fetchData=function _createFetchRecord(input,init){var _a,requestUrl,distributedTraceCtx=_getDistributedTraceCtx(),traceID=distributedTraceCtx&&distributedTraceCtx.getTraceId()||generateW3CId(),spanID=strSubstr(generateW3CId(),0,16),ajaxData=new ajaxRecord(traceID,spanID,_self.diagLog(),null===(_a=_self.core)||void 0===_a?void 0:_a.getTraceCtx());ajaxData.traceFlags=distributedTraceCtx&&distributedTraceCtx.getTraceFlags(),ajaxData.requestSentTime=dateTimeUtilsNow(),ajaxData.errorStatusText=_enableAjaxErrorStatusText,requestUrl=input instanceof Request?(input||{}).url||"":input;if(""===requestUrl){var location_1=getLocation();location_1&&location_1.href&&(requestUrl=strSplit(location_1.href,"#")[0])}_self.core&&_self.core.config&&(requestUrl=fieldRedaction(requestUrl,_self.core.config));ajaxData.requestUrl=requestUrl;var method="GET";init&&init.method?method=init.method:input&&input instanceof Request&&(method=input.method);ajaxData.method=method;var requestHeaders={};if(_enableRequestHeaderTracking){new Headers((init?init.headers:0)||input instanceof Request&&input.headers||{}).forEach(function(value,key){_canIncludeHeaders(key)&&(requestHeaders[key]=value)})}return ajaxData.requestHeaders=requestHeaders,_createMarkId("fetch",ajaxData),ajaxData}(input,init);var newInit=_self.includeCorrelationHeaders(fetchData,input,init);newInit!==init&&callDetails.set(1,newInit),ctx.data=fetchData}},rsp:function(callDetails,input){if(!_disableFetchTracking){var fetchData_1=callDetails.ctx().data;fetchData_1&&(callDetails.rslt=callDetails.rslt.then(function(response){return _reportFetchMetrics(callDetails,(response||{}).status,input,response,fetchData_1,function(){var _a,ajaxResponse=((_a={statusText:(response||{}).statusText,headerMap:null}).correlationContext=function _getFetchCorrelationContext(response){if(response&&response.headers)try{return correlationIdGetCorrelationContext(response.headers.get(RequestHeaders[0]))}catch(e){_throwInternalWarning(_self,18,CORRELATION_HEADER_ERROR,{fetchDiagnosticsMessage:_getFailedFetchDiagnosticsMessage(response),exception:dumpObj(e)})}}(response),_a);if(_enableResponseHeaderTracking&&response){var responseHeaderMap_1={};response.headers.forEach(function(value,name){_canIncludeHeaders(name)&&(responseHeaderMap_1[name]=value)}),ajaxResponse.headerMap=responseHeaderMap_1}return ajaxResponse}),response}).catch(function(reason){throw _reportFetchMetrics(callDetails,0,input,null,fetchData_1,null,{error:reason.message||dumpObj(reason)}),reason}))}},hkErr:_createErrorCallbackFunc(_self,15,"Failed to monitor Window.fetch"+ERROR_POSTFIX)},!0,isWebWorker())),_fetchInitialized=!0)})),isPolyfill&&(global.fetch.polyfill=isPolyfill)}(),function _populateContext(){var propExt=_self.core.getPlugin("AppInsightsPropertiesPlugin");propExt&&(_context=propExt.plugin.context)}())},_self._doTeardown=function(){_initDefaults()},_self.trackDependencyData=function(dependency,properties){_reportDependencyInternal(_dependencyInitializers,_self.core,null,dependency,properties)},_self.resetAjaxAttempts=function(){_trackAjaxAttempts=0},_self.includeCorrelationHeaders=function(ajaxData,input,init,xhr){var currentWindowHost=_self._currentWindowHost||_currentWindowHost;if(function _processDependencyListeners(listeners,core,ajaxData,xhr,input,init){var result=!0;if(listeners.length>0){var details={core,xhr,input,init,traceId:ajaxData.traceID,spanId:ajaxData.spanID,traceFlags:ajaxData.traceFlags,context:ajaxData.context||{},aborted:!!ajaxData.aborted};result=_processDependencyContainer(core,listeners,details,"listener"),ajaxData.traceID=details.traceId,ajaxData.spanID=details.spanId,ajaxData.traceFlags=details.traceFlags,ajaxData.context=details.context}return result}(_dependencyListeners,_self.core,ajaxData,xhr,input,init))if(input||""===input){if(correlationIdCanIncludeCorrelationHeader(_extensionConfig,ajaxData.getAbsoluteUrl(),currentWindowHost)){init||(init={});var headers=new Headers(init.headers||input instanceof Request&&input.headers||{});if(_isUsingAIHeaders){var id="|"+ajaxData.traceID+"."+ajaxData.spanID;headers.set(RequestHeaders[3],id),_enableRequestHeaderTracking&&(ajaxData.requestHeaders[RequestHeaders[3]]=id)}if((appId=_appId||_context&&_context.appId())&&(headers.set(RequestHeaders[0],RequestHeaders[2]+appId),_enableRequestHeaderTracking&&(ajaxData.requestHeaders[RequestHeaders[0]]=RequestHeaders[2]+appId)),_isUsingW3CHeaders){isNullOrUndefined(traceFlags=ajaxData.traceFlags)&&(traceFlags=1);var traceParent=formatTraceParent(createTraceParent(ajaxData.traceID,ajaxData.spanID,traceFlags));headers.set(RequestHeaders[4],traceParent),_enableRequestHeaderTracking&&(ajaxData.requestHeaders[RequestHeaders[4]]=traceParent)}init.headers=headers}}else if(xhr&&correlationIdCanIncludeCorrelationHeader(_extensionConfig,ajaxData.getAbsoluteUrl(),currentWindowHost)){if(_isUsingAIHeaders)if(_isHeaderSet(xhr,RequestHeaders[3]))_throwInternalWarning(_self,71,"Unable to set ["+RequestHeaders[3]+"] as it has already been set by another instance");else{id="|"+ajaxData.traceID+"."+ajaxData.spanID;xhr.setRequestHeader(RequestHeaders[3],id),_enableRequestHeaderTracking&&(ajaxData.requestHeaders[RequestHeaders[3]]=id)}var appId,traceFlags;if((appId=_appId||_context&&_context.appId())&&(_isHeaderSet(xhr,RequestHeaders[0])?_throwInternalWarning(_self,71,"Unable to set ["+RequestHeaders[0]+"] as it has already been set by another instance"):(xhr.setRequestHeader(RequestHeaders[0],RequestHeaders[2]+appId),_enableRequestHeaderTracking&&(ajaxData.requestHeaders[RequestHeaders[0]]=RequestHeaders[2]+appId))),_isUsingW3CHeaders)if(isNullOrUndefined(traceFlags=ajaxData.traceFlags)&&(traceFlags=1),_isHeaderSet(xhr,RequestHeaders[4]))_throwInternalWarning(_self,71,"Unable to set ["+RequestHeaders[4]+"] as it has already been set by another instance");else{traceParent=formatTraceParent(createTraceParent(ajaxData.traceID,ajaxData.spanID,traceFlags));xhr.setRequestHeader(RequestHeaders[4],traceParent),_enableRequestHeaderTracking&&(ajaxData.requestHeaders[RequestHeaders[4]]=traceParent)}}return xhr||init},_self.trackDependencyDataInternal=function(dependency,properties,systemProperties){if(-1===_maxAjaxCallsPerView||_trackAjaxAttempts<_maxAjaxCallsPerView){2!==_distributedTracingMode&&1!==_distributedTracingMode||"string"!=typeof dependency.id||"."===dependency.id[dependency.id.length-1]||(dependency.id+="."),isNullOrUndefined(dependency.startTime)&&(dependency.startTime=new Date);var item=createTelemetryItem(dependency,RemoteDependencyData.dataType,RemoteDependencyData.envelopeType,_self.diagLog(),properties,systemProperties);_self.core.track(item)}else _trackAjaxAttempts===_maxAjaxCallsPerView&&_throwInternalCritical(_self,55,"Maximum ajax per page view limit reached, ajax monitoring is paused until the next trackPageView(). In order to increase the limit set the maxAjaxCallsPerView configuration parameter.",!0);++_trackAjaxAttempts},_self.addDependencyListener=function(dependencyListener){return _addHandler(_dependencyListeners,_dependencyHandlerId++,dependencyListener)},_self.addDependencyInitializer=function(dependencyInitializer){return _addHandler(_dependencyInitializers,_dependencyHandlerId++,dependencyInitializer)}}),_this}return __extendsFn(AjaxMonitor,_super),AjaxMonitor.prototype.processTelemetry=function(item,itemCtx){this.processNext(item,itemCtx)},AjaxMonitor.prototype.addDependencyInitializer=function(dependencyInitializer){return null},AjaxMonitor.identifier="AjaxDependencyPlugin",AjaxMonitor}(BaseTelemetryPlugin),Application=function Application(){},Device=function Device(){this.id="browser",this.deviceClass="Browser"},Internal=function Internal(config,unloadHookContainer){var _this=this,unloadHook=onConfigChange(config,function(){var prefix=config.sdkExtension;_this.sdkVersion=(prefix?prefix+"_":"")+"javascript:3.3.11"});unloadHookContainer&&unloadHookContainer.add(unloadHook)},Location=function Location(){},Session=function Session(){},_SessionManager=function(){function _SessionManager(config,core,unloadHookContainer){var _storageNamePrefix,_cookieUpdatedTimestamp,_sessionExpirationMs,_sessionRenewalMs,_logger=safeGetLogger(core),_cookieManager=safeGetCookieMgr(core);dynamicProto(_SessionManager,this,function(_self){config||(config={});var unloadHook=onConfigChange(config,function(details){_sessionExpirationMs=config.sessionExpirationMs||864e5,_sessionRenewalMs=config.sessionRenewalMs||18e5;var sessionCookiePostfix=config.sessionCookiePostfix||config.namePrefix||"";_storageNamePrefix="ai_session"+sessionCookiePostfix});function _initializeAutomaticSessionWithData(session,sessionData){var isValid=!1,tokens=sessionData.split("|");if(tokens.length>=2)try{var acqMs=+tokens[1]||0,renewalMs=+tokens[2]||0;isNaN(acqMs)||acqMs<=0?_throwInternal(_logger,2,27,"AI session acquisition date is 0, session will be reset"):isNaN(renewalMs)||renewalMs<=0?_throwInternal(_logger,2,27,"AI session renewal date is 0, session will be reset"):tokens[0]&&(session.id=tokens[0],session.acquisitionDate=acqMs,session.renewalDate=renewalMs,isValid=!0)}catch(e){_throwInternal(_logger,1,9,"Error parsing ai_session value ["+(sessionData||"")+"], session will be reset - "+getExceptionName(e),{exception:dumpObj(e)})}return isValid}function _setCookie(session,nowMs){var acq=session.acquisitionDate;session.renewalDate=nowMs;var renewalPeriodMs=_sessionRenewalMs,acqTimeLeftMs=acq+_sessionExpirationMs-nowMs,cookie=[session.id,acq,nowMs],maxAgeSec=0;maxAgeSec=acqTimeLeftMs<renewalPeriodMs?acqTimeLeftMs/1e3:renewalPeriodMs/1e3;var cookieDomain=config.cookieDomain||null;_cookieManager.set(_storageNamePrefix,cookie.join("|"),_sessionExpirationMs>0?maxAgeSec:null,cookieDomain),_cookieUpdatedTimestamp=nowMs}unloadHookContainer&&unloadHookContainer.add(unloadHook),_self.automaticSession=new Session,_self.update=function(){var nowMs=utcNow(),isExpired=!1,session=_self.automaticSession;if(session.id||(isExpired=!function _initializeAutomaticSession(session,now){var isValid=!1,cookieValue=_cookieManager.get(_storageNamePrefix);if(cookieValue&&isFunction(cookieValue.split))isValid=_initializeAutomaticSessionWithData(session,cookieValue);else{var storageValue=utlGetLocalStorage(_logger,_storageNamePrefix);storageValue&&(isValid=_initializeAutomaticSessionWithData(session,storageValue))}return isValid||!!session.id}(session)),!isExpired&&_sessionExpirationMs>0){var timeSinceAcqMs=nowMs-session.acquisitionDate,timeSinceRenewalMs=nowMs-session.renewalDate;isExpired=(isExpired=(isExpired=timeSinceAcqMs<0||timeSinceRenewalMs<0)||timeSinceAcqMs>_sessionExpirationMs)||timeSinceRenewalMs>_sessionRenewalMs}isExpired?function _renew(nowMs){var getNewId=config.getNewId||newId;_self.automaticSession.id=getNewId(config.idLength||22),_self.automaticSession.acquisitionDate=nowMs,_setCookie(_self.automaticSession,nowMs),utlCanUseLocalStorage()||_throwInternal(_logger,2,0,"Browser does not support local storage. Session durations will be inaccurate.")}(nowMs):(!_cookieUpdatedTimestamp||nowMs-_cookieUpdatedTimestamp>6e4)&&_setCookie(session,nowMs)},_self.backup=function(){var session=_self.automaticSession;!function _setStorage(guid,acq,renewal){utlSetLocalStorage(_logger,_storageNamePrefix,[guid,acq,renewal].join("|"))}(session.id,session.acquisitionDate,session.renewalDate)}})}return _SessionManager.__ieDyn=1,_SessionManager}(),TelemetryTrace=function TelemetryTrace(id,parentId,name,logger,config){this.traceID=id||generateW3CId(),this.parentID=parentId;var location=getLocation();!name&&location&&location.pathname&&(name=location.pathname,config&&(name=fieldRedaction(name,config))),this.name=dataSanitizeString(logger,name)};function _validateUserInput(id){return!("string"!=typeof id||!id||id.match(/,|;|=| |\|/))}var User=function(){function User(config,core,unloadHookContainer){this.isNewUser=!1,this.isUserCookieSet=!1;var _storageNamePrefix,_logger=safeGetLogger(core),_cookieManager=safeGetCookieMgr(core);dynamicProto(User,this,function(_self){objDefine(_self,"config",{g:function(){return config}});var unloadHook=onConfigChange(config,function(){var userCookiePostfix=config.userCookiePostfix||"";_storageNamePrefix=User.userCookieName+userCookiePostfix;var cookie=_cookieManager.get(_storageNamePrefix);if(cookie){_self.isNewUser=!1;var params=cookie.split(User.cookieSeparator);params.length>0&&(_self.id=params[0],_self.isUserCookieSet=!!_self.id)}if(!_self.id){_self.id=_generateNewId(),_setUserCookie(_generateNewCookie(_self.id).join(User.cookieSeparator));var name_1=(config.namePrefix||"")+"ai_session";!function utlRemoveStorage(logger,name){var storage=_getLocalStorageObject();if(null!==storage)try{return storage.removeItem(name),!0}catch(e){_canUseLocalStorage=!1,_throwInternal(logger,2,5,"Browser failed removal of local storage item. "+getExceptionName(e),{exception:dumpObj(e)})}return!1}(_logger,name_1)}_self.accountId=config.accountId||void 0;var authCookie=_cookieManager.get(User.authUserCookieName);if(authCookie){var authCookieString=(authCookie=decodeURI(authCookie)).split(User.cookieSeparator);authCookieString[0]&&(_self.authenticatedId=authCookieString[0]),authCookieString.length>1&&authCookieString[1]&&(_self.accountId=authCookieString[1])}});function _generateNewId(){var theConfig=config||{};return(theConfig.getNewId||newId)(theConfig.idLength?config.idLength:22)}function _generateNewCookie(userId){var acqStr=toISOString(new Date);return _self.accountAcquisitionDate=acqStr,_self.isNewUser=!0,[userId,acqStr]}function _setUserCookie(cookie){_self.isUserCookieSet=_cookieManager.set(_storageNamePrefix,cookie,31536e3)}unloadHookContainer&&unloadHookContainer.add(unloadHook),_self.setAuthenticatedUserContext=function(authenticatedUserId,accountId,storeInCookie){if(void 0===storeInCookie&&(storeInCookie=!1),!_validateUserInput(authenticatedUserId)||accountId&&!_validateUserInput(accountId))_throwInternal(_logger,2,60,"Setting auth user context failed. User auth/account id should be of type string, and not contain commas, semi-colons, equal signs, spaces, or vertical-bars.",!0);else{_self.authenticatedId=authenticatedUserId;var authCookie=_self.authenticatedId;accountId&&(_self.accountId=accountId,authCookie=[_self.authenticatedId,_self.accountId].join(User.cookieSeparator)),storeInCookie&&_cookieManager.set(User.authUserCookieName,encodeURI(authCookie))}},_self.clearAuthenticatedUserContext=function(){_self.authenticatedId=null,_self.accountId=null,_cookieManager.del(User.authUserCookieName)},_self.update=function(userId){_self.id===userId&&_self.isUserCookieSet||_setUserCookie(_generateNewCookie(userId||_generateNewId()).join(User.cookieSeparator))}})}return User.cookieSeparator="|",User.userCookieName="ai_user",User.authUserCookieName="ai_authUser",User}();function _removeEmpty(target,name){target&&target[name]&&0===objKeys(target[name]).length&&delete target[name]}function _nullResult(){return null}var PropertiesPlugin_a,TelemetryContext=function(){function TelemetryContext(core,defaultConfig,previousTraceCtx,unloadHookContainer){var _this=this,logger=core.logger;dynamicProto(TelemetryContext,this,function(_self){if(_self.appId=_nullResult,_self.getSessionId=_nullResult,_self.application=new Application,_self.internal=new Internal(defaultConfig,unloadHookContainer),hasWindow()){_self.sessionManager=new _SessionManager(defaultConfig,core,unloadHookContainer),_self.device=new Device,_self.location=new Location,_self.user=new User(defaultConfig,core,unloadHookContainer);var name_1,traceId=void 0,parentId=void 0;previousTraceCtx&&(traceId=previousTraceCtx.getTraceId(),parentId=previousTraceCtx.getSpanId(),name_1=previousTraceCtx.getName()),_self.telemetryTrace=new TelemetryTrace(traceId,parentId,name_1,logger),_self.session=new Session}_self.getSessionId=function(){var session=_self.session,sesId=null;if(session&&isString(session.id))sesId=session.id;else{var autoSession=(_self.sessionManager||{}).automaticSession;sesId=autoSession&&isString(autoSession.id)?autoSession.id:null}return sesId},_self.applySessionContext=function(evt,itemCtx){setValue(getSetValue(evt.ext,Extensions_AppExt),"sesId",_self.getSessionId(),isString)},_self.applyOperatingSystemContxt=function(evt,itemCtx){setValue(evt.ext,Extensions_OSExt,_self.os)},_self.applyApplicationContext=function(evt,itemCtx){var application=_self.application;if(application){var tags=getSetValue(evt,"tags");setValue(tags,CtxTagKeys.applicationVersion,application.ver,isString),setValue(tags,CtxTagKeys.applicationBuild,application.build,isString)}},_self.applyDeviceContext=function(evt,itemCtx){var device=_self.device;if(device){var extDevice=getSetValue(getSetValue(evt,"ext"),Extensions_DeviceExt);setValue(extDevice,"localId",device.id,isString),setValue(extDevice,"ip",device.ip,isString),setValue(extDevice,"model",device.model,isString),setValue(extDevice,"deviceClass",device.deviceClass,isString)}},_self.applyInternalContext=function(evt,itemCtx){var internal=_self.internal;if(internal){var tags=getSetValue(evt,"tags");setValue(tags,CtxTagKeys.internalAgentVersion,internal.agentVersion,isString),setValue(tags,CtxTagKeys.internalSdkVersion,dataSanitizeString(logger,internal.sdkVersion,64),isString),evt.baseType!==_InternalLogMessage.dataType&&evt.baseType!==PageView.dataType||(setValue(tags,CtxTagKeys.internalSnippet,internal.snippetVer,isString),setValue(tags,CtxTagKeys.internalSdkSrc,internal.sdkSrc,isString))}},_self.applyLocationContext=function(evt,itemCtx){var location=_this.location;location&&setValue(getSetValue(evt,"tags",[]),CtxTagKeys.locationIp,location.ip,isString)},_self.applyOperationContext=function(evt,itemCtx){var telemetryTrace=_self.telemetryTrace;if(telemetryTrace){var extTrace=getSetValue(getSetValue(evt,"ext"),Extensions_TraceExt,{traceID:void 0,parentID:void 0});setValue(extTrace,"traceID",telemetryTrace.traceID,isString,isNullOrUndefined),setValue(extTrace,"name",telemetryTrace.name,isString,isNullOrUndefined),setValue(extTrace,"parentID",telemetryTrace.parentID,isString,isNullOrUndefined)}},_self.applyWebContext=function(evt,itemCtx){var web=_this.web;web&&setValue(getSetValue(evt,"ext"),Extensions_WebExt,web)},_self.applyUserContext=function(evt,itemCtx){var user=_self.user;if(user){setValue(getSetValue(evt,"tags",[]),CtxTagKeys.userAccountId,user.accountId,isString);var extUser=getSetValue(getSetValue(evt,"ext"),Extensions_UserExt);setValue(extUser,"id",user.id,isString),setValue(extUser,"authId",user.authenticatedId,isString)}},_self.cleanUp=function(evt,itemCtx){var ext=evt.ext;ext&&(_removeEmpty(ext,Extensions_DeviceExt),_removeEmpty(ext,Extensions_UserExt),_removeEmpty(ext,Extensions_WebExt),_removeEmpty(ext,Extensions_OSExt),_removeEmpty(ext,Extensions_AppExt),_removeEmpty(ext,Extensions_TraceExt))}})}return TelemetryContext.__ieDyn=1,TelemetryContext}(),PropertiesPlugin_defaultConfig=objDeepFreeze(((PropertiesPlugin_a={accountId:null,sessionRenewalMs:18e5,samplingPercentage:100,sessionExpirationMs:864e5,cookieDomain:null,sdkExtension:null,isBrowserLinkTrackingEnabled:!1,appId:null}).getSessionId=null,PropertiesPlugin_a.namePrefix=void 0,PropertiesPlugin_a.sessionCookiePostfix=void 0,PropertiesPlugin_a.userCookiePostfix=void 0,PropertiesPlugin_a.idLength=22,PropertiesPlugin_a.getNewId=null,PropertiesPlugin_a));const dist_es5_PropertiesPlugin=function(_super){function PropertiesPlugin(){var _extensionConfig,_distributedTraceCtx,_previousTraceCtx,_context,_disableUserInitMessage,_this=_super.call(this)||this;return _this.priority=110,_this.identifier="AppInsightsPropertiesPlugin",dynamicProto(PropertiesPlugin,_this,function(_self,_base){function _initDefaults(){_extensionConfig=null,_distributedTraceCtx=null,_previousTraceCtx=null,_context=null,_disableUserInitMessage=!0}_initDefaults(),objDefine(_self,"context",{g:function(){return _context}}),_self.initialize=function(config,core,extensions,pluginChain){_base.initialize(config,core,extensions,pluginChain),function _populateDefaults(config){var identifier=_self.identifier,core=_self.core;_self._addHook(onConfigChange(config,function(){var ctx=createProcessTelemetryContext(null,config,core);config.storagePrefix&&utlSetStoragePrefix(config.storagePrefix),_disableUserInitMessage=!1!==config.disableUserInitMessage,_extensionConfig=ctx.getExtCfg(identifier,PropertiesPlugin_defaultConfig),_self._extConfig=_extensionConfig})),_previousTraceCtx=core.getTraceCtx(!1),_context=new TelemetryContext(core,_extensionConfig,_previousTraceCtx,_self._unloadHooks),_distributedTraceCtx=createDistributedTraceContextFromTrace(_self.context.telemetryTrace,_previousTraceCtx),core.setTraceCtx(_distributedTraceCtx),_self.context.appId=function(){var breezeChannel=core.getPlugin("AppInsightsChannelPlugin");return breezeChannel?breezeChannel.plugin._appId:null}}(config)},_self.processTelemetry=function(event,itemCtx){if(!isNullOrUndefined(event)){itemCtx=_self._getTelCtx(itemCtx),event.name===PageView.envelopeType&&itemCtx.diagLog().resetInternalMessageCount();var theContext=_context||{};theContext.session&&"string"!=typeof _context.session.id&&theContext.sessionManager&&theContext.sessionManager.update();var userCtx=theContext.user;if(userCtx&&!userCtx.isUserCookieSet&&userCtx.update(theContext.user.id),function _processTelemetryInternal(evt,itemCtx){getSetValue(evt,"tags",[]),getSetValue(evt,"ext",{});var ctx=_self.context;ctx.applySessionContext(evt,itemCtx),ctx.applyApplicationContext(evt,itemCtx),ctx.applyDeviceContext(evt,itemCtx),ctx.applyOperationContext(evt,itemCtx),ctx.applyUserContext(evt,itemCtx),ctx.applyOperatingSystemContxt(evt,itemCtx),ctx.applyWebContext(evt,itemCtx),ctx.applyLocationContext(evt,itemCtx),ctx.applyInternalContext(evt,itemCtx),ctx.cleanUp(evt,itemCtx)}(event,itemCtx),userCtx&&userCtx.isNewUser&&(userCtx.isNewUser=!1,!_disableUserInitMessage)){var message=new _InternalLogMessage(72,(getNavigator()||{}).userAgent||"");!function _logInternalMessage(logger,severity,message){_getLogger(logger).logInternalMessage(severity,message)}(itemCtx.diagLog(),1,message)}_self.processNext(event,itemCtx)}},_self._doTeardown=function(unloadCtx,unloadState){var core=(unloadCtx||{}).core();core&&core.getTraceCtx&&(core.getTraceCtx(!1)===_distributedTraceCtx&&core.setTraceCtx(_previousTraceCtx));_initDefaults()}}),_this}return __extendsFn(PropertiesPlugin,_super),PropertiesPlugin.__ieDyn=1,PropertiesPlugin}(BaseTelemetryPlugin);var AISku_a,AISku_b,_c,_d,_internalSdkSrc,_ignoreUpdateSnippetProperties=["snippet","dependencies","properties","_snippetVersion","appInsightsNew","getSKUDefaults"],default_throttle_config={disabled:!0,limit:cfgDfMerge({samplingRate:100,maxSendNumber:1}),interval:cfgDfMerge({monthInterval:3,daysOfMonth:[28]})},defaultConfigValues=((AISku_a={}).connectionString=void 0,AISku_a.endpointUrl=void 0,AISku_a.instrumentationKey=void 0,AISku_a.userOverrideEndpointUrl=void 0,AISku_a.diagnosticLogInterval=cfgDfValidate(function _chkDiagLevel(value){return value&&value>0},1e4),AISku_a.featureOptIn=((AISku_b={}).iKeyUsage={mode:3},AISku_b.CdnUsage={mode:2},AISku_b.SdkLoaderVer={mode:2},AISku_b.zipPayload={mode:1},AISku_b),AISku_a.throttleMgrCfg=cfgDfMerge(((_c={})[109]=cfgDfMerge(default_throttle_config),_c[106]=cfgDfMerge(default_throttle_config),_c[111]=cfgDfMerge(default_throttle_config),_c[110]=cfgDfMerge(default_throttle_config),_c)),AISku_a.extensionConfig=cfgDfMerge(((_d={}).AppInsightsCfgSyncPlugin=cfgDfMerge({cfgUrl:"https://js.monitor.azure.com/scripts/b/ai.config.1.cfg.json",syncMode:2}),_d)),AISku_a);function _parseCs(config,configCs){return createSyncPromise(function(resolve,reject){doAwaitResponse(configCs,function(res){var curCs=res&&res.value,parsedCs=null;!res.rejected&&curCs&&(config.connectionString=curCs,parsedCs=parseConnectionString(curCs)),resolve(parsedCs)})})}var AppInsightsSku=function(){function AppInsightsSku(snippet){var dependencies,properties,_sender,_snippetVersion,_evtNamespace,_houseKeepingNamespace,_core,_config,_analyticsPlugin,_cfgSyncPlugin,_throttleMgr,_iKeySentMessage,_cdnSentMessage,_sdkVerSentMessage,_this=this;dynamicProto(AppInsightsSku,this,function(_self){_initDefaults(),objDefine(_self,"config",{g:function(){return _config}}),arrForEach(["pluginVersionStringArr","pluginVersionString"],function(key){objDefine(_self,key,{g:function(){return _core?_core[key]:null}})}),_snippetVersion=""+(snippet.sv||snippet.version||""),snippet.queue=snippet.queue||[],snippet.version=snippet.version||2;var cfgHandler=createDynamicConfig(snippet.config||{},defaultConfigValues);function _initDefaults(){_evtNamespace=createUniqueNamespace("AISKU"),_houseKeepingNamespace=null,dependencies=null,properties=null,_sender=null,_snippetVersion=null,_throttleMgr=null,_iKeySentMessage=!1,_cdnSentMessage=!1,_sdkVerSentMessage=!1,_cfgSyncPlugin=new CfgSyncPlugin}function _removePageEventHandlers(){_houseKeepingNamespace&&(!function removePageUnloadEventListener(listener,evtNamespace){removeEventListeners(["beforeunload","unload","pagehide"],listener,evtNamespace)}(null,_houseKeepingNamespace),function removePageHideEventListener(listener,evtNamespace){var newNamespaces=mergeEvtNamespace(strPageHideNamespace,evtNamespace);removeEventListeners(["pagehide"],listener,newNamespaces),removeEventListeners(["visibilitychange"],null,newNamespaces)}(null,_houseKeepingNamespace))}function _addUnloadHook(hooks){_core.addUnloadHook(hooks)}_config=cfgHandler.cfg,_analyticsPlugin=new AnalyticsPlugin,objDefine(_self,"appInsights",{g:function(){return _analyticsPlugin}}),properties=new dist_es5_PropertiesPlugin,dependencies=new AjaxMonitor,_sender=new Sender,_core=new AppInsightsCore,objDefine(_self,"core",{g:function(){return _core}}),_addUnloadHook(onConfigChange(cfgHandler,function(){var configCs=_config.connectionString;if(isPromiseLike(configCs)){var ikeyPromise=createSyncPromise(function(resolve,reject){doAwaitResponse(_parseCs(_config,configCs),function(rsp){if(rsp.rejected)resolve(null);else{var ikey=_config.instrumentationKey,cs=rsp.value;ikey=cs&&cs.instrumentationkey||ikey,resolve(ikey)}})}),url=_config.userOverrideEndpointUrl;isNullOrUndefined(url)&&(url=createSyncPromise(function(resolve,reject){doAwaitResponse(_parseCs(_config,configCs),function(rsp){if(rsp.rejected)resolve(null);else{var url_1=_config.endpointUrl,cs=rsp.value,ingest=cs&&cs.ingestionendpoint;resolve(url_1=ingest?ingest+"/v2/track":url_1)}})})),_config.instrumentationKey=ikeyPromise,_config.endpointUrl=url}if(isString(configCs)&&configCs){var cs=parseConnectionString(configCs),ingest=cs.ingestionendpoint;_config.endpointUrl=_config.userOverrideEndpointUrl?_config.userOverrideEndpointUrl:ingest+"/v2/track",_config.instrumentationKey=cs.instrumentationkey||_config.instrumentationKey}_config.endpointUrl=_config.userOverrideEndpointUrl?_config.userOverrideEndpointUrl:_config.endpointUrl})),_self.snippet=snippet,_self.flush=function(isAsync,callBack){var result;return void 0===isAsync&&(isAsync=!0),doPerf(_core,function(){return"AISKU.flush"},function(){isAsync&&!callBack&&(result=createPromise(function(resolve){callBack=resolve}));var waiting=1,flushDone=function(){0===--waiting&&callBack()};arrForEach(_core.getChannels(),function(channel){channel&&(waiting++,channel.flush(isAsync,flushDone))}),flushDone()},null,isAsync),result},_self.onunloadFlush=function(isAsync){void 0===isAsync&&(isAsync=!0),arrForEach(_core.getChannels(),function(channel){channel.onunloadFlush?channel.onunloadFlush():channel.flush(isAsync)})},_self.loadAppInsights=function(legacyMode,logger,notificationManager){return void 0===legacyMode&&(legacyMode=!1),legacyMode&&function throwUnsupported(message){throw _unsupportedError||(_unsupportedError=createCustomError("UnsupportedError")),new _unsupportedError(message)}("Legacy Mode is no longer supported"),doPerf(_self.core,function(){return"AISKU.loadAppInsights"},function(){_core.initialize(_config,[_sender,properties,dependencies,_analyticsPlugin,_cfgSyncPlugin],logger,notificationManager),objDefine(_self,"context",{g:function(){return properties.context}}),_throttleMgr||(_throttleMgr=new ThrottleMgr(_core));var sdkSrc=function _findSdkSourceFile(){if(_internalSdkSrc)return _internalSdkSrc;var sdkSrc=null,isModule=!1,cdns=["://js.monitor.azure.com/","://az416426.vo.msecnd.net/"];try{var scrpt=(document||{}).currentScript;scrpt&&(sdkSrc=scrpt.src)}catch(e){}if(sdkSrc){try{var url_2=sdkSrc.toLowerCase();if(url_2){var src_1="";arrForEach(cdns,function(value,idx){if(-1!==strIndexOf(url_2,value))return src_1="cdn"+(idx+1),-1===strIndexOf(url_2,"/scripts/")&&(-1!==strIndexOf(url_2,"/next/")?src_1+="-next":-1!==strIndexOf(url_2,"/beta/")&&(src_1+="-beta")),_internalSdkSrc=src_1+(isModule?".mod":""),-1})}}catch(e){}_internalSdkSrc=sdkSrc}return _internalSdkSrc}();sdkSrc&&_self.context&&(_self.context.internal.sdkSrc=sdkSrc),function _updateSnippetProperties(snippet){if(snippet){var snippetVer="";isNullOrUndefined(_snippetVersion)||(snippetVer+=_snippetVersion),_self.context&&_self.context.internal&&(_self.context.internal.snippetVer=snippetVer||"-"),objForEachKey(_self,function(field,value){isString(field)&&!isFunction(value)&&field&&"_"!==field[0]&&-1===arrIndexOf(_ignoreUpdateSnippetProperties,field)&&snippet[field]!==value&&(snippet[field]=value)})}}(_self.snippet),_self.emptyQueue(),_self.pollInternalLogs(),_self.addHousekeepingBeforeUnload(_self),_addUnloadHook(onConfigChange(cfgHandler,function(){var defaultEnable=!1;_config.throttleMgrCfg[109]&&(defaultEnable=!_config.throttleMgrCfg[109].disabled),!_throttleMgr.isReady()&&_config.extensionConfig&&_config.extensionConfig[_cfgSyncPlugin.identifier]&&defaultEnable&&_throttleMgr.onReadyState(!0),_iKeySentMessage||_config.connectionString||!isFeatureEnabled("iKeyUsage",_config,!0)||(_throttleMgr.sendMessage(106,"See Instrumentation key support at aka.ms/IkeyMigrate"),_iKeySentMessage=!0),!_cdnSentMessage&&_self.context.internal.sdkSrc&&-1!=_self.context.internal.sdkSrc.indexOf("az416426")&&isFeatureEnabled("CdnUsage",_config,!0)&&(_throttleMgr.sendMessage(110,"See Cdn support notice at aka.ms/JsActiveCdn"),_cdnSentMessage=!0),!_sdkVerSentMessage&&parseInt(_snippetVersion)<6&&isFeatureEnabled("SdkLoaderVer",_config,!0)&&(_throttleMgr.sendMessage(111,"An updated Sdk Loader is available, see aka.ms/SnippetVer"),_sdkVerSentMessage=!0)}))}),_self},_self.updateSnippetDefinitions=function(snippet){!function proxyAssign(target,source,chkSet){if(target&&source&&isObject(target)&&isObject(source)){var _loop_1=function(field){if(isString(field)){var value=source[field];isFunction(value)?chkSet&&!chkSet(field,!0,source,target)||(target[field]=_createProxyFunction(source,field)):chkSet&&!chkSet(field,!1,source,target)||(objHasOwn(target,field)&&delete target[field],objDefine(target,field,{g:function(){return source[field]},s:function(theValue){source[field]=theValue}}))}};for(var field in source)_loop_1(field)}return target}(snippet,_self,function(name){return name&&-1===arrIndexOf(_ignoreUpdateSnippetProperties,name)})},_self.emptyQueue=function(){try{if(isArray(_self.snippet.queue)){for(var length_1=_self.snippet.queue.length,i=0;i<length_1;i++){(0,_self.snippet.queue[i])()}_self.snippet.queue=void 0,delete _self.snippet.queue}}catch(exception){exception&&isFunction(exception.toString)&&exception.toString()}},_self.addHousekeepingBeforeUnload=function(appInsightsInstance){if(hasWindow()||hasDocument()){var performHousekeeping_1=function(){if(appInsightsInstance.onunloadFlush(!1),isFunction(_self.core.getPlugin)){var loadedPlugin=_this.core.getPlugin("AppInsightsPropertiesPlugin");if(loadedPlugin){var propertiesPlugin=loadedPlugin.plugin;propertiesPlugin&&propertiesPlugin.context&&propertiesPlugin.context._sessionManager&&propertiesPlugin.context._sessionManager.backup()}}},added_1=!1;_houseKeepingNamespace||(_houseKeepingNamespace=mergeEvtNamespace(_evtNamespace,_core.evtNamespace&&_core.evtNamespace())),_addUnloadHook(onConfigChange(_config,function(details){var coreConfig=details.cfg,analyticsPlugin=appInsightsInstance.appInsights,extConfig=createProcessTelemetryContext(null,coreConfig,analyticsPlugin.core).getExtCfg(analyticsPlugin.identifier||"ApplicationInsightsAnalytics");_removePageEventHandlers();var excludePageUnloadEvents=coreConfig.disablePageUnloadEvents;extConfig.disableFlushOnBeforeUnload||(addPageUnloadEventListener(performHousekeeping_1,excludePageUnloadEvents,_houseKeepingNamespace)&&(added_1=!0),addPageHideEventListener(performHousekeeping_1,excludePageUnloadEvents,_houseKeepingNamespace)&&(added_1=!0),added_1||function isReactNative(){var nav=getNavigator();return!(!nav||!nav.product)&&"ReactNative"===nav.product}()||_throwInternal(_core.logger,1,19,"Could not add handler for beforeunload and pagehide")),added_1||extConfig.disableFlushOnUnload||addPageHideEventListener(performHousekeeping_1,excludePageUnloadEvents,_houseKeepingNamespace)}))}},_self.getSender=function(){return _sender},_self.unload=function(isAsync,unloadComplete,cbTimeout){var result,unloadDone=!1;return!1===isAsync||unloadComplete||(result=createPromise(function(resolve){unloadComplete=resolve})),_self.onunloadFlush(isAsync),_removePageEventHandlers(),_core.unload&&_core.unload(isAsync,function _unloadCallback(unloadState){unloadDone||(unloadDone=!0,_initDefaults(),unloadComplete&&unloadComplete(unloadState))},cbTimeout),result},proxyFunctions(_self,_analyticsPlugin,["getCookieMgr","trackEvent","trackPageView","trackPageViewPerformance","trackException","_onerror","trackTrace","trackMetric","startTrackPage","stopTrackPage","startTrackEvent","stopTrackEvent"]),proxyFunctions(_self,function _getCurrentDependencies(){return dependencies},["trackDependencyData","addDependencyListener","addDependencyInitializer"]),proxyFunctions(_self,_core,["addTelemetryInitializer","pollInternalLogs","stopPollingInternalLogs","getPlugin","addPlugin","evtNamespace","addUnloadCb","getTraceCtx","updateCfg","onCfgChange"]),proxyFunctions(_self,function(){var context=properties.context;return context?context.user:null},["setAuthenticatedUserContext","clearAuthenticatedUserContext"])})}return AppInsightsSku.prototype.addDependencyInitializer=function(dependencyInitializer){return null},AppInsightsSku}()}}]);