"use strict";(self.webpackChunkhbc_project_controls=self.webpackChunkhbc_project_controls||[]).push([[76],{"./src/webparts/hbcProjectControls/components/pages/project/BuyoutLogPage.stories.tsx"(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>BuyoutLogPage_stories});var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/react/index.js"),router=__webpack_require__("./src/webparts/hbcProjectControls/router/index.tsx"),tokens=__webpack_require__("./src/webparts/hbcProjectControls/theme/tokens.ts"),AppContext=__webpack_require__("./src/webparts/hbcProjectControls/components/contexts/AppContext.tsx"),useLeads=__webpack_require__("./src/webparts/hbcProjectControls/components/hooks/useLeads.ts"),QueryClientProvider=__webpack_require__("./node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js"),useQuery=__webpack_require__("./node_modules/@tanstack/react-query/build/modern/useQuery.js"),useMutation=__webpack_require__("./node_modules/@tanstack/react-query/build/modern/useMutation.js"),SignalRContext=__webpack_require__("./src/webparts/hbcProjectControls/components/contexts/SignalRContext.tsx"),src=__webpack_require__("./packages/hbc-sp-services/src/index.ts");function useQueryScope(){const{dataServiceMode,selectedProject,isProjectSite}=(0,AppContext.Us)();return react.useMemo(()=>{var _a;const siteUrl="undefined"!=typeof window?window.location.origin:"";return{mode:dataServiceMode,siteContext:isProjectSite?"project":"hub",siteUrl,projectCode:null!==(_a=null==selectedProject?void 0:selectedProject.projectCode)&&void 0!==_a?_a:null}},[dataServiceMode,isProjectSite,null==selectedProject?void 0:selectedProject.projectCode])}const qk={scope:scope=>["scope",scope.mode,scope.siteContext,scope.siteUrl,scope.projectCode],activeProjects:{base:scope=>[...qk.scope(scope),"activeProjects"],list:(scope,filtersHash)=>[...qk.scope(scope),"activeProjects","list",filtersHash],summary:(scope,filtersHash)=>[...qk.scope(scope),"activeProjects","summary",filtersHash],personnelWorkload:(scope,role)=>[...qk.scope(scope),"activeProjects","personnelWorkload",role]},dataMart:{base:scope=>[...qk.scope(scope),"dataMart"],records:(scope,filtersHash)=>[...qk.scope(scope),"dataMart","records",filtersHash],record:(scope,projectCode)=>[...qk.scope(scope),"dataMart","record",projectCode]},compliance:{base:scope=>[...qk.scope(scope),"compliance"],log:(scope,filtersHash)=>[...qk.scope(scope),"compliance","log",filtersHash],summary:scope=>[...qk.scope(scope),"compliance","summary"]},permission:{base:scope=>[...qk.scope(scope),"permission"],templates:scope=>[...qk.scope(scope),"permission","templates"],mappings:scope=>[...qk.scope(scope),"permission","mappings"],assignmentsRoot:scope=>[...qk.scope(scope),"permission","assignments"],assignments:(scope,projectCode)=>[...qk.scope(scope),"permission","assignments",null!=projectCode?projectCode:"all"]},buyout:{base:scope=>[...qk.scope(scope),"buyout"],entries:(scope,projectCode)=>[...qk.scope(scope),"buyout","entries",projectCode],approvalHistory:(scope,projectCode,entryId)=>[...qk.scope(scope),"buyout","approvalHistory",projectCode,entryId],trackingHistory:(scope,projectCode,entryId)=>[...qk.scope(scope),"buyout","trackingHistory",projectCode,entryId],trackingChain:(scope,projectCode)=>[...qk.scope(scope),"buyout","trackingChain",projectCode]}};var queryOptions=__webpack_require__("./node_modules/@tanstack/react-query/build/modern/queryOptions.js");const QUERY_STALE_TIMES={reference:9e5,dashboard:12e4,projectOperational:6e4,dataMart:3e5,compliance:18e4,permissions:3e4,buyout:2e4};function buyoutEntriesOptions(scope,dataService,projectCode){return(0,queryOptions.j)({queryKey:qk.buyout.entries(scope,projectCode),queryFn:async()=>dataService.getBuyoutEntries(projectCode),staleTime:QUERY_STALE_TIMES.buyout})}var useSignalR=__webpack_require__("./src/webparts/hbcProjectControls/components/hooks/useSignalR.ts");function useSignalRQueryInvalidation(options){const queryClient=(0,QueryClientProvider.jE)(),{entityType,queryKeys,projectCode,onInvalidated}=options;(0,useSignalR.k)({entityType,projectCode,onEntityChanged:react.useCallback(()=>{queryKeys.forEach(queryKey=>{queryClient.invalidateQueries({queryKey})}),null==onInvalidated||onInvalidated()},[queryClient,queryKeys,onInvalidated])})}var useHbcOptimisticMutation=__webpack_require__("./src/webparts/hbcProjectControls/tanstack/query/mutations/useHbcOptimisticMutation.ts"),optimisticMutationFlags=__webpack_require__("./src/webparts/hbcProjectControls/tanstack/query/mutations/optimisticMutationFlags.ts");function appendBuyoutEntryOptimistic(entries,entry){return[...entries,entry].sort((a,b)=>a.divisionCode.localeCompare(b.divisionCode))}function replaceBuyoutEntryOptimistic(entries,entryId,patch){return entries.map(entry=>entry.id===entryId?Object.assign(Object.assign({},entry),patch):entry)}var usePersistedState=__webpack_require__("./src/webparts/hbcProjectControls/components/hooks/usePersistedState.ts");function useCommitmentApproval(){const{dataService,currentUser}=(0,AppContext.Us)(),{broadcastChange}=(0,SignalRContext.$)(),scope=useQueryScope(),queryClient=(0,QueryClientProvider.jE)(),[localError,setLocalError]=react.useState(null);useSignalRQueryInvalidation({entityType:src.ckT.RiskCost,queryKeys:[qk.buyout.base(scope)]});const submitMutation=(0,useMutation.n)({mutationFn:async vars=>dataService.submitCommitmentForApproval(vars.projectCode,vars.entryId,vars.submittedBy),onSuccess:async(_result,vars)=>{await queryClient.invalidateQueries({queryKey:qk.buyout.entries(scope,vars.projectCode)})}}),respondMutation=(0,useMutation.n)({mutationFn:async vars=>dataService.respondToCommitmentApproval(vars.projectCode,vars.entryId,vars.approved,vars.comment,vars.escalate),onSuccess:async(_result,vars)=>{await queryClient.invalidateQueries({queryKey:qk.buyout.entries(scope,vars.projectCode)})}}),broadcastCommitmentChange=react.useCallback((entryId,action,projectCode,summary)=>{var _a;broadcastChange({type:"EntityChanged",entityType:src.ckT.RiskCost,entityId:String(entryId),action,changedBy:null!==(_a=null==currentUser?void 0:currentUser.email)&&void 0!==_a?_a:"unknown",changedByName:null==currentUser?void 0:currentUser.displayName,projectCode,timestamp:(new Date).toISOString(),summary})},[broadcastChange,currentUser]),submitForApproval=react.useCallback(async(projectCode,entryId,submittedBy)=>{setLocalError(null);try{const result=await submitMutation.mutateAsync({projectCode,entryId,submittedBy});return broadcastCommitmentChange(entryId,"updated",projectCode,"Commitment submitted for approval"),dataService.syncToDataMart(projectCode).catch(()=>{}),result}catch(err){const msg=err instanceof Error?err.message:"Failed to submit commitment";throw setLocalError(msg),err}},[submitMutation,broadcastCommitmentChange,dataService]),respondToApproval=react.useCallback(async(projectCode,entryId,approved,comment,escalate)=>{setLocalError(null);try{const result=await respondMutation.mutateAsync({projectCode,entryId,approved,comment,escalate});return broadcastCommitmentChange(entryId,"updated",projectCode,approved?"Commitment approved":"Commitment rejected"),dataService.syncToDataMart(projectCode).catch(()=>{}),result}catch(err){const msg=err instanceof Error?err.message:"Failed to respond to approval";throw setLocalError(msg),err}},[respondMutation,broadcastCommitmentChange,dataService]),getApprovalHistory=react.useCallback(async(projectCode,entryId)=>{setLocalError(null);try{return await queryClient.fetchQuery(function buyoutApprovalHistoryOptions(scope,dataService,projectCode,entryId){return(0,queryOptions.j)({queryKey:qk.buyout.approvalHistory(scope,projectCode,entryId),queryFn:async()=>dataService.getCommitmentApprovalHistory(projectCode,entryId),staleTime:QUERY_STALE_TIMES.buyout})}(scope,dataService,projectCode,entryId))}catch(err){const msg=err instanceof Error?err.message:"Failed to load approval history";throw setLocalError(msg),err}},[queryClient,scope,dataService]),error=localError;return{loading:submitMutation.isPending||respondMutation.isPending,error,submitForApproval,respondToApproval,getApprovalHistory,setRefreshCallback:_cb=>{}}}function useContractTracking(){const{dataService,currentUser}=(0,AppContext.Us)(),{broadcastChange}=(0,SignalRContext.$)(),scope=useQueryScope(),queryClient=(0,QueryClientProvider.jE)(),[localError,setLocalError]=react.useState(null);useSignalRQueryInvalidation({entityType:src.ckT.ContractTracking,queryKeys:[qk.buyout.base(scope)]});const submitMutation=(0,useMutation.n)({mutationFn:async vars=>dataService.submitContractTracking(vars.projectCode,vars.entryId,vars.submittedBy),onSuccess:async(_result,vars)=>{await queryClient.invalidateQueries({queryKey:qk.buyout.entries(scope,vars.projectCode)})}}),respondMutation=(0,useMutation.n)({mutationFn:async vars=>dataService.respondToContractTracking(vars.projectCode,vars.entryId,vars.approved,vars.comment),onSuccess:async(_result,vars)=>{await queryClient.invalidateQueries({queryKey:qk.buyout.entries(scope,vars.projectCode)})}}),broadcastTrackingChange=react.useCallback((entryId,action,projectCode,summary)=>{var _a;broadcastChange({type:"EntityChanged",entityType:src.ckT.ContractTracking,entityId:String(entryId),action,changedBy:null!==(_a=null==currentUser?void 0:currentUser.email)&&void 0!==_a?_a:"unknown",changedByName:null==currentUser?void 0:currentUser.displayName,projectCode,timestamp:(new Date).toISOString(),summary})},[broadcastChange,currentUser]),submitForTracking=react.useCallback(async(projectCode,entryId,submittedBy)=>{setLocalError(null);try{const result=await submitMutation.mutateAsync({projectCode,entryId,submittedBy});return broadcastTrackingChange(entryId,"updated",projectCode,"Contract tracking submitted"),dataService.syncToDataMart(projectCode).catch(()=>{}),result}catch(err){const msg=err instanceof Error?err.message:"Failed to submit for tracking";throw setLocalError(msg),err}},[submitMutation,broadcastTrackingChange,dataService]),respondToTracking=react.useCallback(async(projectCode,entryId,approved,comment)=>{setLocalError(null);try{const result=await respondMutation.mutateAsync({projectCode,entryId,approved,comment});return broadcastTrackingChange(entryId,"updated",projectCode,approved?"Contract tracking approved":"Contract tracking rejected"),dataService.syncToDataMart(projectCode).catch(()=>{}),result}catch(err){const msg=err instanceof Error?err.message:"Failed to respond to tracking";throw setLocalError(msg),err}},[respondMutation,broadcastTrackingChange,dataService]),getTrackingHistory=react.useCallback(async(projectCode,entryId)=>{setLocalError(null);try{return await queryClient.fetchQuery(function buyoutTrackingHistoryOptions(scope,dataService,projectCode,entryId){return(0,queryOptions.j)({queryKey:qk.buyout.trackingHistory(scope,projectCode,entryId),queryFn:async()=>dataService.getContractTrackingHistory(projectCode,entryId),staleTime:QUERY_STALE_TIMES.buyout})}(scope,dataService,projectCode,entryId))}catch(err){const msg=err instanceof Error?err.message:"Failed to load tracking history";throw setLocalError(msg),err}},[queryClient,scope,dataService]),resolveTrackingChain=react.useCallback(async projectCode=>{setLocalError(null);try{return await queryClient.fetchQuery(function buyoutTrackingChainOptions(scope,dataService,projectCode){return(0,queryOptions.j)({queryKey:qk.buyout.trackingChain(scope,projectCode),queryFn:async()=>dataService.resolveWorkflowChain(src.Rhp.CONTRACT_TRACKING,projectCode),staleTime:QUERY_STALE_TIMES.buyout})}(scope,dataService,projectCode))}catch(err){const msg=err instanceof Error?err.message:"Failed to resolve tracking chain";throw setLocalError(msg),err}},[queryClient,scope,dataService]);return{loading:submitMutation.isPending||respondMutation.isPending,error:localError,submitForTracking,respondToTracking,getTrackingHistory,resolveTrackingChain,setRefreshCallback:_cb=>{}}}const COMPASS_OPTIONS=["Approved","Pending","Expired","Not Registered"],sectionStyle={marginBottom:20,padding:16,border:`1px solid ${tokens.rf.gray200}`,borderRadius:8,backgroundColor:tokens.rf.gray50},labelStyle={display:"block",fontSize:12,fontWeight:600,color:tokens.rf.gray700,marginBottom:4},inputStyle={width:"100%",padding:"6px 10px",fontSize:13,border:`1px solid ${tokens.rf.gray300}`,borderRadius:4,boxSizing:"border-box"},checkboxRowStyle={display:"flex",alignItems:"center",gap:8,padding:"6px 0"},EVERIFY_STATUS_COLORS={"Not Sent":{bg:tokens.rf.gray200,color:tokens.rf.gray700},Sent:{bg:tokens.rf.infoLight,color:"#1E40AF"},"Reminder Sent":{bg:tokens.rf.warningLight,color:"#92400E"},Received:{bg:tokens.rf.successLight,color:"#065F46"},Overdue:{bg:tokens.rf.errorLight,color:"#991B1B"}};const CommitmentForm=({entry,onSubmit,onCancel})=>{var _a,_b,_c,_d,_e,_f,_g,_h,_j;const[qScore,setQScore]=react.useState(entry.qScore),[compassStatus,setCompassStatus]=react.useState(entry.compassPreQualStatus),[scopeMatch,setScopeMatch]=react.useState(null!==(_a=entry.scopeMatchesBudget)&&void 0!==_a&&_a),[exhibitC,setExhibitC]=react.useState(null!==(_b=entry.exhibitCInsuranceConfirmed)&&void 0!==_b&&_b),[exhibitD,setExhibitD]=react.useState(null!==(_c=entry.exhibitDScheduleConfirmed)&&void 0!==_c&&_c),[exhibitE,setExhibitE]=react.useState(null!==(_d=entry.exhibitESafetyConfirmed)&&void 0!==_d&&_d),[errors,setErrors]=react.useState([]),[selectedFile,setSelectedFile]=react.useState(null),[existingFileName]=react.useState(null!==(_e=entry.compiledCommitmentFileName)&&void 0!==_e?_e:""),fileInputRef=react.useRef(null),[eVerifyContractNumber,setEVerifyContractNumber]=react.useState(null!==(_f=entry.eVerifyContractNumber)&&void 0!==_f?_f:""),[eVerifySentDate,setEVerifySentDate]=react.useState(null!==(_g=entry.eVerifySentDate)&&void 0!==_g?_g:""),[eVerifyReminderDate,setEVerifyReminderDate]=react.useState(null!==(_h=entry.eVerifyReminderDate)&&void 0!==_h?_h:""),[eVerifyReceivedDate,setEVerifyReceivedDate]=react.useState(null!==(_j=entry.eVerifyReceivedDate)&&void 0!==_j?_j:""),eVerifyStatus=react.useMemo(()=>function computeEVerifyStatus(sent,reminder,received){if(received)return"Received";if(sent){const sentDate=new Date(sent),now=new Date;return Math.floor((now.getTime()-sentDate.getTime())/864e5)>30?"Overdue":reminder?"Reminder Sent":"Sent"}return"Not Sent"}(eVerifySentDate,eVerifyReminderDate,eVerifyReceivedDate),[eVerifySentDate,eVerifyReminderDate,eVerifyReceivedDate]),riskAssessment=react.useMemo(()=>(0,src.wLN)(Object.assign(Object.assign({},entry),{qScore})),[entry,qScore]);return(0,jsx_runtime.jsxs)("div",{style:{maxWidth:600},children:[(0,jsx_runtime.jsxs)("h3",{style:{margin:"0 0 16px",fontSize:16,fontWeight:700,color:tokens.rf.navy},children:["Commitment Submission: ",entry.divisionDescription]}),riskAssessment.triggers.length>0&&(0,jsx_runtime.jsxs)("div",{style:{padding:12,borderRadius:6,marginBottom:16,backgroundColor:riskAssessment.requiresWaiver?tokens.rf.warningLight:tokens.rf.infoLight,border:`1px solid ${riskAssessment.requiresWaiver?tokens.rf.warning:tokens.rf.info}`},children:[(0,jsx_runtime.jsx)("div",{style:{fontSize:12,fontWeight:700,color:riskAssessment.requiresWaiver?"#92400E":"#1E40AF",marginBottom:4},children:riskAssessment.requiresWaiver?"Waiver Required":"Risk Advisory"}),riskAssessment.triggers.map((t,i)=>(0,jsx_runtime.jsxs)("div",{style:{fontSize:12,color:tokens.rf.gray700,paddingLeft:8},children:["- ",t]},i))]}),(0,jsx_runtime.jsxs)("div",{style:sectionStyle,children:[(0,jsx_runtime.jsx)("div",{style:{fontSize:13,fontWeight:700,color:tokens.rf.navy,marginBottom:12},children:"Risk Profile"}),(0,jsx_runtime.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{style:labelStyle,children:"Q-Score (0-100)"}),(0,jsx_runtime.jsx)("input",{type:"number",min:0,max:100,value:null!=qScore?qScore:"",onChange:e=>setQScore(e.target.value?Number(e.target.value):void 0),style:inputStyle,placeholder:"Enter Q-Score"})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{style:labelStyle,children:"Compass Pre-Qual Status"}),(0,jsx_runtime.jsxs)("select",{value:null!=compassStatus?compassStatus:"",onChange:e=>setCompassStatus(e.target.value||void 0),style:inputStyle,children:[(0,jsx_runtime.jsx)("option",{value:"",children:"Select..."}),COMPASS_OPTIONS.map(opt=>(0,jsx_runtime.jsx)("option",{value:opt,children:opt},opt))]})]})]}),riskAssessment.qScoreWarning&&(0,jsx_runtime.jsx)("div",{style:{fontSize:11,color:tokens.rf.warning,marginTop:6,fontWeight:600},children:"Warning: Q-Score below 70 threshold"})]}),(0,jsx_runtime.jsxs)("div",{style:sectionStyle,children:[(0,jsx_runtime.jsx)("div",{style:{fontSize:13,fontWeight:700,color:tokens.rf.navy,marginBottom:12},children:"Compliance Checklist"}),(0,jsx_runtime.jsxs)("div",{style:checkboxRowStyle,children:[(0,jsx_runtime.jsx)("input",{type:"checkbox",checked:scopeMatch,onChange:e=>setScopeMatch(e.target.checked),id:"scope"}),(0,jsx_runtime.jsx)("label",{htmlFor:"scope",style:{fontSize:13},children:"Scope matches Budget"})]}),(0,jsx_runtime.jsxs)("div",{style:checkboxRowStyle,children:[(0,jsx_runtime.jsx)("input",{type:"checkbox",checked:exhibitC,onChange:e=>setExhibitC(e.target.checked),id:"exhibitC"}),(0,jsx_runtime.jsx)("label",{htmlFor:"exhibitC",style:{fontSize:13},children:"Exhibit C (Insurance) confirmed in PDF"})]}),(0,jsx_runtime.jsxs)("div",{style:checkboxRowStyle,children:[(0,jsx_runtime.jsx)("input",{type:"checkbox",checked:exhibitD,onChange:e=>setExhibitD(e.target.checked),id:"exhibitD"}),(0,jsx_runtime.jsx)("label",{htmlFor:"exhibitD",style:{fontSize:13},children:"Exhibit D (Schedule) confirmed in PDF"})]}),(0,jsx_runtime.jsxs)("div",{style:checkboxRowStyle,children:[(0,jsx_runtime.jsx)("input",{type:"checkbox",checked:exhibitE,onChange:e=>setExhibitE(e.target.checked),id:"exhibitE"}),(0,jsx_runtime.jsx)("label",{htmlFor:"exhibitE",style:{fontSize:13},children:"Exhibit E (Safety) confirmed in PDF"})]}),(0,jsx_runtime.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginTop:8},children:[(0,jsx_runtime.jsxs)("div",{style:checkboxRowStyle,children:[(0,jsx_runtime.jsx)("input",{type:"checkbox",checked:entry.enrolledInSDI,disabled:!0,id:"sdi"}),(0,jsx_runtime.jsx)("label",{htmlFor:"sdi",style:{fontSize:13,color:tokens.rf.gray500},children:"SDI Enrolled"})]}),(0,jsx_runtime.jsxs)("div",{style:checkboxRowStyle,children:[(0,jsx_runtime.jsx)("input",{type:"checkbox",checked:entry.bondRequired,disabled:!0,id:"bond"}),(0,jsx_runtime.jsx)("label",{htmlFor:"bond",style:{fontSize:13,color:tokens.rf.gray500},children:"Bond Required"})]})]})]}),(0,jsx_runtime.jsxs)("div",{style:sectionStyle,children:[(0,jsx_runtime.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[(0,jsx_runtime.jsx)("div",{style:{fontSize:13,fontWeight:700,color:tokens.rf.navy},children:"E-Verify Affidavit Tracking"}),(0,jsx_runtime.jsx)("span",{style:{padding:"2px 10px",borderRadius:12,fontSize:11,fontWeight:600,backgroundColor:EVERIFY_STATUS_COLORS[eVerifyStatus].bg,color:EVERIFY_STATUS_COLORS[eVerifyStatus].color},children:eVerifyStatus})]}),(0,jsx_runtime.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{style:labelStyle,children:"Contract Number"}),(0,jsx_runtime.jsx)("input",{type:"text",value:eVerifyContractNumber,onChange:e=>setEVerifyContractNumber(e.target.value),style:inputStyle,placeholder:"e.g., SC-25-042-01-05-120"})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{style:labelStyle,children:"E-Verify Sent Date"}),(0,jsx_runtime.jsx)("input",{type:"date",value:eVerifySentDate,onChange:e=>setEVerifySentDate(e.target.value),style:inputStyle})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{style:labelStyle,children:"Reminder Sent Date"}),(0,jsx_runtime.jsx)("input",{type:"date",value:eVerifyReminderDate,onChange:e=>setEVerifyReminderDate(e.target.value),style:inputStyle,disabled:!eVerifySentDate})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{style:labelStyle,children:"E-Verify Received Date"}),(0,jsx_runtime.jsx)("input",{type:"date",value:eVerifyReceivedDate,onChange:e=>setEVerifyReceivedDate(e.target.value),style:inputStyle,disabled:!eVerifySentDate})]})]}),"Overdue"===eVerifyStatus&&(0,jsx_runtime.jsx)("div",{style:{fontSize:11,color:tokens.rf.error,marginTop:8,fontWeight:600},children:"E-Verify affidavit is overdue. More than 30 days since sent without receipt."})]}),(0,jsx_runtime.jsxs)("div",{style:sectionStyle,children:[(0,jsx_runtime.jsx)("div",{style:{fontSize:13,fontWeight:700,color:tokens.rf.navy,marginBottom:12},children:"Compiled Commitment Document"}),existingFileName&&!selectedFile&&(0,jsx_runtime.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"8px 12px",backgroundColor:tokens.rf.successLight,borderRadius:6,marginBottom:8},children:[(0,jsx_runtime.jsx)("span",{style:{fontSize:16},children:"ðŸ“„"}),(0,jsx_runtime.jsx)("span",{style:{fontSize:12,color:"#065F46",flex:1},children:existingFileName}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:()=>{var _a;return null===(_a=fileInputRef.current)||void 0===_a?void 0:_a.click()},style:{padding:"4px 8px",fontSize:11,border:`1px solid ${tokens.rf.gray300}`,borderRadius:4,backgroundColor:"#fff",cursor:"pointer",color:tokens.rf.gray700},children:"Replace"})]}),selectedFile&&(0,jsx_runtime.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"8px 12px",backgroundColor:tokens.rf.infoLight,borderRadius:6,marginBottom:8},children:[(0,jsx_runtime.jsx)("span",{style:{fontSize:16},children:"ðŸ“„"}),(0,jsx_runtime.jsxs)("span",{style:{fontSize:12,color:"#1E40AF",flex:1},children:[selectedFile.name," (",(selectedFile.size/1024).toFixed(0)," KB)"]}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:()=>{setSelectedFile(null),fileInputRef.current&&(fileInputRef.current.value="")},style:{padding:"4px 8px",fontSize:11,border:`1px solid ${tokens.rf.error}`,borderRadius:4,backgroundColor:"#fff",cursor:"pointer",color:tokens.rf.error},children:"Remove"})]}),!existingFileName&&!selectedFile&&(0,jsx_runtime.jsxs)("div",{onClick:()=>{var _a;return null===(_a=fileInputRef.current)||void 0===_a?void 0:_a.click()},style:{border:`2px dashed ${tokens.rf.gray300}`,borderRadius:8,padding:"20px 16px",textAlign:"center",cursor:"pointer",backgroundColor:"#fff",transition:"border-color 0.15s"},onMouseEnter:e=>e.currentTarget.style.borderColor=tokens.rf.info,onMouseLeave:e=>e.currentTarget.style.borderColor=tokens.rf.gray300,children:[(0,jsx_runtime.jsx)("div",{style:{fontSize:24,marginBottom:4},children:"ðŸ“‚"}),(0,jsx_runtime.jsx)("div",{style:{fontSize:12,color:tokens.rf.gray600,fontWeight:600},children:"Click to upload compiled commitment PDF"}),(0,jsx_runtime.jsx)("div",{style:{fontSize:11,color:tokens.rf.gray400,marginTop:2},children:"PDF files only, max 25MB"})]}),(0,jsx_runtime.jsx)("input",{ref:fileInputRef,type:"file",accept:".pdf,application/pdf",onChange:e=>{var _a;const file=null===(_a=e.target.files)||void 0===_a?void 0:_a[0];if(file){if("application/pdf"!==file.type)return void setErrors(prev=>[...prev,"Only PDF files are accepted"]);if(file.size>26214400)return void setErrors(prev=>[...prev,"File size must be less than 25MB"]);setSelectedFile(file)}},style:{display:"none"}})]}),errors.length>0&&(0,jsx_runtime.jsx)("div",{style:{padding:12,borderRadius:6,marginBottom:16,backgroundColor:tokens.rf.errorLight,border:`1px solid ${tokens.rf.error}`},children:errors.map((err,i)=>(0,jsx_runtime.jsxs)("div",{style:{fontSize:12,color:"#991B1B"},children:["- ",err]},i))}),(0,jsx_runtime.jsxs)("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[(0,jsx_runtime.jsx)("button",{type:"button",onClick:onCancel,style:{padding:"8px 16px",borderRadius:4,border:`1px solid ${tokens.rf.gray300}`,backgroundColor:"#fff",color:tokens.rf.gray700,cursor:"pointer",fontSize:13},children:"Cancel"}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:()=>{const validationErrors=(()=>{const errs=[];return(null==qScore||qScore<0||qScore>100)&&errs.push("Q-Score must be between 0 and 100"),compassStatus||errs.push("Compass Pre-Qual status is required"),scopeMatch||errs.push("Scope must match budget confirmation is required"),exhibitC||errs.push("Exhibit C (Insurance) confirmation is required"),exhibitD||errs.push("Exhibit D (Schedule) confirmation is required"),exhibitE||errs.push("Exhibit E (Safety) confirmation is required"),selectedFile||existingFileName||errs.push("Compiled Commitment PDF is required"),errs})();validationErrors.length>0?setErrors(validationErrors):(setErrors([]),onSubmit({qScore,compassPreQualStatus:compassStatus,scopeMatchesBudget:scopeMatch,exhibitCInsuranceConfirmed:exhibitC,exhibitDScheduleConfirmed:exhibitD,exhibitESafetyConfirmed:exhibitE,eVerifyContractNumber,eVerifySentDate:eVerifySentDate||void 0,eVerifyReminderDate:eVerifyReminderDate||void 0,eVerifyReceivedDate:eVerifyReceivedDate||void 0,eVerifyStatus},null!=selectedFile?selectedFile:void 0))},style:{padding:"8px 16px",borderRadius:4,border:"none",backgroundColor:tokens.rf.navy,color:"#fff",cursor:"pointer",fontSize:13,fontWeight:600},children:"Submit for Approval"})]})]})};try{CommitmentForm.displayName="CommitmentForm",CommitmentForm.__docgenInfo={description:"",displayName:"CommitmentForm",props:{entry:{defaultValue:null,description:"",name:"entry",required:!0,type:{name:"IBuyoutEntry"}},onSubmit:{defaultValue:null,description:"",name:"onSubmit",required:!0,type:{name:"(data: Partial<IBuyoutEntry>, file?: File | undefined) => void"}},onCancel:{defaultValue:null,description:"",name:"onCancel",required:!0,type:{name:"() => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/webparts/hbcProjectControls/components/pages/project/CommitmentForm.tsx#CommitmentForm"]={docgenInfo:CommitmentForm.__docgenInfo,name:"CommitmentForm",path:"src/webparts/hbcProjectControls/components/pages/project/CommitmentForm.tsx#CommitmentForm"})}catch(__react_docgen_typescript_loader_error){}const STATUS_CONFIG={Budgeted:{label:"Budgeted",bg:tokens.rf.gray100,color:tokens.rf.gray700},PendingReview:{label:"Pending PX Review",bg:tokens.rf.warningLight,color:"#92400E"},WaiverPending:{label:"Waiver Pending",bg:"#FFF7ED",color:"#C2410C"},PXApproved:{label:"PX Approved",bg:"#DBEAFE",color:"#1E40AF"},ComplianceReview:{label:"Compliance Review",bg:"#F3E8FF",color:"#6B21A8"},CFOReview:{label:"CFO Review",bg:tokens.rf.errorLight,color:"#991B1B"},Committed:{label:"Fully Committed",bg:tokens.rf.successLight,color:"#065F46"},Rejected:{label:"Rejected",bg:tokens.rf.errorLight,color:"#991B1B"}},stepLabel=step=>{switch(step){case"PX":return"Project Executive";case"ComplianceManager":return"Compliance Manager";case"CFO":return"Chief Financial Officer";default:return step}},approvalStatusColor=status=>{switch(status){case"Approved":return tokens.rf.success;case"Rejected":return tokens.rf.error;case"Escalated":return tokens.rf.warning;default:return tokens.rf.gray400}},CommitmentApprovalPanel=({entry,canApprovePX,canApproveCompliance,canApproveCFO,canEscalate,onApprove,onReject,onEscalate})=>{var _a;const[comment,setComment]=react.useState(""),statusConfig=STATUS_CONFIG[entry.commitmentStatus]||STATUS_CONFIG.Budgeted,currentStep=entry.currentApprovalStep,canAct="PX"===currentStep&&canApprovePX||"ComplianceManager"===currentStep&&canApproveCompliance||"CFO"===currentStep&&canApproveCFO,history=entry.approvalHistory||[];return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{style:{display:"inline-block",padding:"4px 12px",borderRadius:12,fontSize:12,fontWeight:700,backgroundColor:statusConfig.bg,color:statusConfig.color,marginBottom:16},children:statusConfig.label}),currentStep&&(0,jsx_runtime.jsxs)("div",{style:{padding:12,borderRadius:6,border:`2px solid ${tokens.rf.orange}`,marginBottom:16},children:[(0,jsx_runtime.jsxs)("div",{style:{fontSize:12,fontWeight:700,color:tokens.rf.orange,marginBottom:4},children:["Pending: ",stepLabel(currentStep)]}),entry.waiverRequired&&(0,jsx_runtime.jsxs)("div",{style:{fontSize:11,color:tokens.rf.gray600},children:["Waiver Type: ",null!==(_a=entry.waiverType)&&void 0!==_a?_a:"N/A",entry.waiverReason&&` â€” ${entry.waiverReason}`]})]}),canAct&&(0,jsx_runtime.jsxs)("div",{style:{marginBottom:16},children:[(0,jsx_runtime.jsx)("textarea",{value:comment,onChange:e=>setComment(e.target.value),placeholder:"Comment (optional)...",style:{width:"100%",border:`1px solid ${tokens.rf.gray200}`,borderRadius:4,padding:8,fontSize:12,minHeight:40,resize:"vertical",marginBottom:8,boxSizing:"border-box"}}),(0,jsx_runtime.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,jsx_runtime.jsx)("button",{type:"button",onClick:()=>{onApprove(comment),setComment("")},style:{flex:1,padding:8,backgroundColor:tokens.rf.success,color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontSize:13,fontWeight:600},children:"Approve"}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:()=>{onReject(comment),setComment("")},style:{flex:1,padding:8,backgroundColor:tokens.rf.error,color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontSize:13,fontWeight:600},children:"Reject"}),canEscalate&&"ComplianceManager"===currentStep&&(0,jsx_runtime.jsx)("button",{type:"button",onClick:()=>{onEscalate(comment),setComment("")},style:{flex:1,padding:8,backgroundColor:tokens.rf.warning,color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontSize:13,fontWeight:600},children:"Escalate to CFO"})]})]}),history.length>0&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{style:{fontSize:13,fontWeight:700,color:tokens.rf.navy,marginBottom:8},children:"Approval History"}),history.map((step,i)=>(0,jsx_runtime.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:10,padding:"8px 0",borderBottom:i<history.length-1?`1px solid ${tokens.rf.gray100}`:"none"},children:[(0,jsx_runtime.jsx)("div",{style:{width:8,height:8,borderRadius:"50%",backgroundColor:approvalStatusColor(step.status),marginTop:4,flexShrink:0}}),(0,jsx_runtime.jsxs)("div",{style:{flex:1},children:[(0,jsx_runtime.jsxs)("div",{style:{fontSize:12,fontWeight:600,color:tokens.rf.gray800},children:[stepLabel(step.step)," â€” ",step.approverName]}),(0,jsx_runtime.jsx)("div",{style:{fontSize:11,color:approvalStatusColor(step.status),fontWeight:600},children:step.status}),step.comment&&(0,jsx_runtime.jsxs)("div",{style:{fontSize:11,color:tokens.rf.gray500,fontStyle:"italic",marginTop:2},children:["â€œ",step.comment,"â€"]}),step.actionDate&&(0,jsx_runtime.jsx)("div",{style:{fontSize:10,color:tokens.rf.gray400,marginTop:2},children:new Date(step.actionDate).toLocaleString()})]})]},step.id||i))]})]})};try{CommitmentApprovalPanel.displayName="CommitmentApprovalPanel",CommitmentApprovalPanel.__docgenInfo={description:"",displayName:"CommitmentApprovalPanel",props:{entry:{defaultValue:null,description:"",name:"entry",required:!0,type:{name:"IBuyoutEntry"}},canApprovePX:{defaultValue:null,description:"",name:"canApprovePX",required:!0,type:{name:"boolean"}},canApproveCompliance:{defaultValue:null,description:"",name:"canApproveCompliance",required:!0,type:{name:"boolean"}},canApproveCFO:{defaultValue:null,description:"",name:"canApproveCFO",required:!0,type:{name:"boolean"}},canEscalate:{defaultValue:null,description:"",name:"canEscalate",required:!0,type:{name:"boolean"}},onApprove:{defaultValue:null,description:"",name:"onApprove",required:!0,type:{name:"(comment: string) => void"}},onReject:{defaultValue:null,description:"",name:"onReject",required:!0,type:{name:"(comment: string) => void"}},onEscalate:{defaultValue:null,description:"",name:"onEscalate",required:!0,type:{name:"(comment: string) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/webparts/hbcProjectControls/components/pages/project/CommitmentApprovalPanel.tsx#CommitmentApprovalPanel"]={docgenInfo:CommitmentApprovalPanel.__docgenInfo,name:"CommitmentApprovalPanel",path:"src/webparts/hbcProjectControls/components/pages/project/CommitmentApprovalPanel.tsx#CommitmentApprovalPanel"})}catch(__react_docgen_typescript_loader_error){}const STEP_ORDER=["APM_PA","ProjectManager","RiskManager","ProjectExecutive"],STEP_LABELS={APM_PA:"APM / PA",ProjectManager:"Project Manager",RiskManager:"Risk Manager",ProjectExecutive:"Project Executive"},ContractTrackingPanel_STATUS_CONFIG={NotStarted:{label:"Not Started",bg:tokens.rf.gray200,color:tokens.rf.gray700},PendingAPM:{label:"APM/PA Review",bg:tokens.rf.warningLight,color:"#92400E"},PendingPM:{label:"PM Review",bg:"#DBEAFE",color:"#1E40AF"},PendingRiskMgr:{label:"Risk Review",bg:"#F3E8FF",color:"#6B21A8"},PendingPX:{label:"PX Review",bg:"#FEF3C7",color:"#92400E"},Tracked:{label:"Tracked",bg:tokens.rf.successLight,color:"#065F46"},Rejected:{label:"Rejected",bg:tokens.rf.errorLight,color:"#991B1B"}},ContractTrackingPanel_approvalStatusColor=status=>{switch(status){case"Approved":return tokens.rf.success;case"Rejected":return tokens.rf.error;case"Skipped":return tokens.rf.gray400;default:return tokens.rf.warning}},ContractTrackingPanel=({entry,canApproveAPM,canApprovePM,canApproveRisk,canApprovePX,onApprove,onReject,resolvedChain})=>{const[comment,setComment]=react.useState(""),status=entry.contractTrackingStatus||"NotStarted",currentStep=entry.currentContractTrackingStep,statusConfig=ContractTrackingPanel_STATUS_CONFIG[status]||ContractTrackingPanel_STATUS_CONFIG.NotStarted,canAct="APM_PA"===currentStep&&canApproveAPM||"ProjectManager"===currentStep&&canApprovePM||"RiskManager"===currentStep&&canApproveRisk||"ProjectExecutive"===currentStep&&canApprovePX,history=entry.contractTrackingHistory||[];return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{style:{display:"inline-block",padding:"4px 12px",borderRadius:12,fontSize:12,fontWeight:700,backgroundColor:statusConfig.bg,color:statusConfig.color,marginBottom:16},children:statusConfig.label}),(0,jsx_runtime.jsx)("div",{style:{display:"flex",alignItems:"center",gap:0,marginBottom:20,padding:"0 8px"},children:STEP_ORDER.map((step,i)=>{const state=(step=>{const record=history.find(h=>h.step===step);return"Skipped"===(null==record?void 0:record.status)?"skipped":"Approved"===(null==record?void 0:record.status)?"past":step===currentStep?"current":"future"})(step),circleColor="past"===state?tokens.rf.success:"current"===state?tokens.rf.orange:"skipped"===state?tokens.rf.gray300:tokens.rf.gray200,textColor="past"===state?tokens.rf.success:"current"===state?tokens.rf.orange:tokens.rf.gray400;return(0,jsx_runtime.jsxs)(react.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",flex:1},children:[(0,jsx_runtime.jsx)("div",{style:{width:28,height:28,borderRadius:"50%",backgroundColor:circleColor,display:"flex",alignItems:"center",justifyContent:"center",color:"future"===state||"skipped"===state?tokens.rf.gray500:"#fff",fontSize:12,fontWeight:700},children:"past"===state?"âœ“":"skipped"===state?"â€”":i+1}),(0,jsx_runtime.jsx)("div",{style:{fontSize:10,color:textColor,fontWeight:600,marginTop:4,textAlign:"center"},children:STEP_LABELS[step]})]}),i<STEP_ORDER.length-1&&(0,jsx_runtime.jsx)("div",{style:{flex:.5,height:2,backgroundColor:"past"===state?tokens.rf.success:tokens.rf.gray200,marginTop:-14}})]},step)})}),currentStep&&(0,jsx_runtime.jsx)("div",{style:{padding:12,borderRadius:6,border:`2px solid ${tokens.rf.orange}`,marginBottom:16},children:(0,jsx_runtime.jsxs)("div",{style:{fontSize:12,fontWeight:700,color:tokens.rf.orange,marginBottom:4},children:["Pending: ",STEP_LABELS[currentStep]," â€” ",(step=>{var _a;const record=history.find(h=>h.step===step);if(record)return record.approverName;const chainStep=null==resolvedChain?void 0:resolvedChain.find(s=>{const stepIdx=STEP_ORDER.indexOf(step);return s.stepOrder===stepIdx+1});return(null===(_a=null==chainStep?void 0:chainStep.assignee)||void 0===_a?void 0:_a.displayName)?chainStep.assignee.displayName:STEP_LABELS[step]})(currentStep)]})}),canAct&&(0,jsx_runtime.jsxs)("div",{style:{marginBottom:16},children:[(0,jsx_runtime.jsx)("textarea",{value:comment,onChange:e=>setComment(e.target.value),placeholder:"Comment (optional)...",style:{width:"100%",border:`1px solid ${tokens.rf.gray200}`,borderRadius:4,padding:8,fontSize:12,minHeight:40,resize:"vertical",marginBottom:8,boxSizing:"border-box"}}),(0,jsx_runtime.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,jsx_runtime.jsx)("button",{type:"button",onClick:()=>{onApprove(comment),setComment("")},style:{flex:1,padding:8,backgroundColor:tokens.rf.success,color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontSize:13,fontWeight:600},children:"Approve"}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:()=>{onReject(comment),setComment("")},style:{flex:1,padding:8,backgroundColor:tokens.rf.error,color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontSize:13,fontWeight:600},children:"Reject"})]})]}),history.length>0&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{style:{fontSize:13,fontWeight:700,color:tokens.rf.navy,marginBottom:8},children:"Tracking History"}),history.map((step,i)=>(0,jsx_runtime.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:10,padding:"8px 0",borderBottom:i<history.length-1?`1px solid ${tokens.rf.gray100}`:"none"},children:[(0,jsx_runtime.jsx)("div",{style:{width:8,height:8,borderRadius:"50%",backgroundColor:ContractTrackingPanel_approvalStatusColor(step.status),marginTop:4,flexShrink:0}}),(0,jsx_runtime.jsxs)("div",{style:{flex:1},children:[(0,jsx_runtime.jsxs)("div",{style:{fontSize:12,fontWeight:600,color:tokens.rf.gray800},children:[STEP_LABELS[step.step]," â€” ",step.approverName]}),(0,jsx_runtime.jsx)("div",{style:{fontSize:11,color:ContractTrackingPanel_approvalStatusColor(step.status),fontWeight:600},children:step.status}),step.comment&&(0,jsx_runtime.jsxs)("div",{style:{fontSize:11,color:tokens.rf.gray500,fontStyle:"italic",marginTop:2},children:["â€œ",step.comment,"â€"]}),step.skippedReason&&(0,jsx_runtime.jsx)("div",{style:{fontSize:11,color:tokens.rf.gray400,fontStyle:"italic",marginTop:2},children:step.skippedReason}),step.actionDate&&(0,jsx_runtime.jsx)("div",{style:{fontSize:10,color:tokens.rf.gray400,marginTop:2},children:new Date(step.actionDate).toLocaleString()})]})]},step.id||i))]})]})};try{ContractTrackingPanel.displayName="ContractTrackingPanel",ContractTrackingPanel.__docgenInfo={description:"",displayName:"ContractTrackingPanel",props:{entry:{defaultValue:null,description:"",name:"entry",required:!0,type:{name:"IBuyoutEntry"}},canApproveAPM:{defaultValue:null,description:"",name:"canApproveAPM",required:!0,type:{name:"boolean"}},canApprovePM:{defaultValue:null,description:"",name:"canApprovePM",required:!0,type:{name:"boolean"}},canApproveRisk:{defaultValue:null,description:"",name:"canApproveRisk",required:!0,type:{name:"boolean"}},canApprovePX:{defaultValue:null,description:"",name:"canApprovePX",required:!0,type:{name:"boolean"}},onApprove:{defaultValue:null,description:"",name:"onApprove",required:!0,type:{name:"(comment: string) => void"}},onReject:{defaultValue:null,description:"",name:"onReject",required:!0,type:{name:"(comment: string) => void"}},resolvedChain:{defaultValue:null,description:"",name:"resolvedChain",required:!1,type:{name:"IResolvedWorkflowStep[]"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/webparts/hbcProjectControls/components/pages/project/ContractTrackingPanel.tsx#ContractTrackingPanel"]={docgenInfo:ContractTrackingPanel.__docgenInfo,name:"ContractTrackingPanel",path:"src/webparts/hbcProjectControls/components/pages/project/ContractTrackingPanel.tsx#ContractTrackingPanel"})}catch(__react_docgen_typescript_loader_error){}const fmt=n=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(n),ContractTrackingSubmitModal_STEP_ORDER=["APM_PA","ProjectManager","RiskManager","ProjectExecutive"],ContractTrackingSubmitModal_STEP_LABELS={APM_PA:"APM / PA",ProjectManager:"Project Manager",RiskManager:"Risk Manager",ProjectExecutive:"Project Executive"},ContractTrackingSubmitModal=({entry,resolvedChain,loading,onSubmit,onClose})=>{const{isFeatureEnabled}=(0,AppContext.Us)(),[submitted,setSubmitted]=react.useState(!1),[previewEntry,setPreviewEntry]=react.useState(null),showDevPreview=isFeatureEnabled("ContractTrackingDevPreview");return submitted&&previewEntry&&showDevPreview?(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{style:{padding:"8px 12px",borderRadius:6,marginBottom:16,backgroundColor:"#FFF7ED",border:`1px solid ${tokens.rf.warning}`,fontSize:11,fontWeight:600,color:"#92400E"},children:"Dev Preview â€” Next approver view"}),(0,jsx_runtime.jsxs)("h3",{style:{margin:"0 0 12px",fontSize:15,fontWeight:700,color:tokens.rf.navy},children:[entry.divisionDescription," â€” ",entry.subcontractorName||"TBD"]}),(0,jsx_runtime.jsx)("div",{style:Object.assign(Object.assign({},cardStyle),{padding:12,marginBottom:16,fontSize:12}),children:(0,jsx_runtime.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("span",{style:ContractTrackingSubmitModal_labelStyle,children:"Division:"})," ",entry.divisionCode," â€” ",entry.divisionDescription]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("span",{style:ContractTrackingSubmitModal_labelStyle,children:"Subcontractor:"})," ",entry.subcontractorName||"â€”"]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("span",{style:ContractTrackingSubmitModal_labelStyle,children:"Contract Value:"})," ",null!=entry.contractValue?fmt(entry.contractValue):"â€”"]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("span",{style:ContractTrackingSubmitModal_labelStyle,children:"Status:"})," ",entry.commitmentStatus]})]})}),(0,jsx_runtime.jsx)(ContractTrackingPanel,{entry:previewEntry,canApproveAPM:!1,canApprovePM:!1,canApproveRisk:!1,canApprovePX:!1,onApprove:()=>{},onReject:()=>{},resolvedChain}),(0,jsx_runtime.jsx)("div",{style:{marginTop:16,textAlign:"right"},children:(0,jsx_runtime.jsx)("button",{onClick:onClose,style:btnOutline,children:"Close"})})]}):(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{style:{margin:"0 0 16px",fontSize:16,fontWeight:700,color:tokens.rf.navy},children:"Submit for Contract Tracking"}),(0,jsx_runtime.jsx)("div",{style:Object.assign(Object.assign({},cardStyle),{padding:16,marginBottom:20,fontSize:13}),children:(0,jsx_runtime.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("span",{style:ContractTrackingSubmitModal_labelStyle,children:"Division:"})," ",entry.divisionCode," â€” ",entry.divisionDescription]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("span",{style:ContractTrackingSubmitModal_labelStyle,children:"Subcontractor:"})," ",entry.subcontractorName||"â€”"]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("span",{style:ContractTrackingSubmitModal_labelStyle,children:"Contract Value:"})," ",null!=entry.contractValue?fmt(entry.contractValue):"â€”"]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("span",{style:ContractTrackingSubmitModal_labelStyle,children:"Commitment:"})," ",entry.commitmentStatus]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("span",{style:ContractTrackingSubmitModal_labelStyle,children:"SDI:"})," ",(0,jsx_runtime.jsx)("span",{style:{color:entry.enrolledInSDI?tokens.rf.success:tokens.rf.gray400},children:entry.enrolledInSDI?"Yes":"No"})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("span",{style:ContractTrackingSubmitModal_labelStyle,children:"Bond:"})," ",(0,jsx_runtime.jsx)("span",{style:{color:entry.bondRequired?tokens.rf.warning:tokens.rf.gray400},children:entry.bondRequired?"Required":"No"})]})]})}),(0,jsx_runtime.jsxs)("div",{style:{marginBottom:20},children:[(0,jsx_runtime.jsx)("div",{style:{fontSize:13,fontWeight:700,color:tokens.rf.navy,marginBottom:10},children:"Approval Chain"}),ContractTrackingSubmitModal_STEP_ORDER.map((step,i)=>{var _a,_b;const chainStep=resolvedChain.find(s=>s.stepOrder===i+1),isSkipped=null==chainStep?void 0:chainStep.skipped,assignee=null!==(_b=null===(_a=null==chainStep?void 0:chainStep.assignee)||void 0===_a?void 0:_a.displayName)&&void 0!==_b?_b:ContractTrackingSubmitModal_STEP_LABELS[step];return(0,jsx_runtime.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"8px 12px",marginBottom:4,borderRadius:6,backgroundColor:isSkipped?tokens.rf.gray50:"#fff",border:`1px solid ${tokens.rf.gray200}`,opacity:isSkipped?.6:1},children:[(0,jsx_runtime.jsx)("div",{style:{width:24,height:24,borderRadius:"50%",backgroundColor:isSkipped?tokens.rf.gray300:tokens.rf.navy,color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:11,fontWeight:700,flexShrink:0},children:i+1}),(0,jsx_runtime.jsxs)("div",{style:{flex:1},children:[(0,jsx_runtime.jsxs)("div",{style:{fontSize:12,fontWeight:600,color:isSkipped?tokens.rf.gray400:tokens.rf.gray800},children:[ContractTrackingSubmitModal_STEP_LABELS[step],isSkipped&&(0,jsx_runtime.jsx)("span",{style:{fontSize:10,color:tokens.rf.gray400,marginLeft:8},children:"(Skipped)"})]}),(0,jsx_runtime.jsx)("div",{style:{fontSize:11,color:tokens.rf.gray500},children:assignee})]})]},step)})]}),(0,jsx_runtime.jsxs)("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[(0,jsx_runtime.jsx)("button",{onClick:onClose,style:btnOutline,children:"Cancel"}),(0,jsx_runtime.jsx)("button",{onClick:()=>{var _a,_b,_c,_d,_e,_f;if(onSubmit(),showDevPreview){const firstSkipped=resolvedChain.find(s=>1===s.stepOrder&&s.skipped),firstStep=firstSkipped?"ProjectManager":"APM_PA";setPreviewEntry(Object.assign(Object.assign({},entry),{contractTrackingStatus:"APM_PA"===firstStep?"PendingAPM":"PendingPM",currentContractTrackingStep:firstStep,contractTrackingHistory:[...firstSkipped?[{id:-2,buyoutEntryId:entry.id,projectCode:entry.projectCode,step:"APM_PA",approverName:"N/A",approverEmail:"",status:"Skipped",actionDate:(new Date).toISOString(),skippedReason:"No APM/PA assigned for this project"}]:[],{id:-1,buyoutEntryId:entry.id,projectCode:entry.projectCode,step:firstStep,approverName:null!==(_c=null===(_b=null===(_a=resolvedChain.find(s=>s.stepOrder===(firstSkipped?2:1)))||void 0===_a?void 0:_a.assignee)||void 0===_b?void 0:_b.displayName)&&void 0!==_c?_c:ContractTrackingSubmitModal_STEP_LABELS[firstStep],approverEmail:null!==(_f=null===(_e=null===(_d=resolvedChain.find(s=>s.stepOrder===(firstSkipped?2:1)))||void 0===_d?void 0:_d.assignee)||void 0===_e?void 0:_e.email)&&void 0!==_f?_f:"",status:"Pending"}]})),setSubmitted(!0)}},disabled:loading,style:Object.assign(Object.assign({},btnPrimary),{opacity:loading?.7:1,cursor:loading?"not-allowed":"pointer"}),children:loading?"Submitting...":"Submit for Tracking"})]})]})},cardStyle={backgroundColor:"#fff",borderRadius:8,border:`1px solid ${tokens.rf.gray200}`,boxShadow:tokens.sp.level1},ContractTrackingSubmitModal_labelStyle={fontWeight:600,color:tokens.rf.gray600},btnPrimary={padding:"8px 20px",backgroundColor:tokens.rf.navy,color:"#fff",border:"none",borderRadius:6,fontWeight:600,fontSize:14,cursor:"pointer"},btnOutline={padding:"8px 20px",backgroundColor:"#fff",color:tokens.rf.gray600,border:`1px solid ${tokens.rf.gray300}`,borderRadius:6,fontWeight:500,fontSize:14,cursor:"pointer"};try{ContractTrackingSubmitModal.displayName="ContractTrackingSubmitModal",ContractTrackingSubmitModal.__docgenInfo={description:"",displayName:"ContractTrackingSubmitModal",props:{entry:{defaultValue:null,description:"",name:"entry",required:!0,type:{name:"IBuyoutEntry"}},resolvedChain:{defaultValue:null,description:"",name:"resolvedChain",required:!0,type:{name:"IResolvedWorkflowStep[]"}},loading:{defaultValue:null,description:"",name:"loading",required:!0,type:{name:"boolean"}},onSubmit:{defaultValue:null,description:"",name:"onSubmit",required:!0,type:{name:"() => void"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/webparts/hbcProjectControls/components/pages/project/ContractTrackingSubmitModal.tsx#ContractTrackingSubmitModal"]={docgenInfo:ContractTrackingSubmitModal.__docgenInfo,name:"ContractTrackingSubmitModal",path:"src/webparts/hbcProjectControls/components/pages/project/ContractTrackingSubmitModal.tsx#ContractTrackingSubmitModal"})}catch(__react_docgen_typescript_loader_error){}var SkeletonLoader=__webpack_require__("./src/webparts/hbcProjectControls/components/shared/SkeletonLoader.tsx"),ToastContainer=__webpack_require__("./src/webparts/hbcProjectControls/components/shared/ToastContainer.tsx");const BuyoutLogPage_fmt=n=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(n),STATUS_OPTIONS=["Not Started","In Progress","Awarded","Executed"],statusColor=s=>{switch(s){case"Executed":return tokens.rf.success;case"Awarded":return"#3B82F6";case"In Progress":return tokens.rf.warning;default:return tokens.rf.gray400}},COMMITMENT_STATUS_CONFIG={Budgeted:{label:"Budgeted",bg:tokens.rf.gray200,color:tokens.rf.gray700},PendingReview:{label:"Pending Review",bg:tokens.rf.warningLight,color:"#92400E"},WaiverPending:{label:"Waiver Pending",bg:"#FFF7ED",color:"#C2410C"},PXApproved:{label:"PX Approved",bg:"#DBEAFE",color:"#1E40AF"},ComplianceReview:{label:"Risk Review",bg:"#F3E8FF",color:"#6B21A8"},CFOReview:{label:"CFO Review",bg:tokens.rf.errorLight,color:"#991B1B"},Committed:{label:"Committed",bg:tokens.rf.successLight,color:"#065F46"},Rejected:{label:"Rejected",bg:tokens.rf.errorLight,color:"#991B1B"}},TRACKING_STATUS_CONFIG={NotStarted:{label:"Not Started",bg:tokens.rf.gray200,color:tokens.rf.gray700},PendingAPM:{label:"APM/PA",bg:tokens.rf.warningLight,color:"#92400E"},PendingPM:{label:"PM Review",bg:"#DBEAFE",color:"#1E40AF"},PendingRiskMgr:{label:"Risk Review",bg:"#F3E8FF",color:"#6B21A8"},PendingPX:{label:"PX Review",bg:"#FEF3C7",color:"#92400E"},Tracked:{label:"Tracked",bg:tokens.rf.successLight,color:"#065F46"},Rejected:{label:"Rejected",bg:tokens.rf.errorLight,color:"#991B1B"}},BuyoutLogPage=()=>{var _a,_b;const navigate=(0,router.Zp)(),{selectedProject,hasPermission,currentUser,dataService,isFeatureEnabled}=(0,AppContext.Us)(),{leads,fetchLeads}=(0,useLeads.D)(),{entries,loading,error,metrics,fetchEntries,initializeLog,addEntry,updateEntry,removeEntry}=function useBuyoutLog(){const{dataService,currentUser}=(0,AppContext.Us)(),{broadcastChange}=(0,SignalRContext.$)(),scope=useQueryScope(),queryClient=(0,QueryClientProvider.jE)(),[activeProjectCode,setActiveProjectCode]=react.useState(null),[localError,setLocalError]=react.useState(null),entriesQuery=(0,useQuery.I)(Object.assign(Object.assign({},buyoutEntriesOptions(scope,dataService,null!=activeProjectCode?activeProjectCode:"")),{enabled:!!activeProjectCode}));useSignalRQueryInvalidation({entityType:src.ckT.RiskCost,queryKeys:[qk.buyout.base(scope)]});const broadcastBuyoutChange=react.useCallback((projectCode,entityId,action,summary)=>{var _a;broadcastChange({type:"EntityChanged",entityType:src.ckT.RiskCost,entityId:String(entityId),action,changedBy:null!==(_a=null==currentUser?void 0:currentUser.email)&&void 0!==_a?_a:"unknown",changedByName:null==currentUser?void 0:currentUser.displayName,timestamp:(new Date).toISOString(),summary,projectCode})},[broadcastChange,currentUser]),initializeLogMutation=(0,useMutation.n)({mutationFn:async projectCode=>dataService.initializeBuyoutLog(projectCode),onSuccess:async(data,projectCode)=>{queryClient.setQueryData(qk.buyout.entries(scope,projectCode),data),await queryClient.invalidateQueries({queryKey:qk.buyout.entries(scope,projectCode)})}}),addEntryMutation=(0,useHbcOptimisticMutation.h)({method:"addBuyoutEntry",domainFlag:optimisticMutationFlags.G.buyout,mutationFn:async vars=>dataService.addBuyoutEntry(vars.projectCode,vars.entry),getStateKey:vars=>qk.buyout.entries(scope,vars.projectCode),applyOptimistic:(previous,vars)=>{var _a,_b,_c,_d,_e,_f,_g,_h,_j,_k,_l,_m,_o,_p,_q,_r;const now=(new Date).toISOString();return appendBuyoutEntryOptimistic(null!=previous?previous:[],Object.assign({id:-Date.now(),projectCode:vars.projectCode,divisionCode:null!==(_a=vars.entry.divisionCode)&&void 0!==_a?_a:"TEMP",divisionDescription:null!==(_b=vars.entry.divisionDescription)&&void 0!==_b?_b:"Pending",isStandard:null!==(_c=vars.entry.isStandard)&&void 0!==_c&&_c,originalBudget:null!==(_d=vars.entry.originalBudget)&&void 0!==_d?_d:0,estimatedTax:null!==(_e=vars.entry.estimatedTax)&&void 0!==_e?_e:0,totalBudget:null!==(_f=vars.entry.totalBudget)&&void 0!==_f?_f:(null!==(_g=vars.entry.originalBudget)&&void 0!==_g?_g:0)+(null!==(_h=vars.entry.estimatedTax)&&void 0!==_h?_h:0),enrolledInSDI:null!==(_j=vars.entry.enrolledInSDI)&&void 0!==_j&&_j,bondRequired:null!==(_k=vars.entry.bondRequired)&&void 0!==_k&&_k,commitmentStatus:null!==(_l=vars.entry.commitmentStatus)&&void 0!==_l?_l:"Budgeted",waiverRequired:null!==(_m=vars.entry.waiverRequired)&&void 0!==_m&&_m,approvalHistory:null!==(_o=vars.entry.approvalHistory)&&void 0!==_o?_o:[],status:null!==(_p=vars.entry.status)&&void 0!==_p?_p:"Not Started",createdDate:null!==(_q=vars.entry.createdDate)&&void 0!==_q?_q:now,modifiedDate:null!==(_r=vars.entry.modifiedDate)&&void 0!==_r?_r:now},vars.entry))},onSuccess:async(created,vars)=>{const key=qk.buyout.entries(scope,vars.projectCode);queryClient.setQueryData(key,prev=>appendBuyoutEntryOptimistic((null!=prev?prev:[]).filter(entry=>entry.id>0),created)),await queryClient.invalidateQueries({queryKey:key})}}),updateEntryMutation=(0,useHbcOptimisticMutation.h)({method:"updateBuyoutEntry",domainFlag:optimisticMutationFlags.G.buyout,mutationFn:async vars=>dataService.updateBuyoutEntry(vars.projectCode,vars.entryId,vars.data),getStateKey:vars=>qk.buyout.entries(scope,vars.projectCode),applyOptimistic:(previous,vars)=>replaceBuyoutEntryOptimistic(null!=previous?previous:[],vars.entryId,vars.data),onSuccess:async(updated,vars)=>{const key=qk.buyout.entries(scope,vars.projectCode);queryClient.setQueryData(key,prev=>replaceBuyoutEntryOptimistic(null!=prev?prev:[],vars.entryId,updated)),await queryClient.invalidateQueries({queryKey:key})}}),removeEntryMutation=(0,useHbcOptimisticMutation.h)({method:"removeBuyoutEntry",domainFlag:optimisticMutationFlags.G.buyout,mutationFn:async vars=>dataService.removeBuyoutEntry(vars.projectCode,vars.entryId),getStateKey:vars=>qk.buyout.entries(scope,vars.projectCode),applyOptimistic:(previous,vars)=>function removeBuyoutEntryOptimistic(entries,entryId){return entries.filter(entry=>entry.id!==entryId)}(null!=previous?previous:[],vars.entryId),onSuccess:async(_result,vars)=>{await queryClient.invalidateQueries({queryKey:qk.buyout.entries(scope,vars.projectCode)})}}),fetchEntries=react.useCallback(async projectCode=>{setLocalError(null),setActiveProjectCode(projectCode);try{await queryClient.fetchQuery(buyoutEntriesOptions(scope,dataService,projectCode))}catch(err){setLocalError(err instanceof Error?err.message:"Failed to load buyout entries")}},[queryClient,scope,dataService]),initializeLog=react.useCallback(async projectCode=>{setLocalError(null),setActiveProjectCode(projectCode);try{const data=await initializeLogMutation.mutateAsync(projectCode);return broadcastBuyoutChange(projectCode,projectCode,"created","Buyout log initialized"),data}catch(err){throw setLocalError(err instanceof Error?err.message:"Failed to initialize buyout log"),err}},[initializeLogMutation,broadcastBuyoutChange]),addEntry=react.useCallback(async(projectCode,entry)=>{setLocalError(null),setActiveProjectCode(projectCode);try{const created=await addEntryMutation.mutateAsync({projectCode,entry});return broadcastBuyoutChange(projectCode,created.id,"created","Buyout entry added"),created}catch(err){throw setLocalError(err instanceof Error?err.message:"Failed to add entry"),err}},[addEntryMutation,broadcastBuyoutChange]),updateEntry=react.useCallback(async(projectCode,entryId,data)=>{setLocalError(null),setActiveProjectCode(projectCode);try{const updated=await updateEntryMutation.mutateAsync({projectCode,entryId,data});return broadcastBuyoutChange(projectCode,entryId,"updated","Buyout entry updated"),updated}catch(err){throw setLocalError(err instanceof Error?err.message:"Failed to update entry"),err}},[updateEntryMutation,broadcastBuyoutChange]),removeEntry=react.useCallback(async(projectCode,entryId)=>{setLocalError(null),setActiveProjectCode(projectCode);try{await removeEntryMutation.mutateAsync({projectCode,entryId}),broadcastBuyoutChange(projectCode,entryId,"deleted","Buyout entry removed")}catch(err){throw setLocalError(err instanceof Error?err.message:"Failed to remove entry"),err}},[removeEntryMutation,broadcastBuyoutChange]),entries=react.useMemo(()=>{var _a;return null!==(_a=entriesQuery.data)&&void 0!==_a?_a:[]},[entriesQuery.data]),queryError=entriesQuery.error,error=null!=localError?localError:queryError instanceof Error?queryError.message:null,loading=entriesQuery.isFetching||initializeLogMutation.isPending||addEntryMutation.isPending||updateEntryMutation.isPending||removeEntryMutation.isPending,metrics=react.useMemo(()=>{const totalOriginalBudget=entries.reduce((sum,e)=>sum+e.originalBudget,0),awarded=entries.filter(e=>null!=e.contractValue&&e.contractValue>0),totalAwardedValue=awarded.reduce((sum,e)=>sum+(e.contractValue||0),0),totalOverUnder=awarded.reduce((sum,e)=>sum+(e.overUnder||0),0),executedCount=entries.filter(e=>"Executed"===e.status||"Awarded"===e.status).length;return{totalOriginalBudget,totalAwardedValue,totalOverUnder,procurementProgress:entries.length>0?Math.round(executedCount/entries.length*100):0,totalDivisions:entries.length,awardedDivisions:executedCount}},[entries]);return{entries,loading,error,metrics,fetchEntries,initializeLog,addEntry,updateEntry,removeEntry}}(),{submitForApproval,respondToApproval}=useCommitmentApproval(),{submitForTracking,respondToTracking,resolveTrackingChain,loading:trackingLoading}=useContractTracking(),projectCode=null!==(_a=null==selectedProject?void 0:selectedProject.projectCode)&&void 0!==_a?_a:"",[search,setSearch]=(0,usePersistedState.y)("buyout-search",""),[statusFilter,setStatusFilter]=(0,usePersistedState.y)("buyout-status","all"),[editingId,setEditingId]=react.useState(null),[editData,setEditData]=react.useState({}),[showAddForm,setShowAddForm]=react.useState(!1),[newEntry,setNewEntry]=react.useState({divisionCode:"",divisionDescription:""}),{addToast}=(0,ToastContainer.d)(),[commitmentFormEntry,setCommitmentFormEntry]=react.useState(null),[approvalDetailEntry,setApprovalDetailEntry]=react.useState(null),[trackingSubmitEntry,setTrackingSubmitEntry]=react.useState(null),[trackingDetailEntry,setTrackingDetailEntry]=react.useState(null),[trackingChain,setTrackingChain]=react.useState([]),contractTrackingEnabled=isFeatureEnabled("ContractTracking"),canEdit=hasPermission(src.JjK.BUYOUT_EDIT),canManage=hasPermission(src.JjK.BUYOUT_MANAGE),canSubmitCommitment=hasPermission(src.JjK.COMMITMENT_SUBMIT),canApprovePX=hasPermission(src.JjK.COMMITMENT_APPROVE_PX),canApproveCompliance=hasPermission(src.JjK.COMMITMENT_APPROVE_COMPLIANCE),canApproveCFO=hasPermission(src.JjK.COMMITMENT_APPROVE_CFO),canEscalate=hasPermission(src.JjK.COMMITMENT_ESCALATE),canSubmitTracking=hasPermission(src.JjK.CONTRACT_TRACKING_SUBMIT),canApproveTrackingAPM=hasPermission(src.JjK.CONTRACT_TRACKING_APPROVE_APM),canApproveTrackingPM=hasPermission(src.JjK.CONTRACT_TRACKING_APPROVE_PM),canApproveTrackingRisk=hasPermission(src.JjK.CONTRACT_TRACKING_APPROVE_RISK),canApproveTrackingPX=hasPermission(src.JjK.CONTRACT_TRACKING_APPROVE_PX);react.useEffect(()=>{fetchLeads().catch(console.error)},[fetchLeads]),react.useEffect(()=>{projectCode&&fetchEntries(projectCode).catch(console.error)},[projectCode,fetchEntries]);const project=react.useMemo(()=>{var _a;return null!==(_a=leads.find(l=>l.ProjectCode===projectCode))&&void 0!==_a?_a:null},[leads,projectCode]),filtered=react.useMemo(()=>{let list=entries;if(search){const q=search.toLowerCase();list=list.filter(e=>e.divisionCode.toLowerCase().includes(q)||e.divisionDescription.toLowerCase().includes(q)||(e.subcontractorName||"").toLowerCase().includes(q))}return"all"!==statusFilter&&(list=list.filter(e=>e.status===statusFilter)),list},[entries,search,statusFilter]),handleInitialize=async()=>{await initializeLog(projectCode),addToast("Buyout log initialized","success")},startEdit=entry=>{setEditingId(entry.id),setEditData(Object.assign({},entry))},cancelEdit=()=>{setEditingId(null),setEditData({})},saveEdit=async()=>{null!=editingId&&(await updateEntry(projectCode,editingId,editData),setEditingId(null),setEditData({}),addToast("Entry updated","success"))},handleApprovalAction=async(action,comment)=>{if(!approvalDetailEntry)return;await respondToApproval(projectCode,approvalDetailEntry.id,"reject"!==action,comment,"escalate"===action),await fetchEntries(projectCode),setApprovalDetailEntry(null);addToast("approve"===action?"Commitment approved":"reject"===action?"Commitment rejected":"Escalated to CFO","reject"===action?"warning":"success")};return loading&&0===entries.length?(0,jsx_runtime.jsx)(SkeletonLoader.j,{variant:"table",rows:8,columns:6}):error?(0,jsx_runtime.jsx)("div",{style:{padding:48,textAlign:"center",color:tokens.rf.error},children:error}):0===entries.length?(0,jsx_runtime.jsxs)("div",{style:{padding:48,textAlign:"center"},children:[(0,jsx_runtime.jsx)("h2",{style:{color:tokens.rf.navy,marginBottom:8},children:"Buyout Log"}),(0,jsx_runtime.jsx)("p",{style:{color:tokens.rf.gray500,marginBottom:24},children:"No buyout log has been created for this project yet."}),canManage&&(0,jsx_runtime.jsx)("button",{onClick:handleInitialize,style:BuyoutLogPage_btnPrimary,children:"Initialize Buyout Log"})]}):(0,jsx_runtime.jsxs)("div",{style:{padding:"0 0 32px"},children:[(0,jsx_runtime.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24},children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h2",{style:{margin:0,color:tokens.rf.navy},children:"Buyout Log"}),(0,jsx_runtime.jsxs)("p",{style:{margin:"4px 0 0",fontSize:13,color:tokens.rf.gray500},children:[null!==(_b=null==project?void 0:project.Title)&&void 0!==_b?_b:projectCode," â€” Budget vs. Actual Tracking"]})]}),canManage&&(0,jsx_runtime.jsx)("button",{onClick:()=>setShowAddForm(!0),style:BuyoutLogPage_btnPrimary,children:"+ Add Division"})]}),(0,jsx_runtime.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:16,marginBottom:24},children:[(0,jsx_runtime.jsx)(MetricCard,{label:"Total Original Budget",value:BuyoutLogPage_fmt(metrics.totalOriginalBudget),color:"#3B82F6"}),(0,jsx_runtime.jsx)(MetricCard,{label:"Total Awarded Value",value:BuyoutLogPage_fmt(metrics.totalAwardedValue),color:"#8B5CF6"}),(0,jsx_runtime.jsx)(MetricCard,{label:"Total Over / Under",value:`${metrics.totalOverUnder>=0?"+":""}${BuyoutLogPage_fmt(metrics.totalOverUnder)}`,color:metrics.totalOverUnder>=0?tokens.rf.success:tokens.rf.error,subtitle:metrics.totalOverUnder>=0?"Under Budget (Savings)":"Over Budget"}),(0,jsx_runtime.jsx)(MetricCard,{label:"Procurement Progress",value:`${metrics.procurementProgress}%`,color:tokens.rf.orange,subtitle:`${metrics.awardedDivisions} of ${metrics.totalDivisions} divisions`})]}),(0,jsx_runtime.jsxs)("div",{style:{display:"flex",gap:12,marginBottom:16},children:[(0,jsx_runtime.jsx)("input",{type:"text",placeholder:"Search divisions or subcontractors...",value:search,onChange:e=>setSearch(e.target.value),style:Object.assign(Object.assign({},BuyoutLogPage_inputStyle),{flex:1})}),(0,jsx_runtime.jsxs)("select",{value:statusFilter,onChange:e=>setStatusFilter(e.target.value),style:Object.assign(Object.assign({},BuyoutLogPage_inputStyle),{width:180}),children:[(0,jsx_runtime.jsx)("option",{value:"all",children:"All Statuses"}),STATUS_OPTIONS.map(s=>(0,jsx_runtime.jsx)("option",{value:s,children:s},s))]})]}),showAddForm&&(0,jsx_runtime.jsxs)("div",{style:Object.assign(Object.assign({},BuyoutLogPage_cardStyle),{marginBottom:16,padding:16,display:"flex",gap:12,alignItems:"flex-end"}),children:[(0,jsx_runtime.jsxs)("div",{style:{flex:1},children:[(0,jsx_runtime.jsx)("label",{style:BuyoutLogPage_labelStyle,children:"Division Code"}),(0,jsx_runtime.jsx)("input",{style:BuyoutLogPage_inputStyle,placeholder:"e.g. 09-300",value:newEntry.divisionCode||"",onChange:e=>setNewEntry(p=>Object.assign(Object.assign({},p),{divisionCode:e.target.value}))})]}),(0,jsx_runtime.jsxs)("div",{style:{flex:2},children:[(0,jsx_runtime.jsx)("label",{style:BuyoutLogPage_labelStyle,children:"Description"}),(0,jsx_runtime.jsx)("input",{style:BuyoutLogPage_inputStyle,placeholder:"e.g. Tile Work",value:newEntry.divisionDescription||"",onChange:e=>setNewEntry(p=>Object.assign(Object.assign({},p),{divisionDescription:e.target.value}))})]}),(0,jsx_runtime.jsx)("button",{onClick:async()=>{newEntry.divisionCode&&newEntry.divisionDescription&&(await addEntry(projectCode,Object.assign(Object.assign({},newEntry),{isStandard:!1})),setNewEntry({divisionCode:"",divisionDescription:""}),setShowAddForm(!1),addToast("Custom division added","success"))},style:BuyoutLogPage_btnPrimary,children:"Add"}),(0,jsx_runtime.jsx)("button",{onClick:()=>setShowAddForm(!1),style:BuyoutLogPage_btnOutline,children:"Cancel"})]}),(0,jsx_runtime.jsxs)("div",{style:Object.assign(Object.assign({},BuyoutLogPage_cardStyle),{overflow:"auto"}),children:[(0,jsx_runtime.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:[(0,jsx_runtime.jsx)("thead",{children:(0,jsx_runtime.jsxs)("tr",{style:{backgroundColor:tokens.rf.gray50,borderBottom:`2px solid ${tokens.rf.gray200}`},children:[(0,jsx_runtime.jsx)(Th,{children:"Division"}),(0,jsx_runtime.jsx)(Th,{children:"Commitment #"}),(0,jsx_runtime.jsx)(Th,{children:"Description"}),(0,jsx_runtime.jsx)(Th,{align:"right",children:"Original Budget"}),(0,jsx_runtime.jsx)(Th,{align:"right",children:"Est. Tax"}),(0,jsx_runtime.jsx)(Th,{align:"right",children:"Total Budget"}),(0,jsx_runtime.jsx)(Th,{children:"Subcontractor"}),(0,jsx_runtime.jsx)(Th,{align:"right",children:"Contract Value"}),(0,jsx_runtime.jsx)(Th,{align:"right",children:"Over / Under"}),(0,jsx_runtime.jsx)(Th,{align:"center",children:"SDI"}),(0,jsx_runtime.jsx)(Th,{align:"center",children:"Bond"}),(0,jsx_runtime.jsx)(Th,{children:"LOI Sent"}),(0,jsx_runtime.jsx)(Th,{children:"LOI Returned"}),(0,jsx_runtime.jsx)(Th,{children:"Contract Sent"}),(0,jsx_runtime.jsx)(Th,{children:"Contract Exec."}),(0,jsx_runtime.jsx)(Th,{children:"COI Received"}),(0,jsx_runtime.jsx)(Th,{children:"Status"}),(0,jsx_runtime.jsx)(Th,{children:"Commitment"}),contractTrackingEnabled&&(0,jsx_runtime.jsx)(Th,{children:"Tracking"}),canEdit&&(0,jsx_runtime.jsx)(Th,{align:"center",children:"Actions"})]})}),(0,jsx_runtime.jsx)("tbody",{children:filtered.map(entry=>{var _a,_b,_c,_d;const isEditing=editingId===entry.id,row=isEditing?editData:entry,overUnder=row.overUnder,overUnderColor=null==overUnder?tokens.rf.gray400:overUnder>=0?tokens.rf.success:tokens.rf.error;return(0,jsx_runtime.jsxs)("tr",{style:{borderBottom:`1px solid ${tokens.rf.gray200}`},onDoubleClick:()=>canEdit&&!isEditing&&startEdit(entry),children:[(0,jsx_runtime.jsx)(Td,{children:entry.divisionCode}),(0,jsx_runtime.jsx)(Td,{children:(0,jsx_runtime.jsx)("span",{onClick:()=>navigate("/operations/contract-tracking"),style:{color:tokens.rf.navy,cursor:"pointer",textDecoration:"none",fontWeight:500},onMouseEnter:e=>{e.target.style.textDecoration="underline"},onMouseLeave:e=>{e.target.style.textDecoration="none"},children:`CMT-${entry.divisionCode}`})}),(0,jsx_runtime.jsx)(Td,{children:entry.divisionDescription}),(0,jsx_runtime.jsx)(Td,{align:"right",children:isEditing?(0,jsx_runtime.jsx)("input",{type:"number",style:Object.assign(Object.assign({},inlineInput),{width:100,textAlign:"right"}),value:null!==(_a=row.originalBudget)&&void 0!==_a?_a:0,onChange:e=>setEditData(p=>Object.assign(Object.assign({},p),{originalBudget:Number(e.target.value)}))}):BuyoutLogPage_fmt(entry.originalBudget)}),(0,jsx_runtime.jsx)(Td,{align:"right",children:isEditing?(0,jsx_runtime.jsx)("input",{type:"number",style:Object.assign(Object.assign({},inlineInput),{width:80,textAlign:"right"}),value:null!==(_b=row.estimatedTax)&&void 0!==_b?_b:0,onChange:e=>setEditData(p=>Object.assign(Object.assign({},p),{estimatedTax:Number(e.target.value)}))}):BuyoutLogPage_fmt(entry.estimatedTax)}),(0,jsx_runtime.jsx)(Td,{align:"right",bold:!0,children:BuyoutLogPage_fmt(isEditing?(row.originalBudget||0)+(row.estimatedTax||0):entry.totalBudget)}),(0,jsx_runtime.jsx)(Td,{children:isEditing?(0,jsx_runtime.jsx)("input",{style:Object.assign(Object.assign({},inlineInput),{width:150}),value:null!==(_c=row.subcontractorName)&&void 0!==_c?_c:"",onChange:e=>setEditData(p=>Object.assign(Object.assign({},p),{subcontractorName:e.target.value}))}):entry.subcontractorName||"â€”"}),(0,jsx_runtime.jsx)(Td,{align:"right",children:isEditing?(0,jsx_runtime.jsx)("input",{type:"number",style:Object.assign(Object.assign({},inlineInput),{width:100,textAlign:"right"}),value:null!==(_d=row.contractValue)&&void 0!==_d?_d:"",onChange:e=>{const val=e.target.value?Number(e.target.value):void 0;setEditData(p=>{const tb=(p.originalBudget||0)+(p.estimatedTax||0);return Object.assign(Object.assign({},p),{contractValue:val,overUnder:null!=val?tb-val:void 0})})}}):null!=entry.contractValue?BuyoutLogPage_fmt(entry.contractValue):"â€”"}),(0,jsx_runtime.jsx)(Td,{align:"right",children:(0,jsx_runtime.jsx)("span",{style:{color:overUnderColor,fontWeight:600},children:null!=overUnder?`${overUnder>=0?"+":""}${BuyoutLogPage_fmt(overUnder)}`:"â€”"})}),(0,jsx_runtime.jsx)(Td,{align:"center",children:isEditing?(0,jsx_runtime.jsx)("input",{type:"checkbox",checked:!!row.enrolledInSDI,onChange:e=>setEditData(p=>Object.assign(Object.assign({},p),{enrolledInSDI:e.target.checked}))}):(0,jsx_runtime.jsx)("span",{style:{color:entry.enrolledInSDI?tokens.rf.success:tokens.rf.gray400},children:entry.enrolledInSDI?"Yes":"No"})}),(0,jsx_runtime.jsx)(Td,{align:"center",children:isEditing?(0,jsx_runtime.jsx)("input",{type:"checkbox",checked:!!row.bondRequired,onChange:e=>setEditData(p=>Object.assign(Object.assign({},p),{bondRequired:e.target.checked}))}):(0,jsx_runtime.jsx)("span",{style:{color:entry.bondRequired?tokens.rf.warning:tokens.rf.gray400},children:entry.bondRequired?"Yes":"No"})}),(0,jsx_runtime.jsx)(DateCell,{isEditing,value:isEditing?row.loiSentDate:entry.loiSentDate,onChange:v=>setEditData(p=>Object.assign(Object.assign({},p),{loiSentDate:v}))}),(0,jsx_runtime.jsx)(DateCell,{isEditing,value:isEditing?row.loiReturnedDate:entry.loiReturnedDate,onChange:v=>setEditData(p=>Object.assign(Object.assign({},p),{loiReturnedDate:v}))}),(0,jsx_runtime.jsx)(DateCell,{isEditing,value:isEditing?row.contractSentDate:entry.contractSentDate,onChange:v=>setEditData(p=>Object.assign(Object.assign({},p),{contractSentDate:v}))}),(0,jsx_runtime.jsx)(DateCell,{isEditing,value:isEditing?row.contractExecutedDate:entry.contractExecutedDate,onChange:v=>setEditData(p=>Object.assign(Object.assign({},p),{contractExecutedDate:v}))}),(0,jsx_runtime.jsx)(DateCell,{isEditing,value:isEditing?row.insuranceCOIReceivedDate:entry.insuranceCOIReceivedDate,onChange:v=>setEditData(p=>Object.assign(Object.assign({},p),{insuranceCOIReceivedDate:v}))}),(0,jsx_runtime.jsx)(Td,{children:isEditing?(0,jsx_runtime.jsx)("select",{style:inlineInput,value:row.status,onChange:e=>setEditData(p=>Object.assign(Object.assign({},p),{status:e.target.value})),children:STATUS_OPTIONS.map(s=>(0,jsx_runtime.jsx)("option",{value:s,children:s},s))}):(0,jsx_runtime.jsx)("span",{style:{display:"inline-block",padding:"2px 8px",borderRadius:12,fontSize:11,fontWeight:600,color:"#fff",backgroundColor:statusColor(entry.status)},children:entry.status})}),(0,jsx_runtime.jsx)(Td,{children:(()=>{const cs=entry.commitmentStatus||"Budgeted",cfg=COMMITMENT_STATUS_CONFIG[cs]||COMMITMENT_STATUS_CONFIG.Budgeted;return(0,jsx_runtime.jsx)("span",{onClick:()=>"Budgeted"!==cs?setApprovalDetailEntry(entry):void 0,style:{display:"inline-block",padding:"2px 8px",borderRadius:12,fontSize:10,fontWeight:700,backgroundColor:cfg.bg,color:cfg.color,cursor:"Budgeted"!==cs?"pointer":"default",textDecoration:"Rejected"===cs?"line-through":"none"},children:cfg.label})})()}),contractTrackingEnabled&&(0,jsx_runtime.jsx)(Td,{children:(()=>{const ts=entry.contractTrackingStatus||"NotStarted",tcfg=TRACKING_STATUS_CONFIG[ts]||TRACKING_STATUS_CONFIG.NotStarted,isClickable="NotStarted"!==ts;return(0,jsx_runtime.jsx)("span",{onClick:()=>isClickable?setTrackingDetailEntry(entry):void 0,style:{display:"inline-block",padding:"2px 8px",borderRadius:12,fontSize:10,fontWeight:700,backgroundColor:tcfg.bg,color:tcfg.color,cursor:isClickable?"pointer":"default",textDecoration:"Rejected"===ts?"line-through":"none"},children:tcfg.label})})()}),canEdit&&(0,jsx_runtime.jsx)(Td,{align:"center",children:isEditing?(0,jsx_runtime.jsxs)("span",{style:{display:"flex",gap:4,justifyContent:"center"},children:[(0,jsx_runtime.jsx)("button",{onClick:saveEdit,style:btnSmallPrimary,children:"Save"}),(0,jsx_runtime.jsx)("button",{onClick:cancelEdit,style:btnSmallOutline,children:"Cancel"})]}):(0,jsx_runtime.jsxs)("span",{style:{display:"flex",gap:4,justifyContent:"center",flexWrap:"wrap"},children:[(0,jsx_runtime.jsx)("button",{onClick:()=>startEdit(entry),style:btnSmallOutline,children:"Edit"}),canSubmitCommitment&&("Budgeted"===entry.commitmentStatus||void 0===entry.commitmentStatus)&&null!=entry.contractValue&&entry.contractValue>0&&(0,jsx_runtime.jsx)("button",{onClick:()=>setCommitmentFormEntry(entry),style:btnSmallCommit,children:"Submit"}),contractTrackingEnabled&&canSubmitTracking&&"Committed"===entry.commitmentStatus&&(!entry.contractTrackingStatus||"NotStarted"===entry.contractTrackingStatus)&&(0,jsx_runtime.jsx)("button",{onClick:()=>(async entry=>{setTrackingSubmitEntry(entry);try{const chain=await resolveTrackingChain(projectCode);setTrackingChain(chain)}catch(_a){setTrackingChain([])}})(entry),style:btnSmallTrack,children:"Track"}),canManage&&!entry.isStandard&&(0,jsx_runtime.jsx)("button",{onClick:()=>(async entry=>{confirm(`Remove "${entry.divisionCode} - ${entry.divisionDescription}"?`)&&(await removeEntry(projectCode,entry.id),addToast("Division removed","success"))})(entry),style:btnSmallDanger,children:"Del"})]})})]},entry.id)})})]}),0===filtered.length&&(0,jsx_runtime.jsx)("div",{style:{padding:32,textAlign:"center",color:tokens.rf.gray400},children:"No divisions match your filter."})]}),commitmentFormEntry&&(0,jsx_runtime.jsx)("div",{style:modalOverlay,onClick:()=>setCommitmentFormEntry(null),children:(0,jsx_runtime.jsx)("div",{style:modalContent,onClick:e=>e.stopPropagation(),children:(0,jsx_runtime.jsx)(CommitmentForm,{entry:commitmentFormEntry,onSubmit:async(data,file)=>{var _a;if(!commitmentFormEntry)return;if(file)try{const result=await dataService.uploadCommitmentDocument(projectCode,commitmentFormEntry.id,file);data.compiledCommitmentPdfUrl=result.fileUrl,data.compiledCommitmentFileId=result.fileId,data.compiledCommitmentFileName=result.fileName}catch(err){console.error("File upload failed:",err)}await updateEntry(projectCode,commitmentFormEntry.id,data);const updated=await submitForApproval(projectCode,commitmentFormEntry.id,null!==(_a=null==currentUser?void 0:currentUser.displayName)&&void 0!==_a?_a:"Unknown");await fetchEntries(projectCode),setCommitmentFormEntry(null),addToast(updated.waiverRequired?"Commitment submitted â€” waiver required":"Commitment submitted for review","success")},onCancel:()=>setCommitmentFormEntry(null)})})}),approvalDetailEntry&&(0,jsx_runtime.jsx)("div",{style:modalOverlay,onClick:()=>setApprovalDetailEntry(null),children:(0,jsx_runtime.jsxs)("div",{style:modalContent,onClick:e=>e.stopPropagation(),children:[(0,jsx_runtime.jsxs)("h3",{style:{margin:"0 0 16px",fontSize:16,fontWeight:700,color:tokens.rf.navy},children:["Commitment Details: ",approvalDetailEntry.divisionDescription]}),(0,jsx_runtime.jsx)(CommitmentApprovalPanel,{entry:approvalDetailEntry,canApprovePX,canApproveCompliance,canApproveCFO,canEscalate,onApprove:comment=>handleApprovalAction("approve",comment),onReject:comment=>handleApprovalAction("reject",comment),onEscalate:comment=>handleApprovalAction("escalate",comment)}),(0,jsx_runtime.jsx)("div",{style:{marginTop:16,textAlign:"right"},children:(0,jsx_runtime.jsx)("button",{onClick:()=>setApprovalDetailEntry(null),style:BuyoutLogPage_btnOutline,children:"Close"})})]})}),trackingSubmitEntry&&(0,jsx_runtime.jsx)("div",{style:modalOverlay,onClick:()=>setTrackingSubmitEntry(null),children:(0,jsx_runtime.jsx)("div",{style:modalContent,onClick:e=>e.stopPropagation(),children:(0,jsx_runtime.jsx)(ContractTrackingSubmitModal,{entry:trackingSubmitEntry,resolvedChain:trackingChain,loading:trackingLoading,onSubmit:async()=>{var _a;trackingSubmitEntry&&(await submitForTracking(projectCode,trackingSubmitEntry.id,null!==(_a=null==currentUser?void 0:currentUser.displayName)&&void 0!==_a?_a:"Unknown"),await fetchEntries(projectCode),isFeatureEnabled("ContractTrackingDevPreview")||setTrackingSubmitEntry(null),addToast("Submitted for contract tracking","success"))},onClose:()=>setTrackingSubmitEntry(null)})})}),trackingDetailEntry&&(0,jsx_runtime.jsx)("div",{style:modalOverlay,onClick:()=>setTrackingDetailEntry(null),children:(0,jsx_runtime.jsxs)("div",{style:modalContent,onClick:e=>e.stopPropagation(),children:[(0,jsx_runtime.jsxs)("h3",{style:{margin:"0 0 16px",fontSize:16,fontWeight:700,color:tokens.rf.navy},children:["Contract Tracking: ",trackingDetailEntry.divisionDescription]}),(0,jsx_runtime.jsx)(ContractTrackingPanel,{entry:trackingDetailEntry,canApproveAPM:canApproveTrackingAPM,canApprovePM:canApproveTrackingPM,canApproveRisk:canApproveTrackingRisk,canApprovePX:canApproveTrackingPX,onApprove:async comment=>{trackingDetailEntry&&(await respondToTracking(projectCode,trackingDetailEntry.id,!0,comment),await fetchEntries(projectCode),setTrackingDetailEntry(null),addToast("Contract tracking step approved","success"))},onReject:async comment=>{trackingDetailEntry&&(await respondToTracking(projectCode,trackingDetailEntry.id,!1,comment),await fetchEntries(projectCode),setTrackingDetailEntry(null),addToast("Contract tracking rejected","warning"))}}),(0,jsx_runtime.jsx)("div",{style:{marginTop:16,textAlign:"right"},children:(0,jsx_runtime.jsx)("button",{onClick:()=>setTrackingDetailEntry(null),style:BuyoutLogPage_btnOutline,children:"Close"})})]})})]})},MetricCard=({label,value,color,subtitle})=>(0,jsx_runtime.jsxs)("div",{style:Object.assign(Object.assign(Object.assign({},BuyoutLogPage_cardStyle),{padding:20}),tokens.EP.style(color)),children:[(0,jsx_runtime.jsx)("div",{style:{fontSize:12,fontWeight:500,color:tokens.rf.gray500,marginBottom:4},children:label}),(0,jsx_runtime.jsx)("div",{style:{fontSize:22,fontWeight:700,color},children:value}),subtitle&&(0,jsx_runtime.jsx)("div",{style:{fontSize:11,color:tokens.rf.gray400,marginTop:2},children:subtitle})]}),Th=({children,align})=>(0,jsx_runtime.jsx)("th",{style:{padding:"10px 8px",textAlign:align||"left",fontWeight:600,fontSize:11,color:tokens.rf.gray600,textTransform:"uppercase",letterSpacing:"0.3px",whiteSpace:"nowrap"},children}),Td=({children,align,bold})=>(0,jsx_runtime.jsx)("td",{style:{padding:"8px 8px",textAlign:align||"left",fontWeight:bold?600:400,whiteSpace:"nowrap",verticalAlign:"middle"},children}),DateCell=({isEditing,value,onChange})=>(0,jsx_runtime.jsx)("td",{style:{padding:"8px 8px",whiteSpace:"nowrap",verticalAlign:"middle"},children:isEditing?(0,jsx_runtime.jsx)("input",{type:"date",style:Object.assign(Object.assign({},inlineInput),{width:120}),value:value||"",onChange:e=>onChange(e.target.value)}):(0,jsx_runtime.jsx)("span",{style:{fontSize:12,color:value?tokens.rf.gray700:tokens.rf.gray300},children:value||"â€”"})}),BuyoutLogPage_cardStyle={backgroundColor:"#fff",borderRadius:8,border:`1px solid ${tokens.rf.gray200}`,boxShadow:tokens.sp.level1},BuyoutLogPage_inputStyle={padding:"8px 12px",border:`1px solid ${tokens.rf.gray300}`,borderRadius:6,fontSize:14,outline:"none",width:"100%",boxSizing:"border-box"},inlineInput={padding:"4px 6px",border:`1px solid ${tokens.rf.gray300}`,borderRadius:4,fontSize:12,outline:"none",boxSizing:"border-box"},BuyoutLogPage_labelStyle={display:"block",fontSize:12,fontWeight:600,color:tokens.rf.gray600,marginBottom:4},BuyoutLogPage_btnPrimary={padding:"8px 20px",backgroundColor:tokens.rf.orange,color:"#fff",border:"none",borderRadius:6,fontWeight:600,fontSize:14,cursor:"pointer"},BuyoutLogPage_btnOutline={padding:"8px 20px",backgroundColor:"#fff",color:tokens.rf.gray600,border:`1px solid ${tokens.rf.gray300}`,borderRadius:6,fontWeight:500,fontSize:14,cursor:"pointer"},btnSmallPrimary={padding:"3px 10px",backgroundColor:tokens.rf.orange,color:"#fff",border:"none",borderRadius:4,fontWeight:600,fontSize:11,cursor:"pointer"},btnSmallOutline={padding:"3px 10px",backgroundColor:"#fff",color:tokens.rf.gray600,border:`1px solid ${tokens.rf.gray300}`,borderRadius:4,fontWeight:500,fontSize:11,cursor:"pointer"},btnSmallDanger={padding:"3px 10px",backgroundColor:tokens.rf.errorLight,color:tokens.rf.error,border:`1px solid ${tokens.rf.error}`,borderRadius:4,fontWeight:600,fontSize:11,cursor:"pointer"},btnSmallCommit={padding:"3px 10px",backgroundColor:tokens.rf.navy,color:"#fff",border:"none",borderRadius:4,fontWeight:600,fontSize:11,cursor:"pointer"},btnSmallTrack={padding:"3px 10px",backgroundColor:"#6B21A8",color:"#fff",border:"none",borderRadius:4,fontWeight:600,fontSize:11,cursor:"pointer"},modalOverlay={position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:2e3,display:"flex",alignItems:"center",justifyContent:"center"},modalContent={backgroundColor:"#fff",borderRadius:12,padding:24,maxWidth:640,width:"90%",maxHeight:"85vh",overflow:"auto",boxShadow:tokens.sp.level4};try{BuyoutLogPage.displayName="BuyoutLogPage",BuyoutLogPage.__docgenInfo={description:"",displayName:"BuyoutLogPage",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/webparts/hbcProjectControls/components/pages/project/BuyoutLogPage.tsx#BuyoutLogPage"]={docgenInfo:BuyoutLogPage.__docgenInfo,name:"BuyoutLogPage",path:"src/webparts/hbcProjectControls/components/pages/project/BuyoutLogPage.tsx#BuyoutLogPage"})}catch(__react_docgen_typescript_loader_error){}const BuyoutLogPage_stories={title:"Pages/BuyoutLogPage",component:BuyoutLogPage,tags:["autodocs"],parameters:{layout:"fullscreen",initialRoute:"/operations/buyout-log"}},Default={},__namedExportsOrder=["Default"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"{}",...Default.parameters?.docs?.source}}}},"./src/webparts/hbcProjectControls/components/hooks/usePersistedState.ts"(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{y:()=>usePersistedState});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js");function usePersistedState(key,defaultValue){const[state,setState]=react__WEBPACK_IMPORTED_MODULE_0__.useState(()=>function readStorage(key,defaultValue){try{const raw=sessionStorage.getItem(`hbc-persist-${key}`);return null!==raw?JSON.parse(raw):defaultValue}catch(_a){return defaultValue}}(key,defaultValue));return react__WEBPACK_IMPORTED_MODULE_0__.useEffect(()=>{!function writeStorage(key,value){try{sessionStorage.setItem(`hbc-persist-${key}`,JSON.stringify(value))}catch(_a){}}(key,state)},[key,state]),[state,setState]}},"./src/webparts/hbcProjectControls/components/shared/SkeletonLoader.tsx"(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{j:()=>SkeletonLoader});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/jsx-runtime.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/index.js"),_theme_tokens__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/webparts/hbcProjectControls/theme/tokens.ts");const barStyle={background:`linear-gradient(90deg, ${_theme_tokens__WEBPACK_IMPORTED_MODULE_2__.rf.gray100} 25%, ${_theme_tokens__WEBPACK_IMPORTED_MODULE_2__.rf.gray200} 50%, ${_theme_tokens__WEBPACK_IMPORTED_MODULE_2__.rf.gray100} 75%)`,backgroundSize:"800px 100%",animation:"hbc-shimmer 1.5s infinite linear",borderRadius:"4px"},SkeletonBar=({width="100%",height="14px",style:extra})=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"hbc-skeleton-bar",style:Object.assign(Object.assign(Object.assign({},barStyle),{width,height}),extra)});function TableSkeleton({rows=5,columns=5}){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{style:{backgroundColor:"#fff",borderRadius:"8px",padding:"16px",overflow:"hidden"},children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{style:{display:"flex",gap:"16px",marginBottom:"16px",paddingBottom:"12px",borderBottom:`2px solid ${_theme_tokens__WEBPACK_IMPORTED_MODULE_2__.rf.gray200}`},children:Array.from({length:columns}).map((_,i)=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(SkeletonBar,{width:0===i?"30%":`${Math.floor(70/(columns-1))}%`,height:"12px"},i))}),Array.from({length:rows}).map((_,r)=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{style:{display:"flex",gap:"16px",padding:"10px 0",borderBottom:`1px solid ${_theme_tokens__WEBPACK_IMPORTED_MODULE_2__.rf.gray100}`},children:Array.from({length:columns}).map((_,i)=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(SkeletonBar,{width:0===i?"30%":`${Math.floor(70/(columns-1))}%`,height:"14px"},i))},r))]})}function KPIGridSkeleton({columns=4}){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{style:{display:"grid",gridTemplateColumns:`repeat(${columns}, 1fr)`,gap:"16px"},children:Array.from({length:columns}).map((_,i)=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{style:{backgroundColor:"#fff",borderRadius:"8px",padding:"20px"},children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(SkeletonBar,{width:"60%",height:"12px"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(SkeletonBar,{width:"40%",height:"28px",style:{marginTop:"12px"}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(SkeletonBar,{width:"50%",height:"10px",style:{marginTop:"8px"}})]},i))})}function FormSkeleton({rows=6}){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{style:{backgroundColor:"#fff",borderRadius:"8px",padding:"24px"},children:Array.from({length:rows}).map((_,i)=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(SkeletonBar,{width:"120px",height:"12px",style:{marginBottom:"8px"}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(SkeletonBar,{width:"100%",height:"36px"})]},i))})}function CardSkeleton(){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{style:{backgroundColor:"#fff",borderRadius:"8px",padding:"20px"},children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(SkeletonBar,{width:"70%",height:"16px"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(SkeletonBar,{width:"100%",height:"14px",style:{marginTop:"12px"}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(SkeletonBar,{width:"90%",height:"14px",style:{marginTop:"8px"}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(SkeletonBar,{width:"40%",height:"14px",style:{marginTop:"8px"}})]})}function TextSkeleton({rows=3}){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{children:Array.from({length:rows}).map((_,i)=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(SkeletonBar,{width:i===rows-1?"60%":"100%",height:"14px",style:{marginBottom:"10px"}},i))})}const SkeletonLoader=({variant,rows,columns,style})=>{react__WEBPACK_IMPORTED_MODULE_1__.useEffect(()=>{!function ensureShimmerStyles(){if("undefined"==typeof document)return;if(document.getElementById("hbc-skeleton-shimmer"))return;const style=document.createElement("style");style.id="hbc-skeleton-shimmer",style.textContent="\n    @keyframes hbc-shimmer {\n      0% { background-position: -400px 0; }\n      100% { background-position: 400px 0; }\n    }\n    @media (prefers-reduced-motion: reduce) {\n      .hbc-skeleton-bar {\n        animation: none !important;\n      }\n    }\n  ",document.head.appendChild(style)}()},[]);const content=(()=>{switch(variant){case"table":default:return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(TableSkeleton,{rows,columns});case"kpi-grid":return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(KPIGridSkeleton,{columns});case"form":return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(FormSkeleton,{rows});case"card":return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(CardSkeleton,{});case"text":return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(TextSkeleton,{rows})}})();return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{style,children:content})};try{SkeletonLoader.displayName="SkeletonLoader",SkeletonLoader.__docgenInfo={description:"",displayName:"SkeletonLoader",props:{variant:{defaultValue:null,description:"",name:"variant",required:!0,type:{name:"enum",value:[{value:'"table"'},{value:'"kpi-grid"'},{value:'"form"'},{value:'"card"'},{value:'"text"'}]}},rows:{defaultValue:null,description:"",name:"rows",required:!1,type:{name:"number"}},columns:{defaultValue:null,description:"",name:"columns",required:!1,type:{name:"number"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/webparts/hbcProjectControls/components/shared/SkeletonLoader.tsx#SkeletonLoader"]={docgenInfo:SkeletonLoader.__docgenInfo,name:"SkeletonLoader",path:"src/webparts/hbcProjectControls/components/shared/SkeletonLoader.tsx#SkeletonLoader"})}catch(__react_docgen_typescript_loader_error){}}}]);